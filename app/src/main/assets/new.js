
	define("game.js", function(require, module, exports){ 			
!function(e){function t(n){if(i[n])return i[n].exports;var r=i[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var i={};t.m=e,t.c=i,t.i=function(e){return e},t.d=function(e,i,n){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/",t(t.s=42)}([function(e,t,i){"use strict";var n,r,o,a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(i,s){"object"===a(t)&&void 0!==e?s(t):(r=[t],n=s,void 0!==(o="function"==typeof n?n.apply(t,r):n)&&(e.exports=o))}(0,function(e){function t(){}function i(e,t){this.x=e||0,this.y=t||0}function n(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function r(e,t,i,n){this._x=e||0,this._y=t||0,this._z=i||0,this._w=void 0!==n?n:1}function o(e,t,i){this.x=e||0,this.y=t||0,this.z=i||0}function s(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}function l(e,t,n,r,o,a,c,h,u,d){Object.defineProperty(this,"id",{value:Jo++}),this.uuid=Zo.generateUUID(),this.name="",this.image=void 0!==e?e:l.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:l.DEFAULT_MAPPING,this.wrapS=void 0!==n?n:Qr,this.wrapT=void 0!==r?r:Qr,this.magFilter=void 0!==o?o:no,this.minFilter=void 0!==a?a:oo,this.anisotropy=void 0!==u?u:1,this.format=void 0!==c?c:xo,this.type=void 0!==h?h:ao,this.offset=new i(0,0),this.repeat=new i(1,1),this.center=new i(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new s,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==d?d:Fo,this.version=0,this.onUpdate=null}function c(e,t,i,n){this.x=e||0,this.y=t||0,this.z=i||0,this.w=void 0!==n?n:1}function h(e,t,i){this.uuid=Zo.generateUUID(),this.width=e,this.height=t,this.scissor=new c(0,0,e,t),this.scissorTest=!1,this.viewport=new c(0,0,e,t),void 0===(i=i||{}).minFilter&&(i.minFilter=no),this.texture=new l(void 0,void 0,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0===i.stencilBuffer||i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null}function u(e,t,i){h.call(this,e,t,i),this.activeCubeFace=0,this.activeMipMapLevel=0}function d(e,t,i,n,r,o,a,s,c,h,u,d){l.call(this,null,o,a,s,c,h,n,r,u,d),this.image={data:e,width:t,height:i},this.magFilter=void 0!==c?c:eo,this.minFilter=void 0!==h?h:eo,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}function f(e,t,i,n,r,o,a,s,c,h){l.call(this,e=void 0!==e?e:[],t=void 0!==t?t:Vr,i,n,r,o,a,s,c,h),this.flipY=!1}function p(){this.seq=[],this.map={}}function m(e,t,i){var n=e[0];if(n<=0||n>0)return e;var r=t*i,o=ea[r];if(void 0===o&&(o=new Float32Array(r),ea[r]=o),0!==t){n.toArray(o,0);for(var a=1,s=0;a!==t;++a)s+=i,e[a].toArray(o,s)}return o}function g(e,t){var i=ta[t];void 0===i&&(i=new Int32Array(t),ta[t]=i);for(var n=0;n!==t;++n)i[n]=e.allocTextureUnit();return i}function v(e,t){e.uniform1f(this.addr,t)}function y(e,t){e.uniform1i(this.addr,t)}function b(e,t){void 0===t.x?e.uniform2fv(this.addr,t):e.uniform2f(this.addr,t.x,t.y)}function w(e,t){void 0!==t.x?e.uniform3f(this.addr,t.x,t.y,t.z):void 0!==t.r?e.uniform3f(this.addr,t.r,t.g,t.b):e.uniform3fv(this.addr,t)}function x(e,t){void 0===t.x?e.uniform4fv(this.addr,t):e.uniform4f(this.addr,t.x,t.y,t.z,t.w)}function _(e,t){e.uniformMatrix2fv(this.addr,!1,t.elements||t)}function M(e,t){void 0===t.elements?e.uniformMatrix3fv(this.addr,!1,t):(na.set(t.elements),e.uniformMatrix3fv(this.addr,!1,na))}function T(e,t){void 0===t.elements?e.uniformMatrix4fv(this.addr,!1,t):(ia.set(t.elements),e.uniformMatrix4fv(this.addr,!1,ia))}function S(e,t,i){var n=i.allocTextureUnit();e.uniform1i(this.addr,n),i.setTexture2D(t||Qo,n)}function E(e,t,i){var n=i.allocTextureUnit();e.uniform1i(this.addr,n),i.setTextureCube(t||$o,n)}function C(e,t){e.uniform2iv(this.addr,t)}function P(e,t){e.uniform3iv(this.addr,t)}function L(e,t){e.uniform4iv(this.addr,t)}function k(e,t){e.uniform1fv(this.addr,t)}function A(e,t){e.uniform1iv(this.addr,t)}function R(e,t){e.uniform2fv(this.addr,m(t,this.size,2))}function O(e,t){e.uniform3fv(this.addr,m(t,this.size,3))}function I(e,t){e.uniform4fv(this.addr,m(t,this.size,4))}function B(e,t){e.uniformMatrix2fv(this.addr,!1,m(t,this.size,4))}function D(e,t){e.uniformMatrix3fv(this.addr,!1,m(t,this.size,9))}function U(e,t){e.uniformMatrix4fv(this.addr,!1,m(t,this.size,16))}function z(e,t,i){var n=t.length,r=g(i,n);e.uniform1iv(this.addr,r);for(var o=0;o!==n;++o)i.setTexture2D(t[o]||Qo,r[o])}function N(e,t,i){var n=t.length,r=g(i,n);e.uniform1iv(this.addr,r);for(var o=0;o!==n;++o)i.setTextureCube(t[o]||$o,r[o])}function j(e,t,i){this.id=e,this.addr=i,this.setValue=function(e){switch(e){case 5126:return v;case 35664:return b;case 35665:return w;case 35666:return x;case 35674:return _;case 35675:return M;case 35676:return T;case 35678:case 36198:return S;case 35680:return E;case 5124:case 35670:return y;case 35667:case 35671:return C;case 35668:case 35672:return P;case 35669:case 35673:return L}}(t.type)}function F(e,t,i){this.id=e,this.addr=i,this.size=t.size,this.setValue=function(e){switch(e){case 5126:return k;case 35664:return R;case 35665:return O;case 35666:return I;case 35674:return B;case 35675:return D;case 35676:return U;case 35678:return z;case 35680:return N;case 5124:case 35670:return A;case 35667:case 35671:return C;case 35668:case 35672:return P;case 35669:case 35673:return L}}(t.type)}function G(e){this.id=e,p.call(this)}function H(e,t){e.seq.push(t),e.map[t.id]=t}function V(e,t,i){var n=e.name,r=n.length;for(ra.lastIndex=0;;){var o=ra.exec(n),a=ra.lastIndex,s=o[1],l="]"===o[2],c=o[3];if(l&&(s|=0),void 0===c||"["===c&&a+2===r){H(i,void 0===c?new j(s,e,t):new F(s,e,t));break}var h=i.map[s];void 0===h&&H(i,h=new G(s)),i=h}}function W(e,t,i){p.call(this),this.renderer=i;for(var n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),r=0;r<n;++r){var o=e.getActiveUniform(t,r),a=o.name;V(o,e.getUniformLocation(t,a),this)}}function q(e,t,i){return void 0===t&&void 0===i?this.set(e):this.setRGB(e,t,i)}function X(e,t){this.min=void 0!==e?e:new i(1/0,1/0),this.max=void 0!==t?t:new i(-1/0,-1/0)}function K(e,t,n,r,a){function s(){var e=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),i=new Uint16Array([0,1,2,0,2,3]);l=t.createBuffer(),c=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,l),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,c),t.bufferData(t.ELEMENT_ARRAY_BUFFER,i,t.STATIC_DRAW),p=t.createTexture(),m=t.createTexture(),n.bindTexture(t.TEXTURE_2D,p),t.texImage2D(t.TEXTURE_2D,0,t.RGB,16,16,0,t.RGB,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),n.bindTexture(t.TEXTURE_2D,m),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,16,16,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),h={vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","\tvUV = uv;","\tvec2 pos = position;","\tif ( renderType == 2 ) {","\t\tvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","\t\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","\t\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","\t\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","\t\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","\t\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","\t\tvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","\t\tvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","\t\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","\t\tvVisibility =        visibility.r / 9.0;","\t\tvVisibility *= 1.0 - visibility.g / 9.0;","\t\tvVisibility *=       visibility.b / 9.0;","\t\tvVisibility *= 1.0 - visibility.a / 9.0;","\t\tpos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","\t\tpos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","\t}","\tgl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","\tif ( renderType == 0 ) {","\t\tgl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","\t} else if ( renderType == 1 ) {","\t\tgl_FragColor = texture2D( map, vUV );","\t} else {","\t\tvec4 texture = texture2D( map, vUV );","\t\ttexture.a *= opacity * vVisibility;","\t\tgl_FragColor = texture;","\t\tgl_FragColor.rgb *= color;","\t}","}"].join("\n")},u=function(e){var i=t.createProgram(),n=t.createShader(t.FRAGMENT_SHADER),r=t.createShader(t.VERTEX_SHADER),o="precision "+a.precision+" float;\n";return t.shaderSource(n,o+e.fragmentShader),t.shaderSource(r,o+e.vertexShader),t.compileShader(n),t.compileShader(r),t.attachShader(i,n),t.attachShader(i,r),t.linkProgram(i),i}(h),d={vertex:t.getAttribLocation(u,"position"),uv:t.getAttribLocation(u,"uv")},f={renderType:t.getUniformLocation(u,"renderType"),map:t.getUniformLocation(u,"map"),occlusionMap:t.getUniformLocation(u,"occlusionMap"),opacity:t.getUniformLocation(u,"opacity"),color:t.getUniformLocation(u,"color"),scale:t.getUniformLocation(u,"scale"),rotation:t.getUniformLocation(u,"rotation"),screenPosition:t.getUniformLocation(u,"screenPosition")}}var l,c,h,u,d,f,p,m;this.render=function(e,a,h,g){if(0!==e.length){var v=new o,y=g.w/g.z,b=.5*g.z,w=.5*g.w,x=16/g.w,_=new i(x*y,x),M=new o(1,1,0),T=new i(1,1),S=new X;S.min.set(g.x,g.y),S.max.set(g.x+(g.z-16),g.y+(g.w-16)),void 0===u&&s(),n.useProgram(u),n.initAttributes(),n.enableAttribute(d.vertex),n.enableAttribute(d.uv),n.disableUnusedAttributes(),t.uniform1i(f.occlusionMap,0),t.uniform1i(f.map,1),t.bindBuffer(t.ARRAY_BUFFER,l),t.vertexAttribPointer(d.vertex,2,t.FLOAT,!1,16,0),t.vertexAttribPointer(d.uv,2,t.FLOAT,!1,16,8),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,c),n.disable(t.CULL_FACE),n.buffers.depth.setMask(!1);for(var E=0,C=e.length;E<C;E++){x=16/g.w,_.set(x*y,x);var P=e[E];if(v.set(P.matrixWorld.elements[12],P.matrixWorld.elements[13],P.matrixWorld.elements[14]),v.applyMatrix4(h.matrixWorldInverse),v.applyMatrix4(h.projectionMatrix),M.copy(v),T.x=g.x+M.x*b+b-8,T.y=g.y+M.y*w+w-8,!0===S.containsPoint(T)){n.activeTexture(t.TEXTURE0),n.bindTexture(t.TEXTURE_2D,null),n.activeTexture(t.TEXTURE1),n.bindTexture(t.TEXTURE_2D,p),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGB,T.x,T.y,16,16,0),t.uniform1i(f.renderType,0),t.uniform2f(f.scale,_.x,_.y),t.uniform3f(f.screenPosition,M.x,M.y,M.z),n.disable(t.BLEND),n.enable(t.DEPTH_TEST),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),n.activeTexture(t.TEXTURE0),n.bindTexture(t.TEXTURE_2D,m),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,T.x,T.y,16,16,0),t.uniform1i(f.renderType,1),n.disable(t.DEPTH_TEST),n.activeTexture(t.TEXTURE1),n.bindTexture(t.TEXTURE_2D,p),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),P.positionScreen.copy(M),P.customUpdateCallback?P.customUpdateCallback(P):P.updateLensFlares(),t.uniform1i(f.renderType,2),n.enable(t.BLEND);for(var L=0,k=P.lensFlares.length;L<k;L++){var A=P.lensFlares[L];A.opacity>.001&&A.scale>.001&&(M.x=A.x,M.y=A.y,M.z=A.z,x=A.size*A.scale/g.w,_.x=x*y,_.y=x,t.uniform3f(f.screenPosition,M.x,M.y,M.z),t.uniform2f(f.scale,_.x,_.y),t.uniform1f(f.rotation,A.rotation),t.uniform1f(f.opacity,A.opacity),t.uniform3f(f.color,A.color.r,A.color.g,A.color.b),n.setBlending(A.blending,A.blendEquation,A.blendSrc,A.blendDst),r.setTexture2D(A.texture,1),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0))}}}n.enable(t.CULL_FACE),n.enable(t.DEPTH_TEST),n.buffers.depth.setMask(!0),n.reset()}}}function Y(e,t,i,n,r,o,a,s,c){l.call(this,e,t,i,n,r,o,a,s,c),this.needsUpdate=!0}function Z(e,t,i,n,a){function s(){var e=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),i=new Uint16Array([0,1,2,0,2,3]);c=t.createBuffer(),h=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,c),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,h),t.bufferData(t.ELEMENT_ARRAY_BUFFER,i,t.STATIC_DRAW),u=function(){var e=t.createProgram(),i=t.createShader(t.VERTEX_SHADER),n=t.createShader(t.FRAGMENT_SHADER);return t.shaderSource(i,["precision "+a.precision+" float;","#define SHADER_NAME SpriteMaterial","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float fogDepth;","void main() {","\tvUV = uvOffset + uv * uvScale;","\tvec2 alignedPosition = position * scale;","\tvec2 rotatedPosition;","\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","\tvec4 mvPosition;","\tmvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","\tmvPosition.xy += rotatedPosition;","\tgl_Position = projectionMatrix * mvPosition;","\tfogDepth = - mvPosition.z;","}"].join("\n")),t.shaderSource(n,["precision "+a.precision+" float;","#define SHADER_NAME SpriteMaterial","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","varying float fogDepth;","void main() {","\tvec4 texture = texture2D( map, vUV );","\tgl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","\tif ( gl_FragColor.a < alphaTest ) discard;","\tif ( fogType > 0 ) {","\t\tfloat fogFactor = 0.0;","\t\tif ( fogType == 1 ) {","\t\t\tfogFactor = smoothstep( fogNear, fogFar, fogDepth );","\t\t} else {","\t\t\tconst float LOG2 = 1.442695;","\t\t\tfogFactor = exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 );","\t\t\tfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","\t\t}","\t\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );","\t}","}"].join("\n")),t.compileShader(i),t.compileShader(n),t.attachShader(e,i),t.attachShader(e,n),t.linkProgram(e),e}(),d={position:t.getAttribLocation(u,"position"),uv:t.getAttribLocation(u,"uv")},f={uvOffset:t.getUniformLocation(u,"uvOffset"),uvScale:t.getUniformLocation(u,"uvScale"),rotation:t.getUniformLocation(u,"rotation"),scale:t.getUniformLocation(u,"scale"),color:t.getUniformLocation(u,"color"),map:t.getUniformLocation(u,"map"),opacity:t.getUniformLocation(u,"opacity"),modelViewMatrix:t.getUniformLocation(u,"modelViewMatrix"),projectionMatrix:t.getUniformLocation(u,"projectionMatrix"),fogType:t.getUniformLocation(u,"fogType"),fogDensity:t.getUniformLocation(u,"fogDensity"),fogNear:t.getUniformLocation(u,"fogNear"),fogFar:t.getUniformLocation(u,"fogFar"),fogColor:t.getUniformLocation(u,"fogColor"),fogDepth:t.getUniformLocation(u,"fogDepth"),alphaTest:t.getUniformLocation(u,"alphaTest")};var n=document.createElement("canvas");n.width=8,n.height=8;var r=n.getContext("2d");r.fillStyle="white",r.fillRect(0,0,8,8),p=new Y(n)}function l(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:t.id-e.id}var c,h,u,d,f,p,m=new o,g=new r,v=new o;this.render=function(r,o,a){if(0!==r.length){void 0===u&&s(),i.useProgram(u),i.initAttributes(),i.enableAttribute(d.position),i.enableAttribute(d.uv),i.disableUnusedAttributes(),i.disable(t.CULL_FACE),i.enable(t.BLEND),t.bindBuffer(t.ARRAY_BUFFER,c),t.vertexAttribPointer(d.position,2,t.FLOAT,!1,16,0),t.vertexAttribPointer(d.uv,2,t.FLOAT,!1,16,8),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,h),t.uniformMatrix4fv(f.projectionMatrix,!1,a.projectionMatrix.elements),i.activeTexture(t.TEXTURE0),t.uniform1i(f.map,0);var y=0,b=0,w=o.fog;w?(t.uniform3f(f.fogColor,w.color.r,w.color.g,w.color.b),w.isFog?(t.uniform1f(f.fogNear,w.near),t.uniform1f(f.fogFar,w.far),t.uniform1i(f.fogType,1),y=1,b=1):w.isFogExp2&&(t.uniform1f(f.fogDensity,w.density),t.uniform1i(f.fogType,2),y=2,b=2)):(t.uniform1i(f.fogType,0),y=0,b=0);for(var x=0,_=r.length;x<_;x++){(T=r[x]).modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,T.matrixWorld),T.z=-T.modelViewMatrix.elements[14]}r.sort(l);for(var M=[],x=0,_=r.length;x<_;x++){var T=r[x],S=T.material;if(!1!==S.visible){T.onBeforeRender(e,o,a,void 0,S,void 0),t.uniform1f(f.alphaTest,S.alphaTest),t.uniformMatrix4fv(f.modelViewMatrix,!1,T.modelViewMatrix.elements),T.matrixWorld.decompose(m,g,v),M[0]=v.x,M[1]=v.y;var E=0;o.fog&&S.fog&&(E=b),y!==E&&(t.uniform1i(f.fogType,E),y=E),null!==S.map?(t.uniform2f(f.uvOffset,S.map.offset.x,S.map.offset.y),t.uniform2f(f.uvScale,S.map.repeat.x,S.map.repeat.y)):(t.uniform2f(f.uvOffset,0,0),t.uniform2f(f.uvScale,1,1)),t.uniform1f(f.opacity,S.opacity),t.uniform3f(f.color,S.color.r,S.color.g,S.color.b),t.uniform1f(f.rotation,S.rotation),t.uniform2fv(f.scale,M),i.setBlending(S.blending,S.blendEquation,S.blendSrc,S.blendDst,S.blendEquationAlpha,S.blendSrcAlpha,S.blendDstAlpha,S.premultipliedAlpha),i.buffers.depth.setTest(S.depthTest),i.buffers.depth.setMask(S.depthWrite),i.buffers.color.setMask(S.colorWrite),n.setTexture2D(S.map||p,0),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),T.onAfterRender(e,o,a,void 0,S,void 0)}}i.enable(t.CULL_FACE),i.reset()}}}function J(){Object.defineProperty(this,"id",{value:ha++}),this.uuid=Zo.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.lights=!0,this.blending=sr,this.side=er,this.flatShading=!1,this.vertexColors=nr,this.opacity=1,this.transparent=!1,this.blendSrc=xr,this.blendDst=_r,this.blendEquation=dr,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Ar,this.depthTest=!0,this.depthWrite=!0,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.overdraw=0,this.visible=!0,this.userData={},this.needsUpdate=!0}function Q(e){J.call(this),this.type="MeshDepthMaterial",this.depthPacking=Ko,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.setValues(e)}function $(e){J.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new o,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.lights=!1,this.setValues(e)}function ee(e,t){this.min=void 0!==e?e:new o(1/0,1/0,1/0),this.max=void 0!==t?t:new o(-1/0,-1/0,-1/0)}function te(e,t){this.center=void 0!==e?e:new o,this.radius=void 0!==t?t:0}function ie(e,t){this.normal=void 0!==e?e:new o(1,0,0),this.constant=void 0!==t?t:0}function ne(e,t,i,n,r,o){this.planes=[void 0!==e?e:new ie,void 0!==t?t:new ie,void 0!==i?i:new ie,void 0!==n?n:new ie,void 0!==r?r:new ie,void 0!==o?o:new ie]}function re(e,t,r){function a(t,i,n,r,o,a){var s=t.geometry,l=null,c=b,h=t.customDepthMaterial;if(n&&(c=w,h=t.customDistanceMaterial),h)l=h;else{var u=!1;i.morphTargets&&(s&&s.isBufferGeometry?u=s.morphAttributes&&s.morphAttributes.position&&s.morphAttributes.position.length>0:s&&s.isGeometry&&(u=s.morphTargets&&s.morphTargets.length>0)),t.isSkinnedMesh&&!1===i.skinning&&console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",t);var d=t.isSkinnedMesh&&i.skinning,f=0;u&&(f|=g),d&&(f|=v),l=c[f]}if(e.localClippingEnabled&&!0===i.clipShadows&&0!==i.clippingPlanes.length){var p=l.uuid,m=i.uuid,y=x[p];void 0===y&&(y={},x[p]=y);var _=y[m];void 0===_&&(_=l.clone(),y[m]=_),l=_}l.visible=i.visible,l.wireframe=i.wireframe;var M=i.side;return k.renderSingleSided&&M==ir&&(M=er),k.renderReverseSided&&(M===er?M=tr:M===tr&&(M=er)),l.side=M,l.clipShadows=i.clipShadows,l.clippingPlanes=i.clippingPlanes,l.clipIntersection=i.clipIntersection,l.wireframeLinewidth=i.wireframeLinewidth,l.linewidth=i.linewidth,n&&l.isMeshDistanceMaterial&&(l.referencePosition.copy(r),l.nearDistance=o,l.farDistance=a),l}function s(i,n,r,o){if(!1!==i.visible){if(i.layers.test(n.layers)&&(i.isMesh||i.isLine||i.isPoints)&&i.castShadow&&(!i.frustumCulled||l.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,i.matrixWorld);var c=t.update(i),h=i.material;if(Array.isArray(h))for(var u=c.groups,d=0,f=u.length;d<f;d++){var p=u[d],g=h[p.materialIndex];if(g&&g.visible){v=a(i,g,o,m,r.near,r.far);e.renderBufferDirect(r,null,c,v,i,p)}}else if(h.visible){var v=a(i,h,o,m,r.near,r.far);e.renderBufferDirect(r,null,c,v,i,null)}}for(var y=i.children,b=0,w=y.length;b<w;b++)s(y[b],n,r,o)}}for(var l=new ne,u=new n,d=new i,f=new i(r,r),p=new o,m=new o,g=1,v=2,y=1+(g|v),b=new Array(y),w=new Array(y),x={},_=[new o(1,0,0),new o(-1,0,0),new o(0,0,1),new o(0,0,-1),new o(0,1,0),new o(0,-1,0)],M=[new o(0,1,0),new o(0,1,0),new o(0,1,0),new o(0,1,0),new o(0,0,1),new o(0,0,-1)],T=[new c,new c,new c,new c,new c,new c],S=0;S!==y;++S){var E=0!=(S&g),C=0!=(S&v),P=new Q({depthPacking:Yo,morphTargets:E,skinning:C});b[S]=P;var L=new $({morphTargets:E,skinning:C});w[S]=L}var k=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Qn,this.renderReverseSided=!0,this.renderSingleSided=!0,this.render=function(t,i,n){if(!1!==k.enabled&&(!1!==k.autoUpdate||!1!==k.needsUpdate)&&0!==t.length){var r=e.context,o=e.state;o.disable(r.BLEND),o.buffers.color.setClear(1,1,1,1),o.buffers.depth.setTest(!0),o.setScissorTest(!1);for(var a,c=0,g=t.length;c<g;c++){var v=t[c],y=v.shadow,b=v&&v.isPointLight;if(void 0!==y){var w=y.camera;if(d.copy(y.mapSize),d.min(f),b){var x=d.x,S=d.y;T[0].set(2*x,S,x,S),T[1].set(0,S,x,S),T[2].set(3*x,S,x,S),T[3].set(x,S,x,S),T[4].set(3*x,0,x,S),T[5].set(x,0,x,S),d.x*=4,d.y*=2}if(null===y.map){var E={minFilter:eo,magFilter:eo,format:xo};y.map=new h(d.x,d.y,E),y.map.texture.name=v.name+".shadowMap",w.updateProjectionMatrix()}y.isSpotLightShadow&&y.update(v);var C=y.map,P=y.matrix;m.setFromMatrixPosition(v.matrixWorld),w.position.copy(m),b?(a=6,P.makeTranslation(-m.x,-m.y,-m.z)):(a=1,p.setFromMatrixPosition(v.target.matrixWorld),w.lookAt(p),w.updateMatrixWorld(),P.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),P.multiply(w.projectionMatrix),P.multiply(w.matrixWorldInverse)),e.setRenderTarget(C),e.clear();for(var L=0;L<a;L++){if(b){p.copy(w.position),p.add(_[L]),w.up.copy(M[L]),w.lookAt(p),w.updateMatrixWorld();var A=T[L];o.viewport(A)}u.multiplyMatrices(w.projectionMatrix,w.matrixWorldInverse),l.setFromMatrix(u),s(i,n,w,b)}}else console.warn("THREE.WebGLShadowMap:",v,"has no shadow.")}k.needsUpdate=!1}}}function oe(e){function t(t,n){t.isInterleavedBufferAttribute&&(t=t.data);var r=i[t.uuid];void 0===r?i[t.uuid]=function(t,i){var n=t.array,r=t.dynamic?e.DYNAMIC_DRAW:e.STATIC_DRAW,o=e.createBuffer();e.bindBuffer(i,o),e.bufferData(i,n,r),t.onUploadCallback();var a=e.FLOAT;return n instanceof Float32Array?a=e.FLOAT:n instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):n instanceof Uint16Array?a=e.UNSIGNED_SHORT:n instanceof Int16Array?a=e.SHORT:n instanceof Uint32Array?a=e.UNSIGNED_INT:n instanceof Int32Array?a=e.INT:n instanceof Int8Array?a=e.BYTE:n instanceof Uint8Array&&(a=e.UNSIGNED_BYTE),{buffer:o,type:a,bytesPerElement:n.BYTES_PER_ELEMENT,version:t.version}}(t,n):r.version<t.version&&(!function(t,i,n){var r=i.array,o=i.updateRange;e.bindBuffer(n,t),!1===i.dynamic?e.bufferData(n,r,e.STATIC_DRAW):-1===o.count?e.bufferSubData(n,0,r):0===o.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(e.bufferSubData(n,o.offset*r.BYTES_PER_ELEMENT,r.subarray(o.offset,o.offset+o.count)),o.count=-1)}(r.buffer,t,n),r.version=t.version)}var i={};return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),i[e.uuid]},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);var n=i[t.uuid];n&&(e.deleteBuffer(n.buffer),delete i[t.uuid])},update:t}}function ae(e,t,i,n){this._x=e||0,this._y=t||0,this._z=i||0,this._order=n||ae.DefaultOrder}function se(){this.mask=1}function le(){Object.defineProperty(this,"id",{value:ua++}),this.uuid=Zo.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=le.DefaultUp.clone();var e=new o,t=new ae,i=new r,a=new o(1,1,1);t.onChange(function(){i.setFromEuler(t,!1)}),i.onChange(function(){t.setFromQuaternion(i,void 0,!1)}),Object.defineProperties(this,{position:{enumerable:!0,value:e},rotation:{enumerable:!0,value:t},quaternion:{enumerable:!0,value:i},scale:{enumerable:!0,value:a},modelViewMatrix:{value:new n},normalMatrix:{value:new s}}),this.matrix=new n,this.matrixWorld=new n,this.matrixAutoUpdate=le.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new se,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function ce(){le.call(this),this.type="Camera",this.matrixWorldInverse=new n,this.projectionMatrix=new n}function he(e,t,i,n,r,o){ce.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=n,this.near=void 0!==r?r:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()}function ue(e,t,i,n,r,a){this.a=e,this.b=t,this.c=i,this.normal=n&&n.isVector3?n:new o,this.vertexNormals=Array.isArray(n)?n:[],this.color=r&&r.isColor?r:new q,this.vertexColors=Array.isArray(r)?r:[],this.materialIndex=void 0!==a?a:0}function de(){Object.defineProperty(this,"id",{value:da+=2}),this.uuid=Zo.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}function fe(e,t,i){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.uuid=Zo.generateUUID(),this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===i,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.onUploadCallback=function(){},this.version=0}function pe(e,t,i){fe.call(this,new Int8Array(e),t,i)}function me(e,t,i){fe.call(this,new Uint8Array(e),t,i)}function ge(e,t,i){fe.call(this,new Uint8ClampedArray(e),t,i)}function ve(e,t,i){fe.call(this,new Int16Array(e),t,i)}function ye(e,t,i){fe.call(this,new Uint16Array(e),t,i)}function be(e,t,i){fe.call(this,new Int32Array(e),t,i)}function we(e,t,i){fe.call(this,new Uint32Array(e),t,i)}function xe(e,t,i){fe.call(this,new Float32Array(e),t,i)}function _e(e,t,i){fe.call(this,new Float64Array(e),t,i)}function Me(){this.indices=[],this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function Te(e){if(0===e.length)return-1/0;for(var t=e[0],i=1,n=e.length;i<n;++i)e[i]>t&&(t=e[i]);return t}function Se(){Object.defineProperty(this,"id",{value:fa+=2}),this.uuid=Zo.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0}}function Ee(e,t){de.call(this),this.type="ShapeGeometry","object"===(void 0===t?"undefined":a(t))&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),t=t.curveSegments),this.parameters={shapes:e,curveSegments:t},this.fromBufferGeometry(new Ce(e,t)),this.mergeVertices()}function Ce(e,t){function i(e){var i,s,c,h=r.length/3,u=e.extractPoints(t),d=u.shape,f=u.holes;if(!1===ma.isClockWise(d))for(d=d.reverse(),i=0,s=f.length;i<s;i++)c=f[i],!0===ma.isClockWise(c)&&(f[i]=c.reverse());var p=ma.triangulateShape(d,f);for(i=0,s=f.length;i<s;i++)c=f[i],d=d.concat(c);for(i=0,s=d.length;i<s;i++){var m=d[i];r.push(m.x,m.y,0),o.push(0,0,1),a.push(m.x,m.y)}for(i=0,s=p.length;i<s;i++){var g=p[i],v=g[0]+h,y=g[1]+h,b=g[2]+h;n.push(v,y,b),l+=3}}Se.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:e,curveSegments:t},t=t||12;var n=[],r=[],o=[],a=[],s=0,l=0;if(!1===Array.isArray(e))i(e);else for(var c=0;c<e.length;c++)i(e[c]),this.addGroup(s,l,c),s+=l,l=0;this.setIndex(n),this.addAttribute("position",new xe(r,3)),this.addAttribute("normal",new xe(o,3)),this.addAttribute("uv",new xe(a,2))}function Pe(e,t,i,n,r,o){de.call(this),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:n,heightSegments:r,depthSegments:o},this.fromBufferGeometry(new Le(e,t,i,n,r,o)),this.mergeVertices()}function Le(e,t,i,n,r,a){function s(e,t,i,n,r,a,s,m,g,v,y){var b,w,x=a/g,_=s/v,M=a/2,T=s/2,S=m/2,E=g+1,C=v+1,P=0,L=0,k=new o;for(w=0;w<C;w++){var A=w*_-T;for(b=0;b<E;b++){var R=b*x-M;k[e]=R*n,k[t]=A*r,k[i]=S,h.push(k.x,k.y,k.z),k[e]=0,k[t]=0,k[i]=m>0?1:-1,u.push(k.x,k.y,k.z),d.push(b/g),d.push(1-w/v),P+=1}}for(w=0;w<v;w++)for(b=0;b<g;b++){var O=f+b+E*w,I=f+b+E*(w+1),B=f+(b+1)+E*(w+1),D=f+(b+1)+E*w;c.push(O,I,D),c.push(I,B,D),L+=6}l.addGroup(p,L,y),p+=L,f+=P}Se.call(this),this.type="BoxBufferGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:n,heightSegments:r,depthSegments:a};var l=this;e=e||1,t=t||1,i=i||1,n=Math.floor(n)||1,r=Math.floor(r)||1;var c=[],h=[],u=[],d=[],f=0,p=0;s("z","y","x",-1,-1,i,t,e,a=Math.floor(a)||1,r,0),s("z","y","x",1,-1,i,t,-e,a,r,1),s("x","z","y",1,1,e,i,t,n,a,2),s("x","z","y",1,-1,e,i,-t,n,a,3),s("x","y","z",1,-1,e,t,i,n,r,4),s("x","y","z",-1,-1,e,t,-i,n,r,5),this.setIndex(c),this.addAttribute("position",new xe(h,3)),this.addAttribute("normal",new xe(u,3)),this.addAttribute("uv",new xe(d,2))}function ke(e,t,i,n){de.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:n},this.fromBufferGeometry(new Ae(e,t,i,n)),this.mergeVertices()}function Ae(e,t,i,n){Se.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:n};var r,o,a=(e=e||1)/2,s=(t=t||1)/2,l=Math.floor(i)||1,c=Math.floor(n)||1,h=l+1,u=c+1,d=e/l,f=t/c,p=[],m=[],g=[],v=[];for(o=0;o<u;o++){var y=o*f-s;for(r=0;r<h;r++){var b=r*d-a;m.push(b,-y,0),g.push(0,0,1),v.push(r/l),v.push(1-o/c)}}for(o=0;o<c;o++)for(r=0;r<l;r++){var w=r+h*o,x=r+h*(o+1),_=r+1+h*(o+1),M=r+1+h*o;p.push(w,x,M),p.push(x,_,M)}this.setIndex(p),this.addAttribute("position",new xe(m,3)),this.addAttribute("normal",new xe(g,3)),this.addAttribute("uv",new xe(v,2))}function Re(e){J.call(this),this.type="MeshBasicMaterial",this.color=new q(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Dr,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.lights=!1,this.setValues(e)}function Oe(e){J.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}function Ie(e,t){this.origin=void 0!==e?e:new o,this.direction=void 0!==t?t:new o}function Be(e,t){this.start=void 0!==e?e:new o,this.end=void 0!==t?t:new o}function De(e,t,i){this.a=void 0!==e?e:new o,this.b=void 0!==t?t:new o,this.c=void 0!==i?i:new o}function Ue(e,t){le.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new Se,this.material=void 0!==t?t:new Re({color:16777215*Math.random()}),this.drawMode=zo,this.updateMorphTargets()}function ze(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program&&t.program&&e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Ne(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function je(){function e(e,i){var n=e.id+","+i.id,r=t[n];return void 0===r&&(r=new function(){var e=[],t=0,i=[],n=[];return{opaque:i,transparent:n,init:function(){t=0,i.length=0,n.length=0},push:function(r,o,a,s,l){var c=e[t];void 0===c?(c={id:r.id,object:r,geometry:o,material:a,program:a.program,renderOrder:r.renderOrder,z:s,group:l},e[t]=c):(c.id=r.id,c.object=r,c.geometry=o,c.material=a,c.program=a.program,c.renderOrder=r.renderOrder,c.z=s,c.group=l),(!0===a.transparent?n:i).push(c),t++},sort:function(){i.length>1&&i.sort(ze),n.length>1&&n.sort(Ne)}}},t[n]=r),r}var t={};return{get:e,dispose:function(){t={}}}}function Fe(e,t){return Math.abs(t[1])-Math.abs(e[1])}function Ge(){var e=new function(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var n;switch(t.type){case"DirectionalLight":n={direction:new o,color:new q,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new i};break;case"SpotLight":n={position:new o,direction:new o,color:new q,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new i};break;case"PointLight":n={position:new o,color:new q,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new i,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":n={direction:new o,skyColor:new q,groundColor:new q};break;case"RectAreaLight":n={color:new q,position:new o,halfWidth:new o,halfHeight:new o}}return e[t.id]=n,n}}},t={hash:"",ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},r=new o,a=new n,s=new n;return{setup:function(i,n,o){for(var l=0,c=0,h=0,u=0,d=0,f=0,p=0,m=0,g=o.matrixWorldInverse,v=0,y=i.length;v<y;v++){var b=i[v],w=b.color,x=b.intensity,_=b.distance,M=b.shadow&&b.shadow.map?b.shadow.map.texture:null;if(b.isAmbientLight)l+=w.r*x,c+=w.g*x,h+=w.b*x;else if(b.isDirectionalLight)(S=e.get(b)).color.copy(b.color).multiplyScalar(b.intensity),S.direction.setFromMatrixPosition(b.matrixWorld),r.setFromMatrixPosition(b.target.matrixWorld),S.direction.sub(r),S.direction.transformDirection(g),S.shadow=b.castShadow,b.castShadow&&(T=b.shadow,S.shadowBias=T.bias,S.shadowRadius=T.radius,S.shadowMapSize=T.mapSize),t.directionalShadowMap[u]=M,t.directionalShadowMatrix[u]=b.shadow.matrix,t.directional[u]=S,u++;else if(b.isSpotLight)(S=e.get(b)).position.setFromMatrixPosition(b.matrixWorld),S.position.applyMatrix4(g),S.color.copy(w).multiplyScalar(x),S.distance=_,S.direction.setFromMatrixPosition(b.matrixWorld),r.setFromMatrixPosition(b.target.matrixWorld),S.direction.sub(r),S.direction.transformDirection(g),S.coneCos=Math.cos(b.angle),S.penumbraCos=Math.cos(b.angle*(1-b.penumbra)),S.decay=0===b.distance?0:b.decay,S.shadow=b.castShadow,b.castShadow&&(T=b.shadow,S.shadowBias=T.bias,S.shadowRadius=T.radius,S.shadowMapSize=T.mapSize),t.spotShadowMap[f]=M,t.spotShadowMatrix[f]=b.shadow.matrix,t.spot[f]=S,f++;else if(b.isRectAreaLight)(S=e.get(b)).color.copy(w).multiplyScalar(x/(b.width*b.height)),S.position.setFromMatrixPosition(b.matrixWorld),S.position.applyMatrix4(g),s.identity(),a.copy(b.matrixWorld),a.premultiply(g),s.extractRotation(a),S.halfWidth.set(.5*b.width,0,0),S.halfHeight.set(0,.5*b.height,0),S.halfWidth.applyMatrix4(s),S.halfHeight.applyMatrix4(s),t.rectArea[p]=S,p++;else if(b.isPointLight){if((S=e.get(b)).position.setFromMatrixPosition(b.matrixWorld),S.position.applyMatrix4(g),S.color.copy(b.color).multiplyScalar(b.intensity),S.distance=b.distance,S.decay=0===b.distance?0:b.decay,S.shadow=b.castShadow,b.castShadow){var T=b.shadow;S.shadowBias=T.bias,S.shadowRadius=T.radius,S.shadowMapSize=T.mapSize,S.shadowCameraNear=T.camera.near,S.shadowCameraFar=T.camera.far}t.pointShadowMap[d]=M,t.pointShadowMatrix[d]=b.shadow.matrix,t.point[d]=S,d++}else if(b.isHemisphereLight){var S=e.get(b);S.direction.setFromMatrixPosition(b.matrixWorld),S.direction.transformDirection(g),S.direction.normalize(),S.skyColor.copy(b.color).multiplyScalar(x),S.groundColor.copy(b.groundColor).multiplyScalar(x),t.hemi[m]=S,m++}}t.ambient[0]=l,t.ambient[1]=c,t.ambient[2]=h,t.directional.length=u,t.spot.length=f,t.rectArea.length=p,t.point.length=d,t.hemi.length=m,t.hash=u+","+d+","+f+","+p+","+m+","+n.length},state:t}}function He(e,t,i){var n=e.createShader(t);return e.shaderSource(n,i),e.compileShader(n),!1===e.getShaderParameter(n,e.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn't compile."),""!==e.getShaderInfoLog(n)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",t===e.VERTEX_SHADER?"vertex":"fragment",e.getShaderInfoLog(n),function(e){for(var t=e.split("\n"),i=0;i<t.length;i++)t[i]=i+1+": "+t[i];return t.join("\n")}(i)),n}function Ve(e){switch(e){case Fo:return["Linear","( value )"];case Go:return["sRGB","( value )"];case Vo:return["RGBE","( value )"];case Wo:return["RGBM","( value, 7.0 )"];case qo:return["RGBM","( value, 16.0 )"];case Xo:return["RGBD","( value, 256.0 )"];case Ho:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw new Error("unsupported encoding: "+e)}}function We(e,t){var i=Ve(t);return"vec4 "+e+"( vec4 value ) { return "+i[0]+"ToLinear"+i[1]+"; }"}function qe(e){return""!==e}function Xe(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights)}function Ke(e){return e.replace(/^[ \t]*#include +<([\w\d.]+)>/gm,function(e,t){var i=la[t];if(void 0===i)throw new Error("Can not resolve #include <"+t+">");return Ke(i)})}function Ye(e){return e.replace(/for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,function(e,t,i,n){for(var r="",o=parseInt(t);o<parseInt(i);o++)r+=n.replace(/\[ i \]/g,"[ "+o+" ]");return r})}function Ze(e,t,i,n,r,o){var a=e.context,s=n.defines,l=r.vertexShader,c=r.fragmentShader,h="SHADOWMAP_TYPE_BASIC";o.shadowMapType===Qn?h="SHADOWMAP_TYPE_PCF":o.shadowMapType===$n&&(h="SHADOWMAP_TYPE_PCF_SOFT");var u="ENVMAP_TYPE_CUBE",d="ENVMAP_MODE_REFLECTION",f="ENVMAP_BLENDING_MULTIPLY";if(o.envMap){switch(n.envMap.mapping){case Vr:case Wr:u="ENVMAP_TYPE_CUBE";break;case Yr:case Zr:u="ENVMAP_TYPE_CUBE_UV";break;case qr:case Xr:u="ENVMAP_TYPE_EQUIREC";break;case Kr:u="ENVMAP_TYPE_SPHERE"}switch(n.envMap.mapping){case Wr:case Xr:d="ENVMAP_MODE_REFRACTION"}switch(n.combine){case Dr:f="ENVMAP_BLENDING_MULTIPLY";break;case Ur:f="ENVMAP_BLENDING_MIX";break;case zr:f="ENVMAP_BLENDING_ADD"}}var p,m,g=e.gammaFactor>0?e.gammaFactor:1,v=function(e,t,i){return[(e=e||{}).derivatives||t.envMapCubeUV||t.bumpMap||t.normalMap||t.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(e.fragDepth||t.logarithmicDepthBuffer)&&i.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",e.drawBuffers&&i.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(e.shaderTextureLOD||t.envMap)&&i.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(qe).join("\n")}(n.extensions,o,t),y=function(e){var t=[];for(var i in e){var n=e[i];!1!==n&&t.push("#define "+i+" "+n)}return t.join("\n")}(s),b=a.createProgram();n.isRawShaderMaterial?((p=[y].filter(qe).join("\n")).length>0&&(p+="\n"),(m=[v,y].filter(qe).join("\n")).length>0&&(m+="\n")):(p=["precision "+o.precision+" float;","precision "+o.precision+" int;","#define SHADER_NAME "+r.name,y,o.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+g,"#define MAX_BONES "+o.maxBones,o.useFog&&o.fog?"#define USE_FOG":"",o.useFog&&o.fogExp?"#define FOG_EXP2":"",o.map?"#define USE_MAP":"",o.envMap?"#define USE_ENVMAP":"",o.envMap?"#define "+d:"",o.lightMap?"#define USE_LIGHTMAP":"",o.aoMap?"#define USE_AOMAP":"",o.emissiveMap?"#define USE_EMISSIVEMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.normalMap?"#define USE_NORMALMAP":"",o.displacementMap&&o.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.roughnessMap?"#define USE_ROUGHNESSMAP":"",o.metalnessMap?"#define USE_METALNESSMAP":"",o.alphaMap?"#define USE_ALPHAMAP":"",o.vertexColors?"#define USE_COLOR":"",o.flatShading?"#define FLAT_SHADED":"",o.skinning?"#define USE_SKINNING":"",o.useVertexTexture?"#define BONE_TEXTURE":"",o.morphTargets?"#define USE_MORPHTARGETS":"",o.morphNormals&&!1===o.flatShading?"#define USE_MORPHNORMALS":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+o.numClippingPlanes,o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+h:"",o.sizeAttenuation?"#define USE_SIZEATTENUATION":"",o.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",o.logarithmicDepthBuffer&&t.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(qe).join("\n"),m=[v,"precision "+o.precision+" float;","precision "+o.precision+" int;","#define SHADER_NAME "+r.name,y,o.alphaTest?"#define ALPHATEST "+o.alphaTest:"","#define GAMMA_FACTOR "+g,o.useFog&&o.fog?"#define USE_FOG":"",o.useFog&&o.fogExp?"#define FOG_EXP2":"",o.map?"#define USE_MAP":"",o.envMap?"#define USE_ENVMAP":"",o.envMap?"#define "+u:"",o.envMap?"#define "+d:"",o.envMap?"#define "+f:"",o.lightMap?"#define USE_LIGHTMAP":"",o.aoMap?"#define USE_AOMAP":"",o.emissiveMap?"#define USE_EMISSIVEMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.normalMap?"#define USE_NORMALMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.roughnessMap?"#define USE_ROUGHNESSMAP":"",o.metalnessMap?"#define USE_METALNESSMAP":"",o.alphaMap?"#define USE_ALPHAMAP":"",o.vertexColors?"#define USE_COLOR":"",o.gradientMap?"#define USE_GRADIENTMAP":"",o.flatShading?"#define FLAT_SHADED":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+o.numClippingPlanes,"#define UNION_CLIPPING_PLANES "+(o.numClippingPlanes-o.numClipIntersection),o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+h:"",o.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",o.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",o.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",o.logarithmicDepthBuffer&&t.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"",o.envMap&&t.get("EXT_shader_texture_lod")?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",o.toneMapping!==Nr?"#define TONE_MAPPING":"",o.toneMapping!==Nr?la.tonemapping_pars_fragment:"",o.toneMapping!==Nr?function(e,t){var i;switch(t){case jr:i="Linear";break;case Fr:i="Reinhard";break;case Gr:i="Uncharted2";break;case Hr:i="OptimizedCineon";break;default:throw new Error("unsupported toneMapping: "+t)}return"vec3 "+e+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}("toneMapping",o.toneMapping):"",o.dithering?"#define DITHERING":"",o.outputEncoding||o.mapEncoding||o.envMapEncoding||o.emissiveMapEncoding?la.encodings_pars_fragment:"",o.mapEncoding?We("mapTexelToLinear",o.mapEncoding):"",o.envMapEncoding?We("envMapTexelToLinear",o.envMapEncoding):"",o.emissiveMapEncoding?We("emissiveMapTexelToLinear",o.emissiveMapEncoding):"",o.outputEncoding?function(e,t){var i=Ve(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}("linearToOutputTexel",o.outputEncoding):"",o.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(qe).join("\n")),l=Xe(l=Ke(l),o),c=Xe(c=Ke(c),o),n.isShaderMaterial||(l=Ye(l),c=Ye(c));var w=p+l,x=m+c,_=He(a,a.VERTEX_SHADER,w),M=He(a,a.FRAGMENT_SHADER,x);a.attachShader(b,_),a.attachShader(b,M),void 0!==n.index0AttributeName?a.bindAttribLocation(b,0,n.index0AttributeName):!0===o.morphTargets&&a.bindAttribLocation(b,0,"position"),a.linkProgram(b);var T=a.getProgramInfoLog(b),S=a.getShaderInfoLog(_),E=a.getShaderInfoLog(M),C=!0,P=!0;!1===a.getProgramParameter(b,a.LINK_STATUS)?(C=!1,console.error("THREE.WebGLProgram: shader error: ",a.getError(),"gl.VALIDATE_STATUS",a.getProgramParameter(b,a.VALIDATE_STATUS),"gl.getProgramInfoLog",T,S,E)):""!==T?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",T):""!==S&&""!==E||(P=!1),P&&(this.diagnostics={runnable:C,material:n,programLog:T,vertexShader:{log:S,prefix:p},fragmentShader:{log:E,prefix:m}}),a.deleteShader(_),a.deleteShader(M);var L;this.getUniforms=function(){return void 0===L&&(L=new W(a,b,e)),L};var k;return this.getAttributes=function(){return void 0===k&&(k=function(e,t){for(var i={},n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),r=0;r<n;r++){var o=e.getActiveAttrib(t,r).name;i[o]=e.getAttribLocation(t,o)}return i}(a,b)),k},this.destroy=function(){a.deleteProgram(b),this.program=void 0},Object.defineProperties(this,{uniforms:{get:function(){return console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms()."),this.getUniforms()}},attributes:{get:function(){return console.warn("THREE.WebGLProgram: .attributes is now .getAttributes()."),this.getAttributes()}}}),this.id=pa++,this.code=i,this.usedTimes=1,this.program=b,this.vertexShader=_,this.fragmentShader=M,this}function Je(e,t,i){function n(e,t){var i;return e?e.isTexture?i=e.encoding:e.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),i=e.texture.encoding):i=Fo,i===Fo&&t&&(i=Ho),i}var r=[],o={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow"},a=["precision","supportsVertexTextures","map","mapEncoding","envMap","envMapMode","envMapEncoding","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering"];this.getParameters=function(t,r,a,s,l,c,h){var u=o[t.type],d=h.isSkinnedMesh?function(e){var t=e.skeleton.bones;if(i.floatVertexTextures)return 1024;var n=i.maxVertexUniforms,r=Math.floor((n-20)/4),o=Math.min(r,t.length);return o<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+o+"."),0):o}(h):0,f=i.precision;null!==t.precision&&(f=i.getMaxPrecision(t.precision))!==t.precision&&console.warn("THREE.WebGLProgram.getParameters:",t.precision,"not supported, using",f,"instead.");var p=e.getRenderTarget();return{shaderID:u,precision:f,supportsVertexTextures:i.vertexTextures,outputEncoding:n(p?p.texture:null,e.gammaOutput),map:!!t.map,mapEncoding:n(t.map,e.gammaInput),envMap:!!t.envMap,envMapMode:t.envMap&&t.envMap.mapping,envMapEncoding:n(t.envMap,e.gammaInput),envMapCubeUV:!!t.envMap&&(t.envMap.mapping===Yr||t.envMap.mapping===Zr),lightMap:!!t.lightMap,aoMap:!!t.aoMap,emissiveMap:!!t.emissiveMap,emissiveMapEncoding:n(t.emissiveMap,e.gammaInput),bumpMap:!!t.bumpMap,normalMap:!!t.normalMap,displacementMap:!!t.displacementMap,roughnessMap:!!t.roughnessMap,metalnessMap:!!t.metalnessMap,specularMap:!!t.specularMap,alphaMap:!!t.alphaMap,gradientMap:!!t.gradientMap,combine:t.combine,vertexColors:t.vertexColors,fog:!!s,useFog:t.fog,fogExp:s&&s.isFogExp2,flatShading:t.flatShading,sizeAttenuation:t.sizeAttenuation,logarithmicDepthBuffer:i.logarithmicDepthBuffer,skinning:t.skinning&&d>0,maxBones:d,useVertexTexture:i.floatVertexTextures,morphTargets:t.morphTargets,morphNormals:t.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:r.directional.length,numPointLights:r.point.length,numSpotLights:r.spot.length,numRectAreaLights:r.rectArea.length,numHemiLights:r.hemi.length,numClippingPlanes:l,numClipIntersection:c,dithering:t.dithering,shadowMapEnabled:e.shadowMap.enabled&&h.receiveShadow&&a.length>0,shadowMapType:e.shadowMap.type,toneMapping:e.toneMapping,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:t.premultipliedAlpha,alphaTest:t.alphaTest,doubleSided:t.side===ir,flipSided:t.side===tr,depthPacking:void 0!==t.depthPacking&&t.depthPacking}},this.getProgramCode=function(t,i){var n=[];if(i.shaderID?n.push(i.shaderID):(n.push(t.fragmentShader),n.push(t.vertexShader)),void 0!==t.defines)for(var r in t.defines)n.push(r),n.push(t.defines[r]);for(var o=0;o<a.length;o++)n.push(i[a[o]]);return n.push(t.onBeforeCompile.toString()),n.push(e.gammaOutput),n.join()},this.acquireProgram=function(i,n,o,a){for(var s,l=0,c=r.length;l<c;l++){var h=r[l];if(h.code===a){++(s=h).usedTimes;break}}return void 0===s&&(s=new Ze(e,t,a,i,n,o),r.push(s)),s},this.releaseProgram=function(e){if(0==--e.usedTimes){var t=r.indexOf(e);r[t]=r[r.length-1],r.pop(),e.destroy()}},this.programs=r}function Qe(e,t,i,n,r,o,a){function s(e,t){if(e.width>t||e.height>t){var i=t/Math.max(e.width,e.height),n=document.createElement("canvas");n.width=Math.floor(e.width*i),n.height=Math.floor(e.height*i);return n.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,n.width,n.height),console.warn("THREE.WebGLRenderer: image is too big ("+e.width+"x"+e.height+"). Resized to "+n.width+"x"+n.height,e),n}return e}function l(e){return Zo.isPowerOfTwo(e.width)&&Zo.isPowerOfTwo(e.height)}function c(e,t){return e.generateMipmaps&&t&&e.minFilter!==eo&&e.minFilter!==no}function h(t){return t===eo||t===to||t===io?e.NEAREST:e.LINEAR}function u(t){var i=t.target;i.removeEventListener("dispose",u),function(t){var i=n.get(t);if(t.image&&i.__image__webglTextureCube)e.deleteTexture(i.__image__webglTextureCube);else{if(void 0===i.__webglInit)return;e.deleteTexture(i.__webglTexture)}n.remove(t)}(i),a.textures--}function d(t){var i=t.target;i.removeEventListener("dispose",d),function(t){var i=n.get(t),r=n.get(t.texture);if(!t)return;void 0!==r.__webglTexture&&e.deleteTexture(r.__webglTexture);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLRenderTargetCube)for(var o=0;o<6;o++)e.deleteFramebuffer(i.__webglFramebuffer[o]),i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer[o]);else e.deleteFramebuffer(i.__webglFramebuffer),i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer);n.remove(t.texture),n.remove(t)}(i),a.textures--}function f(t,h){var d=n.get(t);if(t.version>0&&d.__version!==t.version){var f=t.image;if(void 0===f)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined",t);else{if(!1!==f.complete)return void function(t,n,h){void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",u),t.__webglTexture=e.createTexture(),a.textures++);i.activeTexture(e.TEXTURE0+h),i.bindTexture(e.TEXTURE_2D,t.__webglTexture),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,n.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,n.unpackAlignment);var d=s(n.image,r.maxTextureSize);(function(e){return e.wrapS!==Qr||e.wrapT!==Qr||e.minFilter!==eo&&e.minFilter!==no})(n)&&!1===l(d)&&(d=function(e){if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement){var t=document.createElement("canvas");return t.width=Zo.floorPowerOfTwo(e.width),t.height=Zo.floorPowerOfTwo(e.height),t.getContext("2d").drawImage(e,0,0,t.width,t.height),console.warn("THREE.WebGLRenderer: image is not power of two ("+e.width+"x"+e.height+"). Resized to "+t.width+"x"+t.height,e),t}return e}(d));var f=l(d),m=o.convert(n.format),g=o.convert(n.type);p(e.TEXTURE_2D,n,f);var v,b=n.mipmaps;if(n.isDepthTexture){var w=e.DEPTH_COMPONENT;if(n.type===fo){if(!y)throw new Error("Float Depth Texture only supported in WebGL2.0");w=e.DEPTH_COMPONENT32F}else y&&(w=e.DEPTH_COMPONENT16);n.format===So&&w===e.DEPTH_COMPONENT&&n.type!==co&&n.type!==uo&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),n.type=co,g=o.convert(n.type)),n.format===Eo&&(w=e.DEPTH_STENCIL,n.type!==yo&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),n.type=yo,g=o.convert(n.type))),i.texImage2D(e.TEXTURE_2D,0,w,d.width,d.height,0,m,g,null)}else if(n.isDataTexture)if(b.length>0&&f){for(var x=0,_=b.length;x<_;x++)v=b[x],i.texImage2D(e.TEXTURE_2D,x,m,v.width,v.height,0,m,g,v.data);n.generateMipmaps=!1}else i.texImage2D(e.TEXTURE_2D,0,m,d.width,d.height,0,m,g,d.data);else if(n.isCompressedTexture)for(var x=0,_=b.length;x<_;x++)v=b[x],n.format!==xo&&n.format!==wo?i.getCompressedTextureFormats().indexOf(m)>-1?i.compressedTexImage2D(e.TEXTURE_2D,x,m,v.width,v.height,0,v.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):i.texImage2D(e.TEXTURE_2D,x,m,v.width,v.height,0,m,g,v.data);else if(b.length>0&&f){for(var x=0,_=b.length;x<_;x++)v=b[x],i.texImage2D(e.TEXTURE_2D,x,m,m,g,v);n.generateMipmaps=!1}else i.texImage2D(e.TEXTURE_2D,0,m,m,g,d);c(n,f)&&e.generateMipmap(e.TEXTURE_2D);t.__version=n.version,n.onUpdate&&n.onUpdate(n)}(d,t,h);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete",t)}}i.activeTexture(e.TEXTURE0+h),i.bindTexture(e.TEXTURE_2D,d.__webglTexture)}function p(i,a,s){var l;if(s?(e.texParameteri(i,e.TEXTURE_WRAP_S,o.convert(a.wrapS)),e.texParameteri(i,e.TEXTURE_WRAP_T,o.convert(a.wrapT)),e.texParameteri(i,e.TEXTURE_MAG_FILTER,o.convert(a.magFilter)),e.texParameteri(i,e.TEXTURE_MIN_FILTER,o.convert(a.minFilter))):(e.texParameteri(i,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(i,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),a.wrapS===Qr&&a.wrapT===Qr||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.",a),e.texParameteri(i,e.TEXTURE_MAG_FILTER,h(a.magFilter)),e.texParameteri(i,e.TEXTURE_MIN_FILTER,h(a.minFilter)),a.minFilter!==eo&&a.minFilter!==no&&(a.minFilter=no),a.minFilter!==eo&&a.minFilter!==no&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.",a)),l=t.get("EXT_texture_filter_anisotropic")){if(a.type===fo&&null===t.get("OES_texture_float_linear"))return;if(a.type===po&&null===t.get("OES_texture_half_float_linear"))return;(a.anisotropy>1||n.get(a).__currentAnisotropy)&&(e.texParameterf(i,l.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,r.getMaxAnisotropy())),n.get(a).__currentAnisotropy=a.anisotropy)}}function m(t,r,a,s){var l=o.convert(r.texture.format),c=o.convert(r.texture.type);i.texImage2D(s,0,l,r.width,r.height,0,l,c,null),e.bindFramebuffer(e.FRAMEBUFFER,t),e.framebufferTexture2D(e.FRAMEBUFFER,a,s,n.get(r.texture).__webglTexture,0),e.bindFramebuffer(e.FRAMEBUFFER,null)}function g(t,i){e.bindRenderbuffer(e.RENDERBUFFER,t),i.depthBuffer&&!i.stencilBuffer?(e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,i.width,i.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t)):i.depthBuffer&&i.stencilBuffer?(e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,i.width,i.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t)):e.renderbufferStorage(e.RENDERBUFFER,e.RGBA4,i.width,i.height),e.bindRenderbuffer(e.RENDERBUFFER,null)}function v(t){var i=n.get(t),r=!0===t.isWebGLRenderTargetCube;if(t.depthTexture){if(r)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,i){if(i&&i.isWebGLRenderTargetCube)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(e.FRAMEBUFFER,t),!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");n.get(i.depthTexture).__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),f(i.depthTexture,0);var r=n.get(i.depthTexture).__webglTexture;if(i.depthTexture.format===So)e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,r,0);else{if(i.depthTexture.format!==Eo)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,r,0)}}(i.__webglFramebuffer,t)}else if(r){i.__webglDepthbuffer=[];for(var o=0;o<6;o++)e.bindFramebuffer(e.FRAMEBUFFER,i.__webglFramebuffer[o]),i.__webglDepthbuffer[o]=e.createRenderbuffer(),g(i.__webglDepthbuffer[o],t)}else e.bindFramebuffer(e.FRAMEBUFFER,i.__webglFramebuffer),i.__webglDepthbuffer=e.createRenderbuffer(),g(i.__webglDepthbuffer,t);e.bindFramebuffer(e.FRAMEBUFFER,null)}var y="undefined"!=typeof WebGL2RenderingContext&&e instanceof window.WebGL2RenderingContext;this.setTexture2D=f,this.setTextureCube=function(t,h){var d=n.get(t);if(6===t.image.length)if(t.version>0&&d.__version!==t.version){d.__image__webglTextureCube||(t.addEventListener("dispose",u),d.__image__webglTextureCube=e.createTexture(),a.textures++),i.activeTexture(e.TEXTURE0+h),i.bindTexture(e.TEXTURE_CUBE_MAP,d.__image__webglTextureCube),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t.flipY);for(var f=t&&t.isCompressedTexture,m=t.image[0]&&t.image[0].isDataTexture,g=[],v=0;v<6;v++)g[v]=f||m?m?t.image[v].image:t.image[v]:s(t.image[v],r.maxCubemapSize);var y=l(g[0]),b=o.convert(t.format),w=o.convert(t.type);for(p(e.TEXTURE_CUBE_MAP,t,y),v=0;v<6;v++)if(f)for(var x,_=g[v].mipmaps,M=0,T=_.length;M<T;M++)x=_[M],t.format!==xo&&t.format!==wo?i.getCompressedTextureFormats().indexOf(b)>-1?i.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+v,M,b,x.width,x.height,0,x.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+v,M,b,x.width,x.height,0,b,w,x.data);else m?i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+v,0,b,g[v].width,g[v].height,0,b,w,g[v].data):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+v,0,b,b,w,g[v]);c(t,y)&&e.generateMipmap(e.TEXTURE_CUBE_MAP),d.__version=t.version,t.onUpdate&&t.onUpdate(t)}else i.activeTexture(e.TEXTURE0+h),i.bindTexture(e.TEXTURE_CUBE_MAP,d.__image__webglTextureCube)},this.setTextureCubeDynamic=function(t,r){i.activeTexture(e.TEXTURE0+r),i.bindTexture(e.TEXTURE_CUBE_MAP,n.get(t).__webglTexture)},this.setupRenderTarget=function(t){var r=n.get(t),o=n.get(t.texture);t.addEventListener("dispose",d),o.__webglTexture=e.createTexture(),a.textures++;var s=!0===t.isWebGLRenderTargetCube,h=l(t);if(s)for(r.__webglFramebuffer=[],u=0;u<6;u++)r.__webglFramebuffer[u]=e.createFramebuffer();else r.__webglFramebuffer=e.createFramebuffer();if(s){i.bindTexture(e.TEXTURE_CUBE_MAP,o.__webglTexture),p(e.TEXTURE_CUBE_MAP,t.texture,h);for(var u=0;u<6;u++)m(r.__webglFramebuffer[u],t,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+u);c(t.texture,h)&&e.generateMipmap(e.TEXTURE_CUBE_MAP),i.bindTexture(e.TEXTURE_CUBE_MAP,null)}else i.bindTexture(e.TEXTURE_2D,o.__webglTexture),p(e.TEXTURE_2D,t.texture,h),m(r.__webglFramebuffer,t,e.COLOR_ATTACHMENT0,e.TEXTURE_2D),c(t.texture,h)&&e.generateMipmap(e.TEXTURE_2D),i.bindTexture(e.TEXTURE_2D,null);t.depthBuffer&&v(t)},this.updateRenderTargetMipmap=function(t){var r=t.texture;if(c(r,l(t))){var o=t.isWebGLRenderTargetCube?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,a=n.get(r).__webglTexture;i.bindTexture(o,a),e.generateMipmap(o),i.bindTexture(o,null)}}}function $e(e,t,i,n){ce.call(this),this.type="PerspectiveCamera",this.fov=void 0!==e?e:50,this.zoom=1,this.near=void 0!==i?i:.1,this.far=void 0!==n?n:2e3,this.focus=10,this.aspect=void 0!==t?t:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function et(e){$e.call(this),this.cameras=e||[]}function tt(e,t){return{convert:function(i){var n;if(i===Jr)return e.REPEAT;if(i===Qr)return e.CLAMP_TO_EDGE;if(i===$r)return e.MIRRORED_REPEAT;if(i===eo)return e.NEAREST;if(i===to)return e.NEAREST_MIPMAP_NEAREST;if(i===io)return e.NEAREST_MIPMAP_LINEAR;if(i===no)return e.LINEAR;if(i===ro)return e.LINEAR_MIPMAP_NEAREST;if(i===oo)return e.LINEAR_MIPMAP_LINEAR;if(i===ao)return e.UNSIGNED_BYTE;if(i===mo)return e.UNSIGNED_SHORT_4_4_4_4;if(i===go)return e.UNSIGNED_SHORT_5_5_5_1;if(i===vo)return e.UNSIGNED_SHORT_5_6_5;if(i===so)return e.BYTE;if(i===lo)return e.SHORT;if(i===co)return e.UNSIGNED_SHORT;if(i===ho)return e.INT;if(i===uo)return e.UNSIGNED_INT;if(i===fo)return e.FLOAT;if(i===po&&null!==(n=t.get("OES_texture_half_float")))return n.HALF_FLOAT_OES;if(i===bo)return e.ALPHA;if(i===wo)return e.RGB;if(i===xo)return e.RGBA;if(i===_o)return e.LUMINANCE;if(i===Mo)return e.LUMINANCE_ALPHA;if(i===So)return e.DEPTH_COMPONENT;if(i===Eo)return e.DEPTH_STENCIL;if(i===dr)return e.FUNC_ADD;if(i===fr)return e.FUNC_SUBTRACT;if(i===pr)return e.FUNC_REVERSE_SUBTRACT;if(i===vr)return e.ZERO;if(i===yr)return e.ONE;if(i===br)return e.SRC_COLOR;if(i===wr)return e.ONE_MINUS_SRC_COLOR;if(i===xr)return e.SRC_ALPHA;if(i===_r)return e.ONE_MINUS_SRC_ALPHA;if(i===Mr)return e.DST_ALPHA;if(i===Tr)return e.ONE_MINUS_DST_ALPHA;if(i===Sr)return e.DST_COLOR;if(i===Er)return e.ONE_MINUS_DST_COLOR;if(i===Cr)return e.SRC_ALPHA_SATURATE;if((i===Co||i===Po||i===Lo||i===ko)&&null!==(n=t.get("WEBGL_compressed_texture_s3tc"))){if(i===Co)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===Po)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===Lo)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===ko)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if((i===Ao||i===Ro||i===Oo||i===Io)&&null!==(n=t.get("WEBGL_compressed_texture_pvrtc"))){if(i===Ao)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===Ro)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===Oo)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===Io)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(i===Bo&&null!==(n=t.get("WEBGL_compressed_texture_etc1")))return n.COMPRESSED_RGB_ETC1_WEBGL;if((i===mr||i===gr)&&null!==(n=t.get("EXT_blend_minmax"))){if(i===mr)return n.MIN_EXT;if(i===gr)return n.MAX_EXT}return i===yo&&null!==(n=t.get("WEBGL_depth_texture"))?n.UNSIGNED_INT_24_8_WEBGL:0}}}function it(e){function t(){return null===D?Q:1}function i(){(ve=new function(e){var t={};return{get:function(i){if(void 0!==t[i])return t[i];var n;switch(i){case"WEBGL_depth_texture":n=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case"WEBGL_compressed_texture_etc1":n=e.getExtension("WEBGL_compressed_texture_etc1");break;default:n=e.getExtension(i)}return null===n&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),t[i]=n,n}}}(me)).get("WEBGL_depth_texture"),ve.get("OES_texture_float"),ve.get("OES_texture_float_linear"),ve.get("OES_texture_half_float"),ve.get("OES_texture_half_float_linear"),ve.get("OES_standard_derivatives"),ve.get("OES_element_index_uint"),ve.get("ANGLE_instanced_arrays"),qe=new tt(me,ve),be=new function(e,t,i){function n(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}var r,o=void 0!==i.precision?i.precision:"highp",a=n(o);a!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",a,"instead."),o=a);var s=!0===i.logarithmicDepthBuffer,l=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),c=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),h=e.getParameter(e.MAX_TEXTURE_SIZE),u=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),d=e.getParameter(e.MAX_VERTEX_ATTRIBS),f=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),p=e.getParameter(e.MAX_VARYING_VECTORS),m=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),g=c>0,v=!!t.get("OES_texture_float");return{getMaxAnisotropy:function(){if(void 0!==r)return r;var i=t.get("EXT_texture_filter_anisotropic");return r=null!==i?e.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:n,precision:o,logarithmicDepthBuffer:s,maxTextures:l,maxVertexTextures:c,maxTextureSize:h,maxCubemapSize:u,maxAttributes:d,maxVertexUniforms:f,maxVaryings:p,maxFragmentUniforms:m,vertexTextures:g,floatFragmentTextures:v,floatVertexTextures:g&&v}}(me,ve,e),(xe=new function(e,t,i){function n(t,i,n){var r=new Uint8Array(4),o=e.createTexture();e.bindTexture(t,o),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(var a=0;a<n;a++)e.texImage2D(i+a,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,r);return o}function r(t){!0!==b[t]&&(e.enable(t),b[t]=!0)}function o(t){!1!==b[t]&&(e.disable(t),b[t]=!1)}function a(t,n,a,s,l,c,h,u){if(t!==ar?r(e.BLEND):o(e.BLEND),t!==ur){if(t!==_||u!==L)switch(t){case lr:u?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ONE,e.ONE,e.ONE,e.ONE)):(e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE));break;case cr:u?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ZERO,e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ONE_MINUS_SRC_ALPHA)):(e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.ONE_MINUS_SRC_COLOR));break;case hr:u?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA)):(e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.SRC_COLOR));break;default:u?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA)):(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA))}M=null,T=null,S=null,E=null,C=null,P=null}else l=l||n,c=c||a,h=h||s,n===M&&l===E||(e.blendEquationSeparate(i.convert(n),i.convert(l)),M=n,E=l),a===T&&s===S&&c===C&&h===P||(e.blendFuncSeparate(i.convert(a),i.convert(s),i.convert(c),i.convert(h)),T=a,S=s,C=c,P=h);_=t,L=u}function s(t){k!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),k=t)}function l(t){t!==Kn?(r(e.CULL_FACE),t!==A&&(t===Yn?e.cullFace(e.BACK):t===Zn?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):o(e.CULL_FACE),A=t}function h(t,i,n){t?(r(e.POLYGON_OFFSET_FILL),O===i&&I===n||(e.polygonOffset(i,n),O=i,I=n)):o(e.POLYGON_OFFSET_FILL)}function u(t){void 0===t&&(t=e.TEXTURE0+B-1),U!==t&&(e.activeTexture(t),U=t)}var d=new function(){var t=!1,i=new c,n=null,r=new c(0,0,0,0);return{setMask:function(i){n===i||t||(e.colorMask(i,i,i,i),n=i)},setLocked:function(e){t=e},setClear:function(t,n,o,a,s){!0===s&&(t*=a,n*=a,o*=a),i.set(t,n,o,a),!1===r.equals(i)&&(e.clearColor(t,n,o,a),r.copy(i))},reset:function(){t=!1,n=null,r.set(-1,0,0,0)}}},f=new function(){var t=!1,i=null,n=null,a=null;return{setTest:function(t){t?r(e.DEPTH_TEST):o(e.DEPTH_TEST)},setMask:function(n){i===n||t||(e.depthMask(n),i=n)},setFunc:function(t){if(n!==t){if(t)switch(t){case Pr:e.depthFunc(e.NEVER);break;case Lr:e.depthFunc(e.ALWAYS);break;case kr:e.depthFunc(e.LESS);break;case Ar:e.depthFunc(e.LEQUAL);break;case Rr:e.depthFunc(e.EQUAL);break;case Or:e.depthFunc(e.GEQUAL);break;case Ir:e.depthFunc(e.GREATER);break;case Br:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}else e.depthFunc(e.LEQUAL);n=t}},setLocked:function(e){t=e},setClear:function(t){a!==t&&(e.clearDepth(t),a=t)},reset:function(){t=!1,i=null,n=null,a=null}}},p=new function(){var t=!1,i=null,n=null,a=null,s=null,l=null,c=null,h=null,u=null;return{setTest:function(t){t?r(e.STENCIL_TEST):o(e.STENCIL_TEST)},setMask:function(n){i===n||t||(e.stencilMask(n),i=n)},setFunc:function(t,i,r){n===t&&a===i&&s===r||(e.stencilFunc(t,i,r),n=t,a=i,s=r)},setOp:function(t,i,n){l===t&&c===i&&h===n||(e.stencilOp(t,i,n),l=t,c=i,h=n)},setLocked:function(e){t=e},setClear:function(t){u!==t&&(e.clearStencil(t),u=t)},reset:function(){t=!1,i=null,n=null,a=null,s=null,l=null,c=null,h=null,u=null}}},m=e.getParameter(e.MAX_VERTEX_ATTRIBS),g=new Uint8Array(m),v=new Uint8Array(m),y=new Uint8Array(m),b={},w=null,x=null,_=null,M=null,T=null,S=null,E=null,C=null,P=null,L=!1,k=null,A=null,R=null,O=null,I=null,B=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),D=!0,U=null,z={},N=new c,j=new c,F={};return F[e.TEXTURE_2D]=n(e.TEXTURE_2D,e.TEXTURE_2D,1),F[e.TEXTURE_CUBE_MAP]=n(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),d.setClear(0,0,0,1),f.setClear(1),p.setClear(0),r(e.DEPTH_TEST),f.setFunc(Ar),s(!1),l(Yn),r(e.CULL_FACE),r(e.BLEND),a(sr),{buffers:{color:d,depth:f,stencil:p},initAttributes:function(){for(var e=0,t=g.length;e<t;e++)g[e]=0},enableAttribute:function(i){g[i]=1,0===v[i]&&(e.enableVertexAttribArray(i),v[i]=1),0!==y[i]&&(t.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(i,0),y[i]=0)},enableAttributeAndDivisor:function(i,n){g[i]=1,0===v[i]&&(e.enableVertexAttribArray(i),v[i]=1),y[i]!==n&&(t.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(i,n),y[i]=n)},disableUnusedAttributes:function(){for(var t=0,i=v.length;t!==i;++t)v[t]!==g[t]&&(e.disableVertexAttribArray(t),v[t]=0)},enable:r,disable:o,getCompressedTextureFormats:function(){if(null===w&&(w=[],t.get("WEBGL_compressed_texture_pvrtc")||t.get("WEBGL_compressed_texture_s3tc")||t.get("WEBGL_compressed_texture_etc1")))for(var i=e.getParameter(e.COMPRESSED_TEXTURE_FORMATS),n=0;n<i.length;n++)w.push(i[n]);return w},useProgram:function(t){return x!==t&&(e.useProgram(t),x=t,!0)},setBlending:a,setMaterial:function(t){t.side===ir?o(e.CULL_FACE):r(e.CULL_FACE),s(t.side===tr),!0===t.transparent?a(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha):a(ar),f.setFunc(t.depthFunc),f.setTest(t.depthTest),f.setMask(t.depthWrite),d.setMask(t.colorWrite),h(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)},setFlipSided:s,setCullFace:l,setLineWidth:function(t){t!==R&&(D&&e.lineWidth(t),R=t)},setPolygonOffset:h,setScissorTest:function(t){t?r(e.SCISSOR_TEST):o(e.SCISSOR_TEST)},activeTexture:u,bindTexture:function(t,i){null===U&&u();var n=z[U];void 0===n&&(n={type:void 0,texture:void 0},z[U]=n),n.type===t&&n.texture===i||(e.bindTexture(t,i||F[t]),n.type=t,n.texture=i)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===N.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),N.copy(t))},viewport:function(t){!1===j.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),j.copy(t))},reset:function(){for(var t=0;t<v.length;t++)1===v[t]&&(e.disableVertexAttribArray(t),v[t]=0);b={},w=null,U=null,z={},x=null,_=null,k=null,A=null,d.reset(),f.reset(),p.reset()}}}(me,ve,qe)).scissor(H.copy(ee).multiplyScalar(Q)),xe.viewport(G.copy($).multiplyScalar(Q)),_e=new function(){var e={};return{get:function(t){var i=t.uuid,n=e[i];return void 0===n&&(n={},e[i]=n),n},remove:function(t){delete e[t.uuid]},clear:function(){e={}}}},Me=new Qe(me,ve,xe,_e,be,qe,fe),Ee=new oe(me),Ce=new function(e,t,i){function n(e){var a=e.target,s=r[a.id];null!==s.index&&t.remove(s.index);for(var l in s.attributes)t.remove(s.attributes[l]);a.removeEventListener("dispose",n),delete r[a.id];var c=o[a.id];c&&(t.remove(c),delete o[a.id]),(c=o[s.id])&&(t.remove(c),delete o[s.id]),i.geometries--}var r={},o={};return{get:function(e,t){var o=r[t.id];return o||(t.addEventListener("dispose",n),t.isBufferGeometry?o=t:t.isGeometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=(new Se).setFromObject(e)),o=t._bufferGeometry),r[t.id]=o,i.geometries++,o)},update:function(i){var n=i.index,r=i.attributes;null!==n&&t.update(n,e.ELEMENT_ARRAY_BUFFER);for(var o in r)t.update(r[o],e.ARRAY_BUFFER);var a=i.morphAttributes;for(var o in a)for(var s=a[o],l=0,c=s.length;l<c;l++)t.update(s[l],e.ARRAY_BUFFER)},getWireframeAttribute:function(i){var n=o[i.id];if(n)return n;var r=[],a=i.index,s=i.attributes;if(null!==a)for(var l=0,c=(f=a.array).length;l<c;l+=3){var h=f[l+0],u=f[l+1],d=f[l+2];r.push(h,u,u,d,d,h)}else for(var f=s.position.array,l=0,c=f.length/3-1;l<c;l+=3){var h=l+0,u=l+1,d=l+2;r.push(h,u,u,d,d,h)}return n=new(Te(r)>65535?we:ye)(r,1),t.update(n,e.ELEMENT_ARRAY_BUFFER),o[i.id]=n,n}}}(me,Ee,fe),Pe=new function(e,t){var i={};return{update:function(n){var r=t.frame,o=n.geometry,a=e.get(n,o);return i[a.id]!==r&&(o.isGeometry&&a.updateFromObject(n),e.update(a),i[a.id]=r),a},clear:function(){i={}}}}(Ce,pe),ze=new function(e){var t={},i=new Float32Array(8);return{update:function(n,r,o,a){var s=n.morphTargetInfluences,l=s.length,c=t[r.id];if(void 0===c){for(c=[],d=0;d<l;d++)c[d]=[d,0];t[r.id]=c}for(var h=o.morphTargets&&r.morphAttributes.position,u=o.morphNormals&&r.morphAttributes.normal,d=0;d<l;d++)0!==(f=c[d])[1]&&(h&&r.removeAttribute("morphTarget"+d),u&&r.removeAttribute("morphNormal"+d));for(d=0;d<l;d++)(f=c[d])[0]=d,f[1]=s[d];for(c.sort(Fe),d=0;d<8;d++){var f=c[d];if(f){var p=f[0],m=f[1];if(m){h&&r.addAttribute("morphTarget"+d,h[p]),u&&r.addAttribute("morphNormal"+d,u[p]),i[d]=m;continue}}i[d]=0}a.getUniforms().setValue(e,"morphTargetInfluences",i)}}}(me),Ie=new Je(I,ve,be),ke=new Ge,Be=new je,De=new function(e,t,i,n){function r(e,i){t.buffers.color.setClear(e.r,e.g,e.b,i,n)}var o,a,s,l=new q(0),c=0;return{getClearColor:function(){return l},setClearColor:function(e,t){l.set(e),r(l,c=void 0!==t?t:1)},getClearAlpha:function(){return c},setClearAlpha:function(e){r(l,c=e)},render:function(t,n,h,u){var d=n.background;null===d?r(l,c):d&&d.isColor&&(r(d,1),u=!0),(e.autoClear||u)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),d&&d.isCubeTexture?(void 0===s&&((s=new Ue(new Le(1,1,1),new Oe({uniforms:ca.cube.uniforms,vertexShader:ca.cube.vertexShader,fragmentShader:ca.cube.fragmentShader,side:tr,depthTest:!0,depthWrite:!1,fog:!1}))).geometry.removeAttribute("normal"),s.geometry.removeAttribute("uv"),s.onBeforeRender=function(e,t,i){this.matrixWorld.copyPosition(i.matrixWorld)},i.update(s.geometry)),s.material.uniforms.tCube.value=d,t.push(s,s.geometry,s.material,0,null)):d&&d.isTexture&&(void 0===o&&(o=new he(-1,1,1,-1,0,1),a=new Ue(new Ae(2,2),new Re({depthTest:!1,depthWrite:!1,fog:!1})),i.update(a.geometry)),a.material.map=d,e.renderBufferDirect(o,null,a.geometry,a.material,a,null))}}}(I,xe,Ce,C),Ne=new function(e,t,i){var n;this.setMode=function(e){n=e},this.render=function(t,r){e.drawArrays(n,t,r),i.calls++,i.vertices+=r,n===e.TRIANGLES?i.faces+=r/3:n===e.POINTS&&(i.points+=r)},this.renderInstances=function(r,o,a){var s=t.get("ANGLE_instanced_arrays");if(null!==s){var l=r.attributes.position;l.isInterleavedBufferAttribute?(a=l.data.count,s.drawArraysInstancedANGLE(n,0,a,r.maxInstancedCount)):s.drawArraysInstancedANGLE(n,o,a,r.maxInstancedCount),i.calls++,i.vertices+=a*r.maxInstancedCount,n===e.TRIANGLES?i.faces+=r.maxInstancedCount*a/3:n===e.POINTS&&(i.points+=r.maxInstancedCount*a)}else console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.")}}(me,ve,pe),He=new function(e,t,i){var n,r,o;this.setMode=function(e){n=e},this.setIndex=function(e){r=e.type,o=e.bytesPerElement},this.render=function(t,a){e.drawElements(n,a,r,t*o),i.calls++,i.vertices+=a,n===e.TRIANGLES?i.faces+=a/3:n===e.POINTS&&(i.points+=a)},this.renderInstances=function(a,s,l){var c=t.get("ANGLE_instanced_arrays");null!==c?(c.drawElementsInstancedANGLE(n,l,r,s*o,a.maxInstancedCount),i.calls++,i.vertices+=l*a.maxInstancedCount,n===e.TRIANGLES?i.faces+=a.maxInstancedCount*l/3:n===e.POINTS&&(i.points+=a.maxInstancedCount*l)):console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.")}}(me,ve,pe),Ve=new K(I,me,xe,Me,be),We=new Z(I,me,xe,Me,be),I.info.programs=Ie.programs,I.context=me,I.capabilities=be,I.extensions=ve,I.properties=_e,I.renderLists=Be,I.state=xe}function r(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),B=!0}function a(){console.log("THREE.WebGLRenderer: Context Restored."),B=!1,i()}function l(e){var t=e.target;t.removeEventListener("dispose",l),function(e){h(e),_e.remove(e)}(t)}function h(e){var t=_e.get(e).program;e.program=void 0,void 0!==t&&Ie.releaseProgram(t)}function u(e){null!==Ze&&Ze(e),(Xe.getDevice()||window).requestAnimationFrame(u)}function f(e,t,i){if(!1!==e.visible){if(e.layers.test(t.layers))if(e.isLight)L.push(e),e.castShadow&&k.push(e);else if(e.isSprite)e.frustumCulled&&!ae.intersectsSprite(e)||R.push(e);else if(e.isLensFlare)O.push(e);else if(e.isImmediateRenderObject)i&&de.setFromMatrixPosition(e.matrixWorld).applyMatrix4(ue),A.push(e,null,e.material,de.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.update(),!e.frustumCulled||ae.intersectsObject(e))){i&&de.setFromMatrixPosition(e.matrixWorld).applyMatrix4(ue);var n=Pe.update(e),r=e.material;if(Array.isArray(r))for(var o=n.groups,a=0,s=o.length;a<s;a++){var l=o[a],c=r[l.materialIndex];c&&c.visible&&A.push(e,n,c,de.z,l)}else r.visible&&A.push(e,n,r,de.z,null)}for(var h=e.children,a=0,s=h.length;a<s;a++)f(h[a],t,i)}}function p(e,t,i,n){for(var r=0,o=e.length;r<o;r++){var a=e[r],s=a.object,l=a.geometry,c=void 0===n?a.material:n,h=a.group;if(i.isArrayCamera){F=i;for(var u=i.cameras,d=0,f=u.length;d<f;d++){var p=u[d];if(s.layers.test(p.layers)){var g=p.bounds,v=g.x*Y,y=g.y*J,b=g.z*Y,w=g.w*J;xe.viewport(G.set(v,y,b,w).multiplyScalar(Q)),m(s,t,p,l,c,h)}}}else F=null,m(s,t,i,l,c,h)}}function m(e,t,i,n,r,o){if(e.onBeforeRender(I,t,i,n,r,o),e.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){xe.setMaterial(r);var a=v(i,t.fog,r,e);N="",function(e,t,i){e.render(function(e){I.renderBufferImmediate(e,t,i)})}(e,a,r)}else I.renderBufferDirect(i,t.fog,n,r,e,o);e.onAfterRender(I,t,i,n,r,o)}function g(e,t,i){var n=_e.get(e),r=Ie.getParameters(e,ke.state,k,t,se.numPlanes,se.numIntersection,i),o=Ie.getProgramCode(e,r),a=n.program,s=!0;if(void 0===a)e.addEventListener("dispose",l);else if(a.code!==o)h(e);else{if(void 0!==r.shaderID)return;s=!1}if(s){if(r.shaderID){var c=ca[r.shaderID];n.shader={name:e.type,uniforms:sa.clone(c.uniforms),vertexShader:c.vertexShader,fragmentShader:c.fragmentShader}}else n.shader={name:e.type,uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};e.onBeforeCompile(n.shader),a=Ie.acquireProgram(e,n.shader,r,o),n.program=a,e.program=a}var u=a.getAttributes();if(e.morphTargets){e.numSupportedMorphTargets=0;for(d=0;d<I.maxMorphTargets;d++)u["morphTarget"+d]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals){e.numSupportedMorphNormals=0;for(var d=0;d<I.maxMorphNormals;d++)u["morphNormal"+d]>=0&&e.numSupportedMorphNormals++}var f=n.shader.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(n.numClippingPlanes=se.numPlanes,n.numIntersection=se.numIntersection,f.clippingPlanes=se.uniform),n.fog=t,n.lightsHash=ke.state.hash,e.lights&&(f.ambientLightColor.value=ke.state.ambient,f.directionalLights.value=ke.state.directional,f.spotLights.value=ke.state.spot,f.rectAreaLights.value=ke.state.rectArea,f.pointLights.value=ke.state.point,f.hemisphereLights.value=ke.state.hemi,f.directionalShadowMap.value=ke.state.directionalShadowMap,f.directionalShadowMatrix.value=ke.state.directionalShadowMatrix,f.spotShadowMap.value=ke.state.spotShadowMap,f.spotShadowMatrix.value=ke.state.spotShadowMatrix,f.pointShadowMap.value=ke.state.pointShadowMap,f.pointShadowMatrix.value=ke.state.pointShadowMatrix);var p=n.program.getUniforms(),m=W.seqWithValue(p.seq,f);n.uniformsList=m}function v(e,t,i,n){X=0;var r=_e.get(i);if(le&&(ce||e!==j)){var o=e===j&&i.id===z;se.setState(i.clippingPlanes,i.clipIntersection,i.clipShadows,e,r,o)}!1===i.needsUpdate&&(void 0===r.program?i.needsUpdate=!0:i.fog&&r.fog!==t?i.needsUpdate=!0:i.lights&&r.lightsHash!==ke.state.hash?i.needsUpdate=!0:void 0===r.numClippingPlanes||r.numClippingPlanes===se.numPlanes&&r.numIntersection===se.numIntersection||(i.needsUpdate=!0)),i.needsUpdate&&(g(i,t,n),i.needsUpdate=!1);var a=!1,s=!1,l=!1,c=r.program,h=c.getUniforms(),u=r.shader.uniforms;if(xe.useProgram(c.program)&&(a=!0,s=!0,l=!0),i.id!==z&&(z=i.id,s=!0),a||e!==j){if(h.setValue(me,"projectionMatrix",e.projectionMatrix),be.logarithmicDepthBuffer&&h.setValue(me,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),j!==(F||e)&&(j=F||e,s=!0,l=!0),i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshStandardMaterial||i.envMap){var f=h.map.cameraPosition;void 0!==f&&f.setValue(me,de.setFromMatrixPosition(e.matrixWorld))}(i.isMeshPhongMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.skinning)&&h.setValue(me,"viewMatrix",e.matrixWorldInverse)}if(i.skinning){h.setOptional(me,n,"bindMatrix"),h.setOptional(me,n,"bindMatrixInverse");var p=n.skeleton;if(p){var m=p.bones;if(be.floatVertexTextures){if(void 0===p.boneTexture){var v=Math.sqrt(4*m.length);v=Zo.ceilPowerOfTwo(v),v=Math.max(v,4);var x=new Float32Array(v*v*4);x.set(p.boneMatrices);var _=new d(x,v,v,xo,fo);p.boneMatrices=x,p.boneTexture=_,p.boneTextureSize=v}h.setValue(me,"boneTexture",p.boneTexture),h.setValue(me,"boneTextureSize",p.boneTextureSize)}else h.setOptional(me,p,"boneMatrices")}}return s&&(h.setValue(me,"toneMappingExposure",I.toneMappingExposure),h.setValue(me,"toneMappingWhitePoint",I.toneMappingWhitePoint),i.lights&&function(e,t){e.ambientLightColor.needsUpdate=t,e.directionalLights.needsUpdate=t,e.pointLights.needsUpdate=t,e.spotLights.needsUpdate=t,e.rectAreaLights.needsUpdate=t,e.hemisphereLights.needsUpdate=t}(u,l),t&&i.fog&&function(e,t){e.fogColor.value=t.color,t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)}(u,t),i.isMeshBasicMaterial?y(u,i):i.isMeshLambertMaterial?(y(u,i),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(u,i)):i.isMeshPhongMaterial?(y(u,i),i.isMeshToonMaterial?function(e,t){b(e,t),t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(u,i):b(u,i)):i.isMeshStandardMaterial?(y(u,i),i.isMeshPhysicalMaterial?function(e,t){e.clearCoat.value=t.clearCoat,e.clearCoatRoughness.value=t.clearCoatRoughness,w(e,t)}(u,i):w(u,i)):i.isMeshDepthMaterial?(y(u,i),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(u,i)):i.isMeshDistanceMaterial?(y(u,i),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias);e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(u,i)):i.isMeshNormalMaterial?(y(u,i),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale);t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale));t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(u,i)):i.isLineBasicMaterial?(function(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}(u,i),i.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(u,i)):i.isPointsMaterial?function(e,t){if(e.diffuse.value=t.color,e.opacity.value=t.opacity,e.size.value=t.size*Q,e.scale.value=.5*J,e.map.value=t.map,null!==t.map){if(!0===t.map.matrixAutoUpdate){var i=t.map.offset,n=t.map.repeat,r=t.map.rotation,o=t.map.center;t.map.matrix.setUvTransform(i.x,i.y,n.x,n.y,r,o.x,o.y)}e.uvTransform.value.copy(t.map.matrix)}}(u,i):i.isShadowMaterial&&(u.color.value=i.color,u.opacity.value=i.opacity),void 0!==u.ltcMat&&(u.ltcMat.value=aa.LTC_MAT_TEXTURE),void 0!==u.ltcMag&&(u.ltcMag.value=aa.LTC_MAG_TEXTURE),W.upload(me,r.uniformsList,u,I)),h.setValue(me,"modelViewMatrix",n.modelViewMatrix),h.setValue(me,"normalMatrix",n.normalMatrix),h.setValue(me,"modelMatrix",n.matrixWorld),c}function y(e,t){e.opacity.value=t.opacity,t.color&&(e.diffuse.value=t.color),t.emissive&&e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity),t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.specularMap&&(e.specularMap.value=t.specularMap),t.envMap&&(e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap&&t.envMap.isCubeTexture?-1:1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio),t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity);var i;if(t.map?i=t.map:t.specularMap?i=t.specularMap:t.displacementMap?i=t.displacementMap:t.normalMap?i=t.normalMap:t.bumpMap?i=t.bumpMap:t.roughnessMap?i=t.roughnessMap:t.metalnessMap?i=t.metalnessMap:t.alphaMap?i=t.alphaMap:t.emissiveMap&&(i=t.emissiveMap),void 0!==i){if(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate){var n=i.offset,r=i.repeat,o=i.rotation,a=i.center;i.matrix.setUvTransform(n.x,n.y,r.x,r.y,o,a.x,a.y)}e.uvTransform.value.copy(i.matrix)}}function b(e,t){e.specular.value=t.specular,e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale)),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function w(e,t){e.roughness.value=t.roughness,e.metalness.value=t.metalness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap),t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale)),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),t.envMap&&(e.envMapIntensity.value=t.envMapIntensity)}console.log("THREE.WebGLRenderer",Xn);var x=void 0!==(e=e||{}).canvas?e.canvas:document.createElement("canvas"),_=void 0!==e.context?e.context:null,M=void 0!==e.alpha&&e.alpha,T=void 0===e.depth||e.depth,S=void 0===e.stencil||e.stencil,E=void 0!==e.antialias&&e.antialias,C=void 0===e.premultipliedAlpha||e.premultipliedAlpha,P=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,L=[],k=[],A=null,R=[],O=[];this.domElement=x,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyCorrectLights=!1,this.toneMapping=jr,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var I=this,B=!1,D=null,U=null,z=-1,N="",j=null,F=null,G=new c,H=new c,V=null,X=0,Y=x.width,J=x.height,Q=1,$=new c(0,0,Y,J),ee=new c(0,0,Y,J),te=!1,ae=new ne,se=new function(){function e(){h.value!==n&&(h.value=n,h.needsUpdate=r>0),i.numPlanes=r,i.numIntersection=0}function t(e,t,n,r){var o=null!==e?e.length:0,a=null;if(0!==o){if(a=h.value,!0!==r||null===a){var s=n+4*o,u=t.matrixWorldInverse;c.getNormalMatrix(u),(null===a||a.length<s)&&(a=new Float32Array(s));for(var d=0,f=n;d!==o;++d,f+=4)l.copy(e[d]).applyMatrix4(u,c),l.normal.toArray(a,f),a[f+3]=l.constant}h.value=a,h.needsUpdate=!0}return i.numPlanes=o,a}var i=this,n=null,r=0,o=!1,a=!1,l=new ie,c=new s,h={value:null,needsUpdate:!1};this.uniform=h,this.numPlanes=0,this.numIntersection=0,this.init=function(e,i,a){var s=0!==e.length||i||0!==r||o;return o=i,n=t(e,a,0),r=e.length,s},this.beginShadows=function(){a=!0,t(null)},this.endShadows=function(){a=!1,e()},this.setState=function(i,s,l,c,u,d){if(!o||null===i||0===i.length||a&&!l)a?t(null):e();else{var f=a?0:r,p=4*f,m=u.clippingState||null;h.value=m,m=t(i,c,p,d);for(var g=0;g!==p;++g)m[g]=n[g];u.clippingState=m,this.numIntersection=s?this.numPlanes:0,this.numPlanes+=f}}},le=!1,ce=!1,ue=new n,de=new o,fe={geometries:0,textures:0},pe={frame:0,calls:0,vertices:0,faces:0,points:0};this.info={render:pe,memory:fe,programs:null};var me;try{var ge={alpha:M,depth:T,stencil:S,antialias:E,premultipliedAlpha:C,preserveDrawingBuffer:P};if(null===(me=_||x.getContext("webgl",ge)||x.getContext("experimental-webgl",ge)))throw null!==x.getContext("webgl")?"Error creating WebGL context with your selected attributes.":"Error creating WebGL context.";void 0===me.getShaderPrecisionFormat&&(me.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}),x.addEventListener("webglcontextlost",r,!1),x.addEventListener("webglcontextrestored",a,!1)}catch(e){console.error("THREE.WebGLRenderer: "+e)}var ve,be,xe,_e,Me,Ee,Ce,Pe,ke,Ie,Be,De,ze,Ne,He,Ve,We,qe;i();var Xe=new function(e){function t(){if(null!==r&&r.isPresenting){var t=r.getEyeParameters("left"),n=t.renderWidth,o=t.renderHeight;p=e.getPixelRatio(),f=e.getSize(),e.setDrawingBufferSize(2*n,o,1)}else i.enabled&&e.setDrawingBufferSize(f.width,f.height,p)}var i=this,r=null,o=null;"undefined"!=typeof window&&"VRFrameData"in window&&(o=new window.VRFrameData);var a=new n,s=new n,l=new n,h=new $e;h.bounds=new c(0,0,.5,1),h.layers.enable(1);var u=new $e;u.bounds=new c(.5,0,.5,1),u.layers.enable(2);var d=new et([h,u]);d.layers.enable(1),d.layers.enable(2);var f,p;"undefined"!=typeof window&&window.addEventListener("vrdisplaypresentchange",t,!1),this.enabled=!1,this.standing=!1,this.getDevice=function(){return r},this.setDevice=function(e){void 0!==e&&(r=e)},this.getCamera=function(e){if(null===r)return e;r.depthNear=e.near,r.depthFar=e.far,r.getFrameData(o);var t=o.pose;null!==t.position?e.position.fromArray(t.position):e.position.set(0,0,0),null!==t.orientation&&e.quaternion.fromArray(t.orientation),e.updateMatrixWorld();var i=r.stageParameters;if(this.standing&&i&&(s.fromArray(i.sittingToStandingTransform),l.getInverse(s),e.matrixWorld.multiply(s),e.matrixWorldInverse.multiply(l)),!1===r.isPresenting)return e;h.near=e.near,u.near=e.near,h.far=e.far,u.far=e.far,d.matrixWorld.copy(e.matrixWorld),d.matrixWorldInverse.copy(e.matrixWorldInverse),h.matrixWorldInverse.fromArray(o.leftViewMatrix),u.matrixWorldInverse.fromArray(o.rightViewMatrix),this.standing&&i&&(h.matrixWorldInverse.multiply(l),u.matrixWorldInverse.multiply(l));var n=e.parent;null!==n&&(a.getInverse(n.matrixWorld),h.matrixWorldInverse.multiply(a),u.matrixWorldInverse.multiply(a)),h.matrixWorld.getInverse(h.matrixWorldInverse),u.matrixWorld.getInverse(u.matrixWorldInverse),h.projectionMatrix.fromArray(o.leftProjectionMatrix),u.projectionMatrix.fromArray(o.rightProjectionMatrix),d.projectionMatrix.copy(h.projectionMatrix);var c=r.getLayers();if(c.length){var f=c[0];null!==f.leftBounds&&4===f.leftBounds.length&&h.bounds.fromArray(f.leftBounds),null!==f.rightBounds&&4===f.rightBounds.length&&u.bounds.fromArray(f.rightBounds)}return d},this.getStandingMatrix=function(){return s},this.submitFrame=function(){r&&r.isPresenting&&r.submitFrame()},this.dispose=function(){window.removeEventListener("vrdisplaypresentchange",t)}}(I);this.vr=Xe;var Ke=new re(I,Pe,be.maxTextureSize);this.shadowMap=Ke,this.getContext=function(){return me},this.getContextAttributes=function(){return me.getContextAttributes()},this.forceContextLoss=function(){var e=ve.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=ve.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return Q},this.setPixelRatio=function(e){void 0!==e&&(Q=e,this.setSize(Y,J,!1))},this.getSize=function(){return{width:Y,height:J}},this.setSize=function(e,t,i){var n=Xe.getDevice();n&&n.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(Y=e,J=t,x.width=e*Q,x.height=t*Q,!1!==i&&(x.style.width=e+"px",x.style.height=t+"px"),this.setViewport(0,0,e,t))},this.getDrawingBufferSize=function(){return{width:Y*Q,height:J*Q}},this.setDrawingBufferSize=function(e,t,i){Y=e,J=t,Q=i,x.width=e*i,x.height=t*i,this.setViewport(0,0,e,t)},this.setViewport=function(e,t,i,n){$.set(e,J-t-n,i,n),xe.viewport(G.copy($).multiplyScalar(Q))},this.setScissor=function(e,t,i,n){ee.set(e,J-t-n,i,n),xe.scissor(H.copy(ee).multiplyScalar(Q))},this.setScissorTest=function(e){xe.setScissorTest(te=e)},this.getClearColor=function(){return De.getClearColor()},this.setClearColor=function(){De.setClearColor.apply(De,arguments)},this.getClearAlpha=function(){return De.getClearAlpha()},this.setClearAlpha=function(){De.setClearAlpha.apply(De,arguments)},this.clear=function(e,t,i){var n=0;(void 0===e||e)&&(n|=me.COLOR_BUFFER_BIT),(void 0===t||t)&&(n|=me.DEPTH_BUFFER_BIT),(void 0===i||i)&&(n|=me.STENCIL_BUFFER_BIT),me.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.clearTarget=function(e,t,i,n){this.setRenderTarget(e),this.clear(t,i,n)},this.dispose=function(){x.removeEventListener("webglcontextlost",r,!1),x.removeEventListener("webglcontextrestored",a,!1),Be.dispose(),Xe.dispose()},this.renderBufferImmediate=function(e,t,i){xe.initAttributes();var n=_e.get(e);e.hasPositions&&!n.position&&(n.position=me.createBuffer()),e.hasNormals&&!n.normal&&(n.normal=me.createBuffer()),e.hasUvs&&!n.uv&&(n.uv=me.createBuffer()),e.hasColors&&!n.color&&(n.color=me.createBuffer());var r=t.getAttributes();if(e.hasPositions&&(me.bindBuffer(me.ARRAY_BUFFER,n.position),me.bufferData(me.ARRAY_BUFFER,e.positionArray,me.DYNAMIC_DRAW),xe.enableAttribute(r.position),me.vertexAttribPointer(r.position,3,me.FLOAT,!1,0,0)),e.hasNormals){if(me.bindBuffer(me.ARRAY_BUFFER,n.normal),!i.isMeshPhongMaterial&&!i.isMeshStandardMaterial&&!i.isMeshNormalMaterial&&!0===i.flatShading)for(var o=0,a=3*e.count;o<a;o+=9){var s=e.normalArray,l=(s[o+0]+s[o+3]+s[o+6])/3,c=(s[o+1]+s[o+4]+s[o+7])/3,h=(s[o+2]+s[o+5]+s[o+8])/3;s[o+0]=l,s[o+1]=c,s[o+2]=h,s[o+3]=l,s[o+4]=c,s[o+5]=h,s[o+6]=l,s[o+7]=c,s[o+8]=h}me.bufferData(me.ARRAY_BUFFER,e.normalArray,me.DYNAMIC_DRAW),xe.enableAttribute(r.normal),me.vertexAttribPointer(r.normal,3,me.FLOAT,!1,0,0)}e.hasUvs&&i.map&&(me.bindBuffer(me.ARRAY_BUFFER,n.uv),me.bufferData(me.ARRAY_BUFFER,e.uvArray,me.DYNAMIC_DRAW),xe.enableAttribute(r.uv),me.vertexAttribPointer(r.uv,2,me.FLOAT,!1,0,0)),e.hasColors&&i.vertexColors!==nr&&(me.bindBuffer(me.ARRAY_BUFFER,n.color),me.bufferData(me.ARRAY_BUFFER,e.colorArray,me.DYNAMIC_DRAW),xe.enableAttribute(r.color),me.vertexAttribPointer(r.color,3,me.FLOAT,!1,0,0)),xe.disableUnusedAttributes(),me.drawArrays(me.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,i,n,r,o,a){xe.setMaterial(r);var s=v(e,i,r,o),l=n.id+"_"+s.id+"_"+(!0===r.wireframe),c=!1;l!==N&&(N=l,c=!0),o.morphTargetInfluences&&(ze.update(o,n,r,s),c=!0);var h=n.index,u=n.attributes.position,d=1;!0===r.wireframe&&(h=Ce.getWireframeAttribute(n),d=2);var f,p=Ne;null!==h&&(f=Ee.get(h),(p=He).setIndex(f)),c&&(!function(e,t,i,n){if(i&&i.isInstancedBufferGeometry&&null===ve.get("ANGLE_instanced_arrays"))console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");else{void 0===n&&(n=0),xe.initAttributes();var r=i.attributes,o=t.getAttributes(),a=e.defaultAttributeValues;for(var s in o){var l=o[s];if(l>=0){var c=r[s];if(void 0!==c){var h=c.normalized,u=c.itemSize,d=Ee.get(c);if(void 0===d)continue;var f=d.buffer,p=d.type,m=d.bytesPerElement;if(c.isInterleavedBufferAttribute){var g=c.data,v=g.stride,y=c.offset;g&&g.isInstancedInterleavedBuffer?(xe.enableAttributeAndDivisor(l,g.meshPerAttribute),void 0===i.maxInstancedCount&&(i.maxInstancedCount=g.meshPerAttribute*g.count)):xe.enableAttribute(l),me.bindBuffer(me.ARRAY_BUFFER,f),me.vertexAttribPointer(l,u,p,h,v*m,(n*v+y)*m)}else c.isInstancedBufferAttribute?(xe.enableAttributeAndDivisor(l,c.meshPerAttribute),void 0===i.maxInstancedCount&&(i.maxInstancedCount=c.meshPerAttribute*c.count)):xe.enableAttribute(l),me.bindBuffer(me.ARRAY_BUFFER,f),me.vertexAttribPointer(l,u,p,h,0,n*u*m)}else if(void 0!==a){var b=a[s];if(void 0!==b)switch(b.length){case 2:me.vertexAttrib2fv(l,b);break;case 3:me.vertexAttrib3fv(l,b);break;case 4:me.vertexAttrib4fv(l,b);break;default:me.vertexAttrib1fv(l,b)}}}}xe.disableUnusedAttributes()}}(r,s,n),null!==h&&me.bindBuffer(me.ELEMENT_ARRAY_BUFFER,f.buffer));var m=0;null!==h?m=h.count:void 0!==u&&(m=u.count);var g=n.drawRange.start*d,y=n.drawRange.count*d,b=null!==a?a.start*d:0,w=null!==a?a.count*d:1/0,x=Math.max(g,b),_=Math.min(m,g+y,b+w)-1,M=Math.max(0,_-x+1);if(0!==M){if(o.isMesh)if(!0===r.wireframe)xe.setLineWidth(r.wireframeLinewidth*t()),p.setMode(me.LINES);else switch(o.drawMode){case zo:p.setMode(me.TRIANGLES);break;case No:p.setMode(me.TRIANGLE_STRIP);break;case jo:p.setMode(me.TRIANGLE_FAN)}else if(o.isLine){var T=r.linewidth;void 0===T&&(T=1),xe.setLineWidth(T*t()),o.isLineSegments?p.setMode(me.LINES):o.isLineLoop?p.setMode(me.LINE_LOOP):p.setMode(me.LINE_STRIP)}else o.isPoints&&p.setMode(me.POINTS);n&&n.isInstancedBufferGeometry?n.maxInstancedCount>0&&p.renderInstances(n,x,M):p.render(x,M)}},this.compile=function(e,t){L.length=0,k.length=0,e.traverse(function(e){e.isLight&&(L.push(e),e.castShadow&&k.push(e))}),ke.setup(L,k,t),e.traverse(function(t){if(t.material)if(Array.isArray(t.material))for(var i=0;i<t.material.length;i++)g(t.material[i],e.fog,t);else g(t.material,e.fog,t)})};var Ye=!1,Ze=null;this.animate=function(e){Ze=e,Ye||((Xe.getDevice()||window).requestAnimationFrame(u),Ye=!0)},this.render=function(e,t,i,n){if(t&&t.isCamera){if(!B){N="",z=-1,j=null,!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),Xe.enabled&&(t=Xe.getCamera(t)),ue.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),ae.setFromMatrix(ue),L.length=0,k.length=0,R.length=0,O.length=0,ce=this.localClippingEnabled,le=se.init(this.clippingPlanes,ce,t),(A=Be.get(e,t)).init(),f(e,t,I.sortObjects),!0===I.sortObjects&&A.sort(),le&&se.beginShadows(),Ke.render(k,e,t),ke.setup(L,k,t),le&&se.endShadows(),pe.frame++,pe.calls=0,pe.vertices=0,pe.faces=0,pe.points=0,void 0===i&&(i=null),this.setRenderTarget(i),De.render(A,e,t,n);var r=A.opaque,o=A.transparent;if(e.overrideMaterial){var a=e.overrideMaterial;r.length&&p(r,e,t,a),o.length&&p(o,e,t,a)}else r.length&&p(r,e,t),o.length&&p(o,e,t);We.render(R,e,t),Ve.render(O,e,t,G),i&&Me.updateRenderTargetMipmap(i),xe.buffers.depth.setTest(!0),xe.buffers.depth.setMask(!0),xe.buffers.color.setMask(!0),xe.setPolygonOffset(!1),Xe.enabled&&Xe.submitFrame()}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.setFaceCulling=function(e,t){xe.setCullFace(e),xe.setFlipSided(t===Jn)},this.allocTextureUnit=function(){var e=X;return e>=be.maxTextures&&console.warn("THREE.WebGLRenderer: Trying to use "+e+" texture units while this GPU supports only "+be.maxTextures),X+=1,e},this.setTexture2D=function(){var e=!1;return function(t,i){t&&t.isWebGLRenderTarget&&(e||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),e=!0),t=t.texture),Me.setTexture2D(t,i)}}(),this.setTexture=function(){var e=!1;return function(t,i){e||(console.warn("THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead."),e=!0),Me.setTexture2D(t,i)}}(),this.setTextureCube=function(){var e=!1;return function(t,i){t&&t.isWebGLRenderTargetCube&&(e||(console.warn("THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead."),e=!0),t=t.texture),t&&t.isCubeTexture||Array.isArray(t.image)&&6===t.image.length?Me.setTextureCube(t,i):Me.setTextureCubeDynamic(t,i)}}(),this.getRenderTarget=function(){return D},this.setRenderTarget=function(e){D=e,e&&void 0===_e.get(e).__webglFramebuffer&&Me.setupRenderTarget(e);var t=null,i=!1;if(e){var n=_e.get(e).__webglFramebuffer;e.isWebGLRenderTargetCube?(t=n[e.activeCubeFace],i=!0):t=n,G.copy(e.viewport),H.copy(e.scissor),V=e.scissorTest}else G.copy($).multiplyScalar(Q),H.copy(ee).multiplyScalar(Q),V=te;if(U!==t&&(me.bindFramebuffer(me.FRAMEBUFFER,t),U=t),xe.viewport(G),xe.scissor(H),xe.setScissorTest(V),i){var r=_e.get(e.texture);me.framebufferTexture2D(me.FRAMEBUFFER,me.COLOR_ATTACHMENT0,me.TEXTURE_CUBE_MAP_POSITIVE_X+e.activeCubeFace,r.__webglTexture,e.activeMipMapLevel)}},this.readRenderTargetPixels=function(e,t,i,n,r,o){if(e&&e.isWebGLRenderTarget){var a=_e.get(e).__webglFramebuffer;if(a){var s=!1;a!==U&&(me.bindFramebuffer(me.FRAMEBUFFER,a),s=!0);try{var l=e.texture,c=l.format,h=l.type;if(c!==xo&&qe.convert(c)!==me.getParameter(me.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(h===ao||qe.convert(h)===me.getParameter(me.IMPLEMENTATION_COLOR_READ_TYPE)||h===fo&&(ve.get("OES_texture_float")||ve.get("WEBGL_color_buffer_float"))||h===po&&ve.get("EXT_color_buffer_half_float")))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");me.checkFramebufferStatus(me.FRAMEBUFFER)===me.FRAMEBUFFER_COMPLETE?t>=0&&t<=e.width-n&&i>=0&&i<=e.height-r&&me.readPixels(t,i,n,r,qe.convert(c),qe.convert(h),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{s&&me.bindFramebuffer(me.FRAMEBUFFER,U)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")}}function nt(e,t){this.name="",this.color=new q(e),this.density=void 0!==t?t:25e-5}function rt(e,t,i){this.name="",this.color=new q(e),this.near=void 0!==t?t:1,this.far=void 0!==i?i:1e3}function ot(){le.call(this),this.type="Scene",this.background=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0}function at(e,t,i,n,r){le.call(this),this.lensFlares=[],this.positionScreen=new o,this.customUpdateCallback=void 0,void 0!==e&&this.add(e,t,i,n,r)}function st(e){J.call(this),this.type="SpriteMaterial",this.color=new q(16777215),this.map=null,this.rotation=0,this.fog=!1,this.lights=!1,this.setValues(e)}function lt(e){le.call(this),this.type="Sprite",this.material=void 0!==e?e:new st}function ct(){le.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}function ht(e,t){if(e=e||[],this.bones=e.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var i=0,r=this.bones.length;i<r;i++)this.boneInverses.push(new n)}}function ut(){le.call(this),this.type="Bone"}function dt(e,t){Ue.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new n,this.bindMatrixInverse=new n;var i=new ht(this.initBones());this.bind(i,this.matrixWorld),this.normalizeSkinWeights()}function ft(e){J.call(this),this.type="LineBasicMaterial",this.color=new q(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.lights=!1,this.setValues(e)}function pt(e,t,i){if(1===i)return console.warn("THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead."),new mt(e,t);le.call(this),this.type="Line",this.geometry=void 0!==e?e:new Se,this.material=void 0!==t?t:new ft({color:16777215*Math.random()})}function mt(e,t){pt.call(this,e,t),this.type="LineSegments"}function gt(e,t){pt.call(this,e,t),this.type="LineLoop"}function vt(e){J.call(this),this.type="PointsMaterial",this.color=new q(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.lights=!1,this.setValues(e)}function yt(e,t){le.call(this),this.type="Points",this.geometry=void 0!==e?e:new Se,this.material=void 0!==t?t:new vt({color:16777215*Math.random()})}function bt(){le.call(this),this.type="Group"}function wt(e,t,i,n,r,o,a,s,c){function h(){e.readyState>=e.HAVE_CURRENT_DATA&&(u.needsUpdate=!0),requestAnimationFrame(h)}l.call(this,e,t,i,n,r,o,a,s,c),this.generateMipmaps=!1;var u=this;requestAnimationFrame(h)}function xt(e,t,i,n,r,o,a,s,c,h,u,d){l.call(this,null,o,a,s,c,h,n,r,u,d),this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}function _t(e,t,i,n,r,o,a,s,c,h){if((h=void 0!==h?h:So)!==So&&h!==Eo)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&h===So&&(i=co),void 0===i&&h===Eo&&(i=yo),l.call(this,null,n,r,o,a,s,h,i,c),this.image={width:e,height:t},this.magFilter=void 0!==a?a:eo,this.minFilter=void 0!==s?s:eo,this.flipY=!1,this.generateMipmaps=!1}function Mt(e,t,i){de.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:i},this.fromBufferGeometry(new Tt(e,t,i)),this.mergeVertices()}function Tt(e,t,i){Se.call(this),this.type="ParametricBufferGeometry",this.parameters={func:e,slices:t,stacks:i};var n,r,a=[],s=[],l=[],c=[],h=new o,u=new o,d=new o,f=new o,p=new o,m=t+1;for(n=0;n<=i;n++){var g=n/i;for(r=0;r<=t;r++){var v=r/t;u=e(v,g,u),s.push(u.x,u.y,u.z),v-1e-5>=0?(d=e(v-1e-5,g,d),f.subVectors(u,d)):(d=e(v+1e-5,g,d),f.subVectors(d,u)),g-1e-5>=0?(d=e(v,g-1e-5,d),p.subVectors(u,d)):(d=e(v,g+1e-5,d),p.subVectors(d,u)),h.crossVectors(f,p).normalize(),l.push(h.x,h.y,h.z),c.push(v,g)}}for(n=0;n<i;n++)for(r=0;r<t;r++){var y=n*m+r,b=n*m+r+1,w=(n+1)*m+r+1,x=(n+1)*m+r;a.push(y,b,x),a.push(b,w,x)}this.setIndex(a),this.addAttribute("position",new xe(s,3)),this.addAttribute("normal",new xe(l,3)),this.addAttribute("uv",new xe(c,2))}function St(e,t,i,n){de.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:n},this.fromBufferGeometry(new Et(e,t,i,n)),this.mergeVertices()}function Et(e,t,n,r){function a(e){for(var i=new o,n=new o,r=new o,a=0;a<t.length;a+=3)c(t[a+0],i),c(t[a+1],n),c(t[a+2],r),function(e,t,i,n){var r,o,a=Math.pow(2,n),s=[];for(r=0;r<=a;r++){s[r]=[];var c=e.clone().lerp(i,r/a),h=t.clone().lerp(i,r/a),u=a-r;for(o=0;o<=u;o++)s[r][o]=0===o&&r===a?c:c.clone().lerp(h,o/u)}for(r=0;r<a;r++)for(o=0;o<2*(a-r)-1;o++){var d=Math.floor(o/2);o%2==0?(l(s[r][d+1]),l(s[r+1][d]),l(s[r][d])):(l(s[r][d+1]),l(s[r+1][d+1]),l(s[r+1][d]))}}(i,n,r,e)}function s(){for(var e=new o,t=0;t<d.length;t+=3){e.x=d[t+0],e.y=d[t+1],e.z=d[t+2];var n=u(e)/2/Math.PI+.5,r=function(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}(e)/Math.PI+.5;f.push(n,1-r)}!function(){for(var e=new o,t=new o,n=new o,r=new o,a=new i,s=new i,l=new i,c=0,p=0;c<d.length;c+=9,p+=6){e.set(d[c+0],d[c+1],d[c+2]),t.set(d[c+3],d[c+4],d[c+5]),n.set(d[c+6],d[c+7],d[c+8]),a.set(f[p+0],f[p+1]),s.set(f[p+2],f[p+3]),l.set(f[p+4],f[p+5]),r.copy(e).add(t).add(n).divideScalar(3);var m=u(r);h(a,p+0,e,m),h(s,p+2,t,m),h(l,p+4,n,m)}}(),function(){for(var e=0;e<f.length;e+=6){var t=f[e+0],i=f[e+2],n=f[e+4],r=Math.max(t,i,n),o=Math.min(t,i,n);r>.9&&o<.1&&(t<.2&&(f[e+0]+=1),i<.2&&(f[e+2]+=1),n<.2&&(f[e+4]+=1))}}()}function l(e){d.push(e.x,e.y,e.z)}function c(t,i){var n=3*t;i.x=e[n+0],i.y=e[n+1],i.z=e[n+2]}function h(e,t,i,n){n<0&&1===e.x&&(f[t]=e.x-1),0===i.x&&0===i.z&&(f[t]=n/2/Math.PI+.5)}function u(e){return Math.atan2(e.z,-e.x)}Se.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:r},n=n||1;var d=[],f=[];a(r=r||0),function(e){for(var t=new o,i=0;i<d.length;i+=3)t.x=d[i+0],t.y=d[i+1],t.z=d[i+2],t.normalize().multiplyScalar(e),d[i+0]=t.x,d[i+1]=t.y,d[i+2]=t.z}(n),s(),this.addAttribute("position",new xe(d,3)),this.addAttribute("normal",new xe(d.slice(),3)),this.addAttribute("uv",new xe(f,2)),0===r?this.computeVertexNormals():this.normalizeNormals()}function Ct(e,t){de.call(this),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Pt(e,t)),this.mergeVertices()}function Pt(e,t){Et.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Lt(e,t){de.call(this),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new kt(e,t)),this.mergeVertices()}function kt(e,t){Et.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronBufferGeometry",this.parameters={radius:e,detail:t}}function At(e,t){de.call(this),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Rt(e,t)),this.mergeVertices()}function Rt(e,t){var i=(1+Math.sqrt(5))/2;Et.call(this,[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Ot(e,t){de.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},this.fromBufferGeometry(new It(e,t)),this.mergeVertices()}function It(e,t){void 0!==e&&(Se.call(this),this.type="ExtrudeBufferGeometry",e=Array.isArray(e)?e:[e],this.addShapeList(e,t),this.computeVertexNormals())}function Bt(e,t){de.call(this),this.type="TextGeometry",this.parameters={text:e,parameters:t},this.fromBufferGeometry(new Dt(e,t)),this.mergeVertices()}function Dt(e,t){var i=(t=t||{}).font;if(!i||!i.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new de;var n=i.generateShapes(e,t.size,t.curveSegments);t.amount=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),It.call(this,n,t),this.type="TextBufferGeometry"}function Ut(e,t,i,n,r,o,a){de.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:n,phiLength:r,thetaStart:o,thetaLength:a},this.fromBufferGeometry(new zt(e,t,i,n,r,o,a)),this.mergeVertices()}function zt(e,t,i,n,r,a,s){Se.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:n,phiLength:r,thetaStart:a,thetaLength:s},e=e||1,t=Math.max(3,Math.floor(t)||8),i=Math.max(2,Math.floor(i)||6),n=void 0!==n?n:0,r=void 0!==r?r:2*Math.PI;var l,c,h=(a=void 0!==a?a:0)+(s=void 0!==s?s:Math.PI),u=0,d=[],f=new o,p=new o,m=[],g=[],v=[],y=[];for(c=0;c<=i;c++){var b=[],w=c/i;for(l=0;l<=t;l++){var x=l/t;f.x=-e*Math.cos(n+x*r)*Math.sin(a+w*s),f.y=e*Math.cos(a+w*s),f.z=e*Math.sin(n+x*r)*Math.sin(a+w*s),g.push(f.x,f.y,f.z),p.set(f.x,f.y,f.z).normalize(),v.push(p.x,p.y,p.z),y.push(x,1-w),b.push(u++)}d.push(b)}for(c=0;c<i;c++)for(l=0;l<t;l++){var _=d[c][l+1],M=d[c][l],T=d[c+1][l],S=d[c+1][l+1];(0!==c||a>0)&&m.push(_,M,S),(c!==i-1||h<Math.PI)&&m.push(M,T,S)}this.setIndex(m),this.addAttribute("position",new xe(g,3)),this.addAttribute("normal",new xe(v,3)),this.addAttribute("uv",new xe(y,2))}function Nt(e,t,i,n,r,o){de.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:n,thetaStart:r,thetaLength:o},this.fromBufferGeometry(new jt(e,t,i,n,r,o)),this.mergeVertices()}function jt(e,t,n,r,a,s){Se.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:r,thetaStart:a,thetaLength:s},e=e||.5,t=t||1,a=void 0!==a?a:0,s=void 0!==s?s:2*Math.PI,n=void 0!==n?Math.max(3,n):8;var l,c,h,u=[],d=[],f=[],p=[],m=e,g=(t-e)/(r=void 0!==r?Math.max(1,r):1),v=new o,y=new i;for(c=0;c<=r;c++){for(h=0;h<=n;h++)l=a+h/n*s,v.x=m*Math.cos(l),v.y=m*Math.sin(l),d.push(v.x,v.y,v.z),f.push(0,0,1),y.x=(v.x/t+1)/2,y.y=(v.y/t+1)/2,p.push(y.x,y.y);m+=g}for(c=0;c<r;c++){var b=c*(n+1);for(h=0;h<n;h++){var w=l=h+b,x=l+n+1,_=l+n+2,M=l+1;u.push(w,x,M),u.push(x,_,M)}}this.setIndex(u),this.addAttribute("position",new xe(d,3)),this.addAttribute("normal",new xe(f,3)),this.addAttribute("uv",new xe(p,2))}function Ft(e,t,i,n,r,o,a,s){de.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:n,heightSegments:r,openEnded:o,thetaStart:a,thetaLength:s},this.fromBufferGeometry(new Gt(e,t,i,n,r,o,a,s)),this.mergeVertices()}function Gt(e,t,n,r,a,s,l,c){function h(n){var a,s,h,v=new i,w=new o,x=0,_=!0===n?e:t,M=!0===n?1:-1;for(s=g,a=1;a<=r;a++)f.push(0,y*M,0),p.push(0,M,0),m.push(.5,.5),g++;for(h=g,a=0;a<=r;a++){var T=a/r*c+l,S=Math.cos(T),E=Math.sin(T);w.x=_*E,w.y=y*M,w.z=_*S,f.push(w.x,w.y,w.z),p.push(0,M,0),v.x=.5*S+.5,v.y=.5*E*M+.5,m.push(v.x,v.y),g++}for(a=0;a<r;a++){var C=s+a,P=h+a;!0===n?d.push(P,P+1,C):d.push(P+1,P,C),x+=3}u.addGroup(b,x,!0===n?1:2),b+=x}Se.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:a,openEnded:s,thetaStart:l,thetaLength:c};var u=this;e=void 0!==e?e:1,t=void 0!==t?t:1,n=n||1,r=Math.floor(r)||8,a=Math.floor(a)||1,s=void 0!==s&&s,l=void 0!==l?l:0,c=void 0!==c?c:2*Math.PI;var d=[],f=[],p=[],m=[],g=0,v=[],y=n/2,b=0;!function(){var i,s,h=new o,w=new o,x=0,_=(t-e)/n;for(s=0;s<=a;s++){var M=[],T=s/a,S=T*(t-e)+e;for(i=0;i<=r;i++){var E=i/r,C=E*c+l,P=Math.sin(C),L=Math.cos(C);w.x=S*P,w.y=-T*n+y,w.z=S*L,f.push(w.x,w.y,w.z),h.set(P,_,L).normalize(),p.push(h.x,h.y,h.z),m.push(E,1-T),M.push(g++)}v.push(M)}for(i=0;i<r;i++)for(s=0;s<a;s++){var k=v[s][i],A=v[s+1][i],R=v[s+1][i+1],O=v[s][i+1];d.push(k,A,O),d.push(A,R,O),x+=6}u.addGroup(b,x,0),b+=x}(),!1===s&&(e>0&&h(!0),t>0&&h(!1)),this.setIndex(d),this.addAttribute("position",new xe(f,3)),this.addAttribute("normal",new xe(p,3)),this.addAttribute("uv",new xe(m,2))}function Ht(e,t,i,n,r,o,a){Ft.call(this,0,e,t,i,n,r,o,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:n,openEnded:r,thetaStart:o,thetaLength:a}}function Vt(e,t,i,n,r,o,a){Gt.call(this,0,e,t,i,n,r,o,a),this.type="ConeBufferGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:n,openEnded:r,thetaStart:o,thetaLength:a}}function Wt(e,t,i,n){de.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:n},this.fromBufferGeometry(new qt(e,t,i,n)),this.mergeVertices()}function qt(e,t,n,r){Se.call(this),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:r},e=e||1,t=void 0!==t?Math.max(3,t):8,n=void 0!==n?n:0,r=void 0!==r?r:2*Math.PI;var a,s,l=[],c=[],h=[],u=[],d=new o,f=new i;for(c.push(0,0,0),h.push(0,0,1),u.push(.5,.5),s=0,a=3;s<=t;s++,a+=3){var p=n+s/t*r;d.x=e*Math.cos(p),d.y=e*Math.sin(p),c.push(d.x,d.y,d.z),h.push(0,0,1),f.x=(c[a]/e+1)/2,f.y=(c[a+1]/e+1)/2,u.push(f.x,f.y)}for(a=1;a<=t;a++)l.push(a,a+1,0);this.setIndex(l),this.addAttribute("position",new xe(c,3)),this.addAttribute("normal",new xe(h,3)),this.addAttribute("uv",new xe(u,2))}function Xt(e){J.call(this),this.type="ShadowMaterial",this.color=new q(0),this.opacity=1,this.lights=!0,this.transparent=!0,this.setValues(e)}function Kt(e){Oe.call(this,e),this.type="RawShaderMaterial"}function Yt(e){J.call(this),this.type="MeshPhongMaterial",this.color=new q(16777215),this.specular=new q(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new q(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new i(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Dr,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Zt(e){J.call(this),this.type="MeshLambertMaterial",this.color=new q(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new q(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Dr,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Jt(e){ft.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}function Qt(e,t,i){var n=this,r=!1,o=0,a=0;this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(e){a++,!1===r&&void 0!==n.onStart&&n.onStart(e,o,a),r=!0},this.itemEnd=function(e){o++,void 0!==n.onProgress&&n.onProgress(e,o,a),o===a&&(r=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(e){void 0!==n.onError&&n.onError(e)}}function $t(e){this.manager=void 0!==e?e:ba}function ei(e){this.manager=void 0!==e?e:ba,this._parser=null}function ti(e){this.manager=void 0!==e?e:ba,this._parser=null}function ii(e){this.manager=void 0!==e?e:ba}function ni(e){this.manager=void 0!==e?e:ba}function ri(e){this.manager=void 0!==e?e:ba}function oi(e,t){le.call(this),this.type="Light",this.color=new q(e),this.intensity=void 0!==t?t:1,this.receiveShadow=void 0}function ai(e,t,i){oi.call(this,e,i),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(le.DefaultUp),this.updateMatrix(),this.groundColor=new q(t)}function si(e){this.camera=e,this.bias=0,this.radius=1,this.mapSize=new i(512,512),this.map=null,this.matrix=new n}function li(){si.call(this,new $e(50,1,.5,500))}function ci(e,t,i,n,r,o){oi.call(this,e,t),this.type="SpotLight",this.position.copy(le.DefaultUp),this.updateMatrix(),this.target=new le,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}}),this.distance=void 0!==i?i:0,this.angle=void 0!==n?n:Math.PI/3,this.penumbra=void 0!==r?r:0,this.decay=void 0!==o?o:1,this.shadow=new li}function hi(e,t,i,n){oi.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}}),this.distance=void 0!==i?i:0,this.decay=void 0!==n?n:1,this.shadow=new si(new $e(90,1,.5,500))}function ui(){si.call(this,new he(-5,5,5,-5,.5,500))}function di(e,t){oi.call(this,e,t),this.type="DirectionalLight",this.position.copy(le.DefaultUp),this.updateMatrix(),this.target=new le,this.shadow=new ui}function fi(e,t){oi.call(this,e,t),this.type="AmbientLight",this.castShadow=void 0}function pi(e,t,i,n){oi.call(this,e,t),this.type="RectAreaLight",this.position.set(0,1,0),this.updateMatrix(),this.width=void 0!==i?i:10,this.height=void 0!==n?n:10}function mi(e,t,i,n){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new t.constructor(i),this.sampleValues=t,this.valueSize=i}function gi(e,t,i,n){mi.call(this,e,t,i,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function vi(e,t,i,n){mi.call(this,e,t,i,n)}function yi(e,t,i,n){mi.call(this,e,t,i,n)}function bi(e,t,i,n){if(void 0===e)throw new Error("track name is undefined");if(void 0===t||0===t.length)throw new Error("no keyframes in track named "+e);this.name=e,this.times=xa.convertArray(t,this.TimeBufferType),this.values=xa.convertArray(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation),this.validate(),this.optimize()}function wi(e,t,i,n){bi.call(this,e,t,i,n)}function xi(e,t,i,n){mi.call(this,e,t,i,n)}function _i(e,t,i,n){bi.call(this,e,t,i,n)}function Mi(e,t,i,n){bi.call(this,e,t,i,n)}function Ti(e,t,i,n){bi.call(this,e,t,i,n)}function Si(e,t,i){bi.call(this,e,t,i)}function Ei(e,t,i,n){bi.call(this,e,t,i,n)}function Ci(e,t,i,n){bi.apply(this,e,t,i,n)}function Pi(e,t,i){this.name=e,this.tracks=i,this.duration=void 0!==t?t:-1,this.uuid=Zo.generateUUID(),this.duration<0&&this.resetDuration(),this.optimize()}function Li(e){this.manager=void 0!==e?e:ba,this.textures={}}function ki(e){this.manager=void 0!==e?e:ba}function Ai(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}}function Ri(e){"boolean"==typeof e&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),e=void 0),this.manager=void 0!==e?e:ba,this.withCredentials=!1}function Oi(e){this.manager=void 0!==e?e:ba,this.texturePath=""}function Ii(e,t,i,n,r){var o=.5*(n-t),a=.5*(r-i),s=e*e;return(2*i-2*n+o+a)*(e*s)+(-3*i+3*n-2*o-a)*s+o*e+i}function Bi(e,t,i,n){return function(e,t){var i=1-e;return i*i*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,i)+function(e,t){return e*e*t}(e,n)}function Di(e,t,i,n,r){return function(e,t){var i=1-e;return i*i*i*t}(e,t)+function(e,t){var i=1-e;return 3*i*i*e*t}(e,i)+function(e,t){return 3*(1-e)*e*e*t}(e,n)+function(e,t){return e*e*e*t}(e,r)}function Ui(){this.arcLengthDivisions=200}function zi(e,t){Ui.call(this),this.v1=e,this.v2=t}function Ni(){Ui.call(this),this.curves=[],this.autoClose=!1}function ji(e,t,i,n,r,o,a,s){Ui.call(this),this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=n,this.aStartAngle=r,this.aEndAngle=o,this.aClockwise=a,this.aRotation=s||0}function Fi(e){Ui.call(this),this.points=void 0===e?[]:e}function Gi(e,t,i,n){Ui.call(this),this.v0=e,this.v1=t,this.v2=i,this.v3=n}function Hi(e,t,i){Ui.call(this),this.v0=e,this.v1=t,this.v2=i}function Vi(e){Ni.call(this),this.currentPoint=new i,e&&this.fromPoints(e)}function Wi(){Vi.apply(this,arguments),this.holes=[]}function qi(){this.subPaths=[],this.currentPath=null}function Xi(e){this.data=e}function Ki(e){this.manager=void 0!==e?e:ba}function Yi(e){this.manager=void 0!==e?e:ba}function Zi(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new $e,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new $e,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1}function Ji(){le.call(this),this.type="AudioListener",this.context=La.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null}function Qi(e){le.call(this),this.type="Audio",this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.loop=!1,this.startTime=0,this.offset=0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this.filters=[]}function $i(e){Qi.call(this,e),this.panner=this.context.createPanner(),this.panner.connect(this.gain)}function en(e,t){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=void 0!==t?t:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}function tn(e,t,i){this.binding=e,this.valueSize=i;var n,r=Float64Array;switch(t){case"quaternion":n=this._slerp;break;case"string":case"bool":r=Array,n=this._select;break;default:n=this._lerp}this.buffer=new r(4*i),this._mixBufferRegion=n,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}function nn(e,t,i){var n=i||rn.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,n)}function rn(e,t,i){this.path=t,this.parsedPath=i||rn.parseTrackName(t),this.node=rn.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}function on(){this.uuid=Zo.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var t=0,i=arguments.length;t!==i;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var n=this;this.stats={objects:{get total(){return n._objects.length},get inUse(){return this.total-n.nCachedObjects_}},get bindingsPerObject(){return n._bindings.length}}}function an(e,t,i){this._mixer=e,this._clip=t,this._localRoot=i||null;for(var n=t.tracks,r=n.length,o=new Array(r),a={endingStart:Uo,endingEnd:Uo},s=0;s!==r;++s){var l=n[s].createInterpolant(null);o[s]=l,l.settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(r),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Do,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function sn(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function ln(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}function cn(){Se.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function hn(e,t,i,n){this.uuid=Zo.generateUUID(),this.data=e,this.itemSize=t,this.offset=i,this.normalized=!0===n}function un(e,t){this.uuid=Zo.generateUUID(),this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.onUploadCallback=function(){},this.version=0}function dn(e,t,i){un.call(this,e,t),this.meshPerAttribute=i||1}function fn(e,t,i){fe.call(this,e,t),this.meshPerAttribute=i||1}function pn(e,t,i,n){this.ray=new Ie(e,t),this.near=i||0,this.far=n||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function mn(e,t){return e.distance-t.distance}function gn(e,t,i,n){if(!1!==e.visible&&(e.raycast(t,i),!0===n))for(var r=e.children,o=0,a=r.length;o<a;o++)gn(r[o],t,i,!0)}function vn(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}function yn(e,t,i){return this.radius=void 0!==e?e:1,this.phi=void 0!==t?t:0,this.theta=void 0!==i?i:0,this}function bn(e,t,i){return this.radius=void 0!==e?e:1,this.theta=void 0!==t?t:0,this.y=void 0!==i?i:0,this}function wn(e){le.call(this),this.material=e,this.render=function(){}}function xn(e,t,i,n){this.object=e,this.size=void 0!==t?t:1;var r=void 0!==i?i:16711680,o=void 0!==n?n:1,a=0,s=this.object.geometry;s&&s.isGeometry?a=3*s.faces.length:s&&s.isBufferGeometry&&(a=s.attributes.normal.count);var l=new Se,c=new xe(2*a*3,3);l.addAttribute("position",c),mt.call(this,l,new ft({color:r,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}function _n(e,t){le.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;for(var i=new Se,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],r=0,o=1;r<32;r++,o++){var a=r/32*Math.PI*2,s=o/32*Math.PI*2;n.push(Math.cos(a),Math.sin(a),1,Math.cos(s),Math.sin(s),1)}i.addAttribute("position",new xe(n,3));var l=new ft({fog:!1});this.cone=new mt(i,l),this.add(this.cone),this.update()}function Mn(e){var t=[];e&&e.isBone&&t.push(e);for(var i=0;i<e.children.length;i++)t.push.apply(t,Mn(e.children[i]));return t}function Tn(e){for(var t=Mn(e),i=new Se,n=[],r=[],o=new q(0,0,1),a=new q(0,1,0),s=0;s<t.length;s++){var l=t[s];l.parent&&l.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),r.push(o.r,o.g,o.b),r.push(a.r,a.g,a.b))}i.addAttribute("position",new xe(n,3)),i.addAttribute("color",new xe(r,3));var c=new ft({vertexColors:or,depthTest:!1,depthWrite:!1,transparent:!0});mt.call(this,i,c),this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}function Sn(e,t,i){this.light=e,this.light.updateMatrixWorld(),this.color=i;var n=new zt(t,4,2),r=new Re({wireframe:!0,fog:!1});Ue.call(this,n,r),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function En(e,t){le.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;var i=new ft({fog:!1}),n=new Se;n.addAttribute("position",new fe(new Float32Array(15),3)),this.line=new pt(n,i),this.add(this.line),this.update()}function Cn(e,t,i){le.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i;var n=new kt(t);n.rotateY(.5*Math.PI),this.material=new Re({wireframe:!0,fog:!1}),void 0===this.color&&(this.material.vertexColors=or);var r=n.getAttribute("position"),o=new Float32Array(3*r.count);n.addAttribute("color",new fe(o,3)),this.add(new Ue(n,this.material)),this.update()}function Pn(e,t,i,n){e=e||10,t=t||10,i=new q(void 0!==i?i:4473924),n=new q(void 0!==n?n:8947848);for(var r=t/2,o=e/t,a=e/2,s=[],l=[],c=0,h=0,u=-a;c<=t;c++,u+=o){s.push(-a,0,u,a,0,u),s.push(u,0,-a,u,0,a);var d=c===r?i:n;d.toArray(l,h),h+=3,d.toArray(l,h),h+=3,d.toArray(l,h),h+=3,d.toArray(l,h),h+=3}var f=new Se;f.addAttribute("position",new xe(s,3)),f.addAttribute("color",new xe(l,3));var p=new ft({vertexColors:or});mt.call(this,f,p)}function Ln(e,t,i,n,r,o){e=e||10,t=t||16,i=i||8,n=n||64,r=new q(void 0!==r?r:4473924),o=new q(void 0!==o?o:8947848);var a,s,l,c,h,u,d,f=[],p=[];for(c=0;c<=t;c++)l=c/t*(2*Math.PI),a=Math.sin(l)*e,s=Math.cos(l)*e,f.push(0,0,0),f.push(a,0,s),d=1&c?r:o,p.push(d.r,d.g,d.b),p.push(d.r,d.g,d.b);for(c=0;c<=i;c++)for(d=1&c?r:o,u=e-e/i*c,h=0;h<n;h++)l=h/n*(2*Math.PI),a=Math.sin(l)*u,s=Math.cos(l)*u,f.push(a,0,s),p.push(d.r,d.g,d.b),l=(h+1)/n*(2*Math.PI),a=Math.sin(l)*u,s=Math.cos(l)*u,f.push(a,0,s),p.push(d.r,d.g,d.b);var m=new Se;m.addAttribute("position",new xe(f,3)),m.addAttribute("color",new xe(p,3));var g=new ft({vertexColors:or});mt.call(this,m,g)}function kn(e,t,i,n){this.object=e,this.size=void 0!==t?t:1;var r=void 0!==i?i:16776960,o=void 0!==n?n:1,a=0,s=this.object.geometry;s&&s.isGeometry?a=s.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");var l=new Se,c=new xe(2*a*3,3);l.addAttribute("position",c),mt.call(this,l,new ft({color:r,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}function An(e,t,i){le.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,void 0===t&&(t=1);var n=new Se;n.addAttribute("position",new xe([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));var r=new ft({fog:!1});this.lightPlane=new pt(n,r),this.add(this.lightPlane),(n=new Se).addAttribute("position",new xe([0,0,0,0,0,1],3)),this.targetLine=new pt(n,r),this.add(this.targetLine),this.update()}function Rn(e){function t(e,t,n){i(e,n),i(t,n)}function i(e,t){o.push(0,0,0),a.push(t.r,t.g,t.b),void 0===s[e]&&(s[e]=[]),s[e].push(o.length/3-1)}var n=new Se,r=new ft({color:16777215,vertexColors:rr}),o=[],a=[],s={},l=new q(16755200),c=new q(16711680),h=new q(43775),u=new q(16777215),d=new q(3355443);t("n1","n2",l),t("n2","n4",l),t("n4","n3",l),t("n3","n1",l),t("f1","f2",l),t("f2","f4",l),t("f4","f3",l),t("f3","f1",l),t("n1","f1",l),t("n2","f2",l),t("n3","f3",l),t("n4","f4",l),t("p","n1",c),t("p","n2",c),t("p","n3",c),t("p","n4",c),t("u1","u2",h),t("u2","u3",h),t("u3","u1",h),t("c","t",u),t("p","c",d),t("cn1","cn2",d),t("cn3","cn4",d),t("cf1","cf2",d),t("cf3","cf4",d),n.addAttribute("position",new xe(o,3)),n.addAttribute("color",new xe(a,3)),mt.call(this,n,r),this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()}function On(e,t){this.object=e,void 0===t&&(t=16776960);var i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),r=new Se;r.setIndex(new fe(i,1)),r.addAttribute("position",new fe(n,3)),mt.call(this,r,new ft({color:t})),this.matrixAutoUpdate=!1,this.update()}function In(e,t){this.type="Box3Helper",this.box=e;var i=void 0!==t?t:16776960,n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Se;r.setIndex(new fe(n,1)),r.addAttribute("position",new xe([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),mt.call(this,r,new ft({color:i})),this.geometry.computeBoundingSphere()}function Bn(e,t,i){this.type="PlaneHelper",this.plane=e,this.size=void 0===t?1:t;var n=void 0!==i?i:16776960,r=new Se;r.addAttribute("position",new xe([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),r.computeBoundingSphere(),pt.call(this,r,new ft({color:n}));var o=new Se;o.addAttribute("position",new xe([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),o.computeBoundingSphere(),this.add(new Ue(o,new Re({color:n,opacity:.2,transparent:!0,depthWrite:!1})))}function Dn(e,t,i,n,r,o){le.call(this),void 0===n&&(n=16776960),void 0===i&&(i=1),void 0===r&&(r=.2*i),void 0===o&&(o=.2*r),void 0===ka&&((ka=new Se).addAttribute("position",new xe([0,0,0,0,1,0],3)),(Aa=new Gt(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(t),this.line=new pt(ka,new ft({color:n})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Ue(Aa,new Re({color:n})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(i,r,o)}function Un(e){var t=[0,0,0,e=e||1,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=new Se;i.addAttribute("position",new xe(t,3)),i.addAttribute("color",new xe([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var n=new ft({vertexColors:or});mt.call(this,i,n)}function zn(){function e(e,o,a,s){t=e,i=a,n=-3*e+3*o-2*a-s,r=2*e-2*o+a+s}var t=0,i=0,n=0,r=0;return{initCatmullRom:function(t,i,n,r,o){e(i,n,o*(n-t),o*(r-i))},initNonuniformCatmullRom:function(t,i,n,r,o,a,s){var l=(i-t)/o-(n-t)/(o+a)+(n-i)/a,c=(n-i)/a-(r-i)/(a+s)+(r-n)/s;e(i,n,l*=a,c*=a)},calc:function(e){var o=e*e;return t+i*e+n*o+r*(o*e)}}}function Nn(e){Ui.call(this),e.length<2&&console.warn("THREE.CatmullRomCurve3: Points array needs at least two entries."),this.points=e||[],this.closed=!1}function jn(e,t,i,n){Ui.call(this),this.v0=e,this.v1=t,this.v2=i,this.v3=n}function Fn(e,t,i){Ui.call(this),this.v0=e,this.v1=t,this.v2=i}function Gn(e,t){Ui.call(this),this.v1=e,this.v2=t}function Hn(e,t,i,n,r,o){ji.call(this,e,t,i,i,n,r,o)}function Vn(e){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Nn.call(this,e),this.type="catmullrom",this.closed=!0}function Wn(e){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Nn.call(this,e),this.type="catmullrom"}function qn(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),Nn.call(this,e),this.type="catmullrom"}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}),void 0===Math.sign&&(Math.sign=function(e){return e<0?-1:e>0?1:+e}),"name"in Function.prototype==!1&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(e){if(void 0===e||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),i=1;i<arguments.length;i++){var n=arguments[i];if(void 0!==n&&null!==n)for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}),Object.assign(t.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var i=this._listeners[e];if(void 0!==i){var n=i.indexOf(t);-1!==n&&i.splice(n,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var i=t.slice(0),n=0,r=i.length;n<r;n++)i[n].call(this,e)}}}});var Xn="88dev",Kn=0,Yn=1,Zn=2,Jn=0,Qn=1,$n=2,er=0,tr=1,ir=2,nr=0,rr=1,or=2,ar=0,sr=1,lr=2,cr=3,hr=4,ur=5,dr=100,fr=101,pr=102,mr=103,gr=104,vr=200,yr=201,br=202,wr=203,xr=204,_r=205,Mr=206,Tr=207,Sr=208,Er=209,Cr=210,Pr=0,Lr=1,kr=2,Ar=3,Rr=4,Or=5,Ir=6,Br=7,Dr=0,Ur=1,zr=2,Nr=0,jr=1,Fr=2,Gr=3,Hr=4,Vr=301,Wr=302,qr=303,Xr=304,Kr=305,Yr=306,Zr=307,Jr=1e3,Qr=1001,$r=1002,eo=1003,to=1004,io=1005,no=1006,ro=1007,oo=1008,ao=1009,so=1010,lo=1011,co=1012,ho=1013,uo=1014,fo=1015,po=1016,mo=1017,go=1018,vo=1019,yo=1020,bo=1021,wo=1022,xo=1023,_o=1024,Mo=1025,To=xo,So=1026,Eo=1027,Co=2001,Po=2002,Lo=2003,ko=2004,Ao=2100,Ro=2101,Oo=2102,Io=2103,Bo=2151,Do=2201,Uo=2400,zo=0,No=1,jo=2,Fo=3e3,Go=3001,Ho=3007,Vo=3002,Wo=3004,qo=3005,Xo=3006,Ko=3200,Yo=3201,Zo={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var e,t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),i=new Array(36),n=0;return function(){for(var r=0;r<36;r++)8===r||13===r||18===r||23===r?i[r]="-":14===r?i[r]="4":(n<=2&&(n=33554432+16777216*Math.random()|0),e=15&n,n>>=4,i[r]=t[19===r?3&e|8:e]);return i.join("")}}(),clamp:function(e,t,i){return Math.max(t,Math.min(i,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,i,n,r){return n+(e-t)*(r-n)/(i-t)},lerp:function(e,t,i){return(1-i)*e+i*t},smoothstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*(3-2*e)},smootherstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*Zo.DEG2RAD},radToDeg:function(e){return e*Zo.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}};Object.defineProperties(i.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}}),Object.assign(i.prototype,{isVector2:!0,set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.x=e,this.y=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},applyMatrix3:function(e){var t=this.x,i=this.y,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6],this.y=n[1]*t+n[4]*i+n[7],this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:function(){var e=new i,t=new i;return function(i,n){return e.set(i,i),t.set(n,n),this.clamp(e,t)}}(),clampLength:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y;return t*t+i*i},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromBufferAttribute:function(e,t,i){return void 0!==i&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this},rotateAround:function(e,t){var i=Math.cos(t),n=Math.sin(t),r=this.x-e.x,o=this.y-e.y;return this.x=r*i-o*n+e.x,this.y=r*n+o*i+e.y,this}}),Object.assign(n.prototype,{isMatrix4:!0,set:function(e,t,i,n,r,o,a,s,l,c,h,u,d,f,p,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=i,g[12]=n,g[1]=r,g[5]=o,g[9]=a,g[13]=s,g[2]=l,g[6]=c,g[10]=h,g[14]=u,g[3]=d,g[7]=f,g[11]=p,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new n).fromArray(this.elements)},copy:function(e){var t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this},copyPosition:function(e){var t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this},extractBasis:function(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this},extractRotation:function(){var e=new o;return function(t){var i=this.elements,n=t.elements,r=1/e.setFromMatrixColumn(t,0).length(),o=1/e.setFromMatrixColumn(t,1).length(),a=1/e.setFromMatrixColumn(t,2).length();return i[0]=n[0]*r,i[1]=n[1]*r,i[2]=n[2]*r,i[4]=n[4]*o,i[5]=n[5]*o,i[6]=n[6]*o,i[8]=n[8]*a,i[9]=n[9]*a,i[10]=n[10]*a,this}}(),makeRotationFromEuler:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,i=e.x,n=e.y,r=e.z,o=Math.cos(i),a=Math.sin(i),s=Math.cos(n),l=Math.sin(n),c=Math.cos(r),h=Math.sin(r);if("XYZ"===e.order){var u=o*c,d=o*h,f=a*c,p=a*h;t[0]=s*c,t[4]=-s*h,t[8]=l,t[1]=d+f*l,t[5]=u-p*l,t[9]=-a*s,t[2]=p-u*l,t[6]=f+d*l,t[10]=o*s}else if("YXZ"===e.order){var m=s*c,g=s*h,v=l*c,y=l*h;t[0]=m+y*a,t[4]=v*a-g,t[8]=o*l,t[1]=o*h,t[5]=o*c,t[9]=-a,t[2]=g*a-v,t[6]=y+m*a,t[10]=o*s}else if("ZXY"===e.order){var m=s*c,g=s*h,v=l*c,y=l*h;t[0]=m-y*a,t[4]=-o*h,t[8]=v+g*a,t[1]=g+v*a,t[5]=o*c,t[9]=y-m*a,t[2]=-o*l,t[6]=a,t[10]=o*s}else if("ZYX"===e.order){var u=o*c,d=o*h,f=a*c,p=a*h;t[0]=s*c,t[4]=f*l-d,t[8]=u*l+p,t[1]=s*h,t[5]=p*l+u,t[9]=d*l-f,t[2]=-l,t[6]=a*s,t[10]=o*s}else if("YZX"===e.order){var b=o*s,w=o*l,x=a*s,_=a*l;t[0]=s*c,t[4]=_-b*h,t[8]=x*h+w,t[1]=h,t[5]=o*c,t[9]=-a*c,t[2]=-l*c,t[6]=w*h+x,t[10]=b-_*h}else if("XZY"===e.order){var b=o*s,w=o*l,x=a*s,_=a*l;t[0]=s*c,t[4]=-h,t[8]=l*c,t[1]=b*h+_,t[5]=o*c,t[9]=w*h-x,t[2]=x*h-w,t[6]=a*c,t[10]=_*h+b}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:function(e){var t=this.elements,i=e._x,n=e._y,r=e._z,o=e._w,a=i+i,s=n+n,l=r+r,c=i*a,h=i*s,u=i*l,d=n*s,f=n*l,p=r*l,m=o*a,g=o*s,v=o*l;return t[0]=1-(d+p),t[4]=h-v,t[8]=u+g,t[1]=h+v,t[5]=1-(c+p),t[9]=f-m,t[2]=u-g,t[6]=f+m,t[10]=1-(c+d),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:function(){var e=new o,t=new o,i=new o;return function(n,r,o){var a=this.elements;return i.subVectors(n,r),0===i.lengthSq()&&(i.z=1),i.normalize(),e.crossVectors(o,i),0===e.lengthSq()&&(1===Math.abs(o.z)?i.x+=1e-4:i.z+=1e-4,i.normalize(),e.crossVectors(o,i)),e.normalize(),t.crossVectors(i,e),a[0]=e.x,a[4]=t.x,a[8]=i.x,a[1]=e.y,a[5]=t.y,a[9]=i.y,a[2]=e.z,a[6]=t.z,a[10]=i.z,this}}(),multiply:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var i=e.elements,n=t.elements,r=this.elements,o=i[0],a=i[4],s=i[8],l=i[12],c=i[1],h=i[5],u=i[9],d=i[13],f=i[2],p=i[6],m=i[10],g=i[14],v=i[3],y=i[7],b=i[11],w=i[15],x=n[0],_=n[4],M=n[8],T=n[12],S=n[1],E=n[5],C=n[9],P=n[13],L=n[2],k=n[6],A=n[10],R=n[14],O=n[3],I=n[7],B=n[11],D=n[15];return r[0]=o*x+a*S+s*L+l*O,r[4]=o*_+a*E+s*k+l*I,r[8]=o*M+a*C+s*A+l*B,r[12]=o*T+a*P+s*R+l*D,r[1]=c*x+h*S+u*L+d*O,r[5]=c*_+h*E+u*k+d*I,r[9]=c*M+h*C+u*A+d*B,r[13]=c*T+h*P+u*R+d*D,r[2]=f*x+p*S+m*L+g*O,r[6]=f*_+p*E+m*k+g*I,r[10]=f*M+p*C+m*A+g*B,r[14]=f*T+p*P+m*R+g*D,r[3]=v*x+y*S+b*L+w*O,r[7]=v*_+y*E+b*k+w*I,r[11]=v*M+y*C+b*A+w*B,r[15]=v*T+y*P+b*R+w*D,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},applyToBufferAttribute:function(){var e=new o;return function(t){for(var i=0,n=t.count;i<n;i++)e.x=t.getX(i),e.y=t.getY(i),e.z=t.getZ(i),e.applyMatrix4(this),t.setXYZ(i,e.x,e.y,e.z);return t}}(),determinant:function(){var e=this.elements,t=e[0],i=e[4],n=e[8],r=e[12],o=e[1],a=e[5],s=e[9],l=e[13],c=e[2],h=e[6],u=e[10],d=e[14];return e[3]*(+r*s*h-n*l*h-r*a*u+i*l*u+n*a*d-i*s*d)+e[7]*(+t*s*d-t*l*u+r*o*u-n*o*d+n*l*c-r*s*c)+e[11]*(+t*l*h-t*a*d-r*o*h+i*o*d+r*a*c-i*l*c)+e[15]*(-n*a*c-t*s*h+t*a*u+n*o*h-i*o*u+i*s*c)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var i=this.elements,n=e.elements,r=n[0],o=n[1],a=n[2],s=n[3],l=n[4],c=n[5],h=n[6],u=n[7],d=n[8],f=n[9],p=n[10],m=n[11],g=n[12],v=n[13],y=n[14],b=n[15],w=f*y*u-v*p*u+v*h*m-c*y*m-f*h*b+c*p*b,x=g*p*u-d*y*u-g*h*m+l*y*m+d*h*b-l*p*b,_=d*v*u-g*f*u+g*c*m-l*v*m-d*c*b+l*f*b,M=g*f*h-d*v*h-g*c*p+l*v*p+d*c*y-l*f*y,T=r*w+o*x+a*_+s*M;if(0===T){var S="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(S);return console.warn(S),this.identity()}var E=1/T;return i[0]=w*E,i[1]=(v*p*s-f*y*s-v*a*m+o*y*m+f*a*b-o*p*b)*E,i[2]=(c*y*s-v*h*s+v*a*u-o*y*u-c*a*b+o*h*b)*E,i[3]=(f*h*s-c*p*s-f*a*u+o*p*u+c*a*m-o*h*m)*E,i[4]=x*E,i[5]=(d*y*s-g*p*s+g*a*m-r*y*m-d*a*b+r*p*b)*E,i[6]=(g*h*s-l*y*s-g*a*u+r*y*u+l*a*b-r*h*b)*E,i[7]=(l*p*s-d*h*s+d*a*u-r*p*u-l*a*m+r*h*m)*E,i[8]=_*E,i[9]=(g*f*s-d*v*s-g*o*m+r*v*m+d*o*b-r*f*b)*E,i[10]=(l*v*s-g*c*s+g*o*u-r*v*u-l*o*b+r*c*b)*E,i[11]=(d*c*s-l*f*s-d*o*u+r*f*u+l*o*m-r*c*m)*E,i[12]=M*E,i[13]=(d*v*a-g*f*a+g*o*p-r*v*p-d*o*y+r*f*y)*E,i[14]=(g*c*a-l*v*a-g*o*h+r*v*h+l*o*y-r*c*y)*E,i[15]=(l*f*a-d*c*a+d*o*h-r*f*h-l*o*p+r*c*p)*E,this},scale:function(e){var t=this.elements,i=e.x,n=e.y,r=e.z;return t[0]*=i,t[4]*=n,t[8]*=r,t[1]*=i,t[5]*=n,t[9]*=r,t[2]*=i,t[6]*=n,t[10]*=r,t[3]*=i,t[7]*=n,t[11]*=r,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,n))},makeTranslation:function(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var i=Math.cos(t),n=Math.sin(t),r=1-i,o=e.x,a=e.y,s=e.z,l=r*o,c=r*a;return this.set(l*o+i,l*a-n*s,l*s+n*a,0,l*a+n*s,c*a+i,c*s-n*o,0,l*s-n*a,c*s+n*o,r*s*s+i,0,0,0,0,1),this},makeScale:function(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this},makeShear:function(e,t,i){return this.set(1,t,i,0,e,1,i,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,i){return this.makeRotationFromQuaternion(t),this.scale(i),this.setPosition(e),this},decompose:function(){var e=new o,t=new n;return function(i,n,r){var o=this.elements,a=e.set(o[0],o[1],o[2]).length(),s=e.set(o[4],o[5],o[6]).length(),l=e.set(o[8],o[9],o[10]).length();this.determinant()<0&&(a=-a),i.x=o[12],i.y=o[13],i.z=o[14],t.copy(this);var c=1/a,h=1/s,u=1/l;return t.elements[0]*=c,t.elements[1]*=c,t.elements[2]*=c,t.elements[4]*=h,t.elements[5]*=h,t.elements[6]*=h,t.elements[8]*=u,t.elements[9]*=u,t.elements[10]*=u,n.setFromRotationMatrix(t),r.x=a,r.y=s,r.z=l,this}}(),makePerspective:function(e,t,i,n,r,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var a=this.elements,s=2*r/(t-e),l=2*r/(i-n),c=(t+e)/(t-e),h=(i+n)/(i-n),u=-(o+r)/(o-r),d=-2*o*r/(o-r);return a[0]=s,a[4]=0,a[8]=c,a[12]=0,a[1]=0,a[5]=l,a[9]=h,a[13]=0,a[2]=0,a[6]=0,a[10]=u,a[14]=d,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makeOrthographic:function(e,t,i,n,r,o){var a=this.elements,s=1/(t-e),l=1/(i-n),c=1/(o-r),h=(t+e)*s,u=(i+n)*l,d=(o+r)*c;return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-h,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-u,a[2]=0,a[6]=0,a[10]=-2*c,a[14]=-d,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},equals:function(e){for(var t=this.elements,i=e.elements,n=0;n<16;n++)if(t[n]!==i[n])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var i=0;i<16;i++)this.elements[i]=e[i+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}),Object.assign(r,{slerp:function(e,t,i,n){return i.copy(e).slerp(t,n)},slerpFlat:function(e,t,i,n,r,o,a){var s=i[n+0],l=i[n+1],c=i[n+2],h=i[n+3],u=r[o+0],d=r[o+1],f=r[o+2],p=r[o+3];if(h!==p||s!==u||l!==d||c!==f){var m=1-a,g=s*u+l*d+c*f+h*p,v=g>=0?1:-1,y=1-g*g;if(y>Number.EPSILON){var b=Math.sqrt(y),w=Math.atan2(b,g*v);m=Math.sin(m*w)/b,a=Math.sin(a*w)/b}var x=a*v;if(s=s*m+u*x,l=l*m+d*x,c=c*m+f*x,h=h*m+p*x,m===1-a){var _=1/Math.sqrt(s*s+l*l+c*c+h*h);s*=_,l*=_,c*=_,h*=_}}e[t]=s,e[t+1]=l,e[t+2]=c,e[t+3]=h}}),Object.defineProperties(r.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e,this.onChangeCallback()}}}),Object.assign(r.prototype,{set:function(e,t,i,n){return this._x=e,this._y=t,this._z=i,this._w=n,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this},setFromEuler:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var i=e._x,n=e._y,r=e._z,o=e.order,a=Math.cos,s=Math.sin,l=a(i/2),c=a(n/2),h=a(r/2),u=s(i/2),d=s(n/2),f=s(r/2);return"XYZ"===o?(this._x=u*c*h+l*d*f,this._y=l*d*h-u*c*f,this._z=l*c*f+u*d*h,this._w=l*c*h-u*d*f):"YXZ"===o?(this._x=u*c*h+l*d*f,this._y=l*d*h-u*c*f,this._z=l*c*f-u*d*h,this._w=l*c*h+u*d*f):"ZXY"===o?(this._x=u*c*h-l*d*f,this._y=l*d*h+u*c*f,this._z=l*c*f+u*d*h,this._w=l*c*h-u*d*f):"ZYX"===o?(this._x=u*c*h-l*d*f,this._y=l*d*h+u*c*f,this._z=l*c*f-u*d*h,this._w=l*c*h+u*d*f):"YZX"===o?(this._x=u*c*h+l*d*f,this._y=l*d*h+u*c*f,this._z=l*c*f-u*d*h,this._w=l*c*h-u*d*f):"XZY"===o&&(this._x=u*c*h-l*d*f,this._y=l*d*h-u*c*f,this._z=l*c*f+u*d*h,this._w=l*c*h+u*d*f),!1!==t&&this.onChangeCallback(),this},setFromAxisAngle:function(e,t){var i=t/2,n=Math.sin(i);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(i),this.onChangeCallback(),this},setFromRotationMatrix:function(e){var t,i=e.elements,n=i[0],r=i[4],o=i[8],a=i[1],s=i[5],l=i[9],c=i[2],h=i[6],u=i[10],d=n+s+u;return d>0?(t=.5/Math.sqrt(d+1),this._w=.25/t,this._x=(h-l)*t,this._y=(o-c)*t,this._z=(a-r)*t):n>s&&n>u?(t=2*Math.sqrt(1+n-s-u),this._w=(h-l)/t,this._x=.25*t,this._y=(r+a)/t,this._z=(o+c)/t):s>u?(t=2*Math.sqrt(1+s-n-u),this._w=(o-c)/t,this._x=(r+a)/t,this._y=.25*t,this._z=(l+h)/t):(t=2*Math.sqrt(1+u-n-s),this._w=(a-r)/t,this._x=(o+c)/t,this._y=(l+h)/t,this._z=.25*t),this.onChangeCallback(),this},setFromUnitVectors:function(){var e,t=new o;return function(i,n){return void 0===t&&(t=new o),(e=i.dot(n)+1)<1e-6?(e=0,Math.abs(i.x)>Math.abs(i.z)?t.set(-i.y,i.x,0):t.set(0,-i.z,i.y)):t.crossVectors(i,n),this._x=t.x,this._y=t.y,this._z=t.z,this._w=e,this.normalize()}}(),inverse:function(){return this.conjugate().normalize()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this.onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(e,t){var i=e._x,n=e._y,r=e._z,o=e._w,a=t._x,s=t._y,l=t._z,c=t._w;return this._x=i*c+o*a+n*l-r*s,this._y=n*c+o*s+r*a-i*l,this._z=r*c+o*l+i*s-n*a,this._w=o*c-i*a-n*s-r*l,this.onChangeCallback(),this},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var i=this._x,n=this._y,r=this._z,o=this._w,a=o*e._w+i*e._x+n*e._y+r*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=i,this._y=n,this._z=r,this;var s=Math.sqrt(1-a*a);if(Math.abs(s)<.001)return this._w=.5*(o+this._w),this._x=.5*(i+this._x),this._y=.5*(n+this._y),this._z=.5*(r+this._z),this;var l=Math.atan2(s,a),c=Math.sin((1-t)*l)/s,h=Math.sin(t*l)/s;return this._w=o*c+this._w*h,this._x=i*c+this._x*h,this._y=n*c+this._y*h,this._z=r*c+this._z*h,this.onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}}),Object.assign(o.prototype,{isVector3:!0,set:function(e,t,i){return this.x=e,this.y=t,this.z=i,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(){var e=new r;return function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(e.setFromEuler(t))}}(),applyAxisAngle:function(){var e=new r;return function(t,i){return this.applyQuaternion(e.setFromAxisAngle(t,i))}}(),applyMatrix3:function(e){var t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6]*n,this.y=r[1]*t+r[4]*i+r[7]*n,this.z=r[2]*t+r[5]*i+r[8]*n,this},applyMatrix4:function(e){var t=this.x,i=this.y,n=this.z,r=e.elements,o=1/(r[3]*t+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*t+r[4]*i+r[8]*n+r[12])*o,this.y=(r[1]*t+r[5]*i+r[9]*n+r[13])*o,this.z=(r[2]*t+r[6]*i+r[10]*n+r[14])*o,this},applyQuaternion:function(e){var t=this.x,i=this.y,n=this.z,r=e.x,o=e.y,a=e.z,s=e.w,l=s*t+o*n-a*i,c=s*i+a*t-r*n,h=s*n+r*i-o*t,u=-r*t-o*i-a*n;return this.x=l*s+u*-r+c*-a-h*-o,this.y=c*s+u*-o+h*-r-l*-a,this.z=h*s+u*-a+l*-o-c*-r,this},project:function(){var e=new n;return function(t){return e.multiplyMatrices(t.projectionMatrix,e.getInverse(t.matrixWorld)),this.applyMatrix4(e)}}(),unproject:function(){var e=new n;return function(t){return e.multiplyMatrices(t.matrixWorld,e.getInverse(t.projectionMatrix)),this.applyMatrix4(e)}}(),transformDirection:function(e){var t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*n,this.y=r[1]*t+r[5]*i+r[9]*n,this.z=r[2]*t+r[6]*i+r[10]*n,this.normalize()},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(){var e=new o,t=new o;return function(i,n){return e.set(i,i,i),t.set(n,n,n),this.clamp(e,t)}}(),clampLength:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)},cross:function(e,t){if(void 0!==t)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var i=this.x,n=this.y,r=this.z;return this.x=n*e.z-r*e.y,this.y=r*e.x-i*e.z,this.z=i*e.y-n*e.x,this},crossVectors:function(e,t){var i=e.x,n=e.y,r=e.z,o=t.x,a=t.y,s=t.z;return this.x=n*s-r*a,this.y=r*o-i*s,this.z=i*a-n*o,this},projectOnVector:function(e){var t=e.dot(this)/e.lengthSq();return this.copy(e).multiplyScalar(t)},projectOnPlane:function(){var e=new o;return function(t){return e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){var e=new o;return function(t){return this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),angleTo:function(e){var t=this.dot(e)/Math.sqrt(this.lengthSq()*e.lengthSq());return Math.acos(Zo.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y,n=this.z-e.z;return t*t+i*i+n*n},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},setFromSpherical:function(e){var t=Math.sin(e.phi)*e.radius;return this.x=t*Math.sin(e.theta),this.y=Math.cos(e.phi)*e.radius,this.z=t*Math.cos(e.theta),this},setFromCylindrical:function(e){return this.x=e.radius*Math.sin(e.theta),this.y=e.y,this.z=e.radius*Math.cos(e.theta),this},setFromMatrixPosition:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this},setFromMatrixScale:function(e){var t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=n,this},setFromMatrixColumn:function(e,t){return this.fromArray(e.elements,4*t)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromBufferAttribute:function(e,t,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}}),Object.assign(s.prototype,{isMatrix3:!0,set:function(e,t,i,n,r,o,a,s,l){var c=this.elements;return c[0]=e,c[1]=n,c[2]=a,c[3]=t,c[4]=r,c[5]=s,c[6]=i,c[7]=o,c[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(e){var t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this},setFromMatrix4:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},applyToBufferAttribute:function(){var e=new o;return function(t){for(var i=0,n=t.count;i<n;i++)e.x=t.getX(i),e.y=t.getY(i),e.z=t.getZ(i),e.applyMatrix3(this),t.setXYZ(i,e.x,e.y,e.z);return t}}(),multiply:function(e){return this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var i=e.elements,n=t.elements,r=this.elements,o=i[0],a=i[3],s=i[6],l=i[1],c=i[4],h=i[7],u=i[2],d=i[5],f=i[8],p=n[0],m=n[3],g=n[6],v=n[1],y=n[4],b=n[7],w=n[2],x=n[5],_=n[8];return r[0]=o*p+a*v+s*w,r[3]=o*m+a*y+s*x,r[6]=o*g+a*b+s*_,r[1]=l*p+c*v+h*w,r[4]=l*m+c*y+h*x,r[7]=l*g+c*b+h*_,r[2]=u*p+d*v+f*w,r[5]=u*m+d*y+f*x,r[8]=u*g+d*b+f*_,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],o=e[4],a=e[5],s=e[6],l=e[7],c=e[8];return t*o*c-t*a*l-i*r*c+i*a*s+n*r*l-n*o*s},getInverse:function(e,t){e&&e.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var i=e.elements,n=this.elements,r=i[0],o=i[1],a=i[2],s=i[3],l=i[4],c=i[5],h=i[6],u=i[7],d=i[8],f=d*l-c*u,p=c*h-d*s,m=u*s-l*h,g=r*f+o*p+a*m;if(0===g){var v="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(v);return console.warn(v),this.identity()}var y=1/g;return n[0]=f*y,n[1]=(a*u-d*o)*y,n[2]=(c*o-a*l)*y,n[3]=p*y,n[4]=(d*r-a*h)*y,n[5]=(a*s-c*r)*y,n[6]=m*y,n[7]=(o*h-u*r)*y,n[8]=(l*r-o*s)*y,this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},setUvTransform:function(e,t,i,n,r,o,a){var s=Math.cos(r),l=Math.sin(r);this.set(i*s,i*l,-i*(s*o+l*a)+o+e,-n*l,n*s,-n*(-l*o+s*a)+a+t,0,0,1)},scale:function(e,t){var i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=t,i[4]*=t,i[7]*=t,this},rotate:function(e){var t=Math.cos(e),i=Math.sin(e),n=this.elements,r=n[0],o=n[3],a=n[6],s=n[1],l=n[4],c=n[7];return n[0]=t*r+i*s,n[3]=t*o+i*l,n[6]=t*a+i*c,n[1]=-i*r+t*s,n[4]=-i*o+t*l,n[7]=-i*a+t*c,this},translate:function(e,t){var i=this.elements;return i[0]+=e*i[2],i[3]+=e*i[5],i[6]+=e*i[8],i[1]+=t*i[2],i[4]+=t*i[5],i[7]+=t*i[8],this},equals:function(e){for(var t=this.elements,i=e.elements,n=0;n<9;n++)if(t[n]!==i[n])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var i=0;i<9;i++)this.elements[i]=e[i+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}});var Jo=0;l.DEFAULT_IMAGE=void 0,l.DEFAULT_MAPPING=300,Object.defineProperty(l.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(l.prototype,t.prototype,{constructor:l,isTexture:!0,clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){var t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};if(void 0!==this.image){var n=this.image;void 0===n.uuid&&(n.uuid=Zo.generateUUID()),t||void 0!==e.images[n.uuid]||(e.images[n.uuid]={uuid:n.uuid,url:function(e){var t;if(e instanceof HTMLCanvasElement)t=e;else{(t=document.createElement("canvas")).width=e.width,t.height=e.height;var i=t.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height)}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}(n)}),i.image=n.uuid}return t||(e.textures[this.uuid]=i),i},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(300===this.mapping){if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Jr:e.x=e.x-Math.floor(e.x);break;case Qr:e.x=e.x<0?0:1;break;case $r:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case Jr:e.y=e.y-Math.floor(e.y);break;case Qr:e.y=e.y<0?0:1;break;case $r:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}this.flipY&&(e.y=1-e.y)}}}),Object.assign(c.prototype,{isVector4:!0,set:function(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,i=this.y,n=this.z,r=this.w,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*n+o[12]*r,this.y=o[1]*t+o[5]*i+o[9]*n+o[13]*r,this.z=o[2]*t+o[6]*i+o[10]*n+o[14]*r,this.w=o[3]*t+o[7]*i+o[11]*n+o[15]*r,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,i,n,r,o=e.elements,a=o[0],s=o[4],l=o[8],c=o[1],h=o[5],u=o[9],d=o[2],f=o[6],p=o[10];if(Math.abs(s-c)<.01&&Math.abs(l-d)<.01&&Math.abs(u-f)<.01){if(Math.abs(s+c)<.1&&Math.abs(l+d)<.1&&Math.abs(u+f)<.1&&Math.abs(a+h+p-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;var m=(a+1)/2,g=(h+1)/2,v=(p+1)/2,y=(s+c)/4,b=(l+d)/4,w=(u+f)/4;return m>g&&m>v?m<.01?(i=0,n=.707106781,r=.707106781):(n=y/(i=Math.sqrt(m)),r=b/i):g>v?g<.01?(i=.707106781,n=0,r=.707106781):(i=y/(n=Math.sqrt(g)),r=w/n):v<.01?(i=.707106781,n=.707106781,r=0):(i=b/(r=Math.sqrt(v)),n=w/r),this.set(i,n,r,t),this}var x=Math.sqrt((f-u)*(f-u)+(l-d)*(l-d)+(c-s)*(c-s));return Math.abs(x)<.001&&(x=1),this.x=(f-u)/x,this.y=(l-d)/x,this.z=(c-s)/x,this.w=Math.acos((a+h+p-1)/2),this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(){var e,t;return function(i,n){return void 0===e&&(e=new c,t=new c),e.set(i,i,i,i),t.set(n,n,n,n),this.clamp(e,t)}}(),clampLength:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromBufferAttribute:function(e,t,i){return void 0!==i&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}}),Object.assign(h.prototype,t.prototype,{isWebGLRenderTarget:!0,setSize:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),(u.prototype=Object.create(h.prototype)).constructor=u,u.prototype.isWebGLRenderTargetCube=!0,(d.prototype=Object.create(l.prototype)).constructor=d,d.prototype.isDataTexture=!0,(f.prototype=Object.create(l.prototype)).constructor=f,f.prototype.isCubeTexture=!0,Object.defineProperty(f.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}});var Qo=new l,$o=new f,ea=[],ta=[],ia=new Float32Array(16),na=new Float32Array(9);G.prototype.setValue=function(e,t){for(var i=this.seq,n=0,r=i.length;n!==r;++n){var o=i[n];o.setValue(e,t[o.id])}};var ra=/([\w\d_]+)(\])?(\[|\.)?/g;W.prototype.setValue=function(e,t,i){var n=this.map[t];void 0!==n&&n.setValue(e,i,this.renderer)},W.prototype.setOptional=function(e,t,i){var n=t[i];void 0!==n&&this.setValue(e,i,n)},W.upload=function(e,t,i,n){for(var r=0,o=t.length;r!==o;++r){var a=t[r],s=i[a.id];!1!==s.needsUpdate&&a.setValue(e,s.value,n)}},W.seqWithValue=function(e,t){for(var i=[],n=0,r=e.length;n!==r;++n){var o=e[n];o.id in t&&i.push(o)}return i};var oa={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Object.assign(q.prototype,{isColor:!0,r:1,g:1,b:1,set:function(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setScalar:function(e){return this.r=e,this.g=e,this.b=e,this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,i){return this.r=e,this.g=t,this.b=i,this},setHSL:function(){function e(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+6*(t-e)*(2/3-i):e}return function(t,i,n){if(t=Zo.euclideanModulo(t,1),i=Zo.clamp(i,0,1),n=Zo.clamp(n,0,1),0===i)this.r=this.g=this.b=n;else{var r=n<=.5?n*(1+i):n+i-n*i,o=2*n-r;this.r=e(o,r,t+1/3),this.g=e(o,r,t),this.b=e(o,r,t-1/3)}return this}}(),setStyle:function(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}var i;if(i=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var n,r=i[1],o=i[2];switch(r){case"rgb":case"rgba":if(n=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(n[1],10))/255,this.g=Math.min(255,parseInt(n[2],10))/255,this.b=Math.min(255,parseInt(n[3],10))/255,t(n[5]),this;if(n=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(n[1],10))/100,this.g=Math.min(100,parseInt(n[2],10))/100,this.b=Math.min(100,parseInt(n[3],10))/100,t(n[5]),this;break;case"hsl":case"hsla":if(n=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o)){var a=parseFloat(n[1])/360,s=parseInt(n[2],10)/100,l=parseInt(n[3],10)/100;return t(n[5]),this.setHSL(a,s,l)}}}else if(i=/^\#([A-Fa-f0-9]+)$/.exec(e)){var c=(h=i[1]).length;if(3===c)return this.r=parseInt(h.charAt(0)+h.charAt(0),16)/255,this.g=parseInt(h.charAt(1)+h.charAt(1),16)/255,this.b=parseInt(h.charAt(2)+h.charAt(2),16)/255,this;if(6===c)return this.r=parseInt(h.charAt(0)+h.charAt(1),16)/255,this.g=parseInt(h.charAt(2)+h.charAt(3),16)/255,this.b=parseInt(h.charAt(4)+h.charAt(5),16)/255,this}if(e&&e.length>0){var h=oa[e];void 0!==h?this.setHex(h):console.warn("THREE.Color: Unknown color "+e)}return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){void 0===t&&(t=2);var i=t>0?1/t:1;return this.r=Math.pow(e.r,i),this.g=Math.pow(e.g,i),this.b=Math.pow(e.b,i),this},convertGammaToLinear:function(){var e=this.r,t=this.g,i=this.b;return this.r=e*e,this.g=t*t,this.b=i*i,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){var t,i,n=e||{h:0,s:0,l:0},r=this.r,o=this.g,a=this.b,s=Math.max(r,o,a),l=Math.min(r,o,a),c=(l+s)/2;if(l===s)t=0,i=0;else{var h=s-l;switch(i=c<=.5?h/(s+l):h/(2-s-l),s){case r:t=(o-a)/h+(o<a?6:0);break;case o:t=(a-r)/h+2;break;case a:t=(r-o)/h+4}t/=6}return n.h=t,n.s=i,n.l=c,n},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,t,i){var n=this.getHSL();return n.h+=e,n.s+=t,n.l+=i,this.setHSL(n.h,n.s,n.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},sub:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},toJSON:function(){return this.getHex()}});var aa={common:{diffuse:{value:new q(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new s},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new i(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new q(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new q(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},uvTransform:{value:new s}}},sa={merge:function(e){for(var t={},i=0;i<e.length;i++){var n=this.clone(e[i]);for(var r in n)t[r]=n[r]}return t},clone:function(e){var t={};for(var i in e){t[i]={};for(var n in e[i]){var r=e[i][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture)?t[i][n]=r.clone():Array.isArray(r)?t[i][n]=r.slice():t[i][n]=r}}return t}},la={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif\n",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif\n",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif\n",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif\n",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"\nvec3 transformed = vec3( position );\n",beginnormal_vertex:"\nvec3 objectNormal = vec3( normal );\n",bsdfs:"float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tif( decayExponent > 0.0 ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\treturn distanceFalloff * maxDistanceCutoffFactor;\n#else\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n#endif\n\t}\n\treturn 1.0;\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat theta = acos( dot( N, V ) );\n\tvec2 uv = vec2(\n\t\tsqrt( saturate( roughness ) ),\n\t\tsaturate( theta / ( 0.5 * PI ) ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.86267 + (0.49788 + 0.01436 * y ) * y;\n\tfloat b = 3.45068 + (4.18814 + y) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = (x > 0.0) ? v : 0.5 * inversesqrt( 1.0 - x * x ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tvec3 result = vec3( LTC_ClippedSphereFormFactor( vectorFormFactor ) );\n\treturn result;\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif\n",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; ++ i ) {\n\t\tvec4 plane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t\t\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; ++ i ) {\n\t\t\tvec4 plane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t\n\t#endif\n#endif\n",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif\n",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvarying vec3 vViewPosition;\n#endif\n",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\n",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV(vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif\n",defaultnormal_vertex:"vec3 transformedNormal = normalMatrix * objectNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif\n",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif\n",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif\n",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif\n",encodings_fragment:"  gl_FragColor = linearToOutputTexel( gl_FragColor );\n",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM            = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat D      = max( maxRange / maxRGB, 1.0 );\n\tD            = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n\tXp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract(Le);\n\tvResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n\treturn vec4( max(vRGB, 0.0), 1.0 );\n}\n",envmap_fragment:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif\n",envmap_pars_fragment:"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif\n",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif\n",envmap_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif\n",fog_vertex:"\n#ifdef USE_FOG\nfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n  varying float fogDepth;\n#endif\n",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif\n",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif\n",gradientmap_pars_fragment:"#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif\n",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif\n",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif\n",lights_pars:"uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltcMat;\tuniform sampler2D ltcMag;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif\n#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV(queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif\n",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)\n",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif\n",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos - halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos + halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos + halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos - halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tfloat norm = texture2D( ltcMag, uv ).a;\n\t\tvec4 t = texture2D( ltcMat, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3(   1,   0, t.y ),\n\t\t\tvec3(   0, t.z,   0 ),\n\t\t\tvec3( t.w,   0, t.x )\n\t\t);\n\t\treflectedLight.directSpecular += lightColor * material.specularColor * norm * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}\n",lights_template:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tirradiance += getLightProbeIndirectIrradiance( geometry, 8 );\n\t#endif\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tvec3 radiance = getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), 8 );\n\t#ifndef STANDARD\n\t\tvec3 clearCoatRadiance = getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), 8 );\n\t#else\n\t\tvec3 clearCoatRadiance = vec3( 0.0 );\n\t#endif\n\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif\n",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#ifdef USE_LOGDEPTHBUF\n\tuniform float logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n#endif\n",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n\tuniform float logDepthBufFC;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\tgl_Position.z *= gl_Position.w;\n\t#endif\n#endif\n",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif\n",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n",map_particle_fragment:"#ifdef USE_MAP\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n",map_particle_pars_fragment:"#ifdef USE_MAP\n\tuniform mat3 uvTransform;\n\tuniform sampler2D map;\n#endif\n",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif\n",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif\n",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif\n",normal_fragment:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n#endif\n#ifdef USE_NORMALMAP\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif\n",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n",project_vertex:"vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\ngl_Position = projectionMatrix * mvPosition;\n",dithering_fragment:"#if defined( DITHERING )\n  gl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif\n",dithering_pars_fragment:"#if defined( DITHERING )\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif\n",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif\n",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif\n",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif\n",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif\n",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}\n",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif\n",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif\n",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif\n",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif\n",tonemapping_pars_fragment:"#define saturate(a) clamp( a, 0.0, 1.0 )\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\n",uv_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\n",uv_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n#endif\n",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldPosition;\nvoid main() {\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n\tgl_FragColor.a *= opacity;\n}\n",cube_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}\n",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}\n",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}\n",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}\n",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldPosition );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n}\n",equirect_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}\n",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}\n",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshphysical_frag:"#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <lights_pars>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshphysical_vert:"#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}\n",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}\n",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#ifdef USE_SIZEATTENUATION\n\t\tgl_PointSize = size * ( scale / - mvPosition.z );\n\t#else\n\t\tgl_PointSize = size;\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <fog_fragment>\n}\n",shadow_vert:"#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n"},ca={basic:{uniforms:sa.merge([aa.common,aa.specularmap,aa.envmap,aa.aomap,aa.lightmap,aa.fog]),vertexShader:la.meshbasic_vert,fragmentShader:la.meshbasic_frag},lambert:{uniforms:sa.merge([aa.common,aa.specularmap,aa.envmap,aa.aomap,aa.lightmap,aa.emissivemap,aa.fog,aa.lights,{emissive:{value:new q(0)}}]),vertexShader:la.meshlambert_vert,fragmentShader:la.meshlambert_frag},phong:{uniforms:sa.merge([aa.common,aa.specularmap,aa.envmap,aa.aomap,aa.lightmap,aa.emissivemap,aa.bumpmap,aa.normalmap,aa.displacementmap,aa.gradientmap,aa.fog,aa.lights,{emissive:{value:new q(0)},specular:{value:new q(1118481)},shininess:{value:30}}]),vertexShader:la.meshphong_vert,fragmentShader:la.meshphong_frag},standard:{uniforms:sa.merge([aa.common,aa.envmap,aa.aomap,aa.lightmap,aa.emissivemap,aa.bumpmap,aa.normalmap,aa.displacementmap,aa.roughnessmap,aa.metalnessmap,aa.fog,aa.lights,{emissive:{value:new q(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:la.meshphysical_vert,fragmentShader:la.meshphysical_frag},points:{uniforms:sa.merge([aa.points,aa.fog]),vertexShader:la.points_vert,fragmentShader:la.points_frag},dashed:{uniforms:sa.merge([aa.common,aa.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:la.linedashed_vert,fragmentShader:la.linedashed_frag},depth:{uniforms:sa.merge([aa.common,aa.displacementmap]),vertexShader:la.depth_vert,fragmentShader:la.depth_frag},normal:{uniforms:sa.merge([aa.common,aa.bumpmap,aa.normalmap,aa.displacementmap,{opacity:{value:1}}]),vertexShader:la.normal_vert,fragmentShader:la.normal_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:la.cube_vert,fragmentShader:la.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:la.equirect_vert,fragmentShader:la.equirect_frag},distanceRGBA:{uniforms:sa.merge([aa.common,aa.displacementmap,{referencePosition:{value:new o},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:la.distanceRGBA_vert,fragmentShader:la.distanceRGBA_frag},shadow:{uniforms:sa.merge([aa.lights,aa.fog,{color:{value:new q(0)},opacity:{value:1}}]),vertexShader:la.shadow_vert,fragmentShader:la.shadow_frag}};ca.physical={uniforms:sa.merge([ca.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:la.meshphysical_vert,fragmentShader:la.meshphysical_frag},Object.assign(X.prototype,{set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new i;return function(t,i){var n=e.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(e){var t=e||new i;return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){var t=e||new i;return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){return(t||new i).set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return(t||new i).copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new i;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}),(Y.prototype=Object.create(l.prototype)).constructor=Y;var ha=0;Object.assign(J.prototype,t.prototype,{isMaterial:!0,onBeforeCompile:function(){},setValues:function(e){if(void 0!==e)for(var t in e){var i=e[t];if(void 0!==i)if("shading"!==t){var n=this[t];void 0!==n?n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[t]="overdraw"===t?Number(i):i:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===i;else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},toJSON:function(e){function t(e){var t=[];for(var i in e){var n=e[i];delete n.metadata,t.push(n)}return t}var i=void 0===e||"string"==typeof e;i&&(e={textures:{},images:{}});var n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearCoat&&(n.clearCoat=this.clearCoat),void 0!==this.clearCoatRoughness&&(n.clearCoatRoughness=this.clearCoatRoughness),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,n.reflectivity=this.reflectivity),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(n.size=this.size),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==sr&&(n.blending=this.blending),!0===this.flatShading&&(n.flatShading=this.flatShading),this.side!==er&&(n.side=this.side),this.vertexColors!==nr&&(n.vertexColors=this.vertexColors),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,0!==this.rotation&&(n.rotation=this.rotation),1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(n.morphTargets=!0),!0===this.skinning&&(n.skinning=!0),!1===this.visible&&(n.visible=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),i){var r=t(e.textures),o=t(e.images);r.length>0&&(n.textures=r),o.length>0&&(n.images=o)}return n},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.lights=e.lights,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.overdraw=e.overdraw,this.visible=e.visible,this.userData=JSON.parse(JSON.stringify(e.userData)),this.clipShadows=e.clipShadows,this.clipIntersection=e.clipIntersection;var t=e.clippingPlanes,i=null;if(null!==t){var n=t.length;i=new Array(n);for(var r=0;r!==n;++r)i[r]=t[r].clone()}return this.clippingPlanes=i,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),(Q.prototype=Object.create(J.prototype)).constructor=Q,Q.prototype.isMeshDepthMaterial=!0,Q.prototype.copy=function(e){return J.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},($.prototype=Object.create(J.prototype)).constructor=$,$.prototype.isMeshDistanceMaterial=!0,$.prototype.copy=function(e){return J.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this},Object.assign(ee.prototype,{isBox3:!0,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function(e){for(var t=1/0,i=1/0,n=1/0,r=-1/0,o=-1/0,a=-1/0,s=0,l=e.length;s<l;s+=3){var c=e[s],h=e[s+1],u=e[s+2];c<t&&(t=c),h<i&&(i=h),u<n&&(n=u),c>r&&(r=c),h>o&&(o=h),u>a&&(a=u)}return this.min.set(t,i,n),this.max.set(r,o,a),this},setFromBufferAttribute:function(e){for(var t=1/0,i=1/0,n=1/0,r=-1/0,o=-1/0,a=-1/0,s=0,l=e.count;s<l;s++){var c=e.getX(s),h=e.getY(s),u=e.getZ(s);c<t&&(t=c),h<i&&(i=h),u<n&&(n=u),c>r&&(r=c),h>o&&(o=h),u>a&&(a=u)}return this.min.set(t,i,n),this.max.set(r,o,a),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new o;return function(t,i){var n=e.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}}(),setFromObject:function(e){return this.makeEmpty(),this.expandByObject(e)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(e){var t=e||new o;return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){var t=e||new o;return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},expandByObject:function(){function e(e){var o=e.geometry;if(void 0!==o)if(o.isGeometry){var a=o.vertices;for(i=0,n=a.length;i<n;i++)r.copy(a[i]),r.applyMatrix4(e.matrixWorld),t.expandByPoint(r)}else if(o.isBufferGeometry){var s=o.attributes.position;if(void 0!==s)for(i=0,n=s.count;i<n;i++)r.fromBufferAttribute(s,i).applyMatrix4(e.matrixWorld),t.expandByPoint(r)}}var t,i,n,r=new o;return function(i){return t=this,i.updateMatrixWorld(!0),i.traverse(e),this}}(),containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return(t||new o).set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsSphere:function(){var e=new o;return function(t){return this.clampPoint(t.center,e),e.distanceToSquared(t.center)<=t.radius*t.radius}}(),intersectsPlane:function(e){var t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=e.constant&&i>=e.constant},clampPoint:function(e,t){return(t||new o).copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new o;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),getBoundingSphere:function(){var e=new o;return function(t){var i=t||new te;return this.getCenter(i.center),i.radius=.5*this.getSize(e).length(),i}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(){var e=[new o,new o,new o,new o,new o,new o,new o,new o];return function(t){return this.isEmpty()?this:(e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(e),this)}}(),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}),Object.assign(te.prototype,{set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(){var e=new ee;return function(t,i){var n=this.center;void 0!==i?n.copy(i):e.setFromPoints(t).getCenter(n);for(var r=0,o=0,a=t.length;o<a;o++)r=Math.max(r,n.distanceToSquared(t[o]));return this.radius=Math.sqrt(r),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius},clampPoint:function(e,t){var i=this.center.distanceToSquared(e),n=t||new o;return n.copy(e),i>this.radius*this.radius&&(n.sub(this.center).normalize(),n.multiplyScalar(this.radius).add(this.center)),n},getBoundingBox:function(e){var t=e||new ee;return t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}}),Object.assign(ie.prototype,{set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,i,n){return this.normal.set(e,t,i),this.constant=n,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new o,t=new o;return function(i,n,r){var o=e.subVectors(r,n).cross(t.subVectors(i,n)).normalize();return this.setFromNormalAndCoplanarPoint(o,i),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return(t||new o).copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)},intersectLine:function(){var e=new o;return function(t,i){var n=i||new o,r=t.delta(e),a=this.normal.dot(r);if(0!==a){var s=-(t.start.dot(this.normal)+this.constant)/a;if(!(s<0||s>1))return n.copy(r).multiplyScalar(s).add(t.start)}else if(0===this.distanceToPoint(t.start))return n.copy(t.start)}}(),intersectsLine:function(e){var t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){return(e||new o).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new o,t=new s;return function(i,n){var r=n||t.getNormalMatrix(i),o=this.coplanarPoint(e).applyMatrix4(i),a=this.normal.applyMatrix3(r).normalize();return this.constant=-o.dot(a),this}}(),translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}),Object.assign(ne.prototype,{set:function(e,t,i,n,r,o){var a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(n),a[4].copy(r),a[5].copy(o),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){for(var t=this.planes,i=0;i<6;i++)t[i].copy(e.planes[i]);return this},setFromMatrix:function(e){var t=this.planes,i=e.elements,n=i[0],r=i[1],o=i[2],a=i[3],s=i[4],l=i[5],c=i[6],h=i[7],u=i[8],d=i[9],f=i[10],p=i[11],m=i[12],g=i[13],v=i[14],y=i[15];return t[0].setComponents(a-n,h-s,p-u,y-m).normalize(),t[1].setComponents(a+n,h+s,p+u,y+m).normalize(),t[2].setComponents(a+r,h+l,p+d,y+g).normalize(),t[3].setComponents(a-r,h-l,p-d,y-g).normalize(),t[4].setComponents(a-o,h-c,p-f,y-v).normalize(),t[5].setComponents(a+o,h+c,p+f,y+v).normalize(),this},intersectsObject:function(){var e=new te;return function(t){var i=t.geometry;return null===i.boundingSphere&&i.computeBoundingSphere(),e.copy(i.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSprite:function(){var e=new te;return function(t){return e.center.set(0,0,0),e.radius=.7071067811865476,e.applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSphere:function(e){for(var t=this.planes,i=e.center,n=-e.radius,r=0;r<6;r++){if(t[r].distanceToPoint(i)<n)return!1}return!0},intersectsBox:function(){var e=new o,t=new o;return function(i){for(var n=this.planes,r=0;r<6;r++){var o=n[r];e.x=o.normal.x>0?i.min.x:i.max.x,t.x=o.normal.x>0?i.max.x:i.min.x,e.y=o.normal.y>0?i.min.y:i.max.y,t.y=o.normal.y>0?i.max.y:i.min.y,e.z=o.normal.z>0?i.min.z:i.max.z,t.z=o.normal.z>0?i.max.z:i.min.z;var a=o.distanceToPoint(e),s=o.distanceToPoint(t);if(a<0&&s<0)return!1}return!0}}(),containsPoint:function(e){for(var t=this.planes,i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}}),ae.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],ae.DefaultOrder="XYZ",Object.defineProperties(ae.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(e){this._order=e,this.onChangeCallback()}}}),Object.assign(ae.prototype,{isEuler:!0,set:function(e,t,i,n){return this._x=e,this._y=t,this._z=i,this._order=n||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this.onChangeCallback(),this},setFromRotationMatrix:function(e,t,i){var n=Zo.clamp,r=e.elements,o=r[0],a=r[4],s=r[8],l=r[1],c=r[5],h=r[9],u=r[2],d=r[6],f=r[10];return"XYZ"===(t=t||this._order)?(this._y=Math.asin(n(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(-h,f),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(d,c),this._z=0)):"YXZ"===t?(this._x=Math.asin(-n(h,-1,1)),Math.abs(h)<.99999?(this._y=Math.atan2(s,f),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-u,o),this._z=0)):"ZXY"===t?(this._x=Math.asin(n(d,-1,1)),Math.abs(d)<.99999?(this._y=Math.atan2(-u,f),this._z=Math.atan2(-a,c)):(this._y=0,this._z=Math.atan2(l,o))):"ZYX"===t?(this._y=Math.asin(-n(u,-1,1)),Math.abs(u)<.99999?(this._x=Math.atan2(d,f),this._z=Math.atan2(l,o)):(this._x=0,this._z=Math.atan2(-a,c))):"YZX"===t?(this._z=Math.asin(n(l,-1,1)),Math.abs(l)<.99999?(this._x=Math.atan2(-h,c),this._y=Math.atan2(-u,o)):(this._x=0,this._y=Math.atan2(s,f))):"XZY"===t?(this._z=Math.asin(-n(a,-1,1)),Math.abs(a)<.99999?(this._x=Math.atan2(d,c),this._y=Math.atan2(s,o)):(this._x=Math.atan2(-h,f),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,!1!==i&&this.onChangeCallback(),this},setFromQuaternion:function(){var e=new n;return function(t,i,n){return e.makeRotationFromQuaternion(t),this.setFromRotationMatrix(e,i,n)}}(),setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(){var e=new r;return function(t){return e.setFromEuler(this),this.setFromQuaternion(e,t)}}(),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new o(this._x,this._y,this._z)},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}}),Object.assign(se.prototype,{set:function(e){this.mask=1<<e|0},enable:function(e){this.mask|=1<<e|0},toggle:function(e){this.mask^=1<<e|0},disable:function(e){this.mask&=~(1<<e|0)},test:function(e){return 0!=(this.mask&e.mask)}});var ua=0;le.DefaultUp=new o(0,1,0),le.DefaultMatrixAutoUpdate=!0,Object.assign(le.prototype,t.prototype,{isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(){var e=new r;return function(t,i){return e.setFromAxisAngle(t,i),this.quaternion.multiply(e),this}}(),rotateOnWorldAxis:function(){var e=new r;return function(t,i){return e.setFromAxisAngle(t,i),this.quaternion.premultiply(e),this}}(),rotateX:function(){var e=new o(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new o(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new o(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new o;return function(t,i){return e.copy(t).applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(i)),this}}(),translateX:function(){var e=new o(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new o(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new o(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var e=new n;return function(t){return t.applyMatrix4(e.getInverse(this.matrixWorld))}}(),lookAt:function(){var e=new n,t=new o;return function(i,n,r){i.isVector3?t.copy(i):t.set(i,n,r),this.isCamera?e.lookAt(this.position,t,this.up):e.lookAt(t,this.position,this.up),this.quaternion.setFromRotationMatrix(e)}}(),add:function(e){if(e&&e.parent==this)return this;if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var i=this.children.indexOf(e);return-1!==i&&(e.parent=null,e.dispatchEvent({type:"removed"}),this.children.splice(i,1)),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var i=0,n=this.children.length;i<n;i++){var r=this.children[i].getObjectByProperty(e,t);if(void 0!==r)return r}},getWorldPosition:function(e){var t=e||new o;return this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var e=new o,t=new o;return function(i){var n=i||new r;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,n,t),n}}(),getWorldRotation:function(){var e=new r;return function(t){var i=t||new ae;return this.getWorldQuaternion(e),i.setFromQuaternion(e,this.rotation.order,!1)}}(),getWorldScale:function(){var e=new o,t=new r;return function(i){var n=i||new o;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,t,n),n}}(),getWorldDirection:function(){var e=new r;return function(t){var i=t||new o;return this.getWorldQuaternion(e),i.set(0,0,1).applyQuaternion(e)}}(),raycast:function(){},traverse:function(e){e(this);for(var t=this.children,i=0,n=t.length;i<n;i++)t[i].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=this.children,i=0,n=t.length;i<n;i++)t[i].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,i=0,n=t.length;i<n;i++)t[i].updateMatrixWorld(e)},toJSON:function(e){function t(t,i){return void 0===t[i.uuid]&&(t[i.uuid]=i.toJSON(e)),i.uuid}function i(e){var t=[];for(var i in e){var n=e[i];delete n.metadata,t.push(n)}return t}var n=void 0===e||"string"==typeof e,r={};n&&(e={geometries:{},materials:{},textures:{},images:{}},r.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var o={};if(o.uuid=this.uuid,o.type=this.type,""!==this.name&&(o.name=this.name),!0===this.castShadow&&(o.castShadow=!0),!0===this.receiveShadow&&(o.receiveShadow=!0),!1===this.visible&&(o.visible=!1),"{}"!==JSON.stringify(this.userData)&&(o.userData=this.userData),o.matrix=this.matrix.toArray(),void 0!==this.geometry&&(o.geometry=t(e.geometries,this.geometry)),void 0!==this.material)if(Array.isArray(this.material)){for(var a=[],s=0,l=this.material.length;s<l;s++)a.push(t(e.materials,this.material[s]));o.material=a}else o.material=t(e.materials,this.material);if(this.children.length>0){o.children=[];for(s=0;s<this.children.length;s++)o.children.push(this.children[s].toJSON(e).object)}if(n){var c=i(e.geometries),h=i(e.materials),u=i(e.textures),d=i(e.images);c.length>0&&(r.geometries=c),h.length>0&&(r.materials=h),u.length>0&&(r.textures=u),d.length>0&&(r.images=d)}return r.object=o,r},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t){if(void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var i=0;i<e.children.length;i++){var n=e.children[i];this.add(n.clone())}return this}}),ce.prototype=Object.assign(Object.create(le.prototype),{constructor:ce,isCamera:!0,copy:function(e,t){return le.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this},getWorldDirection:function(){var e=new r;return function(t){var i=t||new o;return this.getWorldQuaternion(e),i.set(0,0,-1).applyQuaternion(e)}}(),updateMatrixWorld:function(e){le.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),he.prototype=Object.assign(Object.create(ce.prototype),{constructor:he,isOrthographicCamera:!0,copy:function(e,t){return ce.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this},setViewOffset:function(e,t,i,n,r,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2,r=i-e,o=i+e,a=n+t,s=n-t;if(null!==this.view&&this.view.enabled){var l=this.zoom/(this.view.width/this.view.fullWidth),c=this.zoom/(this.view.height/this.view.fullHeight),h=(this.right-this.left)/this.view.width,u=(this.top-this.bottom)/this.view.height;o=(r+=h*(this.view.offsetX/l))+h*(this.view.width/l),s=(a-=u*(this.view.offsetY/c))-u*(this.view.height/c)}this.projectionMatrix.makeOrthographic(r,o,a,s,this.near,this.far)},toJSON:function(e){var t=le.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}),Object.assign(ue.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,i=e.vertexNormals.length;t<i;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(var t=0,i=e.vertexColors.length;t<i;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}});var da=0;Object.assign(de.prototype,t.prototype,{isGeometry:!0,applyMatrix:function(e){for(var t=(new s).getNormalMatrix(e),i=0,n=this.vertices.length;i<n;i++){this.vertices[i].applyMatrix4(e)}for(var i=0,n=this.faces.length;i<n;i++){var r=this.faces[i];r.normal.applyMatrix3(t).normalize();for(var o=0,a=r.vertexNormals.length;o<a;o++)r.vertexNormals[o].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(){var e=new n;return function(t){return e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e=new n;return function(t){return e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e=new n;return function(t){return e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e=new n;return function(t,i,n){return e.makeTranslation(t,i,n),this.applyMatrix(e),this}}(),scale:function(){var e=new n;return function(t,i,n){return e.makeScale(t,i,n),this.applyMatrix(e),this}}(),lookAt:function(){var e=new le;return function(t){e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),fromBufferGeometry:function(e){function t(e,t,i,r){var o=new ue(e,t,i,void 0!==l?[d[e].clone(),d[t].clone(),d[i].clone()]:[],void 0!==c?[n.colors[e].clone(),n.colors[t].clone(),n.colors[i].clone()]:[],r);n.faces.push(o),void 0!==h&&n.faceVertexUvs[0].push([f[e].clone(),f[t].clone(),f[i].clone()]),void 0!==u&&n.faceVertexUvs[1].push([p[e].clone(),p[t].clone(),p[i].clone()])}var n=this,r=null!==e.index?e.index.array:void 0,a=e.attributes,s=a.position.array,l=void 0!==a.normal?a.normal.array:void 0,c=void 0!==a.color?a.color.array:void 0,h=void 0!==a.uv?a.uv.array:void 0,u=void 0!==a.uv2?a.uv2.array:void 0;void 0!==u&&(this.faceVertexUvs[1]=[]);for(var d=[],f=[],p=[],m=0,g=0;m<s.length;m+=3,g+=2)n.vertices.push(new o(s[m],s[m+1],s[m+2])),void 0!==l&&d.push(new o(l[m],l[m+1],l[m+2])),void 0!==c&&n.colors.push(new q(c[m],c[m+1],c[m+2])),void 0!==h&&f.push(new i(h[g],h[g+1])),void 0!==u&&p.push(new i(u[g],u[g+1]));var v=e.groups;if(v.length>0)for(m=0;m<v.length;m++)for(var y=v[m],b=y.start,g=b,w=b+y.count;g<w;g+=3)void 0!==r?t(r[g],r[g+1],r[g+2],y.materialIndex):t(g,g+1,g+2,y.materialIndex);else if(void 0!==r)for(m=0;m<r.length;m+=3)t(r[m],r[m+1],r[m+2]);else for(m=0;m<s.length/3;m+=3)t(m,m+1,m+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){this.computeBoundingBox();var e=this.boundingBox.getCenter().negate();return this.translate(e.x,e.y,e.z),e},normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,i=0===t?1:1/t,r=new n;return r.set(i,0,0,-i*e.x,0,i,0,-i*e.y,0,0,i,-i*e.z,0,0,0,1),this.applyMatrix(r),this},computeFaceNormals:function(){for(var e=new o,t=new o,i=0,n=this.faces.length;i<n;i++){var r=this.faces[i],a=this.vertices[r.a],s=this.vertices[r.b],l=this.vertices[r.c];e.subVectors(l,s),t.subVectors(a,s),e.cross(t),e.normalize(),r.normal.copy(e)}},computeVertexNormals:function(e){void 0===e&&(e=!0);var t,i,n,r,a,s;for(s=new Array(this.vertices.length),t=0,i=this.vertices.length;t<i;t++)s[t]=new o;if(e){var l,c,h,u=new o,d=new o;for(n=0,r=this.faces.length;n<r;n++)a=this.faces[n],l=this.vertices[a.a],c=this.vertices[a.b],h=this.vertices[a.c],u.subVectors(h,c),d.subVectors(l,c),u.cross(d),s[a.a].add(u),s[a.b].add(u),s[a.c].add(u)}else for(this.computeFaceNormals(),n=0,r=this.faces.length;n<r;n++)s[(a=this.faces[n]).a].add(a.normal),s[a.b].add(a.normal),s[a.c].add(a.normal);for(t=0,i=this.vertices.length;t<i;t++)s[t].normalize();for(n=0,r=this.faces.length;n<r;n++){var f=(a=this.faces[n]).vertexNormals;3===f.length?(f[0].copy(s[a.a]),f[1].copy(s[a.b]),f[2].copy(s[a.c])):(f[0]=s[a.a].clone(),f[1]=s[a.b].clone(),f[2]=s[a.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var e,t,i;for(this.computeFaceNormals(),e=0,t=this.faces.length;e<t;e++){var n=(i=this.faces[e]).vertexNormals;3===n.length?(n[0].copy(i.normal),n[1].copy(i.normal),n[2].copy(i.normal)):(n[0]=i.normal.clone(),n[1]=i.normal.clone(),n[2]=i.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var e,t,i,n,r;for(i=0,n=this.faces.length;i<n;i++)for((r=this.faces[i]).__originalFaceNormal?r.__originalFaceNormal.copy(r.normal):r.__originalFaceNormal=r.normal.clone(),r.__originalVertexNormals||(r.__originalVertexNormals=[]),e=0,t=r.vertexNormals.length;e<t;e++)r.__originalVertexNormals[e]?r.__originalVertexNormals[e].copy(r.vertexNormals[e]):r.__originalVertexNormals[e]=r.vertexNormals[e].clone();var a=new de;for(a.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var s=this.morphNormals[e].faceNormals,l=this.morphNormals[e].vertexNormals;for(i=0,n=this.faces.length;i<n;i++)h=new o,u={a:new o,b:new o,c:new o},s.push(h),l.push(u)}var c=this.morphNormals[e];a.vertices=this.morphTargets[e].vertices,a.computeFaceNormals(),a.computeVertexNormals();var h,u;for(i=0,n=this.faces.length;i<n;i++)r=this.faces[i],h=c.faceNormals[i],u=c.vertexNormals[i],h.copy(r.normal),u.a.copy(r.vertexNormals[0]),u.b.copy(r.vertexNormals[1]),u.c.copy(r.vertexNormals[2])}for(i=0,n=this.faces.length;i<n;i++)(r=this.faces[i]).normal=r.__originalFaceNormal,r.vertexNormals=r.__originalVertexNormals},computeLineDistances:function(){for(var e=0,t=this.vertices,i=0,n=t.length;i<n;i++)i>0&&(e+=t[i].distanceTo(t[i-1])),this.lineDistances[i]=e},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new ee),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new te),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,i){if(e&&e.isGeometry){var n,r=this.vertices.length,o=this.vertices,a=e.vertices,l=this.faces,c=e.faces,h=this.faceVertexUvs[0],u=e.faceVertexUvs[0],d=this.colors,f=e.colors;void 0===i&&(i=0),void 0!==t&&(n=(new s).getNormalMatrix(t));for(var p=0,m=a.length;p<m;p++){var g=a[p].clone();void 0!==t&&g.applyMatrix4(t),o.push(g)}for(var p=0,m=f.length;p<m;p++)d.push(f[p].clone());for(p=0,m=c.length;p<m;p++){var v,y,b,w=c[p],x=w.vertexNormals,_=w.vertexColors;(v=new ue(w.a+r,w.b+r,w.c+r)).normal.copy(w.normal),void 0!==n&&v.normal.applyMatrix3(n).normalize();for(var M=0,T=x.length;M<T;M++)y=x[M].clone(),void 0!==n&&y.applyMatrix3(n).normalize(),v.vertexNormals.push(y);v.color.copy(w.color);for(var M=0,T=_.length;M<T;M++)b=_[M],v.vertexColors.push(b.clone());v.materialIndex=w.materialIndex+i,l.push(v)}for(p=0,m=u.length;p<m;p++){var S=u[p],E=[];if(void 0!==S){for(var M=0,T=S.length;M<T;M++)E.push(S[M].clone());h.push(E)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e)},mergeMesh:function(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},mergeVertices:function(){var e,t,i,n,r,o,a,s,l={},c=[],h=[],u=Math.pow(10,4);for(i=0,n=this.vertices.length;i<n;i++)e=this.vertices[i],void 0===l[t=Math.round(e.x*u)+"_"+Math.round(e.y*u)+"_"+Math.round(e.z*u)]?(l[t]=i,c.push(this.vertices[i]),h[i]=c.length-1):h[i]=h[l[t]];var d=[];for(i=0,n=this.faces.length;i<n;i++){(r=this.faces[i]).a=h[r.a],r.b=h[r.b],r.c=h[r.c],o=[r.a,r.b,r.c];for(var f=0;f<3;f++)if(o[f]===o[(f+1)%3]){d.push(i);break}}for(i=d.length-1;i>=0;i--){var p=d[i];for(this.faces.splice(p,1),a=0,s=this.faceVertexUvs.length;a<s;a++)this.faceVertexUvs[a].splice(p,1)}var m=this.vertices.length-c.length;return this.vertices=c,m},setFromPoints:function(e){this.vertices=[];for(var t=0,i=e.length;t<i;t++){var n=e[t];this.vertices.push(new o(n.x,n.y,n.z||0))}return this},sortFacesByMaterialIndex:function(){for(var e=this.faces,t=e.length,i=0;i<t;i++)e[i]._id=i;e.sort(function(e,t){return e.materialIndex-t.materialIndex});var n,r,o=this.faceVertexUvs[0],a=this.faceVertexUvs[1];o&&o.length===t&&(n=[]),a&&a.length===t&&(r=[]);for(i=0;i<t;i++){var s=e[i]._id;n&&n.push(o[s]),r&&r.push(a[s])}n&&(this.faceVertexUvs[0]=n),r&&(this.faceVertexUvs[1]=r)},toJSON:function(){function e(e,t,i){return i?e|1<<t:e&~(1<<t)}function t(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==d[t]?d[t]:(d[t]=u.length/3,u.push(e.x,e.y,e.z),d[t])}function i(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==p[t]?p[t]:(p[t]=f.length,f.push(e.getHex()),p[t])}function n(e){var t=e.x.toString()+e.y.toString();return void 0!==g[t]?g[t]:(g[t]=m.length/2,m.push(e.x,e.y),g[t])}var r={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),void 0!==this.parameters){var o=this.parameters;for(var a in o)void 0!==o[a]&&(r[a]=o[a]);return r}for(var s=[],l=0;l<this.vertices.length;l++){var c=this.vertices[l];s.push(c.x,c.y,c.z)}for(var h=[],u=[],d={},f=[],p={},m=[],g={},l=0;l<this.faces.length;l++){var v=this.faces[l],y=void 0!==this.faceVertexUvs[0][l],b=v.normal.length()>0,w=v.vertexNormals.length>0,x=1!==v.color.r||1!==v.color.g||1!==v.color.b,_=v.vertexColors.length>0,M=0;if(M=e(M,0,0),M=e(M,1,!0),M=e(M,2,!1),M=e(M,3,y),M=e(M,4,b),M=e(M,5,w),M=e(M,6,x),M=e(M,7,_),h.push(M),h.push(v.a,v.b,v.c),h.push(v.materialIndex),y){var T=this.faceVertexUvs[0][l];h.push(n(T[0]),n(T[1]),n(T[2]))}if(b&&h.push(t(v.normal)),w){var S=v.vertexNormals;h.push(t(S[0]),t(S[1]),t(S[2]))}if(x&&h.push(i(v.color)),_){var E=v.vertexColors;h.push(i(E[0]),i(E[1]),i(E[2]))}}return r.data={},r.data.vertices=s,r.data.normals=u,f.length>0&&(r.data.colors=f),m.length>0&&(r.data.uvs=[m]),r.data.faces=h,r},clone:function(){return(new de).copy(this)},copy:function(e){var t,i,n,r,o,a;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var s=e.vertices;for(t=0,i=s.length;t<i;t++)this.vertices.push(s[t].clone());var l=e.colors;for(t=0,i=l.length;t<i;t++)this.colors.push(l[t].clone());var c=e.faces;for(t=0,i=c.length;t<i;t++)this.faces.push(c[t].clone());for(t=0,i=e.faceVertexUvs.length;t<i;t++){var h=e.faceVertexUvs[t];for(void 0===this.faceVertexUvs[t]&&(this.faceVertexUvs[t]=[]),n=0,r=h.length;n<r;n++){var u=h[n],d=[];for(o=0,a=u.length;o<a;o++){var f=u[o];d.push(f.clone())}this.faceVertexUvs[t].push(d)}}var p=e.morphTargets;for(t=0,i=p.length;t<i;t++){var m={};if(m.name=p[t].name,void 0!==p[t].vertices)for(m.vertices=[],n=0,r=p[t].vertices.length;n<r;n++)m.vertices.push(p[t].vertices[n].clone());if(void 0!==p[t].normals)for(m.normals=[],n=0,r=p[t].normals.length;n<r;n++)m.normals.push(p[t].normals[n].clone());this.morphTargets.push(m)}var g=e.morphNormals;for(t=0,i=g.length;t<i;t++){var v={};if(void 0!==g[t].vertexNormals)for(v.vertexNormals=[],n=0,r=g[t].vertexNormals.length;n<r;n++){var y=g[t].vertexNormals[n],b={};b.a=y.a.clone(),b.b=y.b.clone(),b.c=y.c.clone(),v.vertexNormals.push(b)}if(void 0!==g[t].faceNormals)for(v.faceNormals=[],n=0,r=g[t].faceNormals.length;n<r;n++)v.faceNormals.push(g[t].faceNormals[n].clone());this.morphNormals.push(v)}var w=e.skinWeights;for(t=0,i=w.length;t<i;t++)this.skinWeights.push(w[t].clone());var x=e.skinIndices;for(t=0,i=x.length;t<i;t++)this.skinIndices.push(x[t].clone());var _=e.lineDistances;for(t=0,i=_.length;t<i;t++)this.lineDistances.push(_[t]);var M=e.boundingBox;null!==M&&(this.boundingBox=M.clone());var T=e.boundingSphere;return null!==T&&(this.boundingSphere=T.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(fe.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(fe.prototype,{isBufferAttribute:!0,setArray:function(e){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.count=void 0!==e?e.length/this.itemSize:0,this.array=e},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.dynamic=e.dynamic,this},copyAt:function(e,t,i){e*=this.itemSize,i*=t.itemSize;for(var n=0,r=this.itemSize;n<r;n++)this.array[e+n]=t.array[i+n];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,i=0,n=0,r=e.length;n<r;n++){var o=e[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),o=new q),t[i++]=o.r,t[i++]=o.g,t[i++]=o.b}return this},copyIndicesArray:function(e){for(var t=this.array,i=0,n=0,r=e.length;n<r;n++){var o=e[n];t[i++]=o.a,t[i++]=o.b,t[i++]=o.c}return this},copyVector2sArray:function(e){for(var t=this.array,n=0,r=0,o=e.length;r<o;r++){var a=e[r];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),a=new i),t[n++]=a.x,t[n++]=a.y}return this},copyVector3sArray:function(e){for(var t=this.array,i=0,n=0,r=e.length;n<r;n++){var a=e[n];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),a=new o),t[i++]=a.x,t[i++]=a.y,t[i++]=a.z}return this},copyVector4sArray:function(e){for(var t=this.array,i=0,n=0,r=e.length;n<r;n++){var o=e[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),o=new c),t[i++]=o.x,t[i++]=o.y,t[i++]=o.z,t[i++]=o.w}return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this},setXYZ:function(e,t,i,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this},setXYZW:function(e,t,i,n,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this.array[e+3]=r,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)}}),(pe.prototype=Object.create(fe.prototype)).constructor=pe,(me.prototype=Object.create(fe.prototype)).constructor=me,(ge.prototype=Object.create(fe.prototype)).constructor=ge,(ve.prototype=Object.create(fe.prototype)).constructor=ve,(ye.prototype=Object.create(fe.prototype)).constructor=ye,(be.prototype=Object.create(fe.prototype)).constructor=be,(we.prototype=Object.create(fe.prototype)).constructor=we,(xe.prototype=Object.create(fe.prototype)).constructor=xe,(_e.prototype=Object.create(fe.prototype)).constructor=_e,Object.assign(Me.prototype,{computeGroups:function(e){for(var t,i=[],n=void 0,r=e.faces,o=0;o<r.length;o++){var a=r[o];a.materialIndex!==n&&(n=a.materialIndex,void 0!==t&&(t.count=3*o-t.start,i.push(t)),t={start:3*o,materialIndex:n})}void 0!==t&&(t.count=3*o-t.start,i.push(t)),this.groups=i},fromGeometry:function(e){var t,n=e.faces,r=e.vertices,o=e.faceVertexUvs,a=o[0]&&o[0].length>0,s=o[1]&&o[1].length>0,l=e.morphTargets,c=l.length;if(c>0){t=[];for(v=0;v<c;v++)t[v]=[];this.morphTargets.position=t}var h,u=e.morphNormals,d=u.length;if(d>0){h=[];for(v=0;v<d;v++)h[v]=[];this.morphTargets.normal=h}for(var f=e.skinIndices,p=e.skinWeights,m=f.length===r.length,g=p.length===r.length,v=0;v<n.length;v++){var y=n[v];this.vertices.push(r[y.a],r[y.b],r[y.c]);var b=y.vertexNormals;if(3===b.length)this.normals.push(b[0],b[1],b[2]);else{var w=y.normal;this.normals.push(w,w,w)}var x=y.vertexColors;if(3===x.length)this.colors.push(x[0],x[1],x[2]);else{var _=y.color;this.colors.push(_,_,_)}if(!0===a){void 0!==(M=o[0][v])?this.uvs.push(M[0],M[1],M[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",v),this.uvs.push(new i,new i,new i))}if(!0===s){var M=o[1][v];void 0!==M?this.uvs2.push(M[0],M[1],M[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",v),this.uvs2.push(new i,new i,new i))}for(S=0;S<c;S++){var T=l[S].vertices;t[S].push(T[y.a],T[y.b],T[y.c])}for(var S=0;S<d;S++){var E=u[S].vertexNormals[v];h[S].push(E.a,E.b,E.c)}m&&this.skinIndices.push(f[y.a],f[y.b],f[y.c]),g&&this.skinWeights.push(p[y.a],p[y.b],p[y.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}});var fa=1;Object.assign(Se.prototype,t.prototype,{isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){Array.isArray(e)?this.index=new(Te(e)>65535?we:ye)(e,1):this.index=e},addAttribute:function(e,t){return t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),void this.setIndex(t)):(this.attributes[e]=t,this):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),void this.addAttribute(e,new fe(arguments[1],arguments[2])))},getAttribute:function(e){return this.attributes[e]},removeAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,i){this.groups.push({start:e,count:t,materialIndex:void 0!==i?i:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix:function(e){var t=this.attributes.position;void 0!==t&&(e.applyToBufferAttribute(t),t.needsUpdate=!0);var i=this.attributes.normal;if(void 0!==i){(new s).getNormalMatrix(e).applyToBufferAttribute(i),i.needsUpdate=!0}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(){var e=new n;return function(t){return e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e=new n;return function(t){return e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e=new n;return function(t){return e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e=new n;return function(t,i,n){return e.makeTranslation(t,i,n),this.applyMatrix(e),this}}(),scale:function(){var e=new n;return function(t,i,n){return e.makeScale(t,i,n),this.applyMatrix(e),this}}(),lookAt:function(){var e=new le;return function(t){e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),center:function(){this.computeBoundingBox();var e=this.boundingBox.getCenter().negate();return this.translate(e.x,e.y,e.z),e},setFromObject:function(e){var t=e.geometry;if(e.isPoints||e.isLine){var i=new xe(3*t.vertices.length,3),n=new xe(3*t.colors.length,3);if(this.addAttribute("position",i.copyVector3sArray(t.vertices)),this.addAttribute("color",n.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){var r=new xe(t.lineDistances.length,1);this.addAttribute("lineDistance",r.copyArray(t.lineDistances))}null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(e){for(var t=[],i=0,n=e.length;i<n;i++){var r=e[i];t.push(r.x,r.y,r.z||0)}return this.addAttribute("position",new xe(t,3)),this},updateFromObject:function(e){var t=e.geometry;if(e.isMesh){var i=t.__directGeometry;if(!0===t.elementsNeedUpdate&&(i=void 0,t.elementsNeedUpdate=!1),void 0===i)return this.fromGeometry(t);i.verticesNeedUpdate=t.verticesNeedUpdate,i.normalsNeedUpdate=t.normalsNeedUpdate,i.colorsNeedUpdate=t.colorsNeedUpdate,i.uvsNeedUpdate=t.uvsNeedUpdate,i.groupsNeedUpdate=t.groupsNeedUpdate,t.verticesNeedUpdate=!1,t.normalsNeedUpdate=!1,t.colorsNeedUpdate=!1,t.uvsNeedUpdate=!1,t.groupsNeedUpdate=!1,t=i}var n;return!0===t.verticesNeedUpdate&&(void 0!==(n=this.attributes.position)&&(n.copyVector3sArray(t.vertices),n.needsUpdate=!0),t.verticesNeedUpdate=!1),!0===t.normalsNeedUpdate&&(void 0!==(n=this.attributes.normal)&&(n.copyVector3sArray(t.normals),n.needsUpdate=!0),t.normalsNeedUpdate=!1),!0===t.colorsNeedUpdate&&(void 0!==(n=this.attributes.color)&&(n.copyColorsArray(t.colors),n.needsUpdate=!0),t.colorsNeedUpdate=!1),t.uvsNeedUpdate&&(void 0!==(n=this.attributes.uv)&&(n.copyVector2sArray(t.uvs),n.needsUpdate=!0),t.uvsNeedUpdate=!1),t.lineDistancesNeedUpdate&&(void 0!==(n=this.attributes.lineDistance)&&(n.copyArray(t.lineDistances),n.needsUpdate=!0),t.lineDistancesNeedUpdate=!1),t.groupsNeedUpdate&&(t.computeGroups(e.geometry),this.groups=t.groups,t.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=(new Me).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(3*e.vertices.length);if(this.addAttribute("position",new fe(t,3).copyVector3sArray(e.vertices)),e.normals.length>0){var i=new Float32Array(3*e.normals.length);this.addAttribute("normal",new fe(i,3).copyVector3sArray(e.normals))}if(e.colors.length>0){var n=new Float32Array(3*e.colors.length);this.addAttribute("color",new fe(n,3).copyColorsArray(e.colors))}if(e.uvs.length>0){var r=new Float32Array(2*e.uvs.length);this.addAttribute("uv",new fe(r,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){var o=new Float32Array(2*e.uvs2.length);this.addAttribute("uv2",new fe(o,2).copyVector2sArray(e.uvs2))}if(e.indices.length>0){var a=new(Te(e.indices)>65535?Uint32Array:Uint16Array)(3*e.indices.length);this.setIndex(new fe(a,1).copyIndicesArray(e.indices))}this.groups=e.groups;for(var s in e.morphTargets){for(var l=[],c=e.morphTargets[s],h=0,u=c.length;h<u;h++){var d=c[h],f=new xe(3*d.length,3);l.push(f.copyVector3sArray(d))}this.morphAttributes[s]=l}if(e.skinIndices.length>0){var p=new xe(4*e.skinIndices.length,4);this.addAttribute("skinIndex",p.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){var m=new xe(4*e.skinWeights.length,4);this.addAttribute("skinWeight",m.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new ee);var e=this.attributes.position;void 0!==e?this.boundingBox.setFromBufferAttribute(e):this.boundingBox.makeEmpty(),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){var e=new ee,t=new o;return function(){null===this.boundingSphere&&(this.boundingSphere=new te);var i=this.attributes.position;if(i){var n=this.boundingSphere.center;e.setFromBufferAttribute(i),e.getCenter(n);for(var r=0,o=0,a=i.count;o<a;o++)t.x=i.getX(o),t.y=i.getY(o),t.z=i.getZ(o),r=Math.max(r,n.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.attributes,i=this.groups;if(t.position){var n=t.position.array;if(void 0===t.normal)this.addAttribute("normal",new fe(new Float32Array(n.length),3));else for(var r=t.normal.array,a=0,s=r.length;a<s;a++)r[a]=0;var l,c,h,u=t.normal.array,d=new o,f=new o,p=new o,m=new o,g=new o;if(e){var v=e.array;0===i.length&&this.addGroup(0,v.length);for(var y=0,b=i.length;y<b;++y)for(var w=i[y],x=w.start,a=x,s=x+w.count;a<s;a+=3)l=3*v[a+0],c=3*v[a+1],h=3*v[a+2],d.fromArray(n,l),f.fromArray(n,c),p.fromArray(n,h),m.subVectors(p,f),g.subVectors(d,f),m.cross(g),u[l]+=m.x,u[l+1]+=m.y,u[l+2]+=m.z,u[c]+=m.x,u[c+1]+=m.y,u[c+2]+=m.z,u[h]+=m.x,u[h+1]+=m.y,u[h+2]+=m.z}else for(var a=0,s=n.length;a<s;a+=9)d.fromArray(n,a),f.fromArray(n,a+3),p.fromArray(n,a+6),m.subVectors(p,f),g.subVectors(d,f),m.cross(g),u[a]=m.x,u[a+1]=m.y,u[a+2]=m.z,u[a+3]=m.x,u[a+4]=m.y,u[a+5]=m.z,u[a+6]=m.x,u[a+7]=m.y,u[a+8]=m.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},merge:function(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0);var i=this.attributes;for(var n in i)if(void 0!==e.attributes[n])for(var r=i[n].array,o=e.attributes[n],a=o.array,s=0,l=o.itemSize*t;s<a.length;s++,l++)r[l]=a[s];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)},normalizeNormals:function(){var e=new o;return function(){for(var t=this.attributes.normal,i=0,n=t.count;i<n;i++)e.x=t.getX(i),e.y=t.getY(i),e.z=t.getZ(i),e.normalize(),t.setXYZ(i,e.x,e.y,e.z)}}(),toNonIndexed:function(){if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var e=new Se,t=this.index.array,i=this.attributes;for(var n in i){for(var r=i[n],o=r.array,a=r.itemSize,s=new o.constructor(t.length*a),l=0,c=0,h=0,u=t.length;h<u;h++){l=t[h]*a;for(var d=0;d<a;d++)s[c++]=o[l++]}e.addAttribute(n,new fe(s,a))}return e},toJSON:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var i in t)void 0!==t[i]&&(e[i]=t[i]);return e}e.data={attributes:{}};var n=this.index;if(null!==n){a=Array.prototype.slice.call(n.array);e.data.index={type:n.array.constructor.name,array:a}}var r=this.attributes;for(var i in r){var o=r[i],a=Array.prototype.slice.call(o.array);e.data.attributes[i]={itemSize:o.itemSize,type:o.array.constructor.name,array:a,normalized:o.normalized}}var s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));var l=this.boundingSphere;return null!==l&&(e.data.boundingSphere={center:l.center.toArray(),radius:l.radius}),e},clone:function(){return(new Se).copy(this)},copy:function(e){var t,i,n;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var r=e.index;null!==r&&this.setIndex(r.clone());var o=e.attributes;for(t in o){var a=o[t];this.addAttribute(t,a.clone())}var s=e.morphAttributes;for(t in s){var l=[],c=s[t];for(i=0,n=c.length;i<n;i++)l.push(c[i].clone());this.morphAttributes[t]=l}var h=e.groups;for(i=0,n=h.length;i<n;i++){var u=h[i];this.addGroup(u.start,u.count,u.materialIndex)}var d=e.boundingBox;null!==d&&(this.boundingBox=d.clone());var f=e.boundingSphere;return null!==f&&(this.boundingSphere=f.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),(Ee.prototype=Object.create(de.prototype)).constructor=Ee,(Ce.prototype=Object.create(Se.prototype)).constructor=Ce,(Pe.prototype=Object.create(de.prototype)).constructor=Pe,(Le.prototype=Object.create(Se.prototype)).constructor=Le,(ke.prototype=Object.create(de.prototype)).constructor=ke,(Ae.prototype=Object.create(Se.prototype)).constructor=Ae,(Re.prototype=Object.create(J.prototype)).constructor=Re,Re.prototype.isMeshBasicMaterial=!0,Re.prototype.copy=function(e){return J.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this},(Oe.prototype=Object.create(J.prototype)).constructor=Oe,Oe.prototype.isShaderMaterial=!0,Oe.prototype.copy=function(e){return J.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=sa.clone(e.uniforms),this.defines=e.defines,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=e.extensions,this},Oe.prototype.toJSON=function(e){var t=J.prototype.toJSON.call(this,e);return t.uniforms=this.uniforms,t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t},Object.assign(Ie.prototype,{set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return(t||new o).copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this},recast:function(){var e=new o;return function(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){var i=t||new o;i.subVectors(e,this.origin);var n=i.dot(this.direction);return n<0?i.copy(this.origin):i.copy(this.direction).multiplyScalar(n).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(){var e=new o;return function(t){var i=e.subVectors(t,this.origin).dot(this.direction);return i<0?this.origin.distanceToSquared(t):(e.copy(this.direction).multiplyScalar(i).add(this.origin),e.distanceToSquared(t))}}(),distanceSqToSegment:function(){var e=new o,t=new o,i=new o;return function(n,r,o,a){e.copy(n).add(r).multiplyScalar(.5),t.copy(r).sub(n).normalize(),i.copy(this.origin).sub(e);var s,l,c,h,u=.5*n.distanceTo(r),d=-this.direction.dot(t),f=i.dot(this.direction),p=-i.dot(t),m=i.lengthSq(),g=Math.abs(1-d*d);if(g>0)if(s=d*p-f,l=d*f-p,h=u*g,s>=0)if(l>=-h)if(l<=h){var v=1/g;c=(s*=v)*(s+d*(l*=v)+2*f)+l*(d*s+l+2*p)+m}else l=u,c=-(s=Math.max(0,-(d*l+f)))*s+l*(l+2*p)+m;else l=-u,c=-(s=Math.max(0,-(d*l+f)))*s+l*(l+2*p)+m;else l<=-h?c=-(s=Math.max(0,-(-d*u+f)))*s+(l=s>0?-u:Math.min(Math.max(-u,-p),u))*(l+2*p)+m:l<=h?(s=0,c=(l=Math.min(Math.max(-u,-p),u))*(l+2*p)+m):c=-(s=Math.max(0,-(d*u+f)))*s+(l=s>0?u:Math.min(Math.max(-u,-p),u))*(l+2*p)+m;else l=d>0?-u:u,c=-(s=Math.max(0,-(d*l+f)))*s+l*(l+2*p)+m;return o&&o.copy(this.direction).multiplyScalar(s).add(this.origin),a&&a.copy(t).multiplyScalar(l).add(e),c}}(),intersectSphere:function(){var e=new o;return function(t,i){e.subVectors(t.center,this.origin);var n=e.dot(this.direction),r=e.dot(e)-n*n,o=t.radius*t.radius;if(r>o)return null;var a=Math.sqrt(o-r),s=n-a,l=n+a;return s<0&&l<0?null:s<0?this.at(l,i):this.at(s,i)}}(),intersectsSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null},intersectPlane:function(e,t){var i=this.distanceToPlane(e);return null===i?null:this.at(i,t)},intersectsPlane:function(e){var t=e.distanceToPoint(this.origin);if(0===t)return!0;return e.normal.dot(this.direction)*t<0},intersectBox:function(e,t){var i,n,r,o,a,s,l=1/this.direction.x,c=1/this.direction.y,h=1/this.direction.z,u=this.origin;return l>=0?(i=(e.min.x-u.x)*l,n=(e.max.x-u.x)*l):(i=(e.max.x-u.x)*l,n=(e.min.x-u.x)*l),c>=0?(r=(e.min.y-u.y)*c,o=(e.max.y-u.y)*c):(r=(e.max.y-u.y)*c,o=(e.min.y-u.y)*c),i>o||r>n?null:((r>i||i!=i)&&(i=r),(o<n||n!=n)&&(n=o),h>=0?(a=(e.min.z-u.z)*h,s=(e.max.z-u.z)*h):(a=(e.max.z-u.z)*h,s=(e.min.z-u.z)*h),i>s||a>n?null:((a>i||i!=i)&&(i=a),(s<n||n!=n)&&(n=s),n<0?null:this.at(i>=0?i:n,t)))},intersectsBox:function(){var e=new o;return function(t){return null!==this.intersectBox(t,e)}}(),intersectTriangle:function(){var e=new o,t=new o,i=new o,n=new o;return function(r,o,a,s,l){t.subVectors(o,r),i.subVectors(a,r),n.crossVectors(t,i);var c,h=this.direction.dot(n);if(h>0){if(s)return null;c=1}else{if(!(h<0))return null;c=-1,h=-h}e.subVectors(this.origin,r);var u=c*this.direction.dot(i.crossVectors(e,i));if(u<0)return null;var d=c*this.direction.dot(t.cross(e));if(d<0)return null;if(u+d>h)return null;var f=-c*e.dot(n);return f<0?null:this.at(f/h,l)}}(),applyMatrix4:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}),Object.assign(Be.prototype,{set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},getCenter:function(e){return(e||new o).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return(e||new o).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){var i=t||new o;return this.delta(i).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(){var e=new o,t=new o;return function(i,n){e.subVectors(i,this.start),t.subVectors(this.end,this.start);var r=t.dot(t),o=t.dot(e)/r;return n&&(o=Zo.clamp(o,0,1)),o}}(),closestPointToPoint:function(e,t,i){var n=this.closestPointToPointParameter(e,t),r=i||new o;return this.delta(r).multiplyScalar(n).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}),Object.assign(De,{normal:function(){var e=new o;return function(t,i,n,r){var a=r||new o;a.subVectors(n,i),e.subVectors(t,i),a.cross(e);var s=a.lengthSq();return s>0?a.multiplyScalar(1/Math.sqrt(s)):a.set(0,0,0)}}(),barycoordFromPoint:function(){var e=new o,t=new o,i=new o;return function(n,r,a,s,l){e.subVectors(s,r),t.subVectors(a,r),i.subVectors(n,r);var c=e.dot(e),h=e.dot(t),u=e.dot(i),d=t.dot(t),f=t.dot(i),p=c*d-h*h,m=l||new o;if(0===p)return m.set(-2,-1,-1);var g=1/p,v=(d*u-h*f)*g,y=(c*f-h*u)*g;return m.set(1-v-y,y,v)}}(),containsPoint:function(){var e=new o;return function(t,i,n,r){var o=De.barycoordFromPoint(t,i,n,r,e);return o.x>=0&&o.y>=0&&o.x+o.y<=1}}()}),Object.assign(De.prototype,{set:function(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this},setFromPointsAndIndices:function(e,t,i,n){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[n]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},area:function(){var e=new o,t=new o;return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),midpoint:function(e){return(e||new o).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return De.normal(this.a,this.b,this.c,e)},plane:function(e){return(e||new ie).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(e,t){return De.barycoordFromPoint(e,this.a,this.b,this.c,t)},containsPoint:function(e){return De.containsPoint(e,this.a,this.b,this.c)},closestPointToPoint:function(){var e=new ie,t=[new Be,new Be,new Be],i=new o,n=new o;return function(r,a){var s=a||new o,l=1/0;if(e.setFromCoplanarPoints(this.a,this.b,this.c),e.projectPoint(r,i),!0===this.containsPoint(i))s.copy(i);else{t[0].set(this.a,this.b),t[1].set(this.b,this.c),t[2].set(this.c,this.a);for(var c=0;c<t.length;c++){t[c].closestPointToPoint(i,!0,n);var h=i.distanceToSquared(n);h<l&&(l=h,s.copy(n))}}return s}}(),equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}),Ue.prototype=Object.assign(Object.create(le.prototype),{constructor:Ue,isMesh:!0,setDrawMode:function(e){this.drawMode=e},copy:function(e){return le.prototype.copy.call(this,e),this.drawMode=e.drawMode,void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this},updateMorphTargets:function(){var e,t,i,n=this.geometry;if(n.isBufferGeometry){var r=n.morphAttributes,o=Object.keys(r);if(o.length>0){var a=r[o[0]];if(void 0!==a)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=a.length;e<t;e++)i=a[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}else{var s=n.morphTargets;if(void 0!==s&&s.length>0)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=s.length;e<t;e++)i=s[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}},raycast:function(){function e(e,t,i,n,r,o,a){return De.barycoordFromPoint(e,t,i,n,y),r.multiplyScalar(y.x),o.multiplyScalar(y.y),a.multiplyScalar(y.z),r.add(o).add(a),r.clone()}function t(e,t,i,n,r,o,a,s){if(null===(t.side===tr?n.intersectTriangle(a,o,r,!0,s):n.intersectTriangle(r,o,a,t.side!==ir,s)))return null;w.copy(s),w.applyMatrix4(e.matrixWorld);var l=i.ray.origin.distanceTo(w);return l<i.near||l>i.far?null:{distance:l,point:w.clone(),object:e}}function r(i,n,r,o,a,s,l,d){c.fromBufferAttribute(o,s),h.fromBufferAttribute(o,l),u.fromBufferAttribute(o,d);var f=t(i,i.material,n,r,c,h,u,b);return f&&(a&&(m.fromBufferAttribute(a,s),g.fromBufferAttribute(a,l),v.fromBufferAttribute(a,d),f.uv=e(b,c,h,u,m,g,v)),f.face=new ue(s,l,d,De.normal(c,h,u)),f.faceIndex=s),f}var a=new n,s=new Ie,l=new te,c=new o,h=new o,u=new o,d=new o,f=new o,p=new o,m=new i,g=new i,v=new i,y=new o,b=new o,w=new o;return function(i,n){var o=this.geometry,y=this.material,w=this.matrixWorld;if(void 0!==y&&(null===o.boundingSphere&&o.computeBoundingSphere(),l.copy(o.boundingSphere),l.applyMatrix4(w),!1!==i.ray.intersectsSphere(l)&&(a.getInverse(w),s.copy(i.ray).applyMatrix4(a),null===o.boundingBox||!1!==s.intersectsBox(o.boundingBox)))){var x;if(o.isBufferGeometry){var _,M,T,S,E,C=o.index,P=o.attributes.position,L=o.attributes.uv;if(null!==C)for(S=0,E=C.count;S<E;S+=3)_=C.getX(S),M=C.getX(S+1),T=C.getX(S+2),(x=r(this,i,s,P,L,_,M,T))&&(x.faceIndex=Math.floor(S/3),n.push(x));else if(void 0!==P)for(S=0,E=P.count;S<E;S+=3)(x=r(this,i,s,P,L,_=S,M=S+1,T=S+2))&&(x.index=_,n.push(x))}else if(o.isGeometry){var k,A,R,O,I=Array.isArray(y),B=o.vertices,D=o.faces,U=o.faceVertexUvs[0];U.length>0&&(O=U);for(var z=0,N=D.length;z<N;z++){var j=D[z],F=I?y[j.materialIndex]:y;if(void 0!==F){if(k=B[j.a],A=B[j.b],R=B[j.c],!0===F.morphTargets){var G=o.morphTargets,H=this.morphTargetInfluences;c.set(0,0,0),h.set(0,0,0),u.set(0,0,0);for(var V=0,W=G.length;V<W;V++){var q=H[V];if(0!==q){var X=G[V].vertices;c.addScaledVector(d.subVectors(X[j.a],k),q),h.addScaledVector(f.subVectors(X[j.b],A),q),u.addScaledVector(p.subVectors(X[j.c],R),q)}}c.add(k),h.add(A),u.add(R),k=c,A=h,R=u}if(x=t(this,F,i,s,k,A,R,b)){if(O&&O[z]){var K=O[z];m.copy(K[0]),g.copy(K[1]),v.copy(K[2]),x.uv=e(b,k,A,R,m,g,v)}x.face=j,x.faceIndex=z,n.push(x)}}}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var pa=0;$e.prototype=Object.assign(Object.create(ce.prototype),{constructor:$e,isPerspectiveCamera:!0,copy:function(e,t){return ce.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*Zo.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){var e=Math.tan(.5*Zo.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*Zo.RAD2DEG*Math.atan(Math.tan(.5*Zo.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,i,n,r,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near,t=e*Math.tan(.5*Zo.DEG2RAD*this.fov)/this.zoom,i=2*t,n=this.aspect*i,r=-.5*n,o=this.view;if(null!==this.view&&this.view.enabled){var a=o.fullWidth,s=o.fullHeight;r+=o.offsetX*n/a,t-=o.offsetY*i/s,n*=o.width/a,i*=o.height/s}var l=this.filmOffset;0!==l&&(r+=e*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+n,t,t-i,e,this.far)},toJSON:function(e){var t=le.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}),et.prototype=Object.assign(Object.create($e.prototype),{constructor:et,isArrayCamera:!0}),nt.prototype.isFogExp2=!0,nt.prototype.clone=function(){return new nt(this.color.getHex(),this.density)},nt.prototype.toJSON=function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}},rt.prototype.isFog=!0,rt.prototype.clone=function(){return new rt(this.color.getHex(),this.near,this.far)},rt.prototype.toJSON=function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}},ot.prototype=Object.assign(Object.create(le.prototype),{constructor:ot,copy:function(e,t){return le.prototype.copy.call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},toJSON:function(e){var t=le.prototype.toJSON.call(this,e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}),at.prototype=Object.assign(Object.create(le.prototype),{constructor:at,isLensFlare:!0,copy:function(e){le.prototype.copy.call(this,e),this.positionScreen.copy(e.positionScreen),this.customUpdateCallback=e.customUpdateCallback;for(var t=0,i=e.lensFlares.length;t<i;t++)this.lensFlares.push(e.lensFlares[t]);return this},add:function(e,t,i,n,r,o){void 0===t&&(t=-1),void 0===i&&(i=0),void 0===o&&(o=1),void 0===r&&(r=new q(16777215)),void 0===n&&(n=sr),i=Math.min(i,Math.max(0,i)),this.lensFlares.push({texture:e,size:t,distance:i,x:0,y:0,z:0,scale:1,rotation:0,opacity:o,color:r,blending:n})},updateLensFlares:function(){var e,t,i=this.lensFlares.length,n=2*-this.positionScreen.x,r=2*-this.positionScreen.y;for(e=0;e<i;e++)(t=this.lensFlares[e]).x=this.positionScreen.x+n*t.distance,t.y=this.positionScreen.y+r*t.distance,t.wantedRotation=t.x*Math.PI*.25,t.rotation+=.25*(t.wantedRotation-t.rotation)}}),(st.prototype=Object.create(J.prototype)).constructor=st,st.prototype.isSpriteMaterial=!0,st.prototype.copy=function(e){return J.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.rotation=e.rotation,this},lt.prototype=Object.assign(Object.create(le.prototype),{constructor:lt,isSprite:!0,raycast:function(){var e=new o,t=new o,i=new o;return function(n,r){t.setFromMatrixPosition(this.matrixWorld),n.ray.closestPointToPoint(t,e),i.setFromMatrixScale(this.matrixWorld);var o=i.x*i.y/4;if(!(t.distanceToSquared(e)>o)){var a=n.ray.origin.distanceTo(e);a<n.near||a>n.far||r.push({distance:a,point:e.clone(),face:null,object:this})}}}(),clone:function(){return new this.constructor(this.material).copy(this)}}),ct.prototype=Object.assign(Object.create(le.prototype),{constructor:ct,copy:function(e){le.prototype.copy.call(this,e,!1);for(var t=e.levels,i=0,n=t.length;i<n;i++){var r=t[i];this.addLevel(r.object.clone(),r.distance)}return this},addLevel:function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var i=this.levels,n=0;n<i.length&&!(t<i[n].distance);n++);i.splice(n,0,{distance:t,object:e}),this.add(e)},getObjectForDistance:function(e){for(var t=this.levels,i=1,n=t.length;i<n&&!(e<t[i].distance);i++);return t[i-1].object},raycast:function(){var e=new o;return function(t,i){e.setFromMatrixPosition(this.matrixWorld);var n=t.ray.origin.distanceTo(e);this.getObjectForDistance(n).raycast(t,i)}}(),update:function(){var e=new o,t=new o;return function(i){var n=this.levels;if(n.length>1){e.setFromMatrixPosition(i.matrixWorld),t.setFromMatrixPosition(this.matrixWorld);var r=e.distanceTo(t);n[0].object.visible=!0;for(var o=1,a=n.length;o<a&&r>=n[o].distance;o++)n[o-1].object.visible=!1,n[o].object.visible=!0;for(;o<a;o++)n[o].object.visible=!1}}}(),toJSON:function(e){var t=le.prototype.toJSON.call(this,e);t.object.levels=[];for(var i=this.levels,n=0,r=i.length;n<r;n++){var o=i[n];t.object.levels.push({object:o.object.uuid,distance:o.distance})}return t}}),Object.assign(ht.prototype,{calculateInverses:function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var i=new n;this.bones[e]&&i.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(i)}},pose:function(){var e,t,i;for(t=0,i=this.bones.length;t<i;t++)(e=this.bones[t])&&e.matrixWorld.getInverse(this.boneInverses[t]);for(t=0,i=this.bones.length;t<i;t++)(e=this.bones[t])&&(e.parent&&e.parent.isBone?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},update:function(){var e=new n,t=new n;return function(){for(var i=this.bones,n=this.boneInverses,r=this.boneMatrices,o=this.boneTexture,a=0,s=i.length;a<s;a++){var l=i[a]?i[a].matrixWorld:t;e.multiplyMatrices(l,n[a]),e.toArray(r,16*a)}void 0!==o&&(o.needsUpdate=!0)}}(),clone:function(){return new ht(this.bones,this.boneInverses)}}),ut.prototype=Object.assign(Object.create(le.prototype),{constructor:ut,isBone:!0}),dt.prototype=Object.assign(Object.create(Ue.prototype),{constructor:dt,isSkinnedMesh:!0,initBones:function(){var e,t,i,n,r=[];if(this.geometry&&void 0!==this.geometry.bones){for(i=0,n=this.geometry.bones.length;i<n;i++)t=this.geometry.bones[i],e=new ut,r.push(e),e.name=t.name,e.position.fromArray(t.pos),e.quaternion.fromArray(t.rotq),void 0!==t.scl&&e.scale.fromArray(t.scl);for(i=0,n=this.geometry.bones.length;i<n;i++)-1!==(t=this.geometry.bones[i]).parent&&null!==t.parent&&void 0!==r[t.parent]?r[t.parent].add(r[i]):this.add(r[i])}return this.updateMatrixWorld(!0),r},bind:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){var e,t;if(this.geometry&&this.geometry.isGeometry)for(t=0;t<this.geometry.skinWeights.length;t++){var i=this.geometry.skinWeights[t];(e=1/i.manhattanLength())!==1/0?i.multiplyScalar(e):i.set(1,0,0,0)}else if(this.geometry&&this.geometry.isBufferGeometry){var n=new c,r=this.geometry.attributes.skinWeight;for(t=0;t<r.count;t++)n.x=r.getX(t),n.y=r.getY(t),n.z=r.getZ(t),n.w=r.getW(t),(e=1/n.manhattanLength())!==1/0?n.multiplyScalar(e):n.set(1,0,0,0),r.setXYZW(t,n.x,n.y,n.z,n.w)}},updateMatrixWorld:function(e){Ue.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),(ft.prototype=Object.create(J.prototype)).constructor=ft,ft.prototype.isLineBasicMaterial=!0,ft.prototype.copy=function(e){return J.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this},pt.prototype=Object.assign(Object.create(le.prototype),{constructor:pt,isLine:!0,raycast:function(){var e=new n,t=new Ie,i=new te;return function(n,r){var a=n.linePrecision,s=a*a,l=this.geometry,c=this.matrixWorld;if(null===l.boundingSphere&&l.computeBoundingSphere(),i.copy(l.boundingSphere),i.applyMatrix4(c),!1!==n.ray.intersectsSphere(i)){e.getInverse(c),t.copy(n.ray).applyMatrix4(e);var h=new o,u=new o,d=new o,f=new o,p=this&&this.isLineSegments?2:1;if(l.isBufferGeometry){var m=l.index,g=l.attributes.position.array;if(null!==m)for(var v=m.array,y=0,b=v.length-1;y<b;y+=p){var w=v[y],x=v[y+1];h.fromArray(g,3*w),u.fromArray(g,3*x);if(!((T=t.distanceSqToSegment(h,u,f,d))>s)){f.applyMatrix4(this.matrixWorld);(S=n.ray.origin.distanceTo(f))<n.near||S>n.far||r.push({distance:S,point:d.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this})}}else for(var y=0,b=g.length/3-1;y<b;y+=p){h.fromArray(g,3*y),u.fromArray(g,3*y+3);if(!((T=t.distanceSqToSegment(h,u,f,d))>s)){f.applyMatrix4(this.matrixWorld);(S=n.ray.origin.distanceTo(f))<n.near||S>n.far||r.push({distance:S,point:d.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this})}}}else if(l.isGeometry)for(var _=l.vertices,M=_.length,y=0;y<M-1;y+=p){var T=t.distanceSqToSegment(_[y],_[y+1],f,d);if(!(T>s)){f.applyMatrix4(this.matrixWorld);var S=n.ray.origin.distanceTo(f);S<n.near||S>n.far||r.push({distance:S,point:d.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this})}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),mt.prototype=Object.assign(Object.create(pt.prototype),{constructor:mt,isLineSegments:!0}),gt.prototype=Object.assign(Object.create(pt.prototype),{constructor:gt,isLineLoop:!0}),(vt.prototype=Object.create(J.prototype)).constructor=vt,vt.prototype.isPointsMaterial=!0,vt.prototype.copy=function(e){return J.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this},yt.prototype=Object.assign(Object.create(le.prototype),{constructor:yt,isPoints:!0,raycast:function(){var e=new n,t=new Ie,i=new te;return function(n,r){function a(e,i){var o=t.distanceSqToPoint(e);if(o<d){var a=t.closestPointToPoint(e);a.applyMatrix4(c);var l=n.ray.origin.distanceTo(a);if(l<n.near||l>n.far)return;r.push({distance:l,distanceToRay:Math.sqrt(o),point:a.clone(),index:i,face:null,object:s})}}var s=this,l=this.geometry,c=this.matrixWorld,h=n.params.Points.threshold;if(null===l.boundingSphere&&l.computeBoundingSphere(),i.copy(l.boundingSphere),i.applyMatrix4(c),i.radius+=h,!1!==n.ray.intersectsSphere(i)){e.getInverse(c),t.copy(n.ray).applyMatrix4(e);var u=h/((this.scale.x+this.scale.y+this.scale.z)/3),d=u*u,f=new o;if(l.isBufferGeometry){var p=l.index,m=l.attributes.position.array;if(null!==p)for(var g=p.array,v=0,y=g.length;v<y;v++){var b=g[v];f.fromArray(m,3*b),a(f,b)}else for(var v=0,w=m.length/3;v<w;v++)f.fromArray(m,3*v),a(f,v)}else for(var x=l.vertices,v=0,w=x.length;v<w;v++)a(x[v],v)}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),bt.prototype=Object.assign(Object.create(le.prototype),{constructor:bt}),(wt.prototype=Object.create(l.prototype)).constructor=wt,(xt.prototype=Object.create(l.prototype)).constructor=xt,xt.prototype.isCompressedTexture=!0,(_t.prototype=Object.create(l.prototype)).constructor=_t,_t.prototype.isDepthTexture=!0,(Mt.prototype=Object.create(de.prototype)).constructor=Mt,(Tt.prototype=Object.create(Se.prototype)).constructor=Tt,(St.prototype=Object.create(de.prototype)).constructor=St,(Et.prototype=Object.create(Se.prototype)).constructor=Et,(Ct.prototype=Object.create(de.prototype)).constructor=Ct,(Pt.prototype=Object.create(Et.prototype)).constructor=Pt,(Lt.prototype=Object.create(de.prototype)).constructor=Lt,(kt.prototype=Object.create(Et.prototype)).constructor=kt,(At.prototype=Object.create(de.prototype)).constructor=At,(Rt.prototype=Object.create(Et.prototype)).constructor=Rt;var ma={area:function(e){for(var t=e.length,i=0,n=t-1,r=0;r<t;n=r++)i+=e[n].x*e[r].y-e[r].x*e[n].y;return.5*i},triangulate:function(){function e(e,t,i,n,r,o){var a,s,l,c,h,u,d,f,p;if(s=e[o[t]].x,l=e[o[t]].y,c=e[o[i]].x,h=e[o[i]].y,u=e[o[n]].x,d=e[o[n]].y,(c-s)*(d-l)-(h-l)*(u-s)<=0)return!1;var m,g,v,y,b,w,x,_,M,T,S,E,C,P,L;for(m=u-c,g=d-h,v=s-u,y=l-d,b=c-s,w=h-l,a=0;a<r;a++)if(f=e[o[a]].x,p=e[o[a]].y,!(f===s&&p===l||f===c&&p===h||f===u&&p===d)&&(x=f-s,_=p-l,M=f-c,T=p-h,S=f-u,E=p-d,L=m*T-g*M,C=b*_-w*x,P=v*E-y*S,L>=-Number.EPSILON&&P>=-Number.EPSILON&&C>=-Number.EPSILON))return!1;return!0}return function(t,i){var n=t.length;if(n<3)return null;var r,o,a,s=[],l=[],c=[];if(ma.area(t)>0)for(o=0;o<n;o++)l[o]=o;else for(o=0;o<n;o++)l[o]=n-1-o;var h=n,u=2*h;for(o=h-1;h>2;){if(u--<=0)return console.warn("THREE.ShapeUtils: Unable to triangulate polygon! in triangulate()"),i?c:s;if(r=o,h<=r&&(r=0),o=r+1,h<=o&&(o=0),a=o+1,h<=a&&(a=0),e(t,r,o,a,h,l)){var d,f,p,m,g;for(d=l[r],f=l[o],p=l[a],s.push([t[d],t[f],t[p]]),c.push([l[r],l[o],l[a]]),m=o,g=o+1;g<h;m++,g++)l[m]=l[g];u=2*--h}}return i?c:s}}(),triangulateShape:function(e,t){function i(e){var t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function n(e,t,i){return e.x!==t.x?e.x<t.x?e.x<=i.x&&i.x<=t.x:t.x<=i.x&&i.x<=e.x:e.y<t.y?e.y<=i.y&&i.y<=t.y:t.y<=i.y&&i.y<=e.y}function r(e,t,i,r,o){var a=t.x-e.x,s=t.y-e.y,l=r.x-i.x,c=r.y-i.y,h=e.x-i.x,u=e.y-i.y,d=s*l-a*c,f=s*h-a*u;if(Math.abs(d)>Number.EPSILON){var p;if(d>0){if(f<0||f>d)return[];if((p=c*h-l*u)<0||p>d)return[]}else{if(f>0||f<d)return[];if((p=c*h-l*u)>0||p<d)return[]}if(0===p)return!o||0!==f&&f!==d?[e]:[];if(p===d)return!o||0!==f&&f!==d?[t]:[];if(0===f)return[i];if(f===d)return[r];var m=p/d;return[{x:e.x+m*a,y:e.y+m*s}]}if(0!==f||c*h!=l*u)return[];var g=0===a&&0===s,v=0===l&&0===c;if(g&&v)return e.x!==i.x||e.y!==i.y?[]:[e];if(g)return n(i,r,e)?[e]:[];if(v)return n(e,t,i)?[i]:[];var y,b,w,x,_,M,T,S;return 0!==a?(e.x<t.x?(y=e,w=e.x,b=t,x=t.x):(y=t,w=t.x,b=e,x=e.x),i.x<r.x?(_=i,T=i.x,M=r,S=r.x):(_=r,T=r.x,M=i,S=i.x)):(e.y<t.y?(y=e,w=e.y,b=t,x=t.y):(y=t,w=t.y,b=e,x=e.y),i.y<r.y?(_=i,T=i.y,M=r,S=r.y):(_=r,T=r.y,M=i,S=i.y)),w<=T?x<T?[]:x===T?o?[]:[_]:x<=S?[_,b]:[_,M]:w>S?[]:w===S?o?[]:[y]:x<=S?[y,b]:[y,M]}function o(e,t,i,n){var r=t.x-e.x,o=t.y-e.y,a=i.x-e.x,s=i.y-e.y,l=n.x-e.x,c=n.y-e.y,h=r*s-o*a,u=r*c-o*l;if(Math.abs(h)>Number.EPSILON){var d=l*s-c*a;return h>0?u>=0&&d>=0:u>=0||d>=0}return u>0}i(e),t.forEach(i);for(var a,s,l,c,h,u,d={},f=e.concat(),p=0,m=t.length;p<m;p++)Array.prototype.push.apply(f,t[p]);for(a=0,s=f.length;a<s;a++)void 0!==d[h=f[a].x+":"+f[a].y]&&console.warn("THREE.ShapeUtils: Duplicate point",h,a),d[h]=a;var g=function(e,t){function i(e,t){var i=y.length-1,n=e-1;n<0&&(n=i);var r=e+1;r>i&&(r=0);var a=o(y[e],y[n],y[r],s[t]);if(!a)return!1;var l=s.length-1,c=t-1;c<0&&(c=l);var h=t+1;return h>l&&(h=0),!!(a=o(s[t],s[c],s[h],y[e]))}function n(e,t){var i,n;for(i=0;i<y.length;i++)if(n=i+1,n%=y.length,r(e,t,y[i],y[n],!0).length>0)return!0;return!1}function a(e,i){var n,o,a,s;for(n=0;n<b.length;n++)for(o=t[b[n]],a=0;a<o.length;a++)if(s=a+1,s%=o.length,r(e,i,o[a],o[s],!0).length>0)return!0;return!1}for(var s,l,c,h,u,d,f,p,m,g,v,y=e.concat(),b=[],w=[],x=0,_=t.length;x<_;x++)b.push(x);for(var M=0,T=2*b.length;b.length>0;){if(--T<0){console.log('THREE.ShapeUtils: Infinite Loop! Holes left:" + indepHoles.length + ", Probably Hole outside Shape!');break}for(c=M;c<y.length;c++){for(h=y[c],l=-1,x=0;x<b.length;x++)if(d=b[x],f=h.x+":"+h.y+":"+d,void 0===w[f]){s=t[d];for(var S=0;S<s.length;S++)if(u=s[S],i(c,S)&&!n(h,u)&&!a(h,u)){l=S,b.splice(x,1),p=y.slice(0,c+1),m=y.slice(c),g=s.slice(l),v=s.slice(0,l+1),y=p.concat(g).concat(v).concat(m),M=c;break}if(l>=0)break;w[f]=!0}if(l>=0)break}}return y}(e,t),v=ma.triangulate(g,!1);for(a=0,s=v.length;a<s;a++)for(c=v[a],l=0;l<3;l++)void 0!==(u=d[h=c[l].x+":"+c[l].y])&&(c[l]=u);return v.concat()},isClockWise:function(e){return ma.area(e)<0}};(Ot.prototype=Object.create(de.prototype)).constructor=Ot,(It.prototype=Object.create(Se.prototype)).constructor=It,It.prototype.getArrays=function(){var e=this.getAttribute("position"),t=e?Array.prototype.slice.call(e.array):[],i=this.getAttribute("uv"),n=i?Array.prototype.slice.call(i.array):[],r=this.index;return{position:t,uv:n,index:r?Array.prototype.slice.call(r.array):[]}},It.prototype.addShapeList=function(e,t){var i=e.length;t.arrays=this.getArrays();for(var n=0;n<i;n++){var r=e[n];this.addShape(r,t)}this.setIndex(t.arrays.index),this.addAttribute("position",new xe(t.arrays.position,3)),this.addAttribute("uv",new xe(t.arrays.uv,2))},It.prototype.addShape=function(e,t){function n(e,t,i){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(i).add(e)}function r(e,t,n){var r,o,a,s=e.x-t.x,l=e.y-t.y,c=n.x-e.x,h=n.y-e.y,u=s*s+l*l,d=s*h-l*c;if(Math.abs(d)>Number.EPSILON){var f=Math.sqrt(u),p=Math.sqrt(c*c+h*h),m=t.x-l/f,g=t.y+s/f,v=((n.x-h/p-m)*h-(n.y+c/p-g)*c)/(s*h-l*c),y=(r=m+s*v-e.x)*r+(o=g+l*v-e.y)*o;if(y<=2)return new i(r,o);a=Math.sqrt(y/2)}else{var b=!1;s>Number.EPSILON?c>Number.EPSILON&&(b=!0):s<-Number.EPSILON?c<-Number.EPSILON&&(b=!0):Math.sign(l)===Math.sign(h)&&(b=!0),b?(r=-l,o=s,a=Math.sqrt(u)):(r=s,o=l,a=Math.sqrt(u/2))}return new i(r/a,o/a)}function a(e,t){var i,n;for(Y=e.length;--Y>=0;){i=Y,(n=Y-1)<0&&(n=e.length-1);var r=0,o=C+2*T;for(r=0;r<o;r++){var a=q*r,s=q*(r+1);!function(e,t,i,n){c(e),c(t),c(n),c(t),c(i),c(n);var r=v.length/3,o=k.generateSideWallUV(I,v,r-6,r-3,r-2,r-1);h(o[0]),h(o[1]),h(o[3]),h(o[1]),h(o[2]),h(o[3])}(t+i+a,t+n+a,t+n+s,t+i+s)}}}function s(e,t,i){w.push(e),w.push(t),w.push(i)}function l(e,t,i){c(e),c(t),c(i);var n=v.length/3,r=k.generateTopUV(I,v,n-3,n-2,n-1);h(r[0]),h(r[1]),h(r[2])}function c(e){y.push(v.length/3),v.push(w[3*e+0]),v.push(w[3*e+1]),v.push(w[3*e+2])}function h(e){b.push(e.x),b.push(e.y)}var u,d,f,p,m,g=t.arrays?t.arrays:this.getArrays(),v=g.position,y=g.index,b=g.uv,w=[],x=void 0!==t.amount?t.amount:100,_=void 0!==t.bevelThickness?t.bevelThickness:6,M=void 0!==t.bevelSize?t.bevelSize:_-2,T=void 0!==t.bevelSegments?t.bevelSegments:3,S=void 0===t.bevelEnabled||t.bevelEnabled,E=void 0!==t.curveSegments?t.curveSegments:12,C=void 0!==t.steps?t.steps:1,P=t.extrudePath,L=!1,k=void 0!==t.UVGenerator?t.UVGenerator:Ot.WorldUVGenerator;P&&(u=P.getSpacedPoints(C),L=!0,S=!1,d=void 0!==t.frames?t.frames:P.computeFrenetFrames(C,!1),f=new o,p=new o,m=new o),S||(T=0,_=0,M=0);var A,R,O,I=this,B=e.extractPoints(E),D=B.shape,U=B.holes;if(!ma.isClockWise(D))for(D=D.reverse(),R=0,O=U.length;R<O;R++)A=U[R],ma.isClockWise(A)&&(U[R]=A.reverse());var z=ma.triangulateShape(D,U),N=D;for(R=0,O=U.length;R<O;R++)A=U[R],D=D.concat(A);for(var j,F,G,H,V,W,q=D.length,X=z.length,K=[],Y=0,Z=N.length,J=Z-1,Q=Y+1;Y<Z;Y++,J++,Q++)J===Z&&(J=0),Q===Z&&(Q=0),K[Y]=r(N[Y],N[J],N[Q]);var $,ee=[],te=K.concat();for(R=0,O=U.length;R<O;R++){for(A=U[R],$=[],Y=0,J=(Z=A.length)-1,Q=Y+1;Y<Z;Y++,J++,Q++)J===Z&&(J=0),Q===Z&&(Q=0),$[Y]=r(A[Y],A[J],A[Q]);ee.push($),te=te.concat($)}for(j=0;j<T;j++){for(G=j/T,H=_*Math.cos(G*Math.PI/2),F=M*Math.sin(G*Math.PI/2),Y=0,Z=N.length;Y<Z;Y++)s((V=n(N[Y],K[Y],F)).x,V.y,-H);for(R=0,O=U.length;R<O;R++)for(A=U[R],$=ee[R],Y=0,Z=A.length;Y<Z;Y++)s((V=n(A[Y],$[Y],F)).x,V.y,-H)}for(F=M,Y=0;Y<q;Y++)V=S?n(D[Y],te[Y],F):D[Y],L?(p.copy(d.normals[0]).multiplyScalar(V.x),f.copy(d.binormals[0]).multiplyScalar(V.y),m.copy(u[0]).add(p).add(f),s(m.x,m.y,m.z)):s(V.x,V.y,0);var ie;for(ie=1;ie<=C;ie++)for(Y=0;Y<q;Y++)V=S?n(D[Y],te[Y],F):D[Y],L?(p.copy(d.normals[ie]).multiplyScalar(V.x),f.copy(d.binormals[ie]).multiplyScalar(V.y),m.copy(u[ie]).add(p).add(f),s(m.x,m.y,m.z)):s(V.x,V.y,x/C*ie);for(j=T-1;j>=0;j--){for(G=j/T,H=_*Math.cos(G*Math.PI/2),F=M*Math.sin(G*Math.PI/2),Y=0,Z=N.length;Y<Z;Y++)s((V=n(N[Y],K[Y],F)).x,V.y,x+H);for(R=0,O=U.length;R<O;R++)for(A=U[R],$=ee[R],Y=0,Z=A.length;Y<Z;Y++)V=n(A[Y],$[Y],F),L?s(V.x,V.y+u[C-1].y,u[C-1].x+H):s(V.x,V.y,x+H)}!function(){var e=v.length/3;if(S){var i=0,n=q*i;for(Y=0;Y<X;Y++)l((W=z[Y])[2]+n,W[1]+n,W[0]+n);for(n=q*(i=C+2*T),Y=0;Y<X;Y++)l((W=z[Y])[0]+n,W[1]+n,W[2]+n)}else{for(Y=0;Y<X;Y++)l((W=z[Y])[2],W[1],W[0]);for(Y=0;Y<X;Y++)l((W=z[Y])[0]+q*C,W[1]+q*C,W[2]+q*C)}I.addGroup(e,v.length/3-e,void 0!==t.material?t.material:0)}(),function(){var e=v.length/3,i=0;for(a(N,i),i+=N.length,R=0,O=U.length;R<O;R++)a(A=U[R],i),i+=A.length;I.addGroup(e,v.length/3-e,void 0!==t.extrudeMaterial?t.extrudeMaterial:1)}(),t.arrays||(this.setIndex(y),this.addAttribute("position",new xe(v,3)),this.addAttribute("uv",new xe(t.arrays.uv,2)))},Ot.WorldUVGenerator={generateTopUV:function(e,t,n,r,o){var a=t[3*n],s=t[3*n+1],l=t[3*r],c=t[3*r+1],h=t[3*o],u=t[3*o+1];return[new i(a,s),new i(l,c),new i(h,u)]},generateSideWallUV:function(e,t,n,r,o,a){var s=t[3*n],l=t[3*n+1],c=t[3*n+2],h=t[3*r],u=t[3*r+1],d=t[3*r+2],f=t[3*o],p=t[3*o+1],m=t[3*o+2],g=t[3*a],v=t[3*a+1],y=t[3*a+2];return Math.abs(l-u)<.01?[new i(s,1-c),new i(h,1-d),new i(f,1-m),new i(g,1-y)]:[new i(l,1-c),new i(u,1-d),new i(p,1-m),new i(v,1-y)]}},(Bt.prototype=Object.create(de.prototype)).constructor=Bt,(Dt.prototype=Object.create(It.prototype)).constructor=Dt,(Ut.prototype=Object.create(de.prototype)).constructor=Ut,(zt.prototype=Object.create(Se.prototype)).constructor=zt,(Nt.prototype=Object.create(de.prototype)).constructor=Nt,(jt.prototype=Object.create(Se.prototype)).constructor=jt,(Ft.prototype=Object.create(de.prototype)).constructor=Ft,(Gt.prototype=Object.create(Se.prototype)).constructor=Gt,(Ht.prototype=Object.create(Ft.prototype)).constructor=Ht,(Vt.prototype=Object.create(Gt.prototype)).constructor=Vt,(Wt.prototype=Object.create(de.prototype)).constructor=Wt,(qt.prototype=Object.create(Se.prototype)).constructor=qt;var ga=Object.freeze({ParametricGeometry:Mt,ParametricBufferGeometry:Tt,TetrahedronGeometry:Ct,TetrahedronBufferGeometry:Pt,OctahedronGeometry:Lt,OctahedronBufferGeometry:kt,IcosahedronGeometry:At,IcosahedronBufferGeometry:Rt,PolyhedronGeometry:St,PolyhedronBufferGeometry:Et,TextGeometry:Bt,TextBufferGeometry:Dt,SphereGeometry:Ut,SphereBufferGeometry:zt,RingGeometry:Nt,RingBufferGeometry:jt,PlaneGeometry:ke,PlaneBufferGeometry:Ae,ExtrudeGeometry:Ot,ExtrudeBufferGeometry:It,ConeGeometry:Ht,ConeBufferGeometry:Vt,CylinderGeometry:Ft,CylinderBufferGeometry:Gt,CircleGeometry:Wt,CircleBufferGeometry:qt,BoxGeometry:Pe,BoxBufferGeometry:Le,ShapeGeometry:Ee,ShapeBufferGeometry:Ce});(Xt.prototype=Object.create(J.prototype)).constructor=Xt,Xt.prototype.isShadowMaterial=!0,(Kt.prototype=Object.create(Oe.prototype)).constructor=Kt,Kt.prototype.isRawShaderMaterial=!0,(Yt.prototype=Object.create(J.prototype)).constructor=Yt,Yt.prototype.isMeshPhongMaterial=!0,Yt.prototype.copy=function(e){return J.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},(Zt.prototype=Object.create(J.prototype)).constructor=Zt,Zt.prototype.isMeshLambertMaterial=!0,Zt.prototype.copy=function(e){return J.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},(Jt.prototype=Object.create(ft.prototype)).constructor=Jt,Jt.prototype.isLineDashedMaterial=!0,Jt.prototype.copy=function(e){return ft.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var va=Object.freeze({ShadowMaterial:Xt,SpriteMaterial:st,MeshPhongMaterial:Yt,MeshLambertMaterial:Zt,MeshBasicMaterial:Re,Material:J}),ya={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},ba=new Qt,wa={};Object.assign($t.prototype,{load:function(e,t,i,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e);var r=this,o=ya.get(e);if(void 0!==o)return r.manager.itemStart(e),setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0),o;if(void 0===wa[e]){var a=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(a){var s=a[1],l=!!a[2],c=a[3];c=window.decodeURIComponent(c),l&&(c=window.atob(c));try{var h,u=(this.responseType||"").toLowerCase();switch(u){case"arraybuffer":case"blob":for(var d=new Uint8Array(c.length),f=0;f<c.length;f++)d[f]=c.charCodeAt(f);h="blob"===u?new Blob([d.buffer],{type:s}):d.buffer;break;case"document":var p=new DOMParser;h=p.parseFromString(c,s);break;case"json":h=JSON.parse(c);break;default:h=c}window.setTimeout(function(){t&&t(h),r.manager.itemEnd(e)},0)}catch(t){window.setTimeout(function(){n&&n(t),r.manager.itemEnd(e),r.manager.itemError(e)},0)}}else{wa[e]=[],wa[e].push({onLoad:t,onProgress:i,onError:n});var m=new XMLHttpRequest;m.open("GET",e,!0),m.addEventListener("load",function(t){var i=t.target.response;ya.add(e,i);var n=wa[e];if(delete wa[e],200===this.status){for(var o=0,a=n.length;o<a;o++){(s=n[o]).onLoad&&s.onLoad(i)}r.manager.itemEnd(e)}else if(0===this.status){console.warn("THREE.FileLoader: HTTP Status 0 received.");for(var o=0,a=n.length;o<a;o++){(s=n[o]).onLoad&&s.onLoad(i)}r.manager.itemEnd(e)}else{for(var o=0,a=n.length;o<a;o++){var s=n[o];s.onError&&s.onError(t)}r.manager.itemEnd(e),r.manager.itemError(e)}},!1),m.addEventListener("progress",function(t){for(var i=wa[e],n=0,r=i.length;n<r;n++){var o=i[n];o.onProgress&&o.onProgress(t)}},!1),m.addEventListener("error",function(t){for(var i=wa[e],n=0,o=i.length;n<o;n++){var a=i[n];a.onError&&a.onError(t)}r.manager.itemEnd(e),r.manager.itemError(e)},!1),void 0!==this.responseType&&(m.responseType=this.responseType),void 0!==this.withCredentials&&(m.withCredentials=this.withCredentials),m.overrideMimeType&&m.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(var g in this.requestHeader)m.setRequestHeader(g,this.requestHeader[g]);m.send(null)}return r.manager.itemStart(e),m}wa[e].push({onLoad:t,onProgress:i,onError:n})},setPath:function(e){return this.path=e,this},setResponseType:function(e){return this.responseType=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setMimeType:function(e){return this.mimeType=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}}),Object.assign(ei.prototype,{load:function(e,t,i,n){function r(r){l.load(e[r],function(e){var i=o._parser(e,!0);a[r]={width:i.width,height:i.height,format:i.format,mipmaps:i.mipmaps},6===(c+=1)&&(1===i.mipmapCount&&(s.minFilter=no),s.format=i.format,s.needsUpdate=!0,t&&t(s))},i,n)}var o=this,a=[],s=new xt;s.image=a;var l=new $t(this.manager);if(l.setPath(this.path),l.setResponseType("arraybuffer"),Array.isArray(e))for(var c=0,h=0,u=e.length;h<u;++h)r(h);else l.load(e,function(e){var i=o._parser(e,!0);if(i.isCubemap)for(var n=i.mipmaps.length/i.mipmapCount,r=0;r<n;r++){a[r]={mipmaps:[]};for(var l=0;l<i.mipmapCount;l++)a[r].mipmaps.push(i.mipmaps[r*i.mipmapCount+l]),a[r].format=i.format,a[r].width=i.width,a[r].height=i.height}else s.image.width=i.width,s.image.height=i.height,s.mipmaps=i.mipmaps;1===i.mipmapCount&&(s.minFilter=no),s.format=i.format,s.needsUpdate=!0,t&&t(s)},i,n);return s},setPath:function(e){return this.path=e,this}}),Object.assign(ti.prototype,{load:function(e,t,i,n){var r=this,o=new d,a=new $t(this.manager);return a.setResponseType("arraybuffer"),a.load(e,function(e){var i=r._parser(e);i&&(void 0!==i.image?o.image=i.image:void 0!==i.data&&(o.image.width=i.width,o.image.height=i.height,o.image.data=i.data),o.wrapS=void 0!==i.wrapS?i.wrapS:Qr,o.wrapT=void 0!==i.wrapT?i.wrapT:Qr,o.magFilter=void 0!==i.magFilter?i.magFilter:no,o.minFilter=void 0!==i.minFilter?i.minFilter:oo,o.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,void 0!==i.format&&(o.format=i.format),void 0!==i.type&&(o.type=i.type),void 0!==i.mipmaps&&(o.mipmaps=i.mipmaps),1===i.mipmapCount&&(o.minFilter=no),o.needsUpdate=!0,t&&t(o,i))},i,n),o}}),Object.assign(ii.prototype,{crossOrigin:"Anonymous",load:function(e,t,i,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e);var r=this,o=ya.get(e);if(void 0!==o)return r.manager.itemStart(e),setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0),o;var a=document.createElement("img");return a.addEventListener("load",function(){ya.add(e,this),t&&t(this),r.manager.itemEnd(e)},!1),a.addEventListener("error",function(t){n&&n(t),r.manager.itemEnd(e),r.manager.itemError(e)},!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(e),a.src=e,a},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(ni.prototype,{crossOrigin:"Anonymous",load:function(e,t,i,n){function r(i){a.load(e[i],function(e){o.images[i]=e,6===++s&&(o.needsUpdate=!0,t&&t(o))},void 0,n)}var o=new f,a=new ii(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);for(var s=0,l=0;l<e.length;++l)r(l);return o},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(ri.prototype,{crossOrigin:"Anonymous",load:function(e,t,i,n){var r=new ii(this.manager);r.setCrossOrigin(this.crossOrigin),r.setPath(this.path);var o=new l;return o.path=e,o.image=r.load(e,function(){var i=e.search(/\.(jpg|jpeg)$/)>0||0===e.search(/^data\:image\/jpeg/);o.format=i?wo:xo,o.needsUpdate=!0,void 0!==t&&t(o)},i,n),o},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),oi.prototype=Object.assign(Object.create(le.prototype),{constructor:oi,isLight:!0,copy:function(e){return le.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){var t=le.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}),ai.prototype=Object.assign(Object.create(oi.prototype),{constructor:ai,isHemisphereLight:!0,copy:function(e){return oi.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),Object.assign(si.prototype,{copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}),li.prototype=Object.assign(Object.create(si.prototype),{constructor:li,isSpotLightShadow:!0,update:function(e){var t=this.camera,i=2*Zo.RAD2DEG*e.angle,n=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;i===t.fov&&n===t.aspect&&r===t.far||(t.fov=i,t.aspect=n,t.far=r,t.updateProjectionMatrix())}}),ci.prototype=Object.assign(Object.create(oi.prototype),{constructor:ci,isSpotLight:!0,copy:function(e){return oi.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),hi.prototype=Object.assign(Object.create(oi.prototype),{constructor:hi,isPointLight:!0,copy:function(e){return oi.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),ui.prototype=Object.assign(Object.create(si.prototype),{constructor:ui}),di.prototype=Object.assign(Object.create(oi.prototype),{constructor:di,isDirectionalLight:!0,copy:function(e){return oi.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),fi.prototype=Object.assign(Object.create(oi.prototype),{constructor:fi,isAmbientLight:!0}),pi.prototype=Object.assign(Object.create(oi.prototype),{constructor:pi,isRectAreaLight:!0,copy:function(e){return oi.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){var t=oi.prototype.toJSON.call(this,e);return t.object.width=this.width,t.object.height=this.height,t}});var xa={arraySlice:function(e,t,i){return xa.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==i?i:e.length)):e.slice(t,i)},convertArray:function(e,t,i){return!e||!i&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){for(var t=e.length,i=new Array(t),n=0;n!==t;++n)i[n]=n;return i.sort(function(t,i){return e[t]-e[i]}),i},sortedArray:function(e,t,i){for(var n=e.length,r=new e.constructor(n),o=0,a=0;a!==n;++o)for(var s=i[o]*t,l=0;l!==t;++l)r[a++]=e[s+l];return r},flattenJSON:function(e,t,i,n){for(var r=1,o=e[0];void 0!==o&&void 0===o[n];)o=e[r++];if(void 0!==o){var a=o[n];if(void 0!==a)if(Array.isArray(a))do{void 0!==(a=o[n])&&(t.push(o.time),i.push.apply(i,a)),o=e[r++]}while(void 0!==o);else if(void 0!==a.toArray)do{void 0!==(a=o[n])&&(t.push(o.time),a.toArray(i,i.length)),o=e[r++]}while(void 0!==o);else do{void 0!==(a=o[n])&&(t.push(o.time),i.push(a)),o=e[r++]}while(void 0!==o)}}};Object.assign(mi.prototype,{evaluate:function(e){var t=this.parameterPositions,i=this._cachedIndex,n=t[i],r=t[i-1];e:{t:{var o;i:{n:if(!(e<n)){for(s=i+2;;){if(void 0===n){if(e<r)break n;return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,e,r)}if(i===s)break;if(r=n,n=t[++i],e<n)break t}o=t.length;break i}if(e>=r)break e;var a=t[1];e<a&&(i=2,r=a);for(var s=i-2;;){if(void 0===r)return this._cachedIndex=0,this.beforeStart_(0,e,n);if(i===s)break;if(n=r,r=t[--i-1],e>=r)break t}o=i,i=0}for(;i<o;){var l=i+o>>>1;e<t[l]?o=l:i=l+1}if(n=t[i],void 0===(r=t[i-1]))return this._cachedIndex=0,this.beforeStart_(0,e,n);if(void 0===n)return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,r,e)}this._cachedIndex=i,this.intervalChanged_(i,r,n)}return this.interpolate_(i,r,e,n)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){for(var t=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=e*n,o=0;o!==n;++o)t[o]=i[r+o];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),//!\ DECLARE ALIAS AFTER assign prototype !
Object.assign(mi.prototype,{beforeStart_:mi.prototype.copySampleValue_,afterEnd_:mi.prototype.copySampleValue_}),gi.prototype=Object.assign(Object.create(mi.prototype),{constructor:gi,DefaultSettings_:{endingStart:Uo,endingEnd:Uo},intervalChanged_:function(e,t,i){var n=this.parameterPositions,r=e-2,o=e+1,a=n[r],s=n[o];if(void 0===a)switch(this.getSettings_().endingStart){case 2401:r=e,a=2*t-i;break;case 2402:a=t+n[r=n.length-2]-n[r+1];break;default:r=e,a=i}if(void 0===s)switch(this.getSettings_().endingEnd){case 2401:o=e,s=2*i-t;break;case 2402:o=1,s=i+n[1]-n[0];break;default:o=e-1,s=t}var l=.5*(i-t),c=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(s-i),this._offsetPrev=r*c,this._offsetNext=o*c},interpolate_:function(e,t,i,n){for(var r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,l=s-a,c=this._offsetPrev,h=this._offsetNext,u=this._weightPrev,d=this._weightNext,f=(i-t)/(n-t),p=f*f,m=p*f,g=-u*m+2*u*p-u*f,v=(1+u)*m+(-1.5-2*u)*p+(-.5+u)*f+1,y=(-1-d)*m+(1.5+d)*p+.5*f,b=d*m-d*p,w=0;w!==a;++w)r[w]=g*o[c+w]+v*o[l+w]+y*o[s+w]+b*o[h+w];return r}}),vi.prototype=Object.assign(Object.create(mi.prototype),{constructor:vi,interpolate_:function(e,t,i,n){for(var r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,l=s-a,c=(i-t)/(n-t),h=1-c,u=0;u!==a;++u)r[u]=o[l+u]*h+o[s+u]*c;return r}}),yi.prototype=Object.assign(Object.create(mi.prototype),{constructor:yi,interpolate_:function(e){return this.copySampleValue_(e-1)}});var _a;_a={TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(e){return new yi(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new vi(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new gi(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){var t;switch(e){case 2300:t=this.InterpolantFactoryMethodDiscrete;break;case 2301:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0!==t)this.createInterpolant=t;else{var i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(i);this.setInterpolation(this.DefaultInterpolation)}console.warn("THREE.KeyframeTrackPrototype:",i)}},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(0!==e)for(var t=this.times,i=0,n=t.length;i!==n;++i)t[i]+=e;return this},scale:function(e){if(1!==e)for(var t=this.times,i=0,n=t.length;i!==n;++i)t[i]*=e;return this},trim:function(e,t){for(var i=this.times,n=i.length,r=0,o=n-1;r!==n&&i[r]<e;)++r;for(;-1!==o&&i[o]>t;)--o;if(++o,0!==r||o!==n){r>=o&&(o=Math.max(o,1),r=o-1);var a=this.getValueSize();this.times=xa.arraySlice(i,r,o),this.values=xa.arraySlice(this.values,r*a,o*a)}return this},validate:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrackPrototype: Invalid value size in track.",this),e=!1);var i=this.times,n=this.values,r=i.length;0===r&&(console.error("THREE.KeyframeTrackPrototype: Track is empty.",this),e=!1);for(var o=null,a=0;a!==r;a++){var s=i[a];if("number"==typeof s&&isNaN(s)){console.error("THREE.KeyframeTrackPrototype: Time is not a valid number.",this,a,s),e=!1;break}if(null!==o&&o>s){console.error("THREE.KeyframeTrackPrototype: Out of order keys.",this,a,s,o),e=!1;break}o=s}if(void 0!==n&&xa.isTypedArray(n))for(var a=0,l=n.length;a!==l;++a){var c=n[a];if(isNaN(c)){console.error("THREE.KeyframeTrackPrototype: Value is not a valid number.",this,a,c),e=!1;break}}return e},optimize:function(){for(var e=this.times,t=this.values,i=this.getValueSize(),n=2302===this.getInterpolation(),r=1,o=e.length-1,a=1;a<o;++a){var s=!1,l=e[a];if(l!==e[a+1]&&(1!==a||l!==l[0]))if(n)s=!0;else for(var c=a*i,h=c-i,u=c+i,d=0;d!==i;++d){var f=t[c+d];if(f!==t[h+d]||f!==t[u+d]){s=!0;break}}if(s){if(a!==r){e[r]=e[a];for(var p=a*i,m=r*i,d=0;d!==i;++d)t[m+d]=t[p+d]}++r}}if(o>0){e[r]=e[o];for(var p=o*i,m=r*i,d=0;d!==i;++d)t[m+d]=t[p+d];++r}return r!==e.length&&(this.times=xa.arraySlice(e,0,r),this.values=xa.arraySlice(t,0,r*i)),this}},wi.prototype=Object.assign(Object.create(_a),{constructor:wi,ValueTypeName:"vector"}),xi.prototype=Object.assign(Object.create(mi.prototype),{constructor:xi,interpolate_:function(e,t,i,n){for(var o=this.resultBuffer,a=this.sampleValues,s=this.valueSize,l=e*s,c=(i-t)/(n-t),h=l+s;l!==h;l+=4)r.slerpFlat(o,0,a,l-s,a,l,c);return o}}),_i.prototype=Object.assign(Object.create(_a),{constructor:_i,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(e){return new xi(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),Mi.prototype=Object.assign(Object.create(_a),{constructor:Mi,ValueTypeName:"number"}),Ti.prototype=Object.assign(Object.create(_a),{constructor:Ti,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Si.prototype=Object.assign(Object.create(_a),{constructor:Si,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Ei.prototype=Object.assign(Object.create(_a),{constructor:Ei,ValueTypeName:"color"}),Ci.prototype=_a,_a.constructor=Ci,Object.assign(Ci,{parse:function(e){if(void 0===e.type)throw new Error("track type undefined, can not parse");var t=Ci._getTrackTypeForValueTypeName(e.type);if(void 0===e.times){var i=[],n=[];xa.flattenJSON(e.keys,i,n,"value"),e.times=i,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)},toJSON:function(e){var t,i=e.constructor;if(void 0!==i.toJSON)t=i.toJSON(e);else{t={name:e.name,times:xa.convertArray(e.times,Array),values:xa.convertArray(e.values,Array)};var n=e.getInterpolation();n!==e.DefaultInterpolation&&(t.interpolation=n)}return t.type=e.ValueTypeName,t},_getTrackTypeForValueTypeName:function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Mi;case"vector":case"vector2":case"vector3":case"vector4":return wi;case"color":return Ei;case"quaternion":return _i;case"bool":case"boolean":return Si;case"string":return Ti}throw new Error("Unsupported typeName: "+e)}}),Object.assign(Pi,{parse:function(e){for(var t=[],i=e.tracks,n=1/(e.fps||1),r=0,o=i.length;r!==o;++r)t.push(Ci.parse(i[r]).scale(n));return new Pi(e.name,e.duration,t)},toJSON:function(e){for(var t=[],i=e.tracks,n={name:e.name,duration:e.duration,tracks:t},r=0,o=i.length;r!==o;++r)t.push(Ci.toJSON(i[r]));return n},CreateFromMorphTargetSequence:function(e,t,i,n){for(var r=t.length,o=[],a=0;a<r;a++){var s=[],l=[];s.push((a+r-1)%r,a,(a+1)%r),l.push(0,1,0);var c=xa.getKeyframeOrder(s);s=xa.sortedArray(s,1,c),l=xa.sortedArray(l,1,c),n||0!==s[0]||(s.push(r),l.push(l[0])),o.push(new Mi(".morphTargetInfluences["+t[a].name+"]",s,l).scale(1/i))}return new Pi(e,-1,o)},findByName:function(e,t){var i=e;if(!Array.isArray(e)){var n=e;i=n.geometry&&n.geometry.animations||n.animations}for(var r=0;r<i.length;r++)if(i[r].name===t)return i[r];return null},CreateClipsFromMorphTargetSequences:function(e,t,i){for(var n={},r=/^([\w-]*?)([\d]+)$/,o=0,a=e.length;o<a;o++){var s=e[o],l=s.name.match(r);if(l&&l.length>1){var c=n[u=l[1]];c||(n[u]=c=[]),c.push(s)}}var h=[];for(var u in n)h.push(Pi.CreateFromMorphTargetSequence(u,n[u],t,i));return h},parseAnimation:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var i=function(e,t,i,n,r){if(0!==i.length){var o=[],a=[];xa.flattenJSON(i,o,a,n),0!==o.length&&r.push(new e(t,o,a))}},n=[],r=e.name||"default",o=e.length||-1,a=e.fps||30,s=e.hierarchy||[],l=0;l<s.length;l++){var c=s[l].keys;if(c&&0!==c.length)if(c[0].morphTargets){for(var h={},u=0;u<c.length;u++)if(c[u].morphTargets)for(m=0;m<c[u].morphTargets.length;m++)h[c[u].morphTargets[m]]=-1;for(var d in h){for(var f=[],p=[],m=0;m!==c[u].morphTargets.length;++m){var g=c[u];f.push(g.time),p.push(g.morphTarget===d?1:0)}n.push(new Mi(".morphTargetInfluence["+d+"]",f,p))}o=h.length*(a||1)}else{var v=".bones["+t[l].name+"]";i(wi,v+".position",c,"pos",n),i(_i,v+".quaternion",c,"rot",n),i(wi,v+".scale",c,"scl",n)}}if(0===n.length)return null;return new Pi(r,o,n)}}),Object.assign(Pi.prototype,{resetDuration:function(){for(var e=0,t=0,i=this.tracks.length;t!==i;++t){var n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}this.duration=e},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}}),Object.assign(Li.prototype,{load:function(e,t,i,n){var r=this;new $t(r.manager).load(e,function(e){t(r.parse(JSON.parse(e)))},i,n)},setTextures:function(e){this.textures=e},parse:function(e){function t(e){return void 0===n[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),n[e]}var n=this.textures,r=new va[e.type];if(void 0!==e.uuid&&(r.uuid=e.uuid),void 0!==e.name&&(r.name=e.name),void 0!==e.color&&r.color.setHex(e.color),void 0!==e.roughness&&(r.roughness=e.roughness),void 0!==e.metalness&&(r.metalness=e.metalness),void 0!==e.emissive&&r.emissive.setHex(e.emissive),void 0!==e.specular&&r.specular.setHex(e.specular),void 0!==e.shininess&&(r.shininess=e.shininess),void 0!==e.clearCoat&&(r.clearCoat=e.clearCoat),void 0!==e.clearCoatRoughness&&(r.clearCoatRoughness=e.clearCoatRoughness),void 0!==e.uniforms&&(r.uniforms=e.uniforms),void 0!==e.vertexShader&&(r.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(r.fragmentShader=e.fragmentShader),void 0!==e.vertexColors&&(r.vertexColors=e.vertexColors),void 0!==e.fog&&(r.fog=e.fog),void 0!==e.flatShading&&(r.flatShading=e.flatShading),void 0!==e.blending&&(r.blending=e.blending),void 0!==e.side&&(r.side=e.side),void 0!==e.opacity&&(r.opacity=e.opacity),void 0!==e.transparent&&(r.transparent=e.transparent),void 0!==e.alphaTest&&(r.alphaTest=e.alphaTest),void 0!==e.depthTest&&(r.depthTest=e.depthTest),void 0!==e.depthWrite&&(r.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(r.colorWrite=e.colorWrite),void 0!==e.wireframe&&(r.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(r.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(r.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(r.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(r.rotation=e.rotation),1!==e.linewidth&&(r.linewidth=e.linewidth),void 0!==e.dashSize&&(r.dashSize=e.dashSize),void 0!==e.gapSize&&(r.gapSize=e.gapSize),void 0!==e.scale&&(r.scale=e.scale),void 0!==e.skinning&&(r.skinning=e.skinning),void 0!==e.morphTargets&&(r.morphTargets=e.morphTargets),void 0!==e.dithering&&(r.dithering=e.dithering),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.shading&&(r.flatShading=1===e.shading),void 0!==e.size&&(r.size=e.size),void 0!==e.sizeAttenuation&&(r.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(r.map=t(e.map)),void 0!==e.alphaMap&&(r.alphaMap=t(e.alphaMap),r.transparent=!0),void 0!==e.bumpMap&&(r.bumpMap=t(e.bumpMap)),void 0!==e.bumpScale&&(r.bumpScale=e.bumpScale),void 0!==e.normalMap&&(r.normalMap=t(e.normalMap)),void 0!==e.normalScale){var o=e.normalScale;!1===Array.isArray(o)&&(o=[o,o]),r.normalScale=(new i).fromArray(o)}return void 0!==e.displacementMap&&(r.displacementMap=t(e.displacementMap)),void 0!==e.displacementScale&&(r.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(r.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(r.roughnessMap=t(e.roughnessMap)),void 0!==e.metalnessMap&&(r.metalnessMap=t(e.metalnessMap)),void 0!==e.emissiveMap&&(r.emissiveMap=t(e.emissiveMap)),void 0!==e.emissiveIntensity&&(r.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(r.specularMap=t(e.specularMap)),void 0!==e.envMap&&(r.envMap=t(e.envMap)),void 0!==e.reflectivity&&(r.reflectivity=e.reflectivity),void 0!==e.lightMap&&(r.lightMap=t(e.lightMap)),void 0!==e.lightMapIntensity&&(r.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(r.aoMap=t(e.aoMap)),void 0!==e.aoMapIntensity&&(r.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(r.gradientMap=t(e.gradientMap)),r}}),Object.assign(ki.prototype,{load:function(e,t,i,n){var r=this;new $t(r.manager).load(e,function(e){t(r.parse(JSON.parse(e)))},i,n)},parse:function(e){var t=new Se,i=e.data.index;if(void 0!==i){s=new Ma[i.type](i.array);t.setIndex(new fe(s,1))}var n=e.data.attributes;for(var r in n){var a=n[r],s=new Ma[a.type](a.array);t.addAttribute(r,new fe(s,a.itemSize,a.normalized))}var l=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==l)for(var c=0,h=l.length;c!==h;++c){var u=l[c];t.addGroup(u.start,u.count,u.materialIndex)}var d=e.data.boundingSphere;if(void 0!==d){var f=new o;void 0!==d.center&&f.fromArray(d.center),t.boundingSphere=new te(f,d.radius)}return t}});var Ma={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};Ai.Handlers={handlers:[],add:function(e,t){this.handlers.push(e,t)},get:function(e){for(var t=this.handlers,i=0,n=t.length;i<n;i+=2){var r=t[i],o=t[i+1];if(r.test(e))return o}return null}},Object.assign(Ai.prototype,{crossOrigin:void 0,extractUrlBase:function(e){var t=e.split("/");return 1===t.length?"./":(t.pop(),t.join("/")+"/")},initMaterials:function(e,t,i){for(var n=[],r=0;r<e.length;++r)n[r]=this.createMaterial(e[r],t,i);return n},createMaterial:function(){var e={NoBlending:ar,NormalBlending:sr,AdditiveBlending:lr,SubtractiveBlending:cr,MultiplyBlending:hr,CustomBlending:ur},t=new q,i=new ri,n=new Li;return function(r,o,a){function s(e,t,n,r,s){var c,h=o+e,u=Ai.Handlers.get(h);null!==u?c=u.load(h):(i.setCrossOrigin(a),c=i.load(h)),void 0!==t&&(c.repeat.fromArray(t),1!==t[0]&&(c.wrapS=Jr),1!==t[1]&&(c.wrapT=Jr)),void 0!==n&&c.offset.fromArray(n),void 0!==r&&("repeat"===r[0]&&(c.wrapS=Jr),"mirror"===r[0]&&(c.wrapS=$r),"repeat"===r[1]&&(c.wrapT=Jr),"mirror"===r[1]&&(c.wrapT=$r)),void 0!==s&&(c.anisotropy=s);var d=Zo.generateUUID();return l[d]=c,d}var l={},c={uuid:Zo.generateUUID(),type:"MeshLambertMaterial"};for(var h in r){var u=r[h];switch(h){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":c.name=u;break;case"blending":c.blending=e[u];break;case"colorAmbient":case"mapAmbient":console.warn("THREE.Loader.createMaterial:",h,"is no longer supported.");break;case"colorDiffuse":c.color=t.fromArray(u).getHex();break;case"colorSpecular":c.specular=t.fromArray(u).getHex();break;case"colorEmissive":c.emissive=t.fromArray(u).getHex();break;case"specularCoef":c.shininess=u;break;case"shading":"basic"===u.toLowerCase()&&(c.type="MeshBasicMaterial"),"phong"===u.toLowerCase()&&(c.type="MeshPhongMaterial"),"standard"===u.toLowerCase()&&(c.type="MeshStandardMaterial");break;case"mapDiffuse":c.map=s(u,r.mapDiffuseRepeat,r.mapDiffuseOffset,r.mapDiffuseWrap,r.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":c.emissiveMap=s(u,r.mapEmissiveRepeat,r.mapEmissiveOffset,r.mapEmissiveWrap,r.mapEmissiveAnisotropy);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":c.lightMap=s(u,r.mapLightRepeat,r.mapLightOffset,r.mapLightWrap,r.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":c.aoMap=s(u,r.mapAORepeat,r.mapAOOffset,r.mapAOWrap,r.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":c.bumpMap=s(u,r.mapBumpRepeat,r.mapBumpOffset,r.mapBumpWrap,r.mapBumpAnisotropy);break;case"mapBumpScale":c.bumpScale=u;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":c.normalMap=s(u,r.mapNormalRepeat,r.mapNormalOffset,r.mapNormalWrap,r.mapNormalAnisotropy);break;case"mapNormalFactor":c.normalScale=[u,u];break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":c.specularMap=s(u,r.mapSpecularRepeat,r.mapSpecularOffset,r.mapSpecularWrap,r.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":c.metalnessMap=s(u,r.mapMetalnessRepeat,r.mapMetalnessOffset,r.mapMetalnessWrap,r.mapMetalnessAnisotropy);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":c.roughnessMap=s(u,r.mapRoughnessRepeat,r.mapRoughnessOffset,r.mapRoughnessWrap,r.mapRoughnessAnisotropy);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":c.alphaMap=s(u,r.mapAlphaRepeat,r.mapAlphaOffset,r.mapAlphaWrap,r.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":c.side=tr;break;case"doubleSided":c.side=ir;break;case"transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity"),c.opacity=u;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":c[h]=u;break;case"vertexColors":!0===u&&(c.vertexColors=or),"face"===u&&(c.vertexColors=rr);break;default:console.error("THREE.Loader.createMaterial: Unsupported",h,u)}}return"MeshBasicMaterial"===c.type&&delete c.emissive,"MeshPhongMaterial"!==c.type&&delete c.specular,c.opacity<1&&(c.transparent=!0),n.setTextures(l),n.parse(c)}}()}),Object.assign(Ri.prototype,{load:function(e,t,i,n){var r=this,o=this.texturePath&&"string"==typeof this.texturePath?this.texturePath:Ai.prototype.extractUrlBase(e),a=new $t(this.manager);a.setWithCredentials(this.withCredentials),a.load(e,function(i){var n=JSON.parse(i),a=n.metadata;if(void 0!==a){var s=a.type;if(void 0!==s){if("object"===s.toLowerCase())return void console.error("THREE.JSONLoader: "+e+" should be loaded with THREE.ObjectLoader instead.");if("scene"===s.toLowerCase())return void console.error("THREE.JSONLoader: "+e+" should be loaded with THREE.SceneLoader instead.")}}var l=r.parse(n,o);t(l.geometry,l.materials)},i,n)},setTexturePath:function(e){this.texturePath=e},parse:function(){return function(e,t){void 0!==e.data&&(e=e.data),void 0!==e.scale?e.scale=1/e.scale:e.scale=1;var n=new de;if(function(e,t){function n(e,t){return e&1<<t}var r,a,s,l,c,h,u,d,f,p,m,g,v,y,b,w,x,_,M,T,S,E,C,P,L,k=e.faces,A=e.vertices,R=e.normals,O=e.colors,I=e.scale,B=0;if(void 0!==e.uvs){for(r=0;r<e.uvs.length;r++)e.uvs[r].length&&B++;for(r=0;r<B;r++)t.faceVertexUvs[r]=[]}for(l=0,c=A.length;l<c;)(_=new o).x=A[l++]*I,_.y=A[l++]*I,_.z=A[l++]*I,t.vertices.push(_);for(l=0,c=k.length;l<c;)if(p=k[l++],m=n(p,0),g=n(p,1),v=n(p,3),y=n(p,4),b=n(p,5),w=n(p,6),x=n(p,7),m){if(T=new ue,T.a=k[l],T.b=k[l+1],T.c=k[l+3],S=new ue,S.a=k[l+1],S.b=k[l+2],S.c=k[l+3],l+=4,g&&(f=k[l++],T.materialIndex=f,S.materialIndex=f),s=t.faces.length,v)for(r=0;r<B;r++)for(P=e.uvs[r],t.faceVertexUvs[r][s]=[],t.faceVertexUvs[r][s+1]=[],a=0;a<4;a++)L=new i(P[2*(d=k[l++])],P[2*d+1]),2!==a&&t.faceVertexUvs[r][s].push(L),0!==a&&t.faceVertexUvs[r][s+1].push(L);if(y&&(u=3*k[l++],T.normal.set(R[u++],R[u++],R[u]),S.normal.copy(T.normal)),b)for(r=0;r<4;r++)u=3*k[l++],C=new o(R[u++],R[u++],R[u]),2!==r&&T.vertexNormals.push(C),0!==r&&S.vertexNormals.push(C);if(w&&(E=O[h=k[l++]],T.color.setHex(E),S.color.setHex(E)),x)for(r=0;r<4;r++)E=O[h=k[l++]],2!==r&&T.vertexColors.push(new q(E)),0!==r&&S.vertexColors.push(new q(E));t.faces.push(T),t.faces.push(S)}else{if(M=new ue,M.a=k[l++],M.b=k[l++],M.c=k[l++],g&&(f=k[l++],M.materialIndex=f),s=t.faces.length,v)for(r=0;r<B;r++)for(P=e.uvs[r],t.faceVertexUvs[r][s]=[],a=0;a<3;a++)L=new i(P[2*(d=k[l++])],P[2*d+1]),t.faceVertexUvs[r][s].push(L);if(y&&(u=3*k[l++],M.normal.set(R[u++],R[u++],R[u])),b)for(r=0;r<3;r++)u=3*k[l++],C=new o(R[u++],R[u++],R[u]),M.vertexNormals.push(C);if(w&&(h=k[l++],M.color.setHex(O[h])),x)for(r=0;r<3;r++)h=k[l++],M.vertexColors.push(new q(O[h]));t.faces.push(M)}}(e,n),function(e,t){var i=void 0!==e.influencesPerVertex?e.influencesPerVertex:2;if(e.skinWeights)for(var n=0,r=e.skinWeights.length;n<r;n+=i){var o=e.skinWeights[n],a=i>1?e.skinWeights[n+1]:0,s=i>2?e.skinWeights[n+2]:0,l=i>3?e.skinWeights[n+3]:0;t.skinWeights.push(new c(o,a,s,l))}if(e.skinIndices)for(var n=0,r=e.skinIndices.length;n<r;n+=i){var h=e.skinIndices[n],u=i>1?e.skinIndices[n+1]:0,d=i>2?e.skinIndices[n+2]:0,f=i>3?e.skinIndices[n+3]:0;t.skinIndices.push(new c(h,u,d,f))}t.bones=e.bones,t.bones&&t.bones.length>0&&(t.skinWeights.length!==t.skinIndices.length||t.skinIndices.length!==t.vertices.length)&&console.warn("When skinning, number of vertices ("+t.vertices.length+"), skinIndices ("+t.skinIndices.length+"), and skinWeights ("+t.skinWeights.length+") should match.")}(e,n),function(e,t){var i=e.scale;if(void 0!==e.morphTargets)for(var n=0,r=e.morphTargets.length;n<r;n++){t.morphTargets[n]={},t.morphTargets[n].name=e.morphTargets[n].name,t.morphTargets[n].vertices=[];for(var a=t.morphTargets[n].vertices,s=e.morphTargets[n].vertices,l=0,c=s.length;l<c;l+=3){var h=new o;h.x=s[l]*i,h.y=s[l+1]*i,h.z=s[l+2]*i,a.push(h)}}if(void 0!==e.morphColors&&e.morphColors.length>0){console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.');for(var u=t.faces,d=e.morphColors[0].colors,n=0,r=u.length;n<r;n++)u[n].color.fromArray(d,3*n)}}(e,n),function(e,t){var i=[],n=[];void 0!==e.animation&&n.push(e.animation),void 0!==e.animations&&(e.animations.length?n=n.concat(e.animations):n.push(e.animations));for(var r=0;r<n.length;r++){var o=Pi.parseAnimation(n[r],t.bones);o&&i.push(o)}if(t.morphTargets){var a=Pi.CreateClipsFromMorphTargetSequences(t.morphTargets,10);i=i.concat(a)}i.length>0&&(t.animations=i)}(e,n),n.computeFaceNormals(),n.computeBoundingSphere(),void 0===e.materials||0===e.materials.length)return{geometry:n};return{geometry:n,materials:Ai.prototype.initMaterials(e.materials,t,this.crossOrigin)}}}()}),Object.assign(Oi.prototype,{load:function(e,t,i,n){""===this.texturePath&&(this.texturePath=e.substring(0,e.lastIndexOf("/")+1));var r=this;new $t(r.manager).load(e,function(i){var o=null;try{o=JSON.parse(i)}catch(t){return void 0!==n&&n(t),void console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message)}var a=o.metadata;void 0!==a&&void 0!==a.type&&"geometry"!==a.type.toLowerCase()?r.parse(o,t):console.error("THREE.ObjectLoader: Can't load "+e+". Use THREE.JSONLoader instead.")},i,n)},setTexturePath:function(e){this.texturePath=e},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e,t){var i=this.parseGeometries(e.geometries),n=this.parseImages(e.images,function(){void 0!==t&&t(a)}),r=this.parseTextures(e.textures,n),o=this.parseMaterials(e.materials,r),a=this.parseObject(e.object,i,o);return e.animations&&(a.animations=this.parseAnimations(e.animations)),void 0!==e.images&&0!==e.images.length||void 0!==t&&t(a),a},parseGeometries:function(e){var t={};if(void 0!==e)for(var i=new Ri,n=new ki,r=0,o=e.length;r<o;r++){var a,s=e[r];switch(s.type){case"PlaneGeometry":case"PlaneBufferGeometry":a=new ga[s.type](s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":a=new ga[s.type](s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":a=new ga[s.type](s.radius,s.segments,s.thetaStart,s.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":a=new ga[s.type](s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":a=new ga[s.type](s.radius,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":a=new ga[s.type](s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":a=new ga[s.type](s.radius,s.detail);break;case"RingGeometry":case"RingBufferGeometry":a=new ga[s.type](s.innerRadius,s.outerRadius,s.thetaSegments,s.phiSegments,s.thetaStart,s.thetaLength);break;case"BufferGeometry":a=n.parse(s);break;case"Geometry":a=i.parse(s,this.texturePath).geometry;break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+s.type+'"');continue}a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),t[s.uuid]=a}return t},parseMaterials:function(e,t){var i={};if(void 0!==e){var n=new Li;n.setTextures(t);for(var r=0,o=e.length;r<o;r++){var a=e[r];if("MultiMaterial"===a.type){for(var s=[],l=0;l<a.materials.length;l++)s.push(n.parse(a.materials[l]));i[a.uuid]=s}else i[a.uuid]=n.parse(a)}}return i},parseAnimations:function(e){for(var t=[],i=0;i<e.length;i++){var n=Pi.parse(e[i]);t.push(n)}return t},parseImages:function(e,t){function i(e){return n.manager.itemStart(e),o.load(e,function(){n.manager.itemEnd(e)},void 0,function(){n.manager.itemEnd(e),n.manager.itemError(e)})}var n=this,r={};if(void 0!==e&&e.length>0){var o=new ii(new Qt(t));o.setCrossOrigin(this.crossOrigin);for(var a=0,s=e.length;a<s;a++){var l=e[a],c=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(l.url)?l.url:n.texturePath+l.url;r[l.uuid]=i(c)}}return r},parseTextures:function(e,t){function i(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}var n={};if(void 0!==e)for(var r=0,o=e.length;r<o;r++){var a=e[r];void 0===a.image&&console.warn('THREE.ObjectLoader: No "image" specified for',a.uuid),void 0===t[a.image]&&console.warn("THREE.ObjectLoader: Undefined image",a.image);var s=new l(t[a.image]);s.needsUpdate=!0,s.uuid=a.uuid,void 0!==a.name&&(s.name=a.name),void 0!==a.mapping&&(s.mapping=i(a.mapping,Ta)),void 0!==a.offset&&s.offset.fromArray(a.offset),void 0!==a.repeat&&s.repeat.fromArray(a.repeat),void 0!==a.center&&s.center.fromArray(a.center),void 0!==a.rotation&&(s.rotation=a.rotation),void 0!==a.wrap&&(s.wrapS=i(a.wrap[0],Sa),s.wrapT=i(a.wrap[1],Sa)),void 0!==a.minFilter&&(s.minFilter=i(a.minFilter,Ea)),void 0!==a.magFilter&&(s.magFilter=i(a.magFilter,Ea)),void 0!==a.anisotropy&&(s.anisotropy=a.anisotropy),void 0!==a.flipY&&(s.flipY=a.flipY),n[a.uuid]=s}return n},parseObject:function(){var e=new n;return function(t,i,n){function r(e){return void 0===i[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),i[e]}function o(e){if(void 0!==e){if(Array.isArray(e)){for(var t=[],i=0,r=e.length;i<r;i++){var o=e[i];void 0===n[o]&&console.warn("THREE.ObjectLoader: Undefined material",o),t.push(n[o])}return t}return void 0===n[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),n[e]}}var a;switch(t.type){case"Scene":a=new ot,void 0!==t.background&&Number.isInteger(t.background)&&(a.background=new q(t.background)),void 0!==t.fog&&("Fog"===t.fog.type?a.fog=new rt(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(a.fog=new nt(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":a=new $e(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(a.focus=t.focus),void 0!==t.zoom&&(a.zoom=t.zoom),void 0!==t.filmGauge&&(a.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(a.filmOffset=t.filmOffset),void 0!==t.view&&(a.view=Object.assign({},t.view));break;case"OrthographicCamera":a=new he(t.left,t.right,t.top,t.bottom,t.near,t.far);break;case"AmbientLight":a=new fi(t.color,t.intensity);break;case"DirectionalLight":a=new di(t.color,t.intensity);break;case"PointLight":a=new hi(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":a=new pi(t.color,t.intensity,t.width,t.height);break;case"SpotLight":a=new ci(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":a=new ai(t.color,t.groundColor,t.intensity);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var s=r(t.geometry),l=o(t.material);a=s.bones&&s.bones.length>0?new dt(s,l):new Ue(s,l);break;case"LOD":a=new ct;break;case"Line":a=new pt(r(t.geometry),o(t.material),t.mode);break;case"LineLoop":a=new gt(r(t.geometry),o(t.material));break;case"LineSegments":a=new mt(r(t.geometry),o(t.material));break;case"PointCloud":case"Points":a=new yt(r(t.geometry),o(t.material));break;case"Sprite":a=new lt(o(t.material));break;case"Group":a=new bt;break;default:a=new le}if(a.uuid=t.uuid,void 0!==t.name&&(a.name=t.name),void 0!==t.matrix?(e.fromArray(t.matrix),e.decompose(a.position,a.quaternion,a.scale)):(void 0!==t.position&&a.position.fromArray(t.position),void 0!==t.rotation&&a.rotation.fromArray(t.rotation),void 0!==t.quaternion&&a.quaternion.fromArray(t.quaternion),void 0!==t.scale&&a.scale.fromArray(t.scale)),void 0!==t.castShadow&&(a.castShadow=t.castShadow),void 0!==t.receiveShadow&&(a.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(a.shadow.bias=t.shadow.bias),void 0!==t.shadow.radius&&(a.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&a.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(a.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(a.visible=t.visible),void 0!==t.userData&&(a.userData=t.userData),void 0!==t.children)for(var c=t.children,h=0;h<c.length;h++)a.add(this.parseObject(c[h],i,n));if("LOD"===t.type)for(var u=t.levels,d=0;d<u.length;d++){var f=u[d],p=a.getObjectByProperty("uuid",f.object);void 0!==p&&a.addLevel(p,f.distance)}return a}}()});var Ta={UVMapping:300,CubeReflectionMapping:Vr,CubeRefractionMapping:Wr,EquirectangularReflectionMapping:qr,EquirectangularRefractionMapping:Xr,SphericalReflectionMapping:Kr,CubeUVReflectionMapping:Yr,CubeUVRefractionMapping:Zr},Sa={RepeatWrapping:Jr,ClampToEdgeWrapping:Qr,MirroredRepeatWrapping:$r},Ea={NearestFilter:eo,NearestMipMapNearestFilter:to,NearestMipMapLinearFilter:io,LinearFilter:no,LinearMipMapNearestFilter:ro,LinearMipMapLinearFilter:oo};Object.assign(Ui.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(e,t){var i=this.getUtoTmapping(e);return this.getPoint(i,t)},getPoints:function(e){void 0===e&&(e=5);for(var t=[],i=0;i<=e;i++)t.push(this.getPoint(i/e));return t},getSpacedPoints:function(e){void 0===e&&(e=5);for(var t=[],i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(void 0===e&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,i,n=[],r=this.getPoint(0),o=0;for(n.push(0),i=1;i<=e;i++)o+=(t=this.getPoint(i/e)).distanceTo(r),n.push(o),r=t;return this.cacheArcLengths=n,n},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){var i,n=this.getLengths(),r=0,o=n.length;i=t||e*n[o-1];for(var a,s=0,l=o-1;s<=l;)if(r=Math.floor(s+(l-s)/2),(a=n[r]-i)<0)s=r+1;else{if(!(a>0)){l=r;break}l=r-1}if(r=l,n[r]===i)return r/(o-1);var c=n[r];return(r+(i-c)/(n[r+1]-c))/(o-1)},getTangent:function(e){var t=e-1e-4,i=e+1e-4;t<0&&(t=0),i>1&&(i=1);var n=this.getPoint(t);return this.getPoint(i).clone().sub(n).normalize()},getTangentAt:function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},computeFrenetFrames:function(e,t){var i,r,a,s=new o,l=[],c=[],h=[],u=new o,d=new n;for(i=0;i<=e;i++)r=i/e,l[i]=this.getTangentAt(r),l[i].normalize();c[0]=new o,h[0]=new o;var f=Number.MAX_VALUE,p=Math.abs(l[0].x),m=Math.abs(l[0].y),g=Math.abs(l[0].z);for(p<=f&&(f=p,s.set(1,0,0)),m<=f&&(f=m,s.set(0,1,0)),g<=f&&s.set(0,0,1),u.crossVectors(l[0],s).normalize(),c[0].crossVectors(l[0],u),h[0].crossVectors(l[0],c[0]),i=1;i<=e;i++)c[i]=c[i-1].clone(),h[i]=h[i-1].clone(),u.crossVectors(l[i-1],l[i]),u.length()>Number.EPSILON&&(u.normalize(),a=Math.acos(Zo.clamp(l[i-1].dot(l[i]),-1,1)),c[i].applyMatrix4(d.makeRotationAxis(u,a))),h[i].crossVectors(l[i],c[i]);if(!0===t)for(a=Math.acos(Zo.clamp(c[0].dot(c[e]),-1,1)),a/=e,l[0].dot(u.crossVectors(c[0],c[e]))>0&&(a=-a),i=1;i<=e;i++)c[i].applyMatrix4(d.makeRotationAxis(l[i],a*i)),h[i].crossVectors(l[i],c[i]);return{tangents:l,normals:c,binormals:h}}}),(zi.prototype=Object.create(Ui.prototype)).constructor=zi,zi.prototype.isLineCurve=!0,zi.prototype.getPoint=function(e,t){var n=t||new i;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n},zi.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},zi.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},Ni.prototype=Object.assign(Object.create(Ui.prototype),{constructor:Ni,add:function(e){this.curves.push(e)},closePath:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new zi(t,e))},getPoint:function(e){for(var t=e*this.getLength(),i=this.getCurveLengths(),n=0;n<i.length;){if(i[n]>=t){var r=i[n]-t,o=this.curves[n],a=o.getLength(),s=0===a?0:1-r/a;return o.getPointAt(s)}n++}return null},getLength:function(){var e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,i=0,n=this.curves.length;i<n;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e},getSpacedPoints:function(e){void 0===e&&(e=40);for(var t=[],i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e){e=e||12;for(var t,i=[],n=0,r=this.curves;n<r.length;n++)for(var o=r[n],a=o&&o.isEllipseCurve?2*e:o&&o.isLineCurve?1:o&&o.isSplineCurve?e*o.points.length:e,s=o.getPoints(a),l=0;l<s.length;l++){var c=s[l];t&&t.equals(c)||(i.push(c),t=c)}return this.autoClose&&i.length>1&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i}}),(ji.prototype=Object.create(Ui.prototype)).constructor=ji,ji.prototype.isEllipseCurve=!0,ji.prototype.getPoint=function(e,t){for(var n=t||new i,r=2*Math.PI,o=this.aEndAngle-this.aStartAngle,a=Math.abs(o)<Number.EPSILON;o<0;)o+=r;for(;o>r;)o-=r;o<Number.EPSILON&&(o=a?0:r),!0!==this.aClockwise||a||(o===r?o=-r:o-=r);var s=this.aStartAngle+e*o,l=this.aX+this.xRadius*Math.cos(s),c=this.aY+this.yRadius*Math.sin(s);if(0!==this.aRotation){var h=Math.cos(this.aRotation),u=Math.sin(this.aRotation),d=l-this.aX,f=c-this.aY;l=d*h-f*u+this.aX,c=d*u+f*h+this.aY}return n.set(l,c)},(Fi.prototype=Object.create(Ui.prototype)).constructor=Fi,Fi.prototype.isSplineCurve=!0,Fi.prototype.getPoint=function(e,t){var n=t||new i,r=this.points,o=(r.length-1)*e,a=Math.floor(o),s=o-a,l=r[0===a?a:a-1],c=r[a],h=r[a>r.length-2?r.length-1:a+1],u=r[a>r.length-3?r.length-1:a+2];return n.set(Ii(s,l.x,c.x,h.x,u.x),Ii(s,l.y,c.y,h.y,u.y)),n},(Gi.prototype=Object.create(Ui.prototype)).constructor=Gi,Gi.prototype.isCubicBezierCurve=!0,Gi.prototype.getPoint=function(e,t){var n=t||new i,r=this.v0,o=this.v1,a=this.v2,s=this.v3;return n.set(Di(e,r.x,o.x,a.x,s.x),Di(e,r.y,o.y,a.y,s.y)),n},(Hi.prototype=Object.create(Ui.prototype)).constructor=Hi,Hi.prototype.isQuadraticBezierCurve=!0,Hi.prototype.getPoint=function(e,t){var n=t||new i,r=this.v0,o=this.v1,a=this.v2;return n.set(Bi(e,r.x,o.x,a.x),Bi(e,r.y,o.y,a.y)),n};var Ca=Object.assign(Object.create(Ni.prototype),{fromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y)},moveTo:function(e,t){this.currentPoint.set(e,t)},lineTo:function(e,t){var n=new zi(this.currentPoint.clone(),new i(e,t));this.curves.push(n),this.currentPoint.set(e,t)},quadraticCurveTo:function(e,t,n,r){var o=new Hi(this.currentPoint.clone(),new i(e,t),new i(n,r));this.curves.push(o),this.currentPoint.set(n,r)},bezierCurveTo:function(e,t,n,r,o,a){var s=new Gi(this.currentPoint.clone(),new i(e,t),new i(n,r),new i(o,a));this.curves.push(s),this.currentPoint.set(o,a)},splineThru:function(e){var t=new Fi([this.currentPoint.clone()].concat(e));this.curves.push(t),this.currentPoint.copy(e[e.length-1])},arc:function(e,t,i,n,r,o){var a=this.currentPoint.x,s=this.currentPoint.y;this.absarc(e+a,t+s,i,n,r,o)},absarc:function(e,t,i,n,r,o){this.absellipse(e,t,i,i,n,r,o)},ellipse:function(e,t,i,n,r,o,a,s){var l=this.currentPoint.x,c=this.currentPoint.y;this.absellipse(e+l,t+c,i,n,r,o,a,s)},absellipse:function(e,t,i,n,r,o,a,s){var l=new ji(e,t,i,n,r,o,a,s);if(this.curves.length>0){var c=l.getPoint(0);c.equals(this.currentPoint)||this.lineTo(c.x,c.y)}this.curves.push(l);var h=l.getPoint(1);this.currentPoint.copy(h)}});Vi.prototype=Ca,Ca.constructor=Vi,Wi.prototype=Object.assign(Object.create(Ca),{constructor:Wi,getPointsHoles:function(e){for(var t=[],i=0,n=this.holes.length;i<n;i++)t[i]=this.holes[i].getPoints(e);return t},extractAllPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},extractPoints:function(e){return this.extractAllPoints(e)}}),Object.assign(qi.prototype,{moveTo:function(e,t){this.currentPath=new Vi,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t)},lineTo:function(e,t){this.currentPath.lineTo(e,t)},quadraticCurveTo:function(e,t,i,n){this.currentPath.quadraticCurveTo(e,t,i,n)},bezierCurveTo:function(e,t,i,n,r,o){this.currentPath.bezierCurveTo(e,t,i,n,r,o)},splineThru:function(e){this.currentPath.splineThru(e)},toShapes:function(e,t){function i(e){for(var t=[],i=0,n=e.length;i<n;i++){var r=e[i],o=new Wi;o.curves=r.curves,t.push(o)}return t}function n(e,t){for(var i=t.length,n=!1,r=i-1,o=0;o<i;r=o++){var a=t[r],s=t[o],l=s.x-a.x,c=s.y-a.y;if(Math.abs(c)>Number.EPSILON){if(c<0&&(a=t[o],l=-l,s=t[r],c=-c),e.y<a.y||e.y>s.y)continue;if(e.y===a.y){if(e.x===a.x)return!0}else{var h=c*(e.x-a.x)-l*(e.y-a.y);if(0===h)return!0;if(h<0)continue;n=!n}}else{if(e.y!==a.y)continue;if(s.x<=e.x&&e.x<=a.x||a.x<=e.x&&e.x<=s.x)return!0}}return n}var r=ma.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===t)return i(o);var a,s,l,c=[];if(1===o.length)return s=o[0],l=new Wi,l.curves=s.curves,c.push(l),c;var h=!r(o[0].getPoints());h=e?!h:h;var u,d=[],f=[],p=[],m=0;f[m]=void 0,p[m]=[];for(var g=0,v=o.length;g<v;g++)a=r(u=(s=o[g]).getPoints()),(a=e?!a:a)?(!h&&f[m]&&m++,f[m]={s:new Wi,p:u},f[m].s.curves=s.curves,h&&m++,p[m]=[]):p[m].push({h:s,p:u[0]});if(!f[0])return i(o);if(f.length>1){for(var y=!1,b=[],w=0,x=f.length;w<x;w++)d[w]=[];for(var w=0,x=f.length;w<x;w++)for(var _=p[w],M=0;M<_.length;M++){for(var T=_[M],S=!0,E=0;E<f.length;E++)n(T.p,f[E].p)&&(w!==E&&b.push({froms:w,tos:E,hole:M}),S?(S=!1,d[E].push(T)):y=!0);S&&d[w].push(T)}b.length>0&&(y||(p=d))}for(var C,g=0,P=f.length;g<P;g++){l=f[g].s,c.push(l);for(var L=0,k=(C=p[g]).length;L<k;L++)l.holes.push(C[L].h)}return c}}),Object.assign(Xi.prototype,{isFont:!0,generateShapes:function(e,t,i){function n(e){for(var n=String(e).split(""),o=t/r.resolution,a=(r.boundingBox.yMax-r.boundingBox.yMin+r.underlineThickness)*o,s=0,l=0,c=[],h=0;h<n.length;h++){var u=n[h];if("\n"===u)s=0,l-=a;else{var d=function(e,t,n,o){var a=r.glyphs[e]||r.glyphs["?"];if(!a)return;var s,l,c,h,u,d,f,p,m,g,v,y=new qi,b=[];if(a.o)for(var w=a._cachedOutline||(a._cachedOutline=a.o.split(" ")),x=0,_=w.length;x<_;){switch(w[x++]){case"m":s=w[x++]*t+n,l=w[x++]*t+o,y.moveTo(s,l);break;case"l":s=w[x++]*t+n,l=w[x++]*t+o,y.lineTo(s,l);break;case"q":if(c=w[x++]*t+n,h=w[x++]*t+o,f=w[x++]*t+n,p=w[x++]*t+o,y.quadraticCurveTo(f,p,c,h),v=b[b.length-1]){u=v.x,d=v.y;for(M=1;M<=i;M++){Bi(T=M/i,u,f,c),Bi(T,d,p,h)}}break;case"b":if(c=w[x++]*t+n,h=w[x++]*t+o,f=w[x++]*t+n,p=w[x++]*t+o,m=w[x++]*t+n,g=w[x++]*t+o,y.bezierCurveTo(f,p,m,g,c,h),v=b[b.length-1]){u=v.x,d=v.y;for(var M=1;M<=i;M++){var T=M/i;Di(T,u,f,m,c),Di(T,d,p,g,h)}}}}return{offsetX:a.ha*t,path:y}}(u,o,s,l);s+=d.offsetX,c.push(d.path)}}return c}void 0===t&&(t=100),void 0===i&&(i=4);for(var r=this.data,o=n(e),a=[],s=0,l=o.length;s<l;s++)Array.prototype.push.apply(a,o[s].toShapes());return a}}),Object.assign(Ki.prototype,{load:function(e,t,i,n){var r;new $t(this.manager);try{r=JSON.parse(e)}catch(t){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),r=JSON.parse(e.substring(65,e.length-2))}var o=this.parse(r);t&&t(o)},parse:function(e){return new Xi(e)},setPath:function(e){return this.path=e,this}});var Pa,La={getContext:function(){return void 0===Pa&&(Pa=new(window.AudioContext||window.webkitAudioContext)),Pa},setContext:function(e){Pa=e}};Object.assign(Yi.prototype,{load:function(e,t,i,n){var r=new $t(this.manager);r.setResponseType("arraybuffer"),r.load(e,function(e){La.getContext().decodeAudioData(e,function(e){t(e)})},i,n)}}),Object.assign(Zi.prototype,{update:function(){var e,t,i,r,o,a,s,l,c=new n,h=new n;return function(n){if(e!==this||t!==n.focus||i!==n.fov||r!==n.aspect*this.aspect||o!==n.near||a!==n.far||s!==n.zoom||l!==this.eyeSep){e=this,t=n.focus,i=n.fov,r=n.aspect*this.aspect,o=n.near,a=n.far,s=n.zoom;var u,d,f=n.projectionMatrix.clone(),p=(l=this.eyeSep/2)*o/t,m=o*Math.tan(Zo.DEG2RAD*i*.5)/s;h.elements[12]=-l,c.elements[12]=l,u=-m*r+p,d=m*r+p,f.elements[0]=2*o/(d-u),f.elements[8]=(d+u)/(d-u),this.cameraL.projectionMatrix.copy(f),u=-m*r-p,d=m*r-p,f.elements[0]=2*o/(d-u),f.elements[8]=(d+u)/(d-u),this.cameraR.projectionMatrix.copy(f)}this.cameraL.matrixWorld.copy(n.matrixWorld).multiply(h),this.cameraR.matrixWorld.copy(n.matrixWorld).multiply(c)}}()}),Ji.prototype=Object.assign(Object.create(le.prototype),{constructor:Ji,getInput:function(){return this.gain},removeFilter:function(){null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null)},getFilter:function(){return this.filter},setFilter:function(e){null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination)},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(e){this.gain.gain.value=e},updateMatrixWorld:function(){var e=new o,t=new r,i=new o,n=new o;return function(r){le.prototype.updateMatrixWorld.call(this,r);var o=this.context.listener,a=this.up;this.matrixWorld.decompose(e,t,i),n.set(0,0,-1).applyQuaternion(t),o.positionX?(o.positionX.setValueAtTime(e.x,this.context.currentTime),o.positionY.setValueAtTime(e.y,this.context.currentTime),o.positionZ.setValueAtTime(e.z,this.context.currentTime),o.forwardX.setValueAtTime(n.x,this.context.currentTime),o.forwardY.setValueAtTime(n.y,this.context.currentTime),o.forwardZ.setValueAtTime(n.z,this.context.currentTime),o.upX.setValueAtTime(a.x,this.context.currentTime),o.upY.setValueAtTime(a.y,this.context.currentTime),o.upZ.setValueAtTime(a.z,this.context.currentTime)):(o.setPosition(e.x,e.y,e.z),o.setOrientation(n.x,n.y,n.z,a.x,a.y,a.z))}}()}),Qi.prototype=Object.assign(Object.create(le.prototype),{constructor:Qi,getOutput:function(){return this.gain},setNodeSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this},setBuffer:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(){if(!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){var e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.onended=this.onEnded.bind(this),e.playbackRate.setValueAtTime(this.playbackRate,this.startTime),this.startTime=this.context.currentTime,e.start(this.startTime,this.offset),this.isPlaying=!0,this.source=e,this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this.source.stop(),this.offset+=(this.context.currentTime-this.startTime)*this.playbackRate,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this.source.stop(),this.offset=0,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(e){return e||(e=[]),!0===this.isPlaying?(this.disconnect(),this.filters=e,this.connect()):this.filters=e,this},getFilter:function(){return this.getFilters()[0]},setFilter:function(e){return this.setFilters(e?[e]:[])},setPlaybackRate:function(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setValueAtTime(this.playbackRate,this.context.currentTime),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},getVolume:function(){return this.gain.gain.value},setVolume:function(e){return this.gain.gain.value=e,this}}),$i.prototype=Object.assign(Object.create(Qi.prototype),{constructor:$i,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(e){this.panner.refDistance=e},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(e){this.panner.rolloffFactor=e},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(e){this.panner.distanceModel=e},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(e){this.panner.maxDistance=e},updateMatrixWorld:function(){var e=new o;return function(t){le.prototype.updateMatrixWorld.call(this,t),e.setFromMatrixPosition(this.matrixWorld),this.panner.setPosition(e.x,e.y,e.z)}}()}),Object.assign(en.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var e=0,t=this.getFrequencyData(),i=0;i<t.length;i++)e+=t[i];return e/t.length}}),Object.assign(tn.prototype,{accumulate:function(e,t){var i=this.buffer,n=this.valueSize,r=e*n+n,o=this.cumulativeWeight;if(0===o){for(var a=0;a!==n;++a)i[r+a]=i[a];o=t}else{var s=t/(o+=t);this._mixBufferRegion(i,r,0,s,n)}this.cumulativeWeight=o},apply:function(e){var t=this.valueSize,i=this.buffer,n=e*t+t,r=this.cumulativeWeight,o=this.binding;if(this.cumulativeWeight=0,r<1){var a=3*t;this._mixBufferRegion(i,n,a,1-r,t)}for(var s=t,l=t+t;s!==l;++s)if(i[s]!==i[s+t]){o.setValue(i,n);break}},saveOriginalState:function(){var e=this.binding,t=this.buffer,i=this.valueSize,n=3*i;e.getValue(t,n);for(var r=i,o=n;r!==o;++r)t[r]=t[n+r%i];this.cumulativeWeight=0},restoreOriginalState:function(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)},_select:function(e,t,i,n,r){if(n>=.5)for(var o=0;o!==r;++o)e[t+o]=e[i+o]},_slerp:function(e,t,i,n){r.slerpFlat(e,t,e,t,e,i,n)},_lerp:function(e,t,i,n,r){for(var o=1-n,a=0;a!==r;++a){var s=t+a;e[s]=e[s]*o+e[i+a]*n}}}),Object.assign(nn.prototype,{getValue:function(e,t){this.bind();var i=this._targetGroup.nCachedObjects_,n=this._bindings[i];void 0!==n&&n.getValue(e,t)},setValue:function(e,t){for(var i=this._bindings,n=this._targetGroup.nCachedObjects_,r=i.length;n!==r;++n)i[n].setValue(e,t)},bind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()},unbind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}),Object.assign(rn,{Composite:nn,create:function(e,t,i){return e&&e.isAnimationObjectGroup?new rn.Composite(e,t,i):new rn(e,t,i)},sanitizeNodeName:function(e){return e.replace(/\s/g,"_").replace(/[^\w-]/g,"")},parseTrackName:function(){var e=new RegExp("^"+/((?:[\w-]+[\/:])*)/.source+/([\w-\.]+)?/.source+/(?:\.([\w-]+)(?:\[(.+)\])?)?/.source+/\.([\w-]+)(?:\[(.+)\])?/.source+"$"),t=["material","materials","bones"];return function(i){var n=e.exec(i);if(!n)throw new Error("PropertyBinding: Cannot parse trackName: "+i);var r={nodeName:n[2],objectName:n[3],objectIndex:n[4],propertyName:n[5],propertyIndex:n[6]},o=r.nodeName&&r.nodeName.lastIndexOf(".");if(void 0!==o&&-1!==o){var a=r.nodeName.substring(o+1);-1!==t.indexOf(a)&&(r.nodeName=r.nodeName.substring(0,o),r.objectName=a)}if(null===r.propertyName||0===r.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+i);return r}}(),findNode:function(e,t){if(!t||""===t||"root"===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var i=function(e){for(var i=0;i<e.bones.length;i++){var n=e.bones[i];if(n.name===t)return n}return null}(e.skeleton);if(i)return i}if(e.children){var n=function e(i){for(var n=0;n<i.length;n++){var r=i[n];if(r.name===t||r.uuid===t)return r;var o=e(r.children);if(o)return o}return null}(e.children);if(n)return n}return null}}),Object.assign(rn.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){for(var i=this.resolvedProperty,n=0,r=i.length;n!==r;++n)e[t++]=i[n]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){for(var i=this.resolvedProperty,n=0,r=i.length;n!==r;++n)i[n]=e[t++]},function(e,t){for(var i=this.resolvedProperty,n=0,r=i.length;n!==r;++n)i[n]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){for(var i=this.resolvedProperty,n=0,r=i.length;n!==r;++n)i[n]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){var e=this.node,t=this.parsedPath,i=t.objectName,n=t.propertyName,r=t.propertyIndex;if(e||(e=rn.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,e){if(i){var o=t.objectIndex;switch(i){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(c=0;c<e.length;c++)if(e[c].name===o){o=c;break}break;default:if(void 0===e[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[i]}if(void 0!==o){if(void 0===e[o])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[o]}}var a=e[n];if(void 0!==a){var s=this.Versioning.None;void 0!==e.needsUpdate?(s=this.Versioning.NeedsUpdate,this.targetObject=e):void 0!==e.matrixWorldNeedsUpdate&&(s=this.Versioning.MatrixWorldNeedsUpdate,this.targetObject=e);var l=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===n){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(c=0;c<this.node.geometry.morphAttributes.position.length;c++)if(e.geometry.morphAttributes.position[c].name===r){r=c;break}}else{if(!e.geometry.morphTargets)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(var c=0;c<this.node.geometry.morphTargets.length;c++)if(e.geometry.morphTargets[c].name===r){r=c;break}}}l=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=r}else void 0!==a.fromArray&&void 0!==a.toArray?(l=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(l=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=n;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][s]}else{var h=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+h+"."+n+" but it wasn't found.",e)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),//!\ DECLARE ALIAS AFTER assign prototype !
Object.assign(rn.prototype,{_getValue_unbound:rn.prototype.getValue,_setValue_unbound:rn.prototype.setValue}),Object.assign(on.prototype,{isAnimationObjectGroup:!0,add:function(){for(var e=this._objects,t=e.length,i=this.nCachedObjects_,n=this._indicesByUUID,r=this._paths,o=this._parsedPaths,a=this._bindings,s=a.length,l=0,c=arguments.length;l!==c;++l){var h=arguments[l],u=h.uuid,d=n[u],f=void 0;if(void 0===d){d=t++,n[u]=d,e.push(h);for(var p=0,m=s;p!==m;++p)a[p].push(new rn(h,r[p],o[p]))}else if(d<i){f=e[d];var g=--i,v=e[g];n[v.uuid]=d,e[d]=v,n[u]=g,e[g]=h;for(var p=0,m=s;p!==m;++p){var y=a[p],b=y[g],w=y[d];y[d]=b,void 0===w&&(w=new rn(h,r[p],o[p])),y[g]=w}}else e[d]!==f&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=i},remove:function(){for(var e=this._objects,t=this.nCachedObjects_,i=this._indicesByUUID,n=this._bindings,r=n.length,o=0,a=arguments.length;o!==a;++o){var s=arguments[o],l=s.uuid,c=i[l];if(void 0!==c&&c>=t){var h=t++,u=e[h];i[u.uuid]=c,e[c]=u,i[l]=h,e[h]=s;for(var d=0,f=r;d!==f;++d){var p=n[d],m=p[h],g=p[c];p[c]=m,p[h]=g}}}this.nCachedObjects_=t},uncache:function(){for(var e=this._objects,t=e.length,i=this.nCachedObjects_,n=this._indicesByUUID,r=this._bindings,o=r.length,a=0,s=arguments.length;a!==s;++a){var l=arguments[a].uuid,c=n[l];if(void 0!==c)if(delete n[l],c<i){var h=--i,u=e[h],d=e[v=--t];n[u.uuid]=c,e[c]=u,n[d.uuid]=h,e[h]=d,e.pop();for(var f=0,p=o;f!==p;++f){var m=(y=r[f])[h],g=y[v];y[c]=m,y[h]=g,y.pop()}}else{var v=--t;n[(d=e[v]).uuid]=c,e[c]=d,e.pop();for(var f=0,p=o;f!==p;++f){var y=r[f];y[c]=y[v],y.pop()}}}this.nCachedObjects_=i},subscribe_:function(e,t){var i=this._bindingsIndicesByPath,n=i[e],r=this._bindings;if(void 0!==n)return r[n];var o=this._paths,a=this._parsedPaths,s=this._objects,l=s.length,c=this.nCachedObjects_,h=new Array(l);n=r.length,i[e]=n,o.push(e),a.push(t),r.push(h);for(var u=c,d=s.length;u!==d;++u){var f=s[u];h[u]=new rn(f,e,t)}return h},unsubscribe_:function(e){var t=this._bindingsIndicesByPath,i=t[e];if(void 0!==i){var n=this._paths,r=this._parsedPaths,o=this._bindings,a=o.length-1,s=o[a];t[e[a]]=i,o[i]=s,o.pop(),r[i]=r[a],r.pop(),n[i]=n[a],n.pop()}}}),Object.assign(an.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(e){return this._startTime=e,this},setLoop:function(e,t){return this.loop=e,this.repetitions=t,this},setEffectiveWeight:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(e){return this._scheduleFading(e,0,1)},fadeOut:function(e){return this._scheduleFading(e,1,0)},crossFadeFrom:function(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){var n=this._clip.duration,r=e._clip.duration,o=r/n,a=n/r;e.warp(1,o,t),this.warp(a,1,t)}return this},crossFadeTo:function(e,t,i){return e.crossFadeFrom(this,t,i)},stopFading:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},setEffectiveTimeScale:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()},syncWith:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()},halt:function(e){return this.warp(this._effectiveTimeScale,0,e)},warp:function(e,t,i){var n=this._mixer,r=n.time,o=this._timeScaleInterpolant,a=this.timeScale;null===o&&(o=n._lendControlInterpolant(),this._timeScaleInterpolant=o);var s=o.parameterPositions,l=o.sampleValues;return s[0]=r,s[1]=r+i,l[0]=e/a,l[1]=t/a,this},stopWarping:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(e,t,i,n){if(this.enabled){var r=this._startTime;if(null!==r){var o=(e-r)*i;if(o<0||0===i)return;this._startTime=null,t=i*o}t*=this._updateTimeScale(e);var a=this._updateTime(t),s=this._updateWeight(e);if(s>0)for(var l=this._interpolants,c=this._propertyBindings,h=0,u=l.length;h!==u;++h)l[h].evaluate(a),c[h].accumulate(n,s)}else this._updateWeight(e)},_updateWeight:function(e){var t=0;if(this.enabled){t=this.weight;var i=this._weightInterpolant;if(null!==i){var n=i.evaluate(e)[0];t*=n,e>i.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=t,t},_updateTimeScale:function(e){var t=0;if(!this.paused){t=this.timeScale;var i=this._timeScaleInterpolant;if(null!==i){t*=i.evaluate(e)[0],e>i.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t},_updateTime:function(e){var t=this.time+e;if(0===e)return t;var i=this._clip.duration,n=this.loop,r=this._loopCount;if(2200===n){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(t>=i)t=i;else{if(!(t<0))break e;t=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{var o=2202===n;if(-1===r&&(e>=0?(r=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),t>=i||t<0){var a=Math.floor(t/i);t-=i*a,r+=Math.abs(a);var s=this.repetitions-r;if(s<0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,t=e>0?i:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(0===s){var l=e<0;this._setEndings(l,!l,o)}else this._setEndings(!1,!1,o);this._loopCount=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}if(o&&1==(1&r))return this.time=t,i-t}return this.time=t,t},_setEndings:function(e,t,i){var n=this._interpolantSettings;i?(n.endingStart=2401,n.endingEnd=2401):(n.endingStart=e?this.zeroSlopeAtStart?2401:Uo:2402,n.endingEnd=t?this.zeroSlopeAtEnd?2401:Uo:2402)},_scheduleFading:function(e,t,i){var n=this._mixer,r=n.time,o=this._weightInterpolant;null===o&&(o=n._lendControlInterpolant(),this._weightInterpolant=o);var a=o.parameterPositions,s=o.sampleValues;return a[0]=r,s[0]=t,a[1]=r+e,s[1]=i,this}}),Object.assign(sn.prototype,t.prototype,{_bindAction:function(e,t){var i=e._localRoot||this._root,n=e._clip.tracks,r=n.length,o=e._propertyBindings,a=e._interpolants,s=i.uuid,l=this._bindingsByRootAndName,c=l[s];void 0===c&&(c={},l[s]=c);for(var h=0;h!==r;++h){var u=n[h],d=u.name,f=c[d];if(void 0!==f)o[h]=f;else{if(void 0!==(f=o[h])){null===f._cacheIndex&&(++f.referenceCount,this._addInactiveBinding(f,s,d));continue}var p=t&&t._propertyBindings[h].binding.parsedPath;++(f=new tn(rn.create(i,d,p),u.ValueTypeName,u.getValueSize())).referenceCount,this._addInactiveBinding(f,s,d),o[h]=f}a[h].resultBuffer=f.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var t=(e._localRoot||this._root).uuid,i=e._clip.uuid,n=this._actionsByClip[i];this._bindAction(e,n&&n.knownActions[0]),this._addInactiveAction(e,i,t)}for(var r=e._propertyBindings,o=0,a=r.length;o!==a;++o){var s=r[o];0==s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,i=0,n=t.length;i!==n;++i){var r=t[i];0==--r.useCount&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){var t=e._cacheIndex;return null!==t&&t<this._nActiveActions},_addInactiveAction:function(e,t,i){var n=this._actions,r=this._actionsByClip,o=r[t];if(void 0===o)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=o;else{var a=o.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=n.length,n.push(e),o.actionByRoot[i]=e},_removeInactiveAction:function(e){var t=this._actions,i=t[t.length-1],n=e._cacheIndex;i._cacheIndex=n,t[n]=i,t.pop(),e._cacheIndex=null;var r=e._clip.uuid,o=this._actionsByClip,a=o[r],s=a.knownActions,l=s[s.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,s[c]=l,s.pop(),e._byClipCacheIndex=null;delete a.actionByRoot[(e._localRoot||this._root).uuid],0===s.length&&delete o[r],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){for(var t=e._propertyBindings,i=0,n=t.length;i!==n;++i){var r=t[i];0==--r.referenceCount&&this._removeInactiveBinding(r)}},_lendAction:function(e){var t=this._actions,i=e._cacheIndex,n=this._nActiveActions++,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r},_takeBackAction:function(e){var t=this._actions,i=e._cacheIndex,n=--this._nActiveActions,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r},_addInactiveBinding:function(e,t,i){var n=this._bindingsByRootAndName,r=n[t],o=this._bindings;void 0===r&&(r={},n[t]=r),r[i]=e,e._cacheIndex=o.length,o.push(e)},_removeInactiveBinding:function(e){var t=this._bindings,i=e.binding,n=i.rootNode.uuid,r=i.path,o=this._bindingsByRootAndName,a=o[n],s=t[t.length-1],l=e._cacheIndex;s._cacheIndex=l,t[l]=s,t.pop(),delete a[r];e:{for(var c in a)break e;delete o[n]}},_lendBinding:function(e){var t=this._bindings,i=e._cacheIndex,n=this._nActiveBindings++,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r},_takeBackBinding:function(e){var t=this._bindings,i=e._cacheIndex,n=--this._nActiveBindings,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r},_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,i=e[t];return void 0===i&&((i=new vi(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=t,e[t]=i),i},_takeBackControlInterpolant:function(e){var t=this._controlInterpolants,i=e.__cacheIndex,n=--this._nActiveControlInterpolants,r=t[n];e.__cacheIndex=n,t[n]=e,r.__cacheIndex=i,t[i]=r},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t){var i=t||this._root,n=i.uuid,r="string"==typeof e?Pi.findByName(i,e):e,o=null!==r?r.uuid:e,a=this._actionsByClip[o],s=null;if(void 0!==a){var l=a.actionByRoot[n];if(void 0!==l)return l;s=a.knownActions[0],null===r&&(r=s._clip)}if(null===r)return null;var c=new an(this,r,t);return this._bindAction(c,s),this._addInactiveAction(c,o,n),c},existingAction:function(e,t){var i=t||this._root,n=i.uuid,r="string"==typeof e?Pi.findByName(i,e):e,o=r?r.uuid:e,a=this._actionsByClip[o];return void 0!==a?a.actionByRoot[n]||null:null},stopAllAction:function(){var e=this._actions,t=this._nActiveActions,i=this._bindings,n=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(r=0;r!==t;++r)e[r].reset();for(var r=0;r!==n;++r)i[r].useCount=0;return this},update:function(e){e*=this.timeScale;for(var t=this._actions,i=this._nActiveActions,n=this.time+=e,r=Math.sign(e),o=this._accuIndex^=1,a=0;a!==i;++a){t[a]._update(n,e,r,o)}for(var s=this._bindings,l=this._nActiveBindings,a=0;a!==l;++a)s[a].apply(o);return this},getRoot:function(){return this._root},uncacheClip:function(e){var t=this._actions,i=e.uuid,n=this._actionsByClip,r=n[i];if(void 0!==r){for(var o=r.knownActions,a=0,s=o.length;a!==s;++a){var l=o[a];this._deactivateAction(l);var c=l._cacheIndex,h=t[t.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,h._cacheIndex=c,t[c]=h,t.pop(),this._removeInactiveBindingsForAction(l)}delete n[i]}},uncacheRoot:function(e){var t=e.uuid,i=this._actionsByClip;for(var n in i){var r=i[n].actionByRoot[t];void 0!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}var o=this._bindingsByRootAndName[t];if(void 0!==o)for(var a in o){var s=o[a];s.restoreOriginalState(),this._removeInactiveBinding(s)}},uncacheAction:function(e,t){var i=this.existingAction(e,t);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}}),ln.prototype.clone=function(){return new ln(void 0===this.value.clone?this.value:this.value.clone())},cn.prototype=Object.assign(Object.create(Se.prototype),{constructor:cn,isInstancedBufferGeometry:!0,copy:function(e){return Se.prototype.copy.call(this,e),this.maxInstancedCount=e.maxInstancedCount,this},clone:function(){return(new this.constructor).copy(this)}}),Object.defineProperties(hn.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(hn.prototype,{isInterleavedBufferAttribute:!0,setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this},setXYZ:function(e,t,i,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this},setXYZW:function(e,t,i,n,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this.data.array[e+3]=r,this}}),Object.defineProperty(un.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(un.prototype,{isInterleavedBuffer:!0,setArray:function(e){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.count=void 0!==e?e.length/this.stride:0,this.array=e},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.dynamic=e.dynamic,this},copyAt:function(e,t,i){e*=this.stride,i*=t.stride;for(var n=0,r=this.stride;n<r;n++)this.array[e+n]=t.array[i+n];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(e){return this.onUploadCallback=e,this}}),dn.prototype=Object.assign(Object.create(un.prototype),{constructor:dn,isInstancedInterleavedBuffer:!0,copy:function(e){return un.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),fn.prototype=Object.assign(Object.create(fe.prototype),{constructor:fn,isInstancedBufferAttribute:!0,copy:function(e){return fe.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),Object.assign(pn.prototype,{linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize()):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,t){var i=[];return gn(e,this,i,t),i.sort(mn),i},intersectObjects:function(e,t){var i=[];if(!1===Array.isArray(e))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),i;for(var n=0,r=e.length;n<r;n++)gn(e[n],this,i,t);return i.sort(mn),i}}),Object.assign(vn.prototype,{start:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=("undefined"==typeof performance?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}),Object.assign(yn.prototype,{set:function(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(e){return this.radius=e.length(),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e.x,e.z),this.phi=Math.acos(Zo.clamp(e.y/this.radius,-1,1))),this}}),Object.assign(bn.prototype,{set:function(e,t,i){return this.radius=e,this.theta=t,this.y=i,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this},setFromVector3:function(e){return this.radius=Math.sqrt(e.x*e.x+e.z*e.z),this.theta=Math.atan2(e.x,e.z),this.y=e.y,this}}),(wn.prototype=Object.create(le.prototype)).constructor=wn,wn.prototype.isImmediateRenderObject=!0,(xn.prototype=Object.create(mt.prototype)).constructor=xn,xn.prototype.update=function(){var e=new o,t=new o,i=new s;return function(){var n=["a","b","c"];this.object.updateMatrixWorld(!0),i.getNormalMatrix(this.object.matrixWorld);var r=this.object.matrixWorld,o=this.geometry.attributes.position,a=this.object.geometry;if(a&&a.isGeometry)for(var s=a.vertices,l=a.faces,c=0,h=0,u=l.length;h<u;h++)for(var d=l[h],f=0,p=d.vertexNormals.length;f<p;f++){var m=s[d[n[f]]],g=d.vertexNormals[f];e.copy(m).applyMatrix4(r),t.copy(g).applyMatrix3(i).normalize().multiplyScalar(this.size).add(e),o.setXYZ(c,e.x,e.y,e.z),c+=1,o.setXYZ(c,t.x,t.y,t.z),c+=1}else if(a&&a.isBufferGeometry)for(var v=a.attributes.position,y=a.attributes.normal,c=0,f=0,p=v.count;f<p;f++)e.set(v.getX(f),v.getY(f),v.getZ(f)).applyMatrix4(r),t.set(y.getX(f),y.getY(f),y.getZ(f)),t.applyMatrix3(i).normalize().multiplyScalar(this.size).add(e),o.setXYZ(c,e.x,e.y,e.z),c+=1,o.setXYZ(c,t.x,t.y,t.z),c+=1;o.needsUpdate=!0}}(),(_n.prototype=Object.create(le.prototype)).constructor=_n,_n.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},_n.prototype.update=function(){var e=new o,t=new o;return function(){this.light.updateMatrixWorld();var i=this.light.distance?this.light.distance:1e3,n=i*Math.tan(this.light.angle);this.cone.scale.set(n,n,i),e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(t.sub(e)),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}(),(Tn.prototype=Object.create(mt.prototype)).constructor=Tn,Tn.prototype.updateMatrixWorld=function(){var e=new o,t=new n,i=new n;return function(n){var r=this.bones,o=this.geometry,a=o.getAttribute("position");i.getInverse(this.root.matrixWorld);for(var s=0,l=0;s<r.length;s++){var c=r[s];c.parent&&c.parent.isBone&&(t.multiplyMatrices(i,c.matrixWorld),e.setFromMatrixPosition(t),a.setXYZ(l,e.x,e.y,e.z),t.multiplyMatrices(i,c.parent.matrixWorld),e.setFromMatrixPosition(t),a.setXYZ(l+1,e.x,e.y,e.z),l+=2)}o.getAttribute("position").needsUpdate=!0,le.prototype.updateMatrixWorld.call(this,n)}}(),(Sn.prototype=Object.create(Ue.prototype)).constructor=Sn,Sn.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},Sn.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)},(En.prototype=Object.create(le.prototype)).constructor=En,En.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},En.prototype.update=function(){var e=.5*this.light.width,t=.5*this.light.height,i=this.line.geometry.attributes.position,n=i.array;n[0]=e,n[1]=-t,n[2]=0,n[3]=e,n[4]=t,n[5]=0,n[6]=-e,n[7]=t,n[8]=0,n[9]=-e,n[10]=-t,n[11]=0,n[12]=e,n[13]=-t,n[14]=0,i.needsUpdate=!0,void 0!==this.color?this.line.material.color.set(this.color):this.line.material.color.copy(this.light.color)},(Cn.prototype=Object.create(le.prototype)).constructor=Cn,Cn.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},Cn.prototype.update=function(){var e=new o,t=new q,i=new q;return function(){var n=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var r=n.geometry.getAttribute("color");t.copy(this.light.color),i.copy(this.light.groundColor);for(var o=0,a=r.count;o<a;o++){var s=o<a/2?t:i;r.setXYZ(o,s.r,s.g,s.b)}r.needsUpdate=!0}n.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate())}}(),(Pn.prototype=Object.create(mt.prototype)).constructor=Pn,(Ln.prototype=Object.create(mt.prototype)).constructor=Ln,(kn.prototype=Object.create(mt.prototype)).constructor=kn,kn.prototype.update=function(){var e=new o,t=new o,i=new s;return function(){this.object.updateMatrixWorld(!0),i.getNormalMatrix(this.object.matrixWorld);for(var n=this.object.matrixWorld,r=this.geometry.attributes.position,o=this.object.geometry,a=o.vertices,s=o.faces,l=0,c=0,h=s.length;c<h;c++){var u=s[c],d=u.normal;e.copy(a[u.a]).add(a[u.b]).add(a[u.c]).divideScalar(3).applyMatrix4(n),t.copy(d).applyMatrix3(i).normalize().multiplyScalar(this.size).add(e),r.setXYZ(l,e.x,e.y,e.z),l+=1,r.setXYZ(l,t.x,t.y,t.z),l+=1}r.needsUpdate=!0}}(),(An.prototype=Object.create(le.prototype)).constructor=An,An.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},An.prototype.update=function(){var e=new o,t=new o,i=new o;return function(){e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),i.subVectors(t,e),this.lightPlane.lookAt(i),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(i),this.targetLine.scale.z=i.length()}}(),(Rn.prototype=Object.create(mt.prototype)).constructor=Rn,Rn.prototype.update=function(){function e(e,o,a,s){n.set(o,a,s).unproject(r);var l=i[e];if(void 0!==l)for(var c=t.getAttribute("position"),h=0,u=l.length;h<u;h++)c.setXYZ(l[h],n.x,n.y,n.z)}var t,i,n=new o,r=new ce;return function(){t=this.geometry,i=this.pointMap;r.projectionMatrix.copy(this.camera.projectionMatrix),e("c",0,0,-1),e("t",0,0,1),e("n1",-1,-1,-1),e("n2",1,-1,-1),e("n3",-1,1,-1),e("n4",1,1,-1),e("f1",-1,-1,1),e("f2",1,-1,1),e("f3",-1,1,1),e("f4",1,1,1),e("u1",.7,1.1,-1),e("u2",-.7,1.1,-1),e("u3",0,2,-1),e("cf1",-1,0,1),e("cf2",1,0,1),e("cf3",0,-1,1),e("cf4",0,1,1),e("cn1",-1,0,-1),e("cn2",1,0,-1),e("cn3",0,-1,-1),e("cn4",0,1,-1),t.getAttribute("position").needsUpdate=!0}}(),(On.prototype=Object.create(mt.prototype)).constructor=On,On.prototype.update=function(){var e=new ee;return function(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&e.setFromObject(this.object),!e.isEmpty()){var i=e.min,n=e.max,r=this.geometry.attributes.position,o=r.array;o[0]=n.x,o[1]=n.y,o[2]=n.z,o[3]=i.x,o[4]=n.y,o[5]=n.z,o[6]=i.x,o[7]=i.y,o[8]=n.z,o[9]=n.x,o[10]=i.y,o[11]=n.z,o[12]=n.x,o[13]=n.y,o[14]=i.z,o[15]=i.x,o[16]=n.y,o[17]=i.z,o[18]=i.x,o[19]=i.y,o[20]=i.z,o[21]=n.x,o[22]=i.y,o[23]=i.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}}}(),On.prototype.setFromObject=function(e){return this.object=e,this.update(),this},(In.prototype=Object.create(mt.prototype)).constructor=In,In.prototype.updateMatrixWorld=function(e){var t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),le.prototype.updateMatrixWorld.call(this,e))},(Bn.prototype=Object.create(pt.prototype)).constructor=Bn,Bn.prototype.updateMatrixWorld=function(e){var t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.lookAt(this.plane.normal),le.prototype.updateMatrixWorld.call(this,e)};var ka,Aa;(Dn.prototype=Object.create(le.prototype)).constructor=Dn,Dn.prototype.setDirection=function(){var e,t=new o;return function(i){i.y>.99999?this.quaternion.set(0,0,0,1):i.y<-.99999?this.quaternion.set(1,0,0,0):(t.set(i.z,0,-i.x).normalize(),e=Math.acos(i.y),this.quaternion.setFromAxisAngle(t,e))}}(),Dn.prototype.setLength=function(e,t,i){void 0===t&&(t=.2*e),void 0===i&&(i=.2*t),this.line.scale.set(1,Math.max(0,e-t),1),this.line.updateMatrix(),this.cone.scale.set(i,t,i),this.cone.position.y=e,this.cone.updateMatrix()},Dn.prototype.setColor=function(e){this.line.material.color.copy(e),this.cone.material.color.copy(e)},(Un.prototype=Object.create(mt.prototype)).constructor=Un;var Ra=new o,Oa=new zn,Ia=new zn,Ba=new zn;(Nn.prototype=Object.create(Ui.prototype)).constructor=Nn,Nn.prototype.isCatmullRomCurve3=!0,Nn.prototype.getPoint=function(e,t){var i=t||new o,n=this.points,r=n.length,a=(r-(this.closed?0:1))*e,s=Math.floor(a),l=a-s;this.closed?s+=s>0?0:(Math.floor(Math.abs(s)/n.length)+1)*n.length:0===l&&s===r-1&&(s=r-2,l=1);var c,h,u,d;if(this.closed||s>0?c=n[(s-1)%r]:(Ra.subVectors(n[0],n[1]).add(n[0]),c=Ra),h=n[s%r],u=n[(s+1)%r],this.closed||s+2<r?d=n[(s+2)%r]:(Ra.subVectors(n[r-1],n[r-2]).add(n[r-1]),d=Ra),void 0===this.type||"centripetal"===this.type||"chordal"===this.type){var f="chordal"===this.type?.5:.25,p=Math.pow(c.distanceToSquared(h),f),m=Math.pow(h.distanceToSquared(u),f),g=Math.pow(u.distanceToSquared(d),f);m<1e-4&&(m=1),p<1e-4&&(p=m),g<1e-4&&(g=m),Oa.initNonuniformCatmullRom(c.x,h.x,u.x,d.x,p,m,g),Ia.initNonuniformCatmullRom(c.y,h.y,u.y,d.y,p,m,g),Ba.initNonuniformCatmullRom(c.z,h.z,u.z,d.z,p,m,g)}else if("catmullrom"===this.type){var v=void 0!==this.tension?this.tension:.5;Oa.initCatmullRom(c.x,h.x,u.x,d.x,v),Ia.initCatmullRom(c.y,h.y,u.y,d.y,v),Ba.initCatmullRom(c.z,h.z,u.z,d.z,v)}return i.set(Oa.calc(l),Ia.calc(l),Ba.calc(l)),i},(jn.prototype=Object.create(Ui.prototype)).constructor=jn,jn.prototype.isCubicBezierCurve3=!0,jn.prototype.getPoint=function(e,t){var i=t||new o,n=this.v0,r=this.v1,a=this.v2,s=this.v3;return i.set(Di(e,n.x,r.x,a.x,s.x),Di(e,n.y,r.y,a.y,s.y),Di(e,n.z,r.z,a.z,s.z)),i},(Fn.prototype=Object.create(Ui.prototype)).constructor=Fn,Fn.prototype.isQuadraticBezierCurve3=!0,Fn.prototype.getPoint=function(e,t){var i=t||new o,n=this.v0,r=this.v1,a=this.v2;return i.set(Bi(e,n.x,r.x,a.x),Bi(e,n.y,r.y,a.y),Bi(e,n.z,r.z,a.z)),i},(Gn.prototype=Object.create(Ui.prototype)).constructor=Gn,Gn.prototype.isLineCurve3=!0,Gn.prototype.getPoint=function(e,t){var i=t||new o;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i},Gn.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},(Hn.prototype=Object.create(ji.prototype)).constructor=Hn,Hn.prototype.isArcCurve=!0;var Da={createMultiMaterialObject:function(e,t){for(var i=new bt,n=0,r=t.length;n<r;n++)i.add(new Ue(e,t[n]));return i},detach:function(e,t,i){e.applyMatrix(t.matrixWorld),t.remove(e),i.add(e)},attach:function(e,t,i){e.applyMatrix((new n).getInverse(i.matrixWorld)),t.remove(e),i.add(e)}};Ui.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(Ui.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},Object.assign(Ni.prototype,{createPointsGeometry:function(e){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getPoints(e);return this.createGeometry(t)},createSpacedPointsGeometry:function(e){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getSpacedPoints(e);return this.createGeometry(t)},createGeometry:function(e){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var t=new de,i=0,n=e.length;i<n;i++){var r=e[i];t.vertices.push(new o(r.x,r.y,r.z||0))}return t}}),Vn.prototype=Object.create(Nn.prototype),Wn.prototype=Object.create(Nn.prototype),qn.prototype=Object.create(Nn.prototype),Object.assign(qn.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),Pn.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Tn.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(X.prototype,{center:function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(ee.prototype,{center:function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}}),Be.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Object.assign(Zo,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(e){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),Zo.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),Zo.ceilPowerOfTwo(e)}}),Object.assign(s.prototype,{flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBuffer:function(e){return console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(n.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){var e;return function(){return void 0===e&&(e=new o),console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),e.setFromMatrixColumn(this,3)}}(),setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function(e){return console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(e,t,i,n,r,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,n,i,r,o)}}),ie.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},r.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Object.assign(Ie.prototype,{isIntersectionBox:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign(Wi.prototype,{extrude:function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Ot(this,e)},makeGeometry:function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Ee(this,e)}}),Object.assign(i.prototype,{fromAttribute:function(e,t,i){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},distanceToManhattan:function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(o.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(e,t,i){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},distanceToManhattan:function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(c.prototype,{fromAttribute:function(e,t,i){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),de.prototype.computeTangents=function(){console.warn("THREE.Geometry: .computeTangents() has been removed.")},Object.assign(le.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)}}),Object.defineProperties(le.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.defineProperties(ct.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(ht.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),Object.defineProperty(Ui.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}}),$e.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(oi.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(fe.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}}}),Object.assign(Se.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addDrawCall:function(e,t,i){void 0!==i&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}}),Object.defineProperties(Se.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(ln.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(J.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new q}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===e}}}),Object.defineProperties(Yt.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(Oe.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Object.assign(it.prototype,{getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")}}),Object.defineProperties(it.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){return this.shadowMap.cullFace},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapCullFace is now .shadowMap.cullFace."),this.shadowMap.cullFace=e}}}),Object.defineProperties(re.prototype,{cullFace:{get:function(){return this.renderReverseSided?Zn:Yn},set:function(e){var t=e!==Yn;console.warn("WebGLRenderer: .shadowMap.cullFace is deprecated. Set .shadowMap.renderReverseSided to "+t+"."),this.renderReverseSided=t}}}),Object.defineProperties(h.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Qi.prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this;return(new Yi).load(e,function(e){t.setBuffer(e)}),this},en.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()};var Ua={merge:function(e,t,i){console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var n;t.isMesh&&(t.matrixAutoUpdate&&t.updateMatrix(),n=t.matrix,t=t.geometry),e.merge(t,n,i)},center:function(e){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}},za={crossOrigin:void 0,loadTexture:function(e,t,i,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var r=new ri;r.setCrossOrigin(this.crossOrigin);var o=r.load(e,i,void 0,n);return t&&(o.mapping=t),o},loadTextureCube:function(e,t,i,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var r=new ni;r.setCrossOrigin(this.crossOrigin);var o=r.load(e,i,void 0,n);return t&&(o.mapping=t),o},loadCompressedTexture:function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")}};e.WebGLRenderTargetCube=u,e.WebGLRenderTarget=h,e.WebGLRenderer=it,e.ShaderLib=ca,e.UniformsLib=aa,e.UniformsUtils=sa,e.ShaderChunk=la,e.FogExp2=nt,e.Fog=rt,e.Scene=ot,e.LensFlare=at,e.Sprite=lt,e.LOD=ct,e.SkinnedMesh=dt,e.Skeleton=ht,e.Bone=ut,e.Mesh=Ue,e.LineSegments=mt,e.LineLoop=gt,e.Line=pt,e.Points=yt,e.Group=bt,e.VideoTexture=wt,e.DataTexture=d,e.CompressedTexture=xt,e.CubeTexture=f,e.CanvasTexture=Y,e.DepthTexture=_t,e.Texture=l,e.CompressedTextureLoader=ei,e.DataTextureLoader=ti,e.CubeTextureLoader=ni,e.TextureLoader=ri,e.ObjectLoader=Oi,e.MaterialLoader=Li,e.BufferGeometryLoader=ki,e.DefaultLoadingManager=ba,e.LoadingManager=Qt,e.JSONLoader=Ri,e.ImageLoader=ii,e.FontLoader=Ki,e.FileLoader=$t,e.Loader=Ai,e.Cache=ya,e.AudioLoader=Yi,e.SpotLightShadow=li,e.SpotLight=ci,e.PointLight=hi,e.RectAreaLight=pi,e.HemisphereLight=ai,e.DirectionalLightShadow=ui,e.DirectionalLight=di,e.AmbientLight=fi,e.LightShadow=si,e.Light=oi,e.StereoCamera=Zi,e.PerspectiveCamera=$e,e.OrthographicCamera=he,e.ArrayCamera=et,e.Camera=ce,e.AudioListener=Ji,e.PositionalAudio=$i,e.AudioContext=La,e.AudioAnalyser=en,e.Audio=Qi,e.VectorKeyframeTrack=wi,e.StringKeyframeTrack=Ti,e.QuaternionKeyframeTrack=_i,e.NumberKeyframeTrack=Mi,e.ColorKeyframeTrack=Ei,e.BooleanKeyframeTrack=Si,e.PropertyMixer=tn,e.PropertyBinding=rn,e.KeyframeTrack=Ci,e.AnimationUtils=xa,e.AnimationObjectGroup=on,e.AnimationMixer=sn,e.AnimationClip=Pi,e.Uniform=ln,e.InstancedBufferGeometry=cn,e.BufferGeometry=Se,e.Geometry=de,e.InterleavedBufferAttribute=hn,e.InstancedInterleavedBuffer=dn,e.InterleavedBuffer=un,e.InstancedBufferAttribute=fn,e.Face3=ue,e.Object3D=le,e.Raycaster=pn,e.Layers=se,e.EventDispatcher=t,e.Clock=vn,e.QuaternionLinearInterpolant=xi,e.LinearInterpolant=vi,e.DiscreteInterpolant=yi,e.CubicInterpolant=gi,e.Interpolant=mi,e.Triangle=De,e.Math=Zo,e.Spherical=yn,e.Cylindrical=bn,e.Plane=ie,e.Frustum=ne,e.Sphere=te,e.Ray=Ie,e.Matrix4=n,e.Matrix3=s,e.Box3=ee,e.Box2=X,e.Line3=Be,e.Euler=ae,e.Vector4=c,e.Vector3=o,e.Vector2=i,e.Quaternion=r,e.Color=q,e.ImmediateRenderObject=wn,e.VertexNormalsHelper=xn,e.SpotLightHelper=_n,e.SkeletonHelper=Tn,e.PointLightHelper=Sn,e.RectAreaLightHelper=En,e.HemisphereLightHelper=Cn,e.GridHelper=Pn,e.PolarGridHelper=Ln,e.FaceNormalsHelper=kn,e.DirectionalLightHelper=An,e.CameraHelper=Rn,e.BoxHelper=On,e.Box3Helper=In,e.PlaneHelper=Bn,e.ArrowHelper=Dn,e.AxesHelper=Un,e.CatmullRomCurve3=Nn,e.CubicBezierCurve3=jn,e.QuadraticBezierCurve3=Fn,e.LineCurve3=Gn,e.ArcCurve=Hn,e.EllipseCurve=ji,e.SplineCurve=Fi,e.CubicBezierCurve=Gi,e.QuadraticBezierCurve=Hi,e.LineCurve=zi,e.Shape=Wi,e.Path=Vi,e.ShapePath=qi,e.Font=Xi,e.CurvePath=Ni,e.Curve=Ui,e.ShapeUtils=ma,e.SceneUtils=Da,e.WebGLUtils=tt,e.ParametricGeometry=Mt,e.ParametricBufferGeometry=Tt,e.TetrahedronGeometry=Ct,e.TetrahedronBufferGeometry=Pt,e.OctahedronGeometry=Lt,e.OctahedronBufferGeometry=kt,e.IcosahedronGeometry=At,e.IcosahedronBufferGeometry=Rt,e.PolyhedronGeometry=St,e.PolyhedronBufferGeometry=Et,e.TextGeometry=Bt,e.TextBufferGeometry=Dt,e.SphereGeometry=Ut,e.SphereBufferGeometry=zt,e.RingGeometry=Nt,e.RingBufferGeometry=jt,e.PlaneGeometry=ke,e.PlaneBufferGeometry=Ae,e.ExtrudeGeometry=Ot,e.ExtrudeBufferGeometry=It,e.ShapeGeometry=Ee,e.ShapeBufferGeometry=Ce,e.ConeGeometry=Ht,e.ConeBufferGeometry=Vt,e.CylinderGeometry=Ft,e.CylinderBufferGeometry=Gt,e.CircleGeometry=Wt,e.CircleBufferGeometry=qt,e.BoxGeometry=Pe,e.BoxBufferGeometry=Le,e.ShadowMaterial=Xt,e.SpriteMaterial=st,e.MeshPhongMaterial=Yt,e.MeshLambertMaterial=Zt,e.MeshBasicMaterial=Re,e.Material=J,e.Float64BufferAttribute=_e,e.Float32BufferAttribute=xe,e.Uint32BufferAttribute=we,e.Int32BufferAttribute=be,e.Uint16BufferAttribute=ye,e.Int16BufferAttribute=ve,e.Uint8ClampedBufferAttribute=ge,e.Uint8BufferAttribute=me,e.Int8BufferAttribute=pe,e.BufferAttribute=fe,e.REVISION=Xn,e.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2},e.CullFaceNone=Kn,e.CullFaceBack=Yn,e.CullFaceFront=Zn,e.CullFaceFrontBack=3,e.FrontFaceDirectionCW=Jn,e.FrontFaceDirectionCCW=1,e.BasicShadowMap=0,e.PCFShadowMap=Qn,e.PCFSoftShadowMap=$n,e.FrontSide=er,e.BackSide=tr,e.DoubleSide=ir,e.FlatShading=1,e.SmoothShading=2,e.NoColors=nr,e.FaceColors=rr,e.VertexColors=or,e.NoBlending=ar,e.NormalBlending=sr,e.AdditiveBlending=lr,e.SubtractiveBlending=cr,e.MultiplyBlending=hr,e.CustomBlending=ur,e.AddEquation=dr,e.SubtractEquation=fr,e.ReverseSubtractEquation=pr,e.MinEquation=mr,e.MaxEquation=gr,e.ZeroFactor=vr,e.OneFactor=yr,e.SrcColorFactor=br,e.OneMinusSrcColorFactor=wr,e.SrcAlphaFactor=xr,e.OneMinusSrcAlphaFactor=_r,e.DstAlphaFactor=Mr,e.OneMinusDstAlphaFactor=Tr,e.DstColorFactor=Sr,e.OneMinusDstColorFactor=Er,e.SrcAlphaSaturateFactor=Cr,e.NeverDepth=Pr,e.AlwaysDepth=Lr,e.LessDepth=kr,e.LessEqualDepth=Ar,e.EqualDepth=Rr,e.GreaterEqualDepth=Or,e.GreaterDepth=Ir,e.NotEqualDepth=Br,e.MultiplyOperation=Dr,e.MixOperation=Ur,e.AddOperation=zr,e.NoToneMapping=Nr,e.LinearToneMapping=jr,e.ReinhardToneMapping=Fr,e.Uncharted2ToneMapping=Gr,e.CineonToneMapping=Hr,e.UVMapping=300,e.CubeReflectionMapping=Vr,e.CubeRefractionMapping=Wr,e.EquirectangularReflectionMapping=qr,e.EquirectangularRefractionMapping=Xr,e.SphericalReflectionMapping=Kr,e.CubeUVReflectionMapping=Yr,e.CubeUVRefractionMapping=Zr,e.RepeatWrapping=Jr,e.ClampToEdgeWrapping=Qr,e.MirroredRepeatWrapping=$r,e.NearestFilter=eo,e.NearestMipMapNearestFilter=to,e.NearestMipMapLinearFilter=io,e.LinearFilter=no,e.LinearMipMapNearestFilter=ro,e.LinearMipMapLinearFilter=oo,e.UnsignedByteType=ao,e.ByteType=so,e.ShortType=lo,e.UnsignedShortType=co,e.IntType=ho,e.UnsignedIntType=uo,e.FloatType=fo,e.HalfFloatType=po,e.UnsignedShort4444Type=mo,e.UnsignedShort5551Type=go,e.UnsignedShort565Type=vo,e.UnsignedInt248Type=yo,e.AlphaFormat=bo,e.RGBFormat=wo,e.RGBAFormat=xo,e.LuminanceFormat=_o,e.LuminanceAlphaFormat=Mo,e.RGBEFormat=To,e.DepthFormat=So,e.DepthStencilFormat=Eo,e.RGB_S3TC_DXT1_Format=Co,e.RGBA_S3TC_DXT1_Format=Po,e.RGBA_S3TC_DXT3_Format=Lo,e.RGBA_S3TC_DXT5_Format=ko,e.RGB_PVRTC_4BPPV1_Format=Ao,e.RGB_PVRTC_2BPPV1_Format=Ro,e.RGBA_PVRTC_4BPPV1_Format=Oo,e.RGBA_PVRTC_2BPPV1_Format=Io,e.RGB_ETC1_Format=Bo,e.LoopOnce=2200,e.LoopRepeat=Do,e.LoopPingPong=2202,e.InterpolateDiscrete=2300,e.InterpolateLinear=2301,e.InterpolateSmooth=2302,e.ZeroCurvatureEnding=Uo,e.ZeroSlopeEnding=2401,e.WrapAroundEnding=2402,e.TrianglesDrawMode=zo,e.TriangleStripDrawMode=No,e.TriangleFanDrawMode=jo,e.LinearEncoding=Fo,e.sRGBEncoding=Go,e.GammaEncoding=Ho,e.RGBEEncoding=Vo,e.LogLuvEncoding=3003,e.RGBM7Encoding=Wo,e.RGBM16Encoding=qo,e.RGBDEncoding=Xo,e.BasicDepthPacking=Ko,e.RGBADepthPacking=Yo,e.CubeGeometry=Pe,e.Face4=function(e,t,i,n,r,o,a){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new ue(e,t,i,r,o,a)},e.LineStrip=0,e.LinePieces=1,e.MeshFaceMaterial=function(e){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),e},e.MultiMaterial=function(e){return void 0===e&&(e=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,e.materials=e,e.clone=function(){return e.slice()},e},e.PointCloud=function(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new yt(e,t)},e.Particle=function(e){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new lt(e)},e.ParticleSystem=function(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new yt(e,t)},e.PointCloudMaterial=function(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new vt(e)},e.ParticleBasicMaterial=function(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new vt(e)},e.ParticleSystemMaterial=function(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new vt(e)},e.Vertex=function(e,t,i){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new o(e,t,i)},e.DynamicBufferAttribute=function(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead."),new fe(e,t).setDynamic(!0)},e.Int8Attribute=function(e,t){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new pe(e,t)},e.Uint8Attribute=function(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new me(e,t)},e.Uint8ClampedAttribute=function(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new ge(e,t)},e.Int16Attribute=function(e,t){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new ve(e,t)},e.Uint16Attribute=function(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new ye(e,t)},e.Int32Attribute=function(e,t){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new be(e,t)},e.Uint32Attribute=function(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new we(e,t)},e.Float32Attribute=function(e,t){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new xe(e,t)},e.Float64Attribute=function(e,t){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new _e(e,t)},e.ClosedSplineCurve3=Vn,e.SplineCurve3=Wn,e.Spline=qn,e.AxisHelper=function(e){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new Un(e)},e.BoundingBoxHelper=function(e,t){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new On(e,t)},e.EdgesHelper=function(e,t){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new mt(new EdgesGeometry(e.geometry),new ft({color:void 0!==t?t:16777215}))},e.WireframeHelper=function(e,t){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new mt(new WireframeGeometry(e.geometry),new ft({color:void 0!==t?t:16777215}))},e.XHRLoader=function(e){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new $t(e)},e.BinaryTextureLoader=function(e){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new ti(e)},e.GeometryUtils=Ua,e.ImageUtils=za,e.Projector=function(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js."),this.projectVector=function(e,t){console.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pickingRay=function(){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}},e.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js"),this.domElement=document.createElement("canvas"),this.clear=function(){},this.render=function(){},this.setClearColor=function(){},this.setSize=function(){}},Object.defineProperty(e,"__esModule",{value:!0})})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.REPORTERTIMEOUT=t.VERSION=t.loader=t.FRUSTUMSIZE=t.BLOCK=t.AUDIO=t.CAMERA=t.WAVE=t.GAME=t.PARTICLE=t.BOTTLE=t.COLORS=void 0;var n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i(0)),r=(t.COLORS={red:13387325,pureRed:16711680,white:14209233,brown:5845806,pink:15964855,brownDark:2300175,blue:40951,yellow:16760320,pureWhite:16777215,orange:16231020,orangeDark:16747520,black:0,cream:16119285,green:2924391,lightBlue:13758190,cyan:9692366,yellowBrown:16764811,purple:9083606},t.BOTTLE={headRadius:.945,bodyWidth:2.34,bodyDepth:2.34,bodyHeight:3.2,reduction:.005,minScale:.5,velocityYIncrement:15,velocityY:135,velocityZIncrement:70}),o=(t.PARTICLE={radius:.3,detail:2},t.GAME={BOTTOMBOUND:-55,TOPBOUND:41,gravity:720,touchmoveTolerance:20,LEFTBOUND:-140,topTrackZ:-30,rightBound:90,HEIGHT:window.innerHeight||736,WIDTH:window.innerWidth||414,canShadow:!0});t.WAVE={innerRadius:2.2,outerRadius:3,thetaSeg:25},t.CAMERA={fov:60},t.AUDIO={success:"res/success.mp3",perfect:"res/perfect.mp3",scale_loop:"res/scale_loop.mp3",scale_intro:"res/scale_intro.mp3",restart:"res/start.mp3",fall:"res/fall.mp3",fall_2:"res/fall_2.mp3",combo1:"res/combo1.mp3",combo2:"res/combo2.mp3",combo3:"res/combo3.mp3",combo4:"res/combo4.mp3",combo5:"res/combo5.mp3",combo6:"res/combo6.mp3",combo7:"res/combo7.mp3",combo8:"res/combo8.mp3",icon:"res/icon.mp3",pop:"res/pop.mp3",sing:"res/sing.mp3",store:"res/store.mp3",water:"res/water.mp3"},t.BLOCK={radius:5,width:10,minRadiusScale:.8,maxRadiusScale:1,height:5.5,radiusSegments:[4,50],floatHeight:0,minDistance:1,maxDistance:17,minScale:r.minScale,reduction:r.reduction,moveDownVelocity:.07,fullHeight:5.5/21*40},t.FRUSTUMSIZE=o.HEIGHT/o.WIDTH/736*414*60,t.loader=new n.TextureLoader,t.VERSION=2,t.REPORTERTIMEOUT=60001},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){var i=t?e+"("+t+")":e;wx.showModal({title:"提示",content:i,showCancel:!1})}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();t.upLoadVerifyPic=function(e){var t=e.path||"",i=e.succ||function(){console.log("upLoadVerifyPic need succ func")},n=e.complete||function(){console.log("upLoadVerifyPic need complete func")},o=a.default.sessionId||"";if(!t||!o)return console.log("upLoadVerifyPic need session_id："+o+"upLoadVerifyPic need path："+t),n(),void r("提交失败","n0");console.log(c.AJAX_URL+"/wxagame/wxagame_filetransfer?action=preview"),wx.uploadFile({url:c.AJAX_URL+"/wxagame/wxagame_filetransfer?action=preview",filePath:t,name:"file",formData:{base_req:JSON.stringify({session_id:o,fast:1})},success:function(e){if(console.log("upLoadVerifyPic success",e),200==e.statusCode)if(e.data){var t=JSON.parse(e.data);if(t.base_resp&&0==t.base_resp.errcode){var n=t.content;i(n)}else r("提交失败","e"+t.base_resp.errcode)}else r("提交失败","no res data");else r("提交失败","s"+e.statusCode)},fail:function(e){console.log("upLoadVerifyPic fail",e),r("提交失败","n1")},complete:function(){n()}})},t.upLoadVerifySubmit=function(e){var t=a.default.sessionId||"",i=e.complete||function(){console.log("upLoadVerifySubmit need complete func")},n=e.succ||function(){console.log("upLoadVerifySubmit need succ func")},o=String(e.name),s=String(e.mobile),l=String(e.fileid),h=Number.parseInt(e.is_async)||0;if(!t)return console.log("upLoadVerifySubmit need session_id："+t),r("提交失败","n0"),void i();var u={base_req:{session_id:a.default.sessionId,fast:1},name:o,phone_number:s,photo_id:l,is_async:h};wx.request({url:c.AJAX_URL+"/wxagame/wxagame_appeal?action=submit",method:"POST",data:u,success:function(e){200===e.statusCode?e.data&&e.data.base_resp&&0===e.data.base_resp.errcode?n():r("提交失败","e"+e.data.base_resp.errcode):r("提交失败","s"+e.statusCode)},fail:function(){r("提交失败","n1")},complete:function(){i()}})};var a=n(i(6)),s=n(i(3)),l=i(69),c={AJAX_URL:"https://mp.weixin.qq.com"},h=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return o(e,null,[{key:"onServerConfigForbid",value:function(e){this.emmitServerConfigForbid=e}},{key:"getUserInfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},t={base_req:{session_id:a.default.sessionId,fast:1}};wx.request({url:c.AJAX_URL+"/wxagame/wxagame_getuserinfo",method:"POST",data:t,success:function(t){if(200===t.statusCode&&0===t.data.base_resp.errcode){e(t.data);var i={nickname:t.data.nickname,headimg:t.data.headimg};s.default.saveMyUserInfo(i)}},fail:function(e){}})}},{key:"requestLogin",value:function(e){e||(e=function(){}),wx.login({success:function(t){t.code?(a.default.setLoginState(t.code),e(!0)):e(!1)},fail:function(t){e(!1)}})}},{key:"requestFriendsScore",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};if(!a.default.serverConfig||a.default.serverConfig.friends_score_switch)if(a.default.sessionId){var t={base_req:{session_id:a.default.sessionId,fast:1}};wx.request({url:c.AJAX_URL+"/wxagame/wxagame_getfriendsscore",method:"POST",data:t,success:function(t){200===t.statusCode&&0===t.data.base_resp.errcode?e(!0,t.data):e&&e(!1)},fail:function(t){e(!1,!1)}})}else e(!1)}},{key:"requestSettlement",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(a.default.sessionId){var r={score:e,times:t,game_data:JSON.stringify(n)},o={base_req:{session_id:a.default.sessionId,fast:1},action_data:(0,l.encrypt)(r,a.default.sessionId)};wx.request({url:c.AJAX_URL+"/wxagame/wxagame_settlement",method:"POST",data:o,success:function(e){if(200===e.statusCode)if(0===e.data.base_resp.errcode){var t=e.data.cheater_status||0;if(1==(e.data.appeal_status||0))i(!0,{banType:2});else switch(t){case 1:i(!0,{banType:3});break;case 2:i(!0,{banType:1});break;default:i(!0,{banType:0})}}else i(!1,"e"+e.data.base_resp.errcode);else i(!1,"s"+e.statusCode)},fail:function(e){i(!1,"n1")}})}else i(!1,"n0")}},{key:"requestCreateGame",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};if(!a.default.serverConfig||a.default.serverConfig.audience_mode_switch){a.default.sessionId||this.reGetSessionId("requestCreateGame",e);var t={base_req:{session_id:a.default.sessionId,fast:1}};wx.request({url:c.AJAX_URL+"/wxagame/wxagame_creategame",method:"POST",data:t,success:function(t){200===t.statusCode&&0===t.data.base_resp.errcode?e(!0,t):e(!1)},fail:function(t){e(!1)}})}else e(!1,"当前围观人数过多，请稍后再试")}},{key:"reGetSessionId",value:function(e,t){var i=this;s.default.clearSessionId(),this.requestLogin(function(n){n?t?i[e](t):i[e]():t&&t(!1)})}},{key:"requestInit",value:function(e){if(a.default.sessionId)if(a.default.serverConfig){var t=a.default.serverConfig.version;this.requestServerInit(t,e)}else this.requestServerInit(0,e)}},{key:"requestServerInit",value:function(e,t){var i={base_req:{session_id:a.default.sessionId,fast:1},version:e};wx.request({url:c.AJAX_URL+"/wxagame/wxagame_init",method:"POST",data:i,success:function(e){200===e.statusCode&&0===e.data.base_resp.errcode&&((e.data.version>a.default.serverConfig.version||!a.default.serverConfig.version)&&(a.default.setServerConfig(e.data),s.default.saveServerConfig(e.data)),e.data.current_skin&&t&&t(e.data))},fail:function(e){}})}},{key:"getGroupScore",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};if(a.default.sessionId){var t={base_req:{session_id:a.default.sessionId,fast:1,group_info:{share_ticket:a.default.shareTicket}}};wx.request({url:c.AJAX_URL+"/wxagame/wxagame_getgrouprank",method:"POST",data:t,success:function(t){200===t.statusCode&&0===t.data.base_resp.errcode?e(!0,t):e(!1)},fail:function(t){e(!1)}})}else e(!1)}},{key:"createPK",value:function(e){return new Promise(function(t,i){if(a.default.sessionId){wx.showLoading();var n={base_req:{session_id:a.default.sessionId,fast:1},score:e};wx.request({url:c.AJAX_URL+"/wxagame/wxagame_createpk",method:"POST",data:n,success:function(e){200===e.statusCode&&0===e.data.base_resp.errcode?(a.default.setPkId(e.data.pk_id),t()):i()},fail:function(e){i()},complete:function(){wx.hideLoading()}})}else i()})}},{key:"getBattleData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},t=arguments[1];if(a.default.sessionId&&t){var i={base_req:{session_id:a.default.sessionId,fast:1},pk_id:t};a.default.shareTicket&&(i.base_req.group_info={share_ticket:a.default.shareTicket}),wx.request({url:c.AJAX_URL+"/wxagame/wxagame_getpkinfo",method:"POST",data:i,success:function(t){200===t.statusCode&&0===t.data.base_resp.errcode?e(!0,t):e(!1)},fail:function(t){e(!1)}})}else e(!1)}},{key:"updatepkinfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},t=arguments[1],i=arguments[2];if(a.default.sessionId&&t){var n={base_req:{session_id:a.default.sessionId,fast:1},pk_id:t,score:i};wx.request({url:c.AJAX_URL+"/wxagame/wxagame_updatepkinfo",method:"POST",data:n,success:function(t){200===t.statusCode&&0===t.data.base_resp.errcode?e(!0,t):e(!1)},fail:function(t){e(!1)}})}else e(!1)}},{key:"quitGame",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};if(a.default.gameId||a.default.sessionId){var t={base_req:{session_id:a.default.sessionId,fast:1},game_id:a.default.gameId};wx.request({url:c.AJAX_URL+"/wxagame/wxagame_quitgame",method:"POST",data:t,success:function(t){200===t.statusCode&&0===t.data.base_resp.errcode?e(!0,t):e(!1)},fail:function(t){e(!1)}})}else e(!1)}},{key:"syncop",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};if(a.default.gameId||a.default.sessionId){var t={base_req:{session_id:a.default.sessionId,fast:1},game_id:a.default.gameId};wx.request({url:c.AJAX_URL+"/wxagame/wxagame_syncop",method:"POST",data:t,success:function(t){200===t.statusCode&&0===t.data.base_resp.errcode?e(!0,t):e(!1)},fail:function(t){e(!1)}})}else callback(!1)}},{key:"sendReport",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(a.default.sessionId){var i={base_req:{session_id:a.default.sessionId,fast:1,client_info:t},report_list:e};wx.request({url:c.AJAX_URL+"/wxagame/wxagame_bottlereport",method:"POST",data:i,success:function(e){},fail:function(){}})}}},{key:"badReport",value:function(e,t){var i=wx.getSystemInfoSync(),n=a.default.sessionId||"",e="model:"+i.model+",SDKVersion:"+i.SDKVersion+",version:"+i.version+",sessionId:"+n+",errmsg:"+e+",stack:"+t;wx.request({url:"https://badjs.weixinbridge.com/badjs",data:{id:130,level:4,msg:e},success:function(e){},fail:function(e){}})}},{key:"sendServerError",value:function(e){if(a.default.sessionId){var t={base_req:{session_id:a.default.sessionId,fast:1},id:1,key:e};wx.request({url:c.AJAX_URL+"/wxagame/wxagame_jsreport",method:"POST",data:t,success:function(e){},fail:function(){}})}}}]),e}();t.default=h},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,null,[{key:"getFriendsScore",value:function(){try{var e=wx.getStorageSync("friends_score")||[];return e=e&&e.ts?e.ts<Date.now()?[]:e.data:[]}catch(e){return[]}}},{key:"saveFriendsScore",value:function(e){wx.setStorage({key:"friends_score",data:e,success:function(e){},fail:function(e){}})}},{key:"saveMyUserInfo",value:function(e){wx.setStorage({key:"my_user_info",data:e,success:function(e){},fail:function(e){}})}},{key:"saveHeighestScore",value:function(e){wx.setStorage({key:"my_heighest_score",data:e,success:function(e){},fail:function(e){}})}},{key:"getHeighestScore",value:function(){try{return wx.getStorageSync("my_heighest_score")||!1}catch(e){return!1}}},{key:"getMyUserInfo",value:function(){try{return wx.getStorageSync("my_user_info")||!1}catch(e){return!1}}},{key:"saveSessionId",value:function(e){wx.setStorage({key:"session_id",data:e,success:function(e){},fail:function(e){}})}},{key:"getSessionId",value:function(e){try{return wx.getStorageSync("session_id")||""}catch(e){return""}}},{key:"clearSessionId",value:function(){wx.removeStorage({key:"session_id",success:function(e){},fail:function(e){}})}},{key:"saveServerConfig",value:function(e){wx.setStorage({key:"server_config",data:e,success:function(e){},fail:function(e){}})}},{key:"getServerConfig",value:function(){try{return wx.getStorageSync("server_config")||0}catch(e){return 0}}},{key:"getFirstBlood",value:function(){try{return wx.getStorageSync("first_blood")||0}catch(e){return 0}}},{key:"saveFirstBlood",value:function(){wx.setStorage({key:"first_blood",data:1,success:function(e){},fail:function(e){}})}},{key:"getHistoryTimes",value:function(){try{return wx.getStorageSync("history_Times2")||!1}catch(e){return!1}}},{key:"saveHistoryTimes",value:function(e){wx.setStorage({key:"history_Times2",data:e,success:function(e){},fail:function(e){}})}},{key:"saveActionData",value:function(e){wx.setStorage({key:"action_data0",data:e,success:function(e){},fail:function(e){}})}},{key:"getActionData",value:function(){try{return wx.getStorageSync("action_data0")||!1}catch(e){return!1}}},{key:"saveWeekBestScore",value:function(e){wx.setStorage({key:"weeek_best_score0",data:e,success:function(e){},fail:function(e){}})}},{key:"getWeekBestScore",value:function(){try{var e=wx.getStorageSync("weeek_best_score0")||0;return e&&e.ts&&(e=e.ts<Date.now()?0:e.data),e}catch(e){return 0}}}]),e}();t.default=r},function(e,t,i){"use strict";function n(e){(e=Object.assign({},{self:{},type:"bg"},e)).self.showState&&(e.self.canvasType==x.gameOver&&"bg"!=e.type&&"btn"!=e.type&&"sample"!=e.type||e.self.canvasType==x.start&&"bg"!=e.type&&"btn"!=e.type&&"sample"!=e.type||(e.self.texture[e.type].needsUpdate=!0,e.self.obj[e.type].visible=!0,e.self.options.camera.add(e.self.obj[e.type])))}function r(e,t){if(e&&t){e.distanceToPoint(t)<0&&e.negate()}}function o(e){if(!T){e.showState=!1;for(var t=0;t<w.length;t++)e.obj[w[t]]&&(e.obj[w[t]].visible=!1,e.options.camera.remove(e.obj[w[t]]))}}function a(e){var t=e*g/414;return v/g<736/414&&(t=e*v/736),t*m}function s(e){var t=e*g/414;return v/g<736/414&&(t=e*v/736+(g-414*v/736)/2),t*m}function l(e){return(v/g>736/414?e*g/414+(v-736*g/414)/2:e*v/736)*m}function c(e){"/0"!=(e=Object.assign({},{self:{},src:"",pos:[0,0,100,100],type:"bg",cb:null,imgid:0,noupdate:!1,round:!1},e)).src&&"/96"!=e.src&&"/64"!=e.src&&e.src||(e.src="res/ava.png");var t=new Image,i=e.self.context[e.type];t.onload=function(){if(e.self.imgid[e.type]==e.imgid){if(e.round){i.save();var r=void 0;r="list1"==e.type||"list2"==e.type?a(e.pos[1])-a(e.pos[3])/2:l(e.pos[1])-a(e.pos[3])/2,h(s(e.pos[0])-a(e.pos[2])/2,r,a(e.pos[2]),a(e.pos[3]),2,i),i.clip(),i.drawImage(t,s(e.pos[0])-a(e.pos[2])/2,r,a(e.pos[2]),a(e.pos[3])),i.closePath(),i.restore()}else"list1"==e.type||"list2"==e.type?i.drawImage(t,s(e.pos[0])-a(e.pos[2])/2,a(e.pos[1])-a(e.pos[3])/2,a(e.pos[2]),a(e.pos[3])):i.drawImage(t,s(e.pos[0])-a(e.pos[2])/2,l(e.pos[1])-a(e.pos[3])/2,a(e.pos[2]),a(e.pos[3]));!!e.cb&&e.cb(),e.noupdate||n({self:e.self,type:e.type})}},t.onerror=function(){!!e.cb&&e.cb()},t.src=e.src}function h(e,t,i,n,r,o){o.beginPath(),o.moveTo(e,t+r-1),o.lineTo(e,t+n-r),o.quadraticCurveTo(e,t+n,e+r,t+n),o.lineTo(e+i-r,t+n),o.quadraticCurveTo(e+i,t+n,e+i,t+n-r),o.lineTo(e+i,t+r),o.quadraticCurveTo(e+i,t,e+i-r,t),o.lineTo(e+r,t),o.quadraticCurveTo(e,t,e,t+r),o.stroke(),o.closePath()}function u(e){var t=(e=Object.assign({},{self:{},t:"",size:17,pos:[0,0],type:"bg",special:!1,align:"center",color:"#fff",bold:!1,italic:!1},e)).self.context[e.type],i=function(e,t){var i=e*m*g/414;return v/g<736/414&&(i=e*m*v/736),t&&C?i+"px "+C:i+"px Helvetica"}(e.size,e.special);e.bold&&(i="bold "+i),e.italic&&(i="italic "+i),t.font=i,t.textBaseline="middle",t.textAlign=e.align,t.fillStyle=e.color,"list1"==e.type||"list2"==e.type?t.fillText(e.t,s(e.pos[0]),a(e.pos[1])):t.fillText(e.t,s(e.pos[0]),l(e.pos[1]))}function d(e,t){return(e=e||"").replace(/[^\x00-\xff]/g,"**").length>t&&(e=d(e=e.substring(0,e.length-1),t)),e}Object.defineProperty(t,"__esModule",{value:!0}),t.ListLineHeight=t.DEBUG=t.CANVASTYPE=t.WIDTH=t.HEIGHT=t.Dpr=void 0,t.createPlane=function(e){if(e){var t=e.self;if(o(t),t.showState=!0,!t.canvas.bg){T&&(w=["sample","btn","bg","list1","list2"]);for(var i=0;i<w.length;i++)t.canvas[w[i]]=document.createElement("canvas"),t.context[w[i]]=t.canvas[w[i]].getContext("2d"),t.canvas[w[i]].width=b,"list1"==w[i]||"list2"==w[i]?t.canvas[w[i]].height=10*a(E):t.canvas[w[i]].height=y,t.texture[w[i]]=new f.Texture(t.canvas[w[i]]),t.material[w[i]]=new f.MeshBasicMaterial({map:t.texture[w[i]],transparent:!0}),"list1"==w[i]||"list2"==w[i]?t.geometry[w[i]]=new f.PlaneBufferGeometry(M,10*a(E)/y*_):t.geometry[w[i]]=new f.PlaneBufferGeometry(M,_),t.obj[w[i]]=new f.Mesh(t.geometry[w[i]],t.material[w[i]]),t.material[w[i]].map.minFilter=f.LinearFilter,t.obj[w[i]].position.y=0,t.obj[w[i]].position.x=0,t.obj[w[i]].position.z=9-.001*i;T&&S&&(t.context.sample.globalAlpha=.4,setTimeout(function(){c({self:t,src:"res/sample.png",pos:[207,368,414,736],type:"sample"})},2e3))}}},t.updatePlane=n,t.updateClip=function(e){var t=e.self;t.p0||(t.p0=new f.Vector3(0,0,9),t.p1=new f.Vector3(-M*(.5-s(30)/b),(.5-l(143)/y)*_,9),t.p2=new f.Vector3(M*(.5-s(30)/b),_*(.5-l(143)/y),9),t.p3=new f.Vector3(M*(.5-s(30)/b),-_*(.5-l(144)/y),9),t.p4=new f.Vector3(-M*(.5-s(30)/b),-_*(.5-l(144)/y),9)),t.p5||(t.p5=new f.Vector3(-M*(.5-s(30)/b),(.5-l(205)/y)*_,9),t.p6=new f.Vector3(M*(.5-s(30)/b),_*(.5-l(205)/y),9),t.p7=new f.Vector3(M*(.5-s(30)/b),-_*(.5-l(104)/y),9),t.p8=new f.Vector3(-M*(.5-s(30)/b),-_*(.5-l(104)/y),9));var i=t.p0.clone(),n=t.p1.clone(),o=t.p2.clone(),a=t.p3.clone(),c=t.p4.clone();t.canvasType==x.pk&&(n=t.p5.clone(),o=t.p6.clone(),a=t.p7.clone(),c=t.p8.clone()),t.options.camera.updateMatrixWorld();var h=t.options.camera.matrixWorld;i.applyMatrix4(h),n.applyMatrix4(h),o.applyMatrix4(h),a.applyMatrix4(h),c.applyMatrix4(h);var u=new f.Triangle(o,n),d=u.plane();r(d,i.clone());var p=(u=new f.Triangle(a,o)).plane();r(p,i.clone());var m=(u=new f.Triangle(c,a)).plane();r(m,i.clone());var g=(u=new f.Triangle(n,c)).plane();r(g,i.clone()),t.material.list1.clippingPlanes=[d,p,m,g],t.material.list1.needsUpdate=!0,t.material.list2.clippingPlanes=[d,p,m,g],t.material.list2.needsUpdate=!0},t.hide=o,t.cwh=a,t.cx=s,t.cy=l,t.rerank=function(e){for(var t,i,n=0,r=e.length;n<r;n++)for(t=0;t<r;t++)e[n].week_best_score>e[t].week_best_score&&(i=e[t],e[t]=e[n],e[n]=i);return e},t.drawImageCenter=c,t.roundedRect=h,t.drawText=u,t.routeCanvas=function(e,t){e.lastCanvasType=e.canvasType,e.canvasType=x[t]},t.cname=function(e,t){return t=t||16,(e=e||"").replace(/[^\x00-\xff]/g,"**").length>t&&(e=d(e,t)+"..."),e},t.findSelfIndex=function(e,t,i){return e.nickname===this.myUserInfo.nickname&&e.week_best_score===this.myUserInfo.week_best_score};var f=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i(0)),p=i(1),m=t.Dpr=window.devicePixelRatio>2?2:window.devicePixelRatio,g=window.innerHeight<window.innerWidth?window.innerHeight:window.innerWidth,v=window.innerHeight>window.innerWidth?window.innerHeight:window.innerWidth,y=t.HEIGHT=v*m,b=t.WIDTH=g*m,w=["btn","bg","list1","list2"],x=t.CANVASTYPE={friendRank:0,groupRank:1,gameOver:2,start:3,pk:4,lookers:5,gameOverNew:6,gameOverHighest:7,beginner:8,verify:9},_=p.FRUSTUMSIZE,M=b/y*_,T=t.DEBUG=!1,S=!1,E=t.ListLineHeight=60,C=wx.loadFont("res/num.ttf")},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TweenAnimation=t.customAnimation=void 0;var n=function(e){return e&&e.__esModule?e:{default:e}}(i(44)),r=-1,o=r-1;(t.customAnimation={}).to=function(e,t,i){t*=1e3;var n=i.delay||0;for(var r in i)"delay"===r?n=i[r]:"onComplete"===r||"ease"===r||setTimeout(function(n){return function(){a(e[n],i[n],t,i.ease||"Linear",function(t,r){e[n]=t,r&&i.onComplete&&i.onComplete()})}}(r),1e3*n)};var a=t.TweenAnimation=function(e,t,i,a,s){var l=++r,c=function(e){return"function"==typeof e},h=function(e){return"number"==typeof e},u=function(e){return"string"==typeof e},d=function(e){if(h(e))return e;if(u(e)){if(/\d+m?s$/.test(e))return/ms/.test(e)?1*e.replace("ms",""):1e3*e.replace("s","");if(/^\d+$/.test(e))return+e}return-1};if(!h(e)||!h(t))return window.console&&console.error("from和to两个参数必须且为数值"),0;var f=n.default;if(!f)return window.console&&console.error("缓动算法函数缺失"),0;var p={duration:300,easing:"Linear",callback:function(){}},m=function(e){c(e)?p.callback=e:-1!=d(e)?p.duration=d(e):u(e)&&(p.easing=e)};m(i),m(a),m(s),window.requestAnimationFrame||(requestAnimationFrame=function(e){setTimeout(e,17)});var g=-1,v=Math.ceil(p.duration/17);p.easing=p.easing.slice(0,1).toUpperCase()+p.easing.slice(1);var y,b=p.easing.split(".");if(1==b.length?y=f[b[0]]:2==b.length&&(y=f[b[0]]&&f[b[0]][b[1]]),0!=c(y)){var w=Date.now(),x=Date.now();!function i(){var n=Date.now(),r=n-x,a=Math.ceil(1e3/r);if(x=n,r>100)requestAnimationFrame(i);else{if(a>=30)g++;else{var s=Math.floor((n-w)/17);g=s>g?s:g+1}var c=y(g,e,t-e,v);g<=v&&l>o?(p.callback(c),requestAnimationFrame(i)):g>v&&l>o&&p.callback(t,!0)}}()}else console.error('没有找到名为"'+p.easing+'"的动画算法')};a.killAll=function(){o=r}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,null,[{key:"init",value:function(){this.sessionId="",this.gameId="",this.gameTicket="",this.serverConfig="",this.shareTicket="",this.pkId="",this.serverConfig=""}},{key:"setLoginState",value:function(e){this.sessionId=e}},{key:"setGameId",value:function(e){this.gameId=e}},{key:"setGameTicket",value:function(e){this.gameTicket=e}},{key:"setServerConfig",value:function(e){this.serverConfig=e}},{key:"setShareTicket",value:function(e){this.shareTicket=e}},{key:"setPkId",value:function(e){this.pkId=e}},{key:"clearPkId",value:function(){this.pkId=""}},{key:"clearGameId",value:function(){this.gameId=""}},{key:"clearShareTicket",value:function(){this.ShareTicket=""}},{key:"clearGameTicket",value:function(){this.gameTicket=""}},{key:"setServerConfig",value:function(e){this.serverConfig=e}}]),e}();t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(e){return e&&e.__esModule?e:{default:e}}(i(67)),o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t=t||{},this._options=t,this._itemSize=t.itemSize||0,this._innerOffsetHeight=t.innerOffsetHeight||0,this._outterOffsetHeight=t.outterOffsetHeight||0,this._extent=this._innerOffsetHeight-this._outterOffsetHeight,this._position=0,this._scroll=new r.default(this._extent),this.updatePosition()}return n(e,[{key:"onTouchStart",value:function(){this._startPosition=this._position,this._lastChangePos=this._startPosition,this._startPosition>0?this._startPosition/=.5:this._startPosition<-this._extent&&(this._startPosition=(this._startPosition+this._extent)/.5-this._extent),this._animation&&(this._animation.cancel(),this._scrolling=!1),this.updatePosition()}},{key:"onTouchMove",value:function(e,t){var i=this._startPosition;(i+=t)>0?i*=.5:i<-this._extent&&(i=.5*(i+this._extent)-this._extent),this._position=i,this.updatePosition()}},{key:"onTouchEnd",value:function(e,t,i){var n=this;this._scroll.set(this._position,i.y),this._scrolling=!0,this._lastChangePos=this._position,this._animation=this.animation(this._scroll,function(){var e=(Date.now()-n._scroll._startTime)/1e3,t=n._scroll.x(e);n._position=t,n.updatePosition()},function(){n._scrolling=!1})}},{key:"scrollTo",value:function(e){this._animation&&(this._animation.cancel(),this._scrolling=!1),"number"==typeof e&&(this._position=-e),this._position<-this._extent?this._position=-this._extent:this._position>0&&(this._position=0),this.updatePosition()}},{key:"updatePosition",value:function(){this._options.updatePosition(this._position)}},{key:"animation",value:function(e,t,i){function n(t,i,r,o){if(!t||!t.cancelled){r(i);var a=e.done();a||t.cancelled||(t.id=requestAnimationFrame(n.bind(null,t,i,r,o))),a&&o&&o(i)}}var r={id:0,cancelled:!1};return n(r,e,t,i),{cancel:function(e){e&&e.id&&cancelAnimationFrame(e.id),e&&(e.cancelled=!0)}.bind(null,r),model:e}}}]),e}();t.default=o},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.shareGroupRank=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};wx.getNetworkType({success:function(t){"none"!==t.networkType?wx.updateShareMenu({withShareTicket:!0,success:function(){wx.shareAppMessage({title:"群雄逐鹿，看看你第几",query:"mode=groupShare",imageUrl:"http://mmbiz.qpic.cn/mmbiz_png/icTdbqWNOwNQ0ia79enzYJBrAavqMRykpovYxSA9RRTwIjde6a68ZCczLMBBd8eSoOyTRyp2Codc5IObdeqZVFyw/0?wx_fmt=png",success:function(t){e(!0,1)},fail:function(t){e(!1)}})}}):(e(!1),wx.showModal({title:"提示",content:"网络状态异常",showCancel:!1}))}})},t.shareBattle=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};a.getShareCard({score:t,type:"shareBattle"},function(t){var n="";try{n=t.toTempFilePathSync()}catch(e){console.log("shareBattle: ",e)}e&&wx.updateShareMenu({withShareTicket:!0,success:function(){wx.shareAppMessage({title:"小试牛刀，不服来战",query:"mode=battle&pkId="+e,imageUrl:n,success:function(t){i(!0,1),console.log("mode=battle&pkId="+e)},fail:function(){i(!1)}})},fail:function(e){i(!1)}})})},t.shareObserve=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},t=o.default.getMyUserInfo();t||(t={nickname:"",headimg:""}),console.log("query: ","gameId="+r.default.gameId+"&mode=observe&nickName="+t.nickname+"&headimg="+t.headimg),wx.updateShareMenu({withShareTicket:!0,success:function(){wx.shareAppMessage({title:"即刻起跳，速来围观",query:"gameId="+r.default.gameId+"&mode=observe&nickName="+t.nickname+"&headimg="+t.headimg,imageUrl:"http://mmbiz.qpic.cn/mmbiz_png/icTdbqWNOwNQ0ia79enzYJBiaBtXsYrvBsYBdBdDtKE7y638J84JKPckcOtFMp4QunIWFGc7pibQLm13s9fKZ9ic9ew/0?wx_fmt=png",success:function(t){e(!0,1)},fail:function(t){e(!1)}})},fail:function(){e(!1)}})},t.pureShare=function(e,t){a.getShareCard({type:e,score:t},function(t){var i="";try{i=t.toTempFilePathSync()}catch(e){console.log("pureShare: ",e)}var n="";n="rank"==e?"跳遍天下，已无敌手":"不好意思，又破纪录了",wx.shareAppMessage({title:n,imageUrl:i,success:function(e){},fail:function(e){}})})};var r=n(i(6)),o=n(i(3)),a=new(n(i(60)).default)({})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i(0)),o=(i(1),function(e){return e&&e.__esModule?e:{default:e}}(i(41))),a=function(){function e(t,i){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.material=new r.MeshBasicMaterial({color:i.fillStyle||16777215,transparent:!0}),i.opacity&&(this.material.opacity=i.opacity),this.options=i||{},this.obj=new r.Object3D,this.obj.name="text",i.chinese){var n=new r.Mesh(new r.TextBufferGeometry(t,{font:o.default,size:1,height:.1}),this.material);this.obj.add(n),"center"==i.textAlign&&(n.position.x=1.1*t.length/-2)}else{this.scores=[],this.plus=new r.Mesh(new r.TextBufferGeometry("+",{font:o.default,size:3,height:.1}),this.material);for(var a=this.options.sumScore?5:2,s=0;s<10;++s){for(var l=[],c=new r.TextBufferGeometry(s,{font:o.default,size:3,height:.1}),h=0;h<a;++h){var u=new r.Mesh(c,this.material);u.using=!1,l.push(u)}this.scores.push(l)}this.setScore(t)}}return n(e,[{key:"setScore",value:function(e){var t=2.5*(e=e.toString()).length,i=this.options.sumScore?5:2,n="center"==this.options.textAlign?-t/2:0;this.options.plusScore&&(n=-(t+2.5)/2,this.plus.position.x=n,this.obj.add(this.plus),n+=2.5);for(var r=0,o=this.scores.length;r<o;++r)for(s=0;s<i;++s)this.scores[r][s].using&&(this.obj.remove(this.scores[r][s]),this.scores[r][s].using=!1);for(var r=0,o=e.length;r<o;++r){for(var a=this.scores[e[r]],s=0;s<i;++s)if(!a[s].using){a[s].position.x=n,a[s].using=!0,this.obj.add(a[s]);break}n+=2.5}}},{key:"changeStyle",value:function(e){Object.assign(this.options,e),this.obj.updateMatrix()}}]),e}();t.default=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=void 0,r=function(){return n=(9301*n+49297)%233280,Math.floor(n/233280*100)/100};t.setRandomSeed=function(e){n=e},t.random=function(){if(0===arguments.length)return r();if(1===arguments.length){var e=arguments[0];return Math.floor(r()*e)}var t=arguments[0],i=arguments[1];return Math.floor(r()*(i-t))+t}},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=n(i(64)),a=n(i(63)),s=n(i(62)),l=n(i(61)),c=i(8),h=n(i(2)),u=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name="single",this.game=t,this.gameCtrl=this.game.gameCtrl,this.model=this.game.gameModel,this.view=this.game.gameView,this.modeCtrl=i,this.netWorkCtrl=this.gameCtrl.netWorkCtrl,this.gameSocket=this.game.gameSocket,this.startPage=new o.default(t),this.gamePage=new a.default(t),this.gameOverPage=new s.default(t),this.friendRankPage=new l.default(t),this.currentPage=null,this.lastPage=null,this.socketTimeout=null}return r(e,[{key:"init",value:function(e){this.startPage.show(),this.model.setStage(this.startPage.name),this.currentPage=this.startPage}},{key:"clickStart",value:function(){this.hideCurrentPage(),this.gamePage.show(),this.game.replayGame(),this.model.setStage(this.gamePage.name),this.currentPage=this.gamePage}},{key:"showGameOverPage",value:function(e){this.hideCurrentPage(),this.gameOverPage.show(e),this.model.clearPkId(),this.model.setStage(this.gameOverPage.name),this.currentPage=this.gameOverPage}},{key:"gameOverClickReplay",value:function(){this.clickStart()}},{key:"showFriendRank",value:function(){this.lastPage=this.currentPage,this.hideCurrentPage(),this.friendRankPage.show(),this.model.setStage(this.friendRankPage.name),this.currentPage=this.friendRankPage}},{key:"friendRankReturn",value:function(){this.hideCurrentPage(),this.lastPage.show(),this.model.setStage(this.lastPage.name),this.currentPage=this.lastPage}},{key:"shareGroupRank",value:function(){var e=this;(0,c.shareGroupRank)(function(t,i){e.gameCtrl.afterShareGroupRank(t,i)})}},{key:"clickRank",value:function(){this.showFriendRank()}},{key:"shareBattleCard",value:function(){var e=this,t=this.model.getSessionId(),i=this.model.currentScore,n=this.model.getPkId();t?n?this.afterHavePkId():h.default.createPK(i).then(function(){e.afterHavePkId()},function(){e.getPKErr()}).catch(function(e){return console.log(e)}):this.view.showNoSession()}},{key:"afterHavePkId",value:function(){var e=this,t=this.model.getPkId(),i=this.model.currentScore;(0,c.shareBattle)(t,i,function(t,i){e.gameCtrl.afterShareBattle(t,i)})}},{key:"getPKErr",value:function(){this.view.showGetPkIdFail()}},{key:"shareObservCard",value:function(){this.gamePage.hideLookersShare(),this.model.setStage("loading"),wx.showLoading();this.model.getSessionId()?this.afterLogin(!0):this.netWorkCtrl.netWorkLogin(this.afterLogin.bind(this))}},{key:"afterLogin",value:function(e){var t=this;e?h.default.requestCreateGame(function(e,i){e?(t.model.setGameId(i.data.game_id),t.model.setGameTicket(i.data.up_op_ticket),t.shareObservCardA()):t.shareObservCardFail(i)}):this.shareObservCardFail()}},{key:"shareObservCardFail",value:function(e){this.view.showShareObserveCardFail(e),this.model.clearGameId(),this.model.clearGameTicket(),"loading"==this.model.stage&&this.model.setStage("game"),this.clearSocketTimeout(),this.gameSocket.close(),wx.hideLoading()}},{key:"shareObservCardA",value:function(){this.socketTimeout=setTimeout(this.shareObservCardFail.bind(this),5e3),this.gameSocket.connectSocket()}},{key:"socketJoinSuccess",value:function(e){wx.hideLoading(),e?(this.clearSocketTimeout(),this.shareObservCardB()):this.shareObservCardFail()}},{key:"shareObservCardB",value:function(){var e=this;(0,c.shareObserve)(function(t,i){t&&e.gameCtrl.afterShareObserveCard(i),setTimeout(function(){"loading"==e.model.stage&&e.model.setStage("game"),e.modeCtrl.singleChangeToPlayer(),e.currentPage=null},50)})}},{key:"clearSocketTimeout",value:function(){null!=this.socketTimeout&&(clearTimeout(this.socketTimeout),this.socketTimeout=null)}},{key:"appealNotify",value:function(){this.currentPage===this.startPage&&this.startPage.show({banType:1})}},{key:"wxOnhide",value:function(){}},{key:"wxOnshow",value:function(){}},{key:"destroy",value:function(){this.hideCurrentPage(),this.currentPage=null,this.model.setStage(""),this.model.clearGameId(),this.model.clearGameTicket(),this.clearSocketTimeout(),this.game.resetScene()}},{key:"hideCurrentPage",value:function(){this.currentPage&&this.currentPage.hide()}}]),e}();t.default=u},function(e,t,i){"use strict";function n(e,t){if(e.imgid.btn++,!(e.changlleListStart+5*t<0||e.changlleListStart+5*t>=e.changlleList.length)){e.changlleListStart=e.changlleListStart+5*t;var i=e.changlleList.slice(e.changlleListStart,e.changlleListStart+5),n=i.length,o=32,a=207-(32*n+10*(n-1))/2;e.context.btn.clearRect((0,r.cx)(30),(0,r.cy)(448),(0,r.cwh)(354),(0,r.cwh)(55));for(var s=function(){var t=a+16+42*l;(0,r.drawImageCenter)({self:e,round:!0,src:i[l].headimg,pos:[t,469,o,o],type:"btn",cb:function(){(0,r.drawImageCenter)({self:e,src:"res/ava_rank.png",pos:[t,469,46,46],type:"btn",imgid:e.imgid.btn})},imgid:e.imgid.btn,noupdate:!0})},l=0;l<n;l++)s();e.changlleList.length>5&&e.changlleListStart+5<e.changlleList.length&&(0,r.drawImageCenter)({self:e,src:"res/r_arr1.png",pos:[339,469,6,8],type:"btn",imgid:e.imgid.btn}),e.changlleList.length>5&&0!=e.changlleListStart&&(0,r.drawImageCenter)({self:e,src:"res/l_arr.png",pos:[69,469,6,8],type:"btn",imgid:e.imgid.btn})}}Object.defineProperty(t,"__esModule",{value:!0}),t.drawGameOverHighest=function(e,t){var i=e.opt;e.imgid.bg++,i.score=i.score||0;var o=e.context.bg;if(o.clearRect(0,0,r.WIDTH,r.HEIGHT),o.fillStyle="rgba(0,0,0, 0.8)",o.fillRect(0,0,r.WIDTH,r.HEIGHT),(l=e.context.btn).clearRect((0,r.cx)(30),(0,r.cy)(448),(0,r.cwh)(354),(0,r.cwh)(55)),(0,r.drawText)({self:e,size:14,t:"历史最高分："+Math.max(i.highest_score,i.score),pos:[207,703]}),"history"==t||"week"==t){0==e.changlleList.length?(o.lineWidth=2*r.Dpr,o.strokeStyle="rgba(255,255,255,0.06)",o.fillStyle="rgba(0,0,0,0.6)",(0,r.roundedRect)((0,r.cx)(30),(0,r.cy)(104),(0,r.cwh)(354),(0,r.cwh)(371),4*r.Dpr,o),o.fill(),(0,r.drawImageCenter)({self:e,src:"res/pure_share.png",pos:[207,440,18,24],type:"bg",imgid:e.imgid.bg})):(o.lineWidth=2*r.Dpr,o.strokeStyle="rgba(255,255,255,0.06)",o.fillStyle="rgba(0,0,0,0.6)",(0,r.roundedRect)((0,r.cx)(30),(0,r.cy)(104),(0,r.cwh)(354),(0,r.cwh)(401),4*r.Dpr,o),o.fill(),o.lineWidth=.5*r.Dpr,o.strokeStyle="rgba(255,255,255,0.2)",o.beginPath(),o.moveTo((0,r.cx)(127),(0,r.cy)(406)),o.lineTo((0,r.cx)(287),(0,r.cy)(406)),o.stroke(),o.closePath(),(0,r.drawText)({self:e,size:14,t:"排名新超越"+e.changlleList.length+"位好友",pos:[207,429]}),e.changlleListStart=0,n(e,0),(0,r.drawImageCenter)({self:e,src:"res/pure_share.png",pos:[207,368,18,24],type:"bg",imgid:e.imgid.bg}));var a="",s="";"history"==t&&(e.opt.highest_score<100&&e.opt.score>=100&&(a="初窥门径",s="#509FC9"),e.opt.highest_score<500&&e.opt.score>=500&&(a="耐得寂寞",s="#E67600"),e.opt.highest_score<1e3&&e.opt.score>=1e3&&(a="登堂入室",s="#009D5E"),e.opt.highest_score<2e3&&e.opt.score>=2e3&&(a="无聊大师",s="#7A0096"),e.opt.highest_score<3e3&&e.opt.score>=3e3&&(a="一指禅",s="#555555"),e.opt.highest_score<5e3&&e.opt.score>=5e3&&(a="立地成佛",s="#AC8742")),a?(o.fillStyle=s,o.strokeStyle=s,o.lineWidth=1*r.Dpr,(0,r.roundedRect)((0,r.cx)(167),(0,r.cy)(154),(0,r.cwh)(80),(0,r.cwh)(26),2*r.Dpr,o),o.fill(),(0,r.drawText)({self:e,bold:!0,size:14,t:a,pos:[207,167]})):(0,r.drawImageCenter)({self:e,src:"res/new.png",pos:[207,167,58,26],type:"bg",imgid:e.imgid.bg}),(0,r.drawText)({self:e,size:14,t:"history"==t?"历史最高分":"本周最高分",pos:[207,224]}),(0,r.drawText)({self:e,size:86,special:!0,color:"#00c777",pos:[207,292.5],t:i.score})}"rank"==t&&((0,r.drawImageCenter)({self:e,src:"res/new.png",pos:[207,167,58,26],type:"bg",imgid:e.imgid.bg}),o.lineWidth=2*r.Dpr,o.strokeStyle="rgba(255,255,255,0.06)",o.fillStyle="rgba(0,0,0,0.6)",(0,r.roundedRect)((0,r.cx)(30),(0,r.cy)(104),(0,r.cwh)(354),(0,r.cwh)(371),4*r.Dpr,o),o.fill(),(0,r.drawImageCenter)({self:e,src:e.myUserInfo.headimg,pos:[207,291,56,56],type:"bg",cb:function(){(0,r.drawImageCenter)({self:e,src:"res/gold.png",pos:[207,253,40,40],type:"bg",imgid:e.imgid.bg})},imgid:e.imgid.bg}),(0,r.drawText)({self:e,size:14,t:"排行榜冠军",pos:[207,224]}),(0,r.drawText)({self:e,size:40,special:!0,t:i.score,pos:[207,349],color:"#00c777"}),(0,r.drawImageCenter)({self:e,src:"res/pure_share.png",pos:[207,415,18,24],type:"bg",imgid:e.imgid.bg})),o.fillStyle="rgba(255,255,255,0.2)",o.fillRect((0,r.cx)(155),(0,r.cy)(218.5),(0,r.cwh)(9),(0,r.cwh)(3)),o.fillRect((0,r.cx)(155),(0,r.cy)(224.5),(0,r.cwh)(9),(0,r.cwh)(3)),o.fillRect((0,r.cx)(248),(0,r.cy)(218.5),(0,r.cwh)(9),(0,r.cwh)(3)),o.fillRect((0,r.cx)(248),(0,r.cy)(224.5),(0,r.cwh)(9),(0,r.cwh)(3)),(0,r.drawImageCenter)({self:e,src:"res/close.png",pos:[375,112,43,43],type:"bg",imgid:e.imgid.bg});var l;(l=e.context.btn).clearRect((0,r.cx)(91),(0,r.cy)(547),(0,r.cwh)(232),(0,r.cwh)(94)),(0,r.drawImageCenter)({self:e,src:"res/replay.png",pos:[207,607,212,84],type:"btn",imgid:e.imgid.btn}),(0,r.drawImageCenter)({self:e,src:"res/flower.png",pos:[207,290,260,141],type:"bg",imgid:e.imgid.bg}),(0,r.updatePlane)({self:e,type:"bg"})},t.reDrawChangeAva=n;var r=i(4)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i(0)),a=i(1),s=i(5),l=i(10),c={green:6393958,white:15658734,lightGreen:8104320,gray:10395294,black:7171437,lightGray:14408667,lightBlack:13355979,brown:6776679,middleLightGreen:125084537,middleLightGray:12303291,middleLightBlack:8947848},h=new o.MeshBasicMaterial({map:a.loader.load("res/cylinder_shadow.png"),transparent:!0,alphaTest:.01}),u=new o.MeshBasicMaterial({map:a.loader.load("res/desk_shadow.png"),transparent:!0,alphaTest:.01}),d=new o.MeshBasicMaterial({map:a.loader.load("res/shadow.png"),transparent:!0,alphaTest:.01}),f=new o.MeshLambertMaterial({map:a.loader.load("res/gray.png")}),p=new o.MeshLambertMaterial({map:a.loader.load("res/number.png"),alphaTest:.6}),m=new o.BoxGeometry(2*a.BLOCK.radius+.02,a.BLOCK.height+.04,2*a.BLOCK.radius+.02),g=new o.BoxGeometry(2*a.BLOCK.radius,a.BLOCK.height,2*a.BLOCK.radius),v=new o.PlaneGeometry(11,11),y=new o.MeshBasicMaterial({map:a.loader.load("res/stripe.png")}),b=a.GAME.canShadow?o.MeshLambertMaterial:o.MeshBasicMaterial,w=new o.SphereGeometry(1,15,15),x=new o.BoxGeometry(3.1,2.4,3.7);x.vertices[4].y-=1.4,x.vertices[5].y-=1.4,x.vertices[6].y+=1,x.vertices[7].y+=1;var _=new o.MeshLambertMaterial({color:14308946}),M=new o.MeshLambertMaterial({color:14588210}),T=new o.MeshLambertMaterial({color:14701649}),S=new o.MeshLambertMaterial({color:15574072}),E=new o.MeshLambertMaterial({color:5613125}),C=new o.MeshLambertMaterial({color:15527148}),P=function(){function e(t,i){var r=this;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.radius=a.BLOCK.radius,this.status="stop",this.scale=1,this.type="green",this.types=["green","black","gray"],this.radiusScale=1,this.obj=new o.Object3D,this.obj.name="block",this.body=new o.Object3D,(t<=8||27==t)&&(this.greenMaterial=new o.MeshLambertMaterial({color:c.green}),this.whiteMaterial=new o.MeshLambertMaterial({color:c.white})),this.shadowWidth=11,2==t||7==t?(this.shadow=new o.Mesh(v,u),this.shadow.position.set(0,-a.BLOCK.height/2-.001*t,-4.5),this.shadow.scale.y=1.2):3==t||21==t||27==t||28==t||29==t?(this.shadow=new o.Mesh(v,h),this.shadow.position.set(-.1,-a.BLOCK.height/2-.001*t,-2.8),this.shadow.scale.y=1.4,this.shadow.scale.x=1):(this.shadow=new o.Mesh(v,d),this.shadow.position.set(-.74,-a.BLOCK.height/2-.001*t,-2.73),this.shadow.scale.y=1.4),this.shadow.rotation.x=-Math.PI/2,this.order=t,this.radiusSegments=4,this.height=a.BLOCK.height,this.canChange=!0,0==t){var l=[this.greenMaterial,this.whiteMaterial],P=new o.Geometry,L=3,k=(a.BLOCK.height-L)/2,A=new o.BoxGeometry(2*a.BLOCK.radius,k,2*a.BLOCK.radius);this.geometry=A;N=new o.BoxGeometry(2*a.BLOCK.radius,L,2*a.BLOCK.radius);this.merge(P,A,0,[{x:0,y:-L/2-k/2,z:0},{x:0,y:L/2+k/2,z:0}]),this.merge(P,N,1,[{x:0,y:0,z:0}]),this.hitObj=new o.Mesh(P,l)}else if(1==t){var l=[this.greenMaterial,this.whiteMaterial],P=new o.Geometry,R=a.BLOCK.height/5,O=new o.BoxGeometry(2*a.BLOCK.radius,R,2*a.BLOCK.radius);this.geometry=O,this.merge(P,O,0,[{x:0,y:0,z:0},{x:0,y:-2*R,z:0},{x:0,y:2*R,z:0}]),this.merge(P,O,1,[{x:0,y:-R,z:0},{x:0,y:R,z:0}]),this.hitObj=new o.Mesh(P,l)}else if(2==t){this.radiusSegments=50,this.height=a.BLOCK.height/21*1.5;var R=a.BLOCK.height/21*19.5,I=a.BLOCK.height-R,B=new o.CylinderGeometry(a.BLOCK.radius-4,a.BLOCK.radius-2,R,50),D=new o.CylinderGeometry(a.BLOCK.radius,a.BLOCK.radius,I,50),U=new o.Mesh(D,this.greenMaterial);(j=new o.Mesh(B,this.whiteMaterial)).position.y=-a.BLOCK.height/21*10.5,this.body.add(j),this.hitObj=U}else if(3==t){this.radiusSegments=50,this.middleLightGreenMaterial=new o.MeshLambertMaterial({color:c.middleLightGreen});var l=[this.greenMaterial,this.whiteMaterial,this.middleLightGreenMaterial],P=new o.Geometry,R=5,I=a.BLOCK.height-R,B=new o.CylinderGeometry(a.BLOCK.radius,a.BLOCK.radius,R,50),D=new o.CylinderGeometry(a.BLOCK.radius,a.BLOCK.radius,I,50);this.geometry=D;(z=new o.RingGeometry(.6*a.BLOCK.radius,.8*a.BLOCK.radius,30)).rotateX(-Math.PI/2),this.merge(P,B,1,[{x:0,y:-(a.BLOCK.height-R)/2,z:0}]),this.merge(P,D,0,[{x:0,y:R+I/2-a.BLOCK.height/2,z:0}]),this.merge(P,z,2,[{x:0,y:a.BLOCK.height/2+.01,z:0}]),this.hitObj=new o.Mesh(P,l)}else if(4==t){var l=[this.greenMaterial,this.whiteMaterial],P=new o.Geometry,O=g;this.geometry=O,this.merge(P,O,0,[{x:0,y:0,z:0}]);var z=new o.RingGeometry(1,2,30,1);this.merge(P,z,1,[{x:0,y:0,z:a.BLOCK.radius+.01}]),z.rotateY(-Math.PI/2),this.merge(P,z,1,[{x:-a.BLOCK.radius-.01,y:0,z:0}]),this.hitObj=new o.Mesh(P,l)}else if(5==t){var l=[this.greenMaterial,this.whiteMaterial],P=new o.Geometry,L=3,k=(a.BLOCK.height-L)/2,A=new o.BoxGeometry(2*a.BLOCK.radius,k,2*a.BLOCK.radius),N=new o.BoxGeometry(2*a.BLOCK.radius,L,2*a.BLOCK.radius);this.merge(P,A,0,[{x:0,y:-L/2-k/2,z:0},{x:0,y:L/2+k/2,z:0}]),this.merge(P,N,1,[{x:0,y:0,z:0}]),this.hitObj=new o.Mesh(P,l)}else if(6==t){var l=[this.greenMaterial,this.whiteMaterial],P=new o.Geometry,L=3,k=(a.BLOCK.height-L)/2,A=new o.BoxGeometry(2*a.BLOCK.radius,k,2*a.BLOCK.radius),N=new o.BoxGeometry(2*a.BLOCK.radius,L,2*a.BLOCK.radius);this.merge(P,A,0,[{x:0,y:-L/2-k/2,z:0},{x:0,y:L/2+k/2,z:0}]),this.merge(P,N,1,[{x:0,y:0,z:0}]),this.hitObj=new o.Mesh(P,l)}else if(7==t){this.radiusSegments=50,this.height=a.BLOCK.height/21*1.5;var R=a.BLOCK.height/21*19.5,I=a.BLOCK.height-R,B=new o.CylinderGeometry(a.BLOCK.radius-4,a.BLOCK.radius-2,R,50),D=new o.CylinderGeometry(a.BLOCK.radius,a.BLOCK.radius,I,50),U=new o.Mesh(D,this.greenMaterial),j=new o.Mesh(B,this.whiteMaterial);j.position.y=-a.BLOCK.height/21*10.5,this.body.add(j),this.hitObj=U}else if(8==t){var l=[this.greenMaterial,this.whiteMaterial],P=new o.Geometry,R=a.BLOCK.height/5,O=new o.BoxGeometry(2*a.BLOCK.radius,R,2*a.BLOCK.radius);this.merge(P,O,0,[{x:0,y:0,z:0},{x:0,y:-2*R,z:0},{x:0,y:2*R,z:0}]),this.merge(P,O,1,[{x:0,y:-R,z:0},{x:0,y:R,z:0}]),this.hitObj=new o.Mesh(P,l)}else if(9==t){var l=[Ce=new o.MeshLambertMaterial({color:15563832}),W=new o.MeshBasicMaterial({map:a.loader.load("res/game.png"),transparent:!0})],P=new o.Geometry,O=g;this.geometry=O,this.merge(P,O,0,[{x:0,y:0,z:0}]),this.merge(P,new o.PlaneGeometry(5,5),1,[{x:0,y:.1,z:a.BLOCK.radius+.01}]),this.hitObj=new o.Mesh(P,l)}else if(10==t){var l=[new o.MeshLambertMaterial({color:16508510}),W=new o.MeshBasicMaterial({map:a.loader.load("res/emotion.png"),transparent:!0})],P=new o.Geometry,O=g,F=new o.CylinderGeometry(2,2,1,50),G=new o.PlaneGeometry(1.5,1.5);this.geometry=O,this.merge(P,O,0,[{x:0,y:0,z:0}]),F.rotateX(Math.PI/2),this.merge(P,F,0,[{x:0,y:0,z:a.BLOCK.radius+.51}]),F.rotateZ(Math.PI/2),F.rotateY(Math.PI/2),this.merge(P,F,0,[{x:-a.BLOCK.radius-.51,y:0,z:0}]),this.merge(P,G,1,[{x:0,y:0,z:a.BLOCK.radius+1.02}]),G.rotateY(-Math.PI/2),this.merge(P,G,1,[{x:-a.BLOCK.radius-1.02,y:0,z:0}]),this.hitObj=new o.Mesh(P,l)}else if(11==t){var O=g,H=new o.BoxGeometry(3,2,4);this.geometry=O;var V=new o.MeshLambertMaterial({color:11855938}),W=new o.MeshBasicMaterial({map:a.loader.load("res/green_face.png"),transparent:!0}),G=new o.PlaneGeometry(6,3),l=[V,W],P=new o.Geometry;this.merge(P,O,0,[{x:0,y:0,z:0}]),this.merge(P,G,1,[{x:.5,y:-1,z:a.BLOCK.radius+.01}]),H.rotateZ(Math.PI/5),this.merge(P,H,0,[{x:-a.BLOCK.radius-1,y:1,z:2.5}]),H.rotateZ(-2*Math.PI/5),this.merge(P,H,0,[{x:a.BLOCK.radius,y:1,z:2.5}]),this.hitObj=new o.Mesh(P,l)}else if(12==t){var O=g,H=new o.BoxGeometry(3,2,4);this.geometry=O;var V=new o.MeshLambertMaterial({color:15921906}),W=new o.MeshLambertMaterial({map:a.loader.load("res/white_face.png")}),G=new o.PlaneGeometry(6,3),l=[V,W],P=new o.Geometry;this.merge(P,O,0,[{x:0,y:0,z:0}]),this.merge(P,G,1,[{x:.5,y:-1,z:a.BLOCK.radius+.01}]),H.rotateZ(Math.PI/5),this.merge(P,H,0,[{x:-a.BLOCK.radius-1,y:1,z:2.5}]),H.rotateZ(-2*Math.PI/5),this.merge(P,H,0,[{x:a.BLOCK.radius,y:1,z:2.5}]),this.hitObj=new o.Mesh(P,l)}else if(13==t){O=g;this.geometry=O;var W=new o.MeshLambertMaterial({map:a.loader.load("res/money.png")}),G=new o.PlaneGeometry(3,3),l=[W],P=new o.Geometry;this.mapUv(64,64,O,1,2,2,4,4),this.mapUv(64,64,O,2,2,2,4,4),this.mapUv(64,64,O,4,2,2,4,4),this.merge(P,O,0,[{x:0,y:0,z:0}]),this.merge(P,G,0,[{x:0,y:0,z:a.BLOCK.radius+.01}]),this.hitObj=new o.Mesh(P,l)}else if(14==t){O=new o.BoxGeometry(2*a.BLOCK.radius,this.height,2*a.BLOCK.radius);this.geometry=O;q=new o.MeshLambertMaterial({map:a.loader.load("res/tit.png")});this.mapUv(310,310,O,1,0,0,200,110),this.mapUv(310,310,O,2,0,110,200,310),this.mapUv(310,310,O,4,200,110,310,310),this.hitObj=new o.Mesh(O,q)}else if(15==t){O=new o.BoxGeometry(2*a.BLOCK.radius,this.height,2*a.BLOCK.radius);this.map=a.loader.load("res/bag.png");q=new o.MeshLambertMaterial({map:this.map});this.glowMap=a.loader.load("res/glow_bag.png"),this.hitObj=new o.Mesh(O,q)}else if(16==t){var O=new o.BoxGeometry(2*a.BLOCK.radius,this.height,2*a.BLOCK.radius),q=new o.MeshLambertMaterial({map:a.loader.load("res/dict.png")});this.mapUv(428,428,O,1,0,148,280,0),this.mapUv(428,428,O,2,0,148,280,428),this.mapUv(428,428,O,4,280,148,428,428),this.hitObj=new o.Mesh(O,q)}else if(17==t){this.height/=3;var X=new o.MeshLambertMaterial({map:a.loader.load("res/box_top.png")}),K=new o.MeshLambertMaterial({map:a.loader.load("res/box_bottom.png")}),O=new o.BoxGeometry(2*a.BLOCK.radius,this.height,2*a.BLOCK.radius);this.geometry=O;var Y=new o.BoxGeometry(2*a.BLOCK.radius,this.height,2*a.BLOCK.radius),l=[X,K],P=new o.Geometry;this.mapUv(198,198,O,1,0,0,148,50),this.mapUv(198,198,O,2,0,50,148,198),this.mapUv(198,198,O,4,148,50,198,198),this.mapUv(444,50,Y,4,148,0,296,50,!0),this.mapUv(444,50,Y,1,0,0,148,50),this.mapUv(444,50,Y,2,0,0,1,1),this.mapUv(444,50,Y,0,296,50,444,0),this.merge(P,O,0,[{x:0,y:0,z:0}]),this.merge(P,Y,1,[{x:0,y:-2*this.height,z:0}]);var Z=new o.MeshLambertMaterial({map:a.loader.load("res/box_middle.png")});this.middle=new o.Mesh(Y,Z),this.middle.position.y=-this.height,this.body.add(this.middle),this.hitObj=new o.Mesh(P,l)}else if(18==t){var O=new o.BoxGeometry(2*a.BLOCK.radius,this.height,2*a.BLOCK.radius),q=new o.MeshLambertMaterial({map:a.loader.load("res/express.png")});this.mapUv(428,428,O,1,0,0,280,148),this.mapUv(428,428,O,2,0,148,280,428),this.mapUv(428,428,O,4,280,148,428,428),this.hitObj=new o.Mesh(O,q)}else if(19==t){this.min=.9,this.height=a.BLOCK.height/21*4;O=new o.BoxGeometry(2*a.BLOCK.radius,this.height+.1,2*a.BLOCK.radius);this.geometry=O;var q=new o.MeshLambertMaterial({color:16777215,transparent:!0,opacity:.3}),B=new o.BoxGeometry(2.05*a.BLOCK.radius,a.BLOCK.height/21*17,2.05*a.BLOCK.radius),l=[q,K=new o.MeshBasicMaterial({map:a.loader.load("res/sing.png")})],P=new o.Geometry;this.mapUv(416,416,B,1,0,0,256,160),this.mapUv(416,416,B,2,0,160,256,416),this.mapUv(416,416,B,4,256,160,416,416),this.merge(P,O,0,[{x:0,y:0,z:0}]),this.merge(P,B,1,[{x:0,y:-a.BLOCK.height/21*10.5,z:0}]),this.hitObj=new o.Mesh(P,l),this.record=new o.Object3D,this.record.add(new o.Mesh(new o.CylinderGeometry(.9*a.BLOCK.radius,.9*a.BLOCK.radius,.4,50),new o.MeshBasicMaterial({color:2894892})));var G=new o.CircleGeometry(.9*a.BLOCK.radius,40),W=new o.MeshBasicMaterial({map:a.loader.load("res/record.png")});(ze=new o.Mesh(G,W)).rotation.x=-Math.PI/2,ze.position.y=.26,this.record.add(ze),this.body.add(this.record);G=new o.PlaneGeometry(2,2);this.musicIcon=new o.Mesh(G,new o.MeshBasicMaterial({map:a.loader.load("res/music_icon.png"),transparent:!0})),this.musicIcon.position.set(0,0,0),this.musicIcon.rotation.y=-Math.PI/4,this.musicIcon.rotation.x=-Math.PI/5,this.musicIcon.rotation.z=-Math.PI/5,this.musicIcon.visible=!1,this.secondMusicIcon=new o.Mesh(G,new o.MeshBasicMaterial({map:a.loader.load("res/music_icon_two.png"),transparent:!0})),this.secondMusicIcon.rotation.y=-Math.PI/4,this.secondMusicIcon.rotation.x=-Math.PI/5,this.secondMusicIcon.rotation.z=-Math.PI/5,this.secondMusicIcon.visible=!1,this.icons=[],this.icons.push(this.musicIcon,this.secondMusicIcon);for(re=0;re<2;++re)this.body.add(this.icons[re])}else if(20==t){O=new o.BoxGeometry(2*a.BLOCK.radius,this.height,2*a.BLOCK.radius/38*48);this.geometry=O,this.shadow.scale.set(1,61/38,48/38);var q=new o.MeshLambertMaterial({map:a.loader.load("res/disk.png")}),J=new o.MeshBasicMaterial({map:a.loader.load("res/disk_dark.png"),transparent:!0}),G=new o.PlaneGeometry(3,3),l=[J,q],P=new o.Geometry;this.mapUv(236,300,O,1,0,250,10,260),this.mapUv(236,300,O,2,0,300,236,0),this.mapUv(236,300,O,4,0,250,10,260),this.merge(P,O,1,[{x:0,y:0,z:0}]),this.merge(P,G,0,[{x:3.5,y:.5,z:a.BLOCK.radius/38*48+.01}]),this.hitObj=new o.Mesh(P,l),this.plane=new o.Mesh(G,new o.MeshBasicMaterial({map:a.loader.load("res/disk_light.png"),transparent:!0})),this.plane.position.set(3.5,.5,a.BLOCK.radius/38*48+.03),this.plane.updateMatrix(),this.plane.matrixAutoUpdate=!1,this.body.add(this.plane),this.timer=setInterval(function(){r.plane.visible=!r.plane.visible},1e3)}else if(21==t){this.radiusSegments=50,this.min=.8,this.height=a.BLOCK.height/21*4;O=new o.CylinderGeometry(.7*a.BLOCK.radius,.8*a.BLOCK.radius,this.height,50);this.geometry=O;var G=new o.CircleGeometry(.7*a.BLOCK.radius,50),B=new o.CylinderGeometry(.7*a.BLOCK.radius,.5*a.BLOCK.radius,a.BLOCK.height/21*17,50),q=new o.MeshBasicMaterial({color:5066061}),W=new o.MeshLambertMaterial({map:a.loader.load("res/westore_desk.png")}),K=new o.MeshBasicMaterial({map:a.loader.load("res/westore.png")});this.shadow.scale.set(.55,.9,.7);var l=[q,K,W],P=new o.Geometry;this.merge(P,O,0,[{x:0,y:0,z:0}]),B.rotateY(2.3),this.merge(P,B,1,[{x:0,y:-a.BLOCK.height/21*10.5,z:0}]),G.rotateX(-Math.PI/2),G.rotateY(-.7),this.merge(P,G,2,[{x:0,y:this.height/2+.01,z:0}]),this.hitObj=new o.Mesh(P,l)}else if(22==t){this.height=a.BLOCK.height/21*6;O=new o.BoxGeometry(2.1*a.BLOCK.radius,this.height,2.1*a.BLOCK.radius);this.geometry=O;var q=new o.MeshLambertMaterial({map:a.loader.load("res/gift.png")}),B=new o.BoxGeometry(2*a.BLOCK.radius,a.BLOCK.height/21*15,2*a.BLOCK.radius),K=new o.MeshLambertMaterial({color:11637749});this.mapUv(300,370,O,1,0,0,300,70),this.mapUv(300,370,O,2,0,70,300,370),this.mapUv(300,370,O,4,0,0,300,70,!0);var l=[q,K],P=new o.Geometry;this.merge(P,O,0,[{x:0,y:0,z:0}]),this.merge(P,B,1,[{x:0,y:-a.BLOCK.height/21*10.5,z:0}]),this.hitObj=new o.Mesh(P,l)}else if(23==t){this.height=a.BLOCK.height/21*5;var O=new o.Geometry,Q=new o.BoxGeometry(2*a.BLOCK.radius,this.height,2*a.BLOCK.radius/38*40);O.merge(Q),this.shadow.scale.set(1,48/38,48/38);var $=new o.BoxGeometry(1.5,3.5,1.5);$.rotateZ(-.3),$.vertices[7].y-=.4,$.vertices[6].y-=.4,$.translate(-4,-3,-3.5),O.merge($),$.vertices[6].y+=.5,$.translate(0,0,7),$.rotateX(-.2),O.merge($),$.vertices[7].y+=.4,$.translate(5,-1,0),$.rotateZ(.4),O.merge($);q=new o.MeshLambertMaterial({map:a.loader.load("res/stool.png")});this.hitObj=new o.Mesh(O,q),this.shadow=new o.Mesh(new o.PlaneGeometry(this.shadowWidth,this.shadowWidth),new o.MeshBasicMaterial({map:a.loader.load("res/stool_shadow.png"),transparent:!0,alphaTest:.01})),this.shadow.position.set(-.76,-a.BLOCK.height/2-.001*t,-3.6),this.shadow.scale.y=1.4,this.shadow.scale.x=.9,this.shadow.rotation.x=-Math.PI/2}else if(24==t){this.height=a.BLOCK.height/21*6;O=new o.BoxGeometry(2*a.BLOCK.radius/38*45,this.height,2*a.BLOCK.radius/38*45);this.geometry=O;B=new o.BoxGeometry(2*a.BLOCK.radius/38*40,a.BLOCK.height/21*15,2*a.BLOCK.radius/38*40);this.shadow.scale.set(40/38,1.4,1);var l=[q=new o.MeshLambertMaterial({map:a.loader.load("res/store_top.png")}),K=new o.MeshBasicMaterial({map:a.loader.load("res/store_bottom.png"),transparent:!0}),W=new o.MeshBasicMaterial({map:a.loader.load("res/indoor.png"),transparent:!0})],G=new o.PlaneGeometry(3.1,3.1),P=new o.Geometry;this.mapUv(340,340,O,1,0,0,280,60),this.mapUv(340,340,O,2,0,60,280,340),this.mapUv(340,340,O,4,280,60,340,340),this.merge(P,O,0,[{x:0,y:0,z:0}]),this.mapUv(434,164,B,1,0,0,217,164),this.mapUv(434,164,B,4,217,0,434,164,!0),this.merge(P,B,1,[{x:0,y:-a.BLOCK.height/21*10.5,z:0}]),G.rotateY(-Math.PI/2),this.merge(P,G,2,[{x:-a.BLOCK.radius/38*40-.01,y:-3.3,z:-2.5}]),this.hitObj=new o.Mesh(P,l);var ee=new o.PlaneGeometry(1.55,3.1);this.door=new o.Mesh(ee,new o.MeshBasicMaterial({map:a.loader.load("res/door.png"),transparent:!0})),this.door.rotation.y=-Math.PI/2,this.door.position.set(-a.BLOCK.radius/38*40-.02,-3.3,-3.3),this.body.add(this.door),this.secondDoor=new o.Mesh(ee,new o.MeshBasicMaterial({map:a.loader.load("res/second_door.png"),transparent:!0})),this.secondDoor.rotation.y=-Math.PI/2,this.secondDoor.position.set(-a.BLOCK.radius/38*40-.02,-3.3,-1.7),this.body.add(this.secondDoor)}else if(25==t){O=new o.BoxGeometry(2*a.BLOCK.radius,this.height,2*a.BLOCK.radius);this.geometry=O;q=new o.MeshLambertMaterial({map:a.loader.load("res/clock.png")});this.mapUv(320,200,O,1,0,0,5,5),this.mapUv(320,200,O,2,0,0,5,5),this.mapUv(320,200,O,4,0,200,320,0,!0);var te=y,ie=new o.CylinderGeometry(1,1,1,30),l=[q,te],P=new o.Geometry;this.merge(P,O,0,[{x:0,y:0,z:0}]),ie.rotateZ(Math.PI/2),this.merge(P,ie,1,[{x:-a.BLOCK.radius-.5,y:0,z:0}]),this.hitObj=new o.Mesh(P,l),this.plane=new o.Mesh(new o.PlaneGeometry(3,3),new o.MeshBasicMaterial({map:a.loader.load("res/point.png"),transparent:!0})),this.plane.position.set(0,0,a.BLOCK.radius+.04),this.body.add(this.plane),this.timer=setInterval(function(){r.plane.visible=!r.plane.visible},1e3),this.numbers=[];for(var ne=new o.PlaneGeometry(3,3),re=0;re<10;++re){for(var oe=new o.MeshBasicMaterial({map:a.loader.load("res/"+re+".png"),alphaTest:.5}),ae=[],se=0;se<4;++se){var le=new o.Mesh(ne,oe);le.position.z=a.BLOCK.radius+.01,le.visible=!1,ae.push(le),this.body.add(le)}this.numbers.push(ae)}var ce=new Date,he=("0"+ce.getHours()).slice(-2),ue=("0"+ce.getMinutes()).slice(-2);this.numbers[he[0]][0].position.x=-3.2*this.radiusScale,this.numbers[he[0]][0].visible=!0,this.numbers[he[1]][1].position.x=-1.3*this.radiusScale,this.numbers[he[1]][1].visible=!0,this.numbers[ue[0]][2].position.x=1.3*this.radiusScale,this.numbers[ue[0]][2].visible=!0,this.numbers[ue[1]][3].position.x=3.2*this.radiusScale,this.numbers[ue[1]][3].visible=!0}else if(26==t){var O=new o.BoxGeometry(2*a.BLOCK.radius,this.height,2*a.BLOCK.radius),q=new o.MeshLambertMaterial({map:a.loader.load("res/well.png")});this.mapUv(280,428,O,1,0,0,280,148),this.mapUv(280,428,O,2,0,148,280,428),this.mapUv(280,428,O,4,0,0,280,148,!0),this.hitObj=new o.Mesh(O,q)}else if(27==t){this.radiusSegments=50;O=new o.CylinderGeometry(2*a.BLOCK.radius/38*25,2*a.BLOCK.radius/38*25,this.height,50);this.geometry=O,this.shadow.scale.set(50/38,50/38,50/38);var q=new o.MeshBasicMaterial({map:a.loader.load("res/golf_bottom.png")}),G=new o.CircleGeometry(2*a.BLOCK.radius/38*25+.01,30),W=new b({map:a.loader.load("res/golf_top.png")}),P=new o.Geometry,l=[q,W];O.rotateY(3),this.merge(P,O,0,[{x:0,y:0,z:0}]),G.rotateX(-Math.PI/2),G.rotateY(-.7),this.merge(P,G,1,[{x:0,y:this.height/2+.01,z:0}]),this.hitObj=new o.Mesh(P,l),this.sphere=new o.Mesh(new o.SphereGeometry(.6,10,10),this.whiteMaterial),this.sphere.position.set(-8,-1,-1.5),this.obj.add(this.sphere)}else if(28==t){this.radiusSegments=50;O=new o.CylinderGeometry(2*a.BLOCK.radius/38*15,2*a.BLOCK.radius/38*15,this.height,50);this.geometry=O,this.shadow.scale.set(30/38,30/38,30/38);var q=new o.MeshBasicMaterial({map:a.loader.load("res/paper_bottom.png")}),G=new o.CircleGeometry(2*a.BLOCK.radius/38*15+.01,30),W=new b({map:a.loader.load("res/paper_top.png")}),P=new o.Geometry,l=[q,W];O.rotateY(4),this.merge(P,O,0,[{x:0,y:0,z:0}]),G.rotateX(-Math.PI/2),G.rotateY(-.7),this.merge(P,G,1,[{x:0,y:this.height/2+.01,z:0}]),this.shadow.scale.y=1.1,this.hitObj=new o.Mesh(P,l)}else if(29==t){this.radiusSegments=50,this.min=.8,this.height=a.BLOCK.height/21*4;O=new o.CylinderGeometry(.4*a.BLOCK.radius,.4*a.BLOCK.radius,this.height,50);this.geometry=O;var q=y,G=new o.CircleGeometry(.4*a.BLOCK.radius,50),W=new o.MeshBasicMaterial({color:16777215}),Y=new o.CylinderGeometry(.4*a.BLOCK.radius,.5*a.BLOCK.radius,a.BLOCK.height/21*1,50),B=new o.CylinderGeometry(.5*a.BLOCK.radius,.5*a.BLOCK.radius,a.BLOCK.height/21*16,50),K=new o.MeshBasicMaterial({map:a.loader.load("res/medicine.png")}),P=new o.Geometry,l=[q,W,K];this.merge(P,O,0,[{x:0,y:0,z:0}]),G.rotateX(-Math.PI/2),this.merge(P,G,1,[{x:0,y:this.height/2+.01,z:0}]),this.merge(P,Y,1,[{x:0,y:-a.BLOCK.height/21*2.5,z:0}]),B.rotateY(2.3),this.merge(P,B,2,[{x:0,y:-a.BLOCK.height/21*11,z:0}]),this.hitObj=new o.Mesh(P,l),this.shadow.scale.set(.55,.9,.7)}else if(30==t){O=new o.BoxGeometry(2*a.BLOCK.radius,this.height,2*a.BLOCK.radius);this.geometry=O,this.map=a.loader.load("res/fox_face.png");var q=new o.MeshLambertMaterial({map:this.map}),de=new o.MeshLambertMaterial({color:15117384}),fe=new o.MeshLambertMaterial({map:a.loader.load("res/fox_ear.png"),transparent:!0});this.mapUv(230,128,O,1,0,110,5,120),this.mapUv(230,128,O,2,0,110,5,120),this.mapUv(230,128,O,4,0,128,230,0,!0);var H=new o.CylinderGeometry(2.4,2.4,.5,3),pe=new o.Object3D,me=new o.Mesh(H,de),ge=new o.Mesh(new o.PlaneGeometry(3.6,3.6),fe);ge.receiveShadow=!0,ge.rotation.x=Math.PI/2,ge.position.set(-.1,-.3,.5),pe.add(me),pe.add(ge),pe.position.set(-3,3.8,-4.7),pe.rotation.x=-Math.PI/2;(ke=pe.clone()).position.x=3,this.body.add(ke),this.body.add(pe),this.hitObj=new o.Mesh(O,q),this.glowMap=a.loader.load("res/fox_blink.png"),this.beforePopup=function(){r.hitObj.material.map=r.map};G=new o.PlaneGeometry(2,2);this.heart=new o.Mesh(G,new o.MeshBasicMaterial({map:a.loader.load("res/heart.png"),transparent:!0})),this.heart.rotation.y=-Math.PI/4,this.heart.rotation.x=-Math.PI/5,this.heart.rotation.z=-Math.PI/5,this.body.add(this.heart),this.whenSucceed=function(){r.heart.material.opacity=0,r.heart.position.set(5,-2,5),r.heart.scale.set(.4,.4,.4),s.customAnimation.to(r.heart.position,2,{ease:"Quad.easeIn",y:7}),s.customAnimation.to(r.heart.position,2,{z:7}),s.customAnimation.to(r.heart.material,.5,{opacity:1}),s.customAnimation.to(r.heart.material,1.5,{opacity:0,delay:.5}),s.customAnimation.to(r.heart.scale,2,{x:1,y:1,z:1}),r.hitObj.material.map=r.glowMap}}else if(31==t){O=new o.BoxGeometry(2*a.BLOCK.radius,this.height,2*a.BLOCK.radius);this.geometry=O;q=new o.MeshLambertMaterial({map:a.loader.load("res/lion_red.png")});this.mapUv(368,368,O,1,0,128,240,0),this.mapUv(368,368,O,2,240,368,0,128),this.mapUv(368,368,O,4,240,128,368,368);(pe=new o.Mesh(x,T)).position.set(-6.75,1.3,1.3);(ke=pe.clone()).rotation.y=Math.PI,ke.position.set(6.45,1.3,1.3),this.body.add(ke),this.body.add(pe);(Me=new o.Mesh(w,M)).position.set(0,.4,6);(Te=new o.Mesh(w,_)).scale.set(.65,.65,.65),Te.position.set(-1.3,-.4,5.65);(Se=Te.clone()).position.x=1.4,this.body.add(Se),this.body.add(Te),this.body.add(Me),this.hitObj=new o.Mesh(O,q)}else if(32==t){O=new o.BoxGeometry(2*a.BLOCK.radius,this.height,2*a.BLOCK.radius);this.geometry=O;q=new o.MeshLambertMaterial({map:a.loader.load("res/luban.png")});this.mapUv(338,338,O,1,0,128,208,0),this.mapUv(338,338,O,2,0,128,210,338),this.mapUv(338,338,O,4,210,129,337,338);var ve=new o.MeshLambertMaterial({color:2199e3}),ye=new o.Mesh(new o.BoxGeometry(10,.4,1.5),ve),be=new o.MeshLambertMaterial({color:4531468}),we=new o.MeshLambertMaterial({color:8037621}),xe=new o.Mesh(new o.BoxGeometry(.8,3.5,3.5),be),_e=new o.Mesh(new o.BoxGeometry(.4,2.5,2.5),we);ye.position.set(0,.8,5.75),this.body.add(ye),xe.position.set(-5.4,0,0),_e.position.set(-6,0,0),this.body.add(_e),this.body.add(xe),this.hitObj=new o.Mesh(O,q)}else if(33==t){O=new o.BoxGeometry(2*a.BLOCK.radius,this.height,2*a.BLOCK.radius);this.geometry=O;q=new o.MeshLambertMaterial({map:a.loader.load("res/lion_yellow.png")});this.mapUv(368,368,O,1,0,128,240,0),this.mapUv(368,368,O,2,240,368,0,128),this.mapUv(368,368,O,4,240,128,368,368);(pe=new o.Mesh(x,S)).position.set(-6.75,1.3,1.3);(ke=pe.clone()).rotation.y=Math.PI,ke.position.set(6.45,1.3,1.3),this.body.add(ke),this.body.add(pe);(Me=new o.Mesh(w,_)).position.set(0,.4,6);(Te=new o.Mesh(w,M)).scale.set(.65,.65,.65),Te.position.set(-1.3,-.4,5.65);(Se=Te.clone()).position.x=1.4,this.body.add(Se),this.body.add(Te),this.body.add(Me),this.hitObj=new o.Mesh(O,q)}else if(34==t){O=new o.BoxGeometry(2*a.BLOCK.radius,this.height,2*a.BLOCK.radius);this.geometry=O;q=new o.MeshLambertMaterial({map:a.loader.load("res/lion_white.png")});this.mapUv(368,368,O,1,0,128,240,0),this.mapUv(368,368,O,2,240,368,0,128),this.mapUv(368,368,O,4,240,128,368,368);(pe=new o.Mesh(x,C)).position.set(-6.75,1.3,1.3);(ke=pe.clone()).rotation.y=Math.PI,ke.position.set(6.45,1.3,1.3),this.body.add(ke),this.body.add(pe);(Me=new o.Mesh(w,_)).position.set(0,.4,6);(Te=new o.Mesh(w,M)).scale.set(.65,.65,.65),Te.position.set(-1.3,-.4,5.65);(Se=Te.clone()).position.x=1.4,this.body.add(Se),this.body.add(Te),this.body.add(Me),this.hitObj=new o.Mesh(O,q)}else if(35==t){O=new o.BoxGeometry(2*a.BLOCK.radius,this.height,2*a.BLOCK.radius);this.geometry=O;q=new o.MeshLambertMaterial({map:a.loader.load("res/lion_green.png")});this.mapUv(368,368,O,1,0,128,240,0),this.mapUv(368,368,O,2,240,368,0,128),this.mapUv(368,368,O,4,240,128,368,368);(pe=new o.Mesh(x,E)).position.set(-6.75,1.3,1.3);(ke=pe.clone()).rotation.y=Math.PI,ke.position.set(6.45,1.3,1.3),this.body.add(ke),this.body.add(pe);var Me=new o.Mesh(w,_);Me.position.set(0,.4,6);var Te=new o.Mesh(w,M);Te.scale.set(.65,.65,.65),Te.position.set(-1.3,-.4,5.65);var Se=Te.clone();Se.position.x=1.4,this.body.add(Se),this.body.add(Te),this.body.add(Me),this.hitObj=new o.Mesh(O,q)}else if(36==t){O=new o.BoxGeometry(2*a.BLOCK.radius,this.height,2*a.BLOCK.radius);this.geometry=O;q=new o.MeshLambertMaterial({map:a.loader.load("res/xiaoqiao.png")});this.mapUv(210,128,O,1,0,110,5,120),this.mapUv(210,128,O,2,0,110,5,120),this.mapUv(210,128,O,4,0,128,210,0,!0);var Ee=new o.MeshLambertMaterial({color:15688853}),Ce=new o.MeshLambertMaterial({color:16562913}),H=new o.BoxGeometry(1.5,3.8,3.8),Pe=new o.BoxGeometry(.5,3.8,3.8),pe=new o.Object3D,me=new o.Mesh(H,Ce),Le=new o.Mesh(Pe,Ee);me.position.set(-1,0,0),pe.add(me),pe.add(Le),pe.position.set(-5.25,0,0);var ke=pe.clone();ke.rotation.y=Math.PI,ke.position.x=5.25,this.body.add(ke),this.body.add(pe),this.hitObj=new o.Mesh(O,q)}else if(-1==t){var Ae=[15622240,14980702,15712087,9089870,7451844,6519997,10772948],O=m,q=new o.MeshLambertMaterial({color:Ae[i],transparent:!0});this.hitObj=new o.Mesh(O,q);var Re=new o.BoxGeometry(2*a.BLOCK.radius,a.BLOCK.height,2*a.BLOCK.radius);this.mapUv(100,88,Re,2,0,0,5,5);var Oe=new o.Mesh(Re,f);0==i&&(Oe.receiveShadow=!0),this.body.add(Oe);var Ie,Be,De,Ue,G=new o.PlaneGeometry(4,8);De=(Ie=i%4*64)+64,Ue=(Be=128*parseInt(i/4))+128,this.mapUv(256,256,G,0,Ie,Ue,De,Be);var ze=new o.Mesh(G,p);ze.rotation.x=-Math.PI/2,ze.rotation.z=-Math.PI/2,ze.position.y=a.BLOCK.height/2+.05,this.body.add(ze),this.obj.scale.set(.7,1,.7)}else if("object"==n(arguments[1])){console.log("aaasdasdasda",arguments[1]);var O=new o.BoxGeometry(2*a.BLOCK.radius,this.height,2*a.BLOCK.radius),q=new o.MeshLambertMaterial({map:a.loader.load(wx.env.USER_DATA_PATH+"/"+arguments[1].res[0].path)});this.mapUv(428,428,O,1,0,0,280,148),this.mapUv(428,428,O,2,0,148,280,428),this.mapUv(428,428,O,4,280,148,428,428),this.hitObj=new o.Mesh(O,q),this.scoreBonus=arguments[1].score,arguments[1].music_src&&(this.musicName=arguments[1].music_name,arguments[2].addMusic(arguments[1].music_name,arguments[1].music_src))}this.shadow.initZ=this.shadow.position.z,this.hitObj.receiveShadow=!0,this.hitObj.name="hitObj",this.body.add(this.hitObj),this.hitObj.matrixAutoUpdate=!1,this.shadow.initScale=this.shadow.scale.y,this.body.position.y=a.BLOCK.height/2-this.height/2,this.obj.add(this.shadow),this.obj.add(this.body)}return r(e,[{key:"merge",value:function(e,t,i,n){for(var r=0,a=t.faces.length;r<a;++r)t.faces[r].materialIndex=0;for(var s=new o.Mesh(t),r=0,a=n.length;r<a;++r)s.position.set(n[r].x,n[r].y,n[r].z),s.updateMatrix(),e.merge(s.geometry,s.matrix,i)}},{key:"_mapUv",value:function(e,t,i,n,r,a,s,l,c){var h=1/e,u=1/t;if(i.faces[n]instanceof o.Face3){d=i.faceVertexUvs[0][2*n];4!=n||c?(d[0].x=r*h,d[0].y=a*u,d[1].x=r*h,d[1].y=l*u,d[2].x=s*h,d[2].y=a*u):(d[0].x=r*h,d[0].y=a*u,d[2].x=r*h,d[2].y=l*u,d[1].x=s*h,d[1].y=a*u);var d=i.faceVertexUvs[0][2*n+1];4!=n||c?(d[0].x=r*h,d[0].y=l*u,d[1].x=s*h,d[1].y=l*u,d[2].x=s*h,d[2].y=a*u):(d[2].x=r*h,d[2].y=l*u,d[1].x=s*h,d[1].y=l*u,d[0].x=s*h,d[0].y=a*u)}}},{key:"mapUv",value:function(e,t,i,n,r,o,a,s,l){if(n.length)for(var c=0;c<n.length;++c)this._mapUv(e,t,i,n[c],r,o,a,s,l);else this._mapUv(e,t,i,n,r,o,a,s,l)}},{key:"getBox",value:function(){return this.boundingBox?this.boundingBox:(this.boundingBox=(new o.Box3).setFromObject(this.body),this.boundingBox)}},{key:"glow",value:function(){this.hitObj.material.map=this.glowMap}},{key:"openDoor",value:function(){s.customAnimation.to(this.door.position,1,{z:-4.5}),s.customAnimation.to(this.secondDoor.position,1,{z:-.5})}},{key:"closeDoor",value:function(){s.customAnimation.to(this.door.position,1,{z:-3.3}),s.customAnimation.to(this.secondDoor.position,1,{z:-1.7})}},{key:"rotateBox",value:function(){s.customAnimation.to(this.middle.rotation,.5,{y:-Math.PI/2})}},{key:"playMusic",value:function(){for(var e=this,t=0;t<2;++t)setTimeout(function(e){return function(){e.visible=!0,e.position.set(0,0,0),e.material.opacity=1,s.customAnimation.to(e.position,2,{x:5*(1-2*Math.random()),y:15,z:5*(1-2*Math.random())}),s.customAnimation.to(e.material,2,{opacity:0})}}(this.icons[t]),1e3*t);this.musicTimer=setTimeout(function(){e.playMusic()},2500)}},{key:"stopMusic",value:function(){this.musicTimer&&(clearTimeout(this.musicTimer),this.musicTimer=null)}},{key:"change",value:function(e,t,i){if(this.canChange){if(this.order>=9){var n=this.order>=13?.7:.6;return this.radiusScale=i||Math.max((0,l.random)()*(a.BLOCK.maxRadiusScale-a.BLOCK.minRadiusScale)+a.BLOCK.minRadiusScale,this.min||n),this.radiusScale=+this.radiusScale.toFixed(2),this.radius=e||this.radiusScale*a.BLOCK.radius,this.radius=+this.radius.toFixed(2),this.obj.scale.set(this.radiusScale,1,this.radiusScale),void(27==this.order&&this.sphere.scale.set(1/this.radiusScale,1,1/this.radiusScale))}this.radiusScale=i||(0,l.random)()*(a.BLOCK.maxRadiusScale-a.BLOCK.minRadiusScale)+a.BLOCK.minRadiusScale,this.radiusScale=+this.radiusScale.toFixed(2),this.radius=e||this.radiusScale*a.BLOCK.radius,this.radius=+this.radius.toFixed(2),this.obj.scale.set(this.radiusScale,1,this.radiusScale),this.changeColor(t)}}},{key:"changeColor",value:function(e){var t=e||this.types[Math.floor(3*Math.random())];this.type!=t&&(this.type=t,"green"==t?(this.greenMaterial.color.setHex(c.green),this.whiteMaterial.color.setHex(c.white),this.middleLightGreenMaterial&&this.middleLightGreenMaterial.color.setHex(c.middleLightGreen)):"gray"==t?(this.greenMaterial.color.setHex(c.white),this.whiteMaterial.color.setHex(c.gray),this.middleLightGreenMaterial&&this.middleLightGreenMaterial.color.setHex(c.middleLightGray)):"black"==t&&(this.greenMaterial.color.setHex(c.black),this.whiteMaterial.color.setHex(c.lightBlack),this.middleLightGreenMaterial&&this.middleLightGreenMaterial.color.setHex(c.middleLightBlack)))}},{key:"getVertices",value:function(){var e=this,t=[],i=this.geometry||this.hitObj.geometry;if(4===this.radiusSegments)[0,1,4,5].forEach(function(n){var r=i.vertices[n].clone().applyMatrix4(e.hitObj.matrixWorld);t.push([r.x,r.z])});else for(var n=0;n<this.radiusSegments;++n){var r=i.vertices[n].clone().applyMatrix4(this.hitObj.matrixWorld);t.push([r.x,r.z])}return t}},{key:"shrink",value:function(){this.status="shrink"}},{key:"_shrink",value:function(){if(this.scale-=a.BLOCK.reduction,this.scale=Math.max(a.BLOCK.minScale,this.scale),this.scale<=a.BLOCK.minScale)this.status="stop";else{this.body.scale.y=this.scale,this.shadow.scale.y-=a.BLOCK.reduction/2,this.shadow.position.z+=a.BLOCK.reduction/4*this.shadowWidth;var e=a.BLOCK.reduction/2*a.BLOCK.height*(a.BLOCK.height-this.height/2)/a.BLOCK.height*2;this.body.position.y-=e}}},{key:"showup",value:function(e){var t=this.shadow.position.z;this.body.position.set(0,20,0),this.shadow.position.z=-15,this.obj.visible=!0,3==e||4==e||6==e?this.obj.position.set(7.5*(6==e?5:3),0,3.8*(3==e||6==e?-1:1)):5==e?this.obj.position.set(30,0,0):this.obj.position.set(7.5*e,0,0),(0,s.TweenAnimation)(this.body.position.y,a.BLOCK.height/2-this.height/2,500,"Bounce.easeOut",function(e,t){this.body.position.y=e}.bind(this)),(0,s.TweenAnimation)(this.shadow.position.z,t,500,"Bounce.easeOut",function(e,t){this.shadow.position.z=e}.bind(this))}},{key:"hideGlow",value:function(){this.hitObj.material.map=this.map}},{key:"popup",value:function(){if(this.beforePopup&&this.beforePopup(),15==this.order)this.hideGlow();else if(25==this.order){for(var e=0;e<10;++e)for(var t=0;t<4;++t)this.numbers[e][t].visible=!1;var i=new Date,n=("0"+i.getHours()).slice(-2),r=("0"+i.getMinutes()).slice(-2);this.numbers[n[0]][0].position.x=-3.1*this.radiusScale,this.numbers[n[0]][0].visible=!0,this.numbers[n[1]][1].position.x=-1.2*this.radiusScale,this.numbers[n[1]][1].visible=!0,this.numbers[r[0]][2].position.x=1.2*this.radiusScale,this.numbers[r[0]][2].visible=!0,this.numbers[r[1]][3].position.x=3.1*this.radiusScale,this.numbers[r[1]][3].visible=!0}else 17==this.order&&(this.middle.rotation.y=0);var o=this.shadow.position.z;this.body.position.y=20,this.shadow.position.z=-15,this.obj.visible=!0,this.boundingBox=null,s.customAnimation.to(this.body.position,.5,{y:a.BLOCK.height/2-this.height/2,ease:"Bounce.easeOut"}),s.customAnimation.to(this.shadow.position,.5,{z:o,ease:"Bounce.easeOut"})}},{key:"reset",value:function(){this.status="stop",this.scale=1,this.obj.scale.y=1,this.body.scale.y=1,this.obj.position.y=0,this.body.position.y=a.BLOCK.height/2-this.height/2,this.shadow.scale.y=this.shadow.initScale,this.shadow.position.z=this.shadow.initZ,this.boundingBox=null}},{key:"rebound",value:function(){this.status="stop",this.scale=1,s.customAnimation.to(this.body.scale,.5,{ease:"Elastic.easeOut",y:1}),s.customAnimation.to(this.body.position,.5,{ease:"Elastic.easeOut",y:a.BLOCK.height/2-this.height/2}),s.customAnimation.to(this.shadow.scale,.5,{ease:"Elastic.easeOut",y:this.shadow.initScale}),s.customAnimation.to(this.shadow.position,.5,{ease:"Elastic.easeOut",z:this.shadow.initZ})}},{key:"update",value:function(){19==this.order&&(this.record.rotation.y+=.01),"stop"!==this.status&&("shrink"===this.status?this._shrink():this.status)}}]),e}();t.default=P},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i(0)),o=i(5),a=i(1),s=function(e){return e&&e.__esModule?e:{default:e}}(i(9)),l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.obj=new r.Object3D,this.obj.name="bottle",this.trail=null,this.bottle=new r.Object3D;var t=new r.MeshBasicMaterial({map:a.loader.load("res/head.png")});this.human=new r.Object3D,this.head=new r.Mesh(new r.SphereGeometry(2.1*.45,20,20),t),this.head.castShadow=!0,this.bottom=new r.Mesh(new r.CylinderGeometry(.8316,1.20015,2.1*.45*2.68,20),new r.MeshBasicMaterial({map:a.loader.load("res/bottom.png")})),this.bottom.rotation.y=4.7,this.bottom.castShadow=!0;var i=new r.CylinderGeometry(2.1*.45,.8316,2.1*.45*1.2,20),n=[new r.MeshBasicMaterial({map:a.loader.load("res/top.png")}),t],o=new r.Geometry;i.rotateY(4.7),this.merge(o,i,0,[{x:0,y:this.bottom.position.y+2.1*.45*1.94,z:0}]);var l=new r.SphereGeometry(2.1*.45,20,20);l.scale(1,.54,1),this.merge(o,l,1,[{x:0,y:this.bottom.position.y+2.4003,z:0}]),this.middle=new r.Mesh(o,n),this.middle.castShadow=!0,this.body=new r.Object3D,this.body.add(this.bottom),this.body.add(this.middle),this.human.add(this.body),this.head.position.y=4.725,this.human.add(this.head),this.bottle.add(this.human),this.bottle.position.y=a.BOTTLE.bodyHeight/2-.25,this.obj.add(this.bottle),this.status="stop",this.scale=1,this.double=1,this.velocity={},this.flyingTime=0,this.direction="straight",this.jumpStatus="init",this.particles=[];for(var c=new r.MeshBasicMaterial({map:a.loader.load("res/white.png"),alphaTest:.5}),h=new r.MeshBasicMaterial({map:a.loader.load("res/green.png"),alphaTest:.5}),u=new r.PlaneGeometry(1,1),d=0;d<15;++d){(f=new r.Mesh(u,c)).rotation.y=-Math.PI/4,f.rotation.x=-Math.PI/5,f.rotation.z=-Math.PI/5,this.particles.push(f),this.obj.add(f)}for(d=0;d<5;++d){var f=new r.Mesh(u,h);f.rotation.y=-Math.PI/4,f.rotation.x=-Math.PI/5,f.rotation.z=-Math.PI/5,this.particles.push(f),this.obj.add(f)}this.scoreText=new s.default("0",{fillStyle:2434341,textAlign:"center",plusScore:!0}),this.scoreText.obj.visible=!1,this.scoreText.obj.rotation.y=-Math.PI/4,this.scoreText.obj.scale.set(.5,.5,.5),this.obj.add(this.scoreText.obj)}return n(e,[{key:"merge",value:function(e,t,i,n){for(var o=0,a=t.faces.length;o<a;++o)t.faces[o].materialIndex=0;for(var s=new r.Mesh(t),o=0,a=n.length;o<a;++o)s.position.set(n[o].x,n[o].y,n[o].z),s.updateMatrix(),e.merge(s.geometry,s.matrix,i)}},{key:"showAddScore",value:function(e,t,i,n){n?this.scoreText.setScore(e.toString()):(t?1===this.double?this.double=2:this.double+=2:this.double=1,i&&this.double<=2&&(this.double*=2),this.double=Math.min(32,this.double),e*=this.double,this.scoreText.setScore(e.toString())),this.scoreText.obj.visible=!0,this.scoreText.obj.position.y=3,this.scoreText.material.opacity=1,(0,o.TweenAnimation)(this.scoreText.obj.position.y,a.BOTTLE.bodyHeight+6,700,function(e){this.scoreText.obj.position.y=e}.bind(this)),(0,o.TweenAnimation)(this.scoreText.material.opacity,0,700,function(e,t){this.scoreText.material.opacity=e,t&&(this.scoreText.obj.visible=!1)}.bind(this))}},{key:"changeScorePos",value:function(e){this.scoreText.obj.position.z=e}},{key:"resetParticles",value:function(){this.gatherTimer&&clearTimeout(this.gatherTimer),this.gatherTimer=null;for(var e=0,t=this.particles.length;e<t;++e)this.particles[e].gathering=!1,this.particles[e].visible=!1,this.particles[e].scattering=!1}},{key:"scatterParticles",value:function(){for(var e=0;e<10;++e)this.particles[e].scattering=!0,this.particles[e].gathering=!1,this._scatterParticles(this.particles[e])}},{key:"_scatterParticles",value:function(e){var t=a.BOTTLE.bodyWidth/2,i=(t+Math.random()*(2-t))*(1-2*Math.random()),n=(t+Math.random()*(2-t))*(1-2*Math.random());e.scale.set(1,1,1),e.visible=!1,e.position.x=i,e.position.y=-.5,e.position.z=n,setTimeout(function(e){return function(){if(e.scattering){e.visible=!0;var t=.3+.2*Math.random();o.customAnimation.to(e.scale,t,{x:.2,y:.2,z:.2}),o.customAnimation.to(e.position,t,{x:2*i,y:2.5*Math.random()+2,z:2*n,onComplete:function(){e.scattering=!1,e.visible=!1}})}}}(e),0)}},{key:"gatherParticles",value:function(){for(var e=this,t=10;t<20;++t)this.particles[t].gathering=!0,this.particles[t].scattering=!1,this._gatherParticles(this.particles[t]);this.gatherTimer=setTimeout(function(){for(var t=0;t<10;++t)e.particles[t].gathering=!0,e.particles[t].scattering=!1,e._gatherParticles(e.particles[t])},500+1e3*Math.random())}},{key:"_gatherParticles",value:function(e){var t=this;e.scale.set(1,1,1),e.visible=!1;var i=Math.random()>.5?1:-1,n=Math.random()>.5?1:-1;e.position.x=(1+7*Math.random())*i,e.position.y=1+7*Math.random(),e.position.z=(1+7*Math.random())*n,setTimeout(function(e){return function(){if(e.gathering){e.visible=!0;var r=.5+.4*Math.random();(0,o.TweenAnimation)(e.scale.x,.8+Math.random(),1e3*r,function(t){e.scale.x=t}),(0,o.TweenAnimation)(e.scale.y,.8+Math.random(),1e3*r,function(t){e.scale.y=t}),(0,o.TweenAnimation)(e.scale.z,.8+Math.random(),1e3*r,function(t){e.scale.z=t}),(0,o.TweenAnimation)(e.position.x,Math.random()*i,1e3*r,function(t){e.position.x=t}),(0,o.TweenAnimation)(e.position.y,2.5*Math.random(),1e3*r,function(t){e.position.y=t}),(0,o.TweenAnimation)(e.position.z,Math.random()*n,1e3*r,function(i,n){e.position.z=i,n&&e.gathering&&t._gatherParticles(e)})}}}(e),500*Math.random())}},{key:"update",value:function(e){"stop"!=this.status&&("prepare"==this.status?this._prepare():"jump"==this.status?this._jump(e):"turn"==this.status&&this.turn())}},{key:"lookAt",value:function(e,t){e!==this.direction&&("straight"===e?(this.turnAngle=-Math.PI/2,this.angle=0):(this.turnAngle=Math.PI/2,this.angle=Math.PI/2),this.direction=e)}},{key:"turn",value:function(){var e=this.turnAngle>0?.2:-.2;this.bottle.rotation.y+=e,this.turnAngle-=e,this.turnAngle>=-.2&&this.turnAngle<=.2&&(this.bottle.rotation.y=this.angle,this.status="stop")}},{key:"fall",value:function(){var e=this;this.stop(),setTimeout(function(){e.status="fall",(0,o.TweenAnimation)(e.obj.position.y,-a.BLOCK.height/2-.3,400,function(e){this.obj.position.y=e}.bind(e))},0)}},{key:"forerake",value:function(){var e=this;this.stop(),this.status="forerake",setTimeout(function(){"straight"===e.direction?(0,o.TweenAnimation)(e.obj.rotation.z,-Math.PI/2,1e3,function(e){this.obj.rotation.z=e}.bind(e)):(0,o.TweenAnimation)(e.obj.rotation.x,-Math.PI/2,1e3,function(e){this.obj.rotation.x=e}.bind(e)),setTimeout(function(){"suspend"!=e.status?((0,o.TweenAnimation)(e.obj.position.y,-a.BLOCK.height/2+1.2,400,function(e,t){this.obj.position.y=e}.bind(e)),o.customAnimation.to(e.head.position,.2,{x:-1.125}),o.customAnimation.to(e.head.position,.2,{x:0,delay:.2})):e.status="stop"},200)},200)}},{key:"hypsokinesis",value:function(){var e=this;this.stop(),this.status="hypsokinesis",setTimeout(function(){"straight"===e.direction?(0,o.TweenAnimation)(e.obj.rotation.z,Math.PI/2,800,function(e){this.obj.rotation.z=e}.bind(e)):(0,o.TweenAnimation)(e.obj.rotation.x,Math.PI/2,800,function(e){this.obj.rotation.x=e}.bind(e)),setTimeout(function(){"suspend"!=e.status?((0,o.TweenAnimation)(e.obj.position.y,-a.BLOCK.height/2+1.2,400,function(e,t){this.obj.position.y=e}.bind(e)),o.customAnimation.to(e.head.position,.2,{x:1.125}),o.customAnimation.to(e.head.position,.2,{x:0,delay:.2})):e.status="stop"},350)},200)}},{key:"_jump",value:function(e){var t=new r.Vector3(0,0,0);t.z=this.velocity.vz*e,t.y=this.velocity.vy*e-a.GAME.gravity/2*e*e-a.GAME.gravity*this.flyingTime*e,this.flyingTime+=e,this.obj.translateY(t.y),this.obj.translateOnAxis(this.axis,t.z)}},{key:"squeeze",value:function(){this.obj.position.y=a.BLOCK.height/2,o.customAnimation.to(this.body.scale,.15,{y:.9,x:1.07,z:1.07}),o.customAnimation.to(this.body.scale,.15,{y:1,x:1,z:1,delay:.15}),o.customAnimation.to(this.head.position,.15,{y:4.725,delay:.15})}},{key:"stop",value:function(){this.status="stop",this.flyingTime=0,this.scale=1,this.velocity={},this.jumpStatus="init"}},{key:"suspend",value:function(){this.status="suspend",o.TweenAnimation.killAll()}},{key:"rotate",value:function(){if(o.TweenAnimation.killAll(),"straight"===this.direction){(0,o.TweenAnimation)(this.obj.rotation.z,0,300,function(e){this.obj.rotation.z=e}.bind(this));var e;e=this.status.indexOf("forerake")>=0?2:-2,(0,o.TweenAnimation)(this.obj.position.x,this.obj.position.x+e,300,function(e){this.obj.position.x=e}.bind(this))}else(0,o.TweenAnimation)(this.obj.rotation.x,0,300,function(e){this.obj.rotation.x=e}.bind(this)),e=this.status.indexOf("forerake")>=0?-2:2,(0,o.TweenAnimation)(this.obj.position.z,this.obj.position.z+e,300,function(e){this.obj.position.z=e}.bind(this));(0,o.TweenAnimation)(this.head.position.x,0,100,function(e){this.head.position.x=e}.bind(this)),(0,o.TweenAnimation)(this.obj.position.y,-a.BLOCK.height/2,300,function(e,t){this.obj.position.y=e,t&&(this.status="stop")}.bind(this)),this.status="rotate"}},{key:"_prepare",value:function(){if(this.scale-=a.BOTTLE.reduction,this.scale=Math.max(a.BOTTLE.minScale,this.scale),!(this.scale<=a.BOTTLE.minScale)){this.body.scale.y=this.scale,this.body.scale.x+=.007,this.body.scale.z+=.007,this.head.position.y-=.018;this.obj.position.y-=a.BLOCK.reduction/2*a.BLOCK.height/2+.027}}},{key:"prepare",value:function(){this.status="prepare",this.gatherParticles()}},{key:"jump",value:function(e){this.resetParticles(),this.status="jump",this.axis=e,o.customAnimation.to(this.body.scale,.25,{x:1,y:1,z:1}),this.head.position.y=4.725,this.scale=1;var t=Math.min(Math.max(this.velocity.vz/35,1.2),1.4);this.human.rotation.z=this.human.rotation.x=0,"straight"===this.direction?(o.customAnimation.to(this.human.rotation,.14,{z:this.human.rotation.z-Math.PI}),o.customAnimation.to(this.human.rotation,.18,{z:this.human.rotation.z-2*Math.PI,delay:.14}),o.customAnimation.to(this.head.position,.1,{y:this.head.position.y+.9*t,x:this.head.position.x+.45*t}),o.customAnimation.to(this.head.position,.1,{y:this.head.position.y-.9*t,x:this.head.position.x-.45*t,delay:.1}),o.customAnimation.to(this.head.position,.15,{y:4.725,x:0,delay:.25}),o.customAnimation.to(this.body.scale,.1,{y:Math.max(t,1),x:Math.max(Math.min(1/t,1),.7),z:Math.max(Math.min(1/t,1),.7)}),o.customAnimation.to(this.body.scale,.1,{y:Math.min(.9/t,.7),x:Math.max(t,1.2),z:Math.max(t,1.2),delay:.1}),o.customAnimation.to(this.body.scale,.3,{y:1,x:1,z:1,delay:.2})):(o.customAnimation.to(this.human.rotation,.14,{x:this.human.rotation.x-Math.PI}),o.customAnimation.to(this.human.rotation,.18,{x:this.human.rotation.x-2*Math.PI,delay:.14}),o.customAnimation.to(this.head.position,.1,{y:this.head.position.y+.9*t,z:this.head.position.z-.45*t}),o.customAnimation.to(this.head.position,.1,{z:this.head.position.z+.45*t,y:this.head.position.y-.9*t,delay:.1}),o.customAnimation.to(this.head.position,.15,{y:4.725,z:0,delay:.25}),o.customAnimation.to(this.body.scale,.05,{y:Math.max(t,1),x:Math.max(Math.min(1/t,1),.7),z:Math.max(Math.min(1/t,1),.7)}),o.customAnimation.to(this.body.scale,.05,{y:Math.min(.9/t,.7),x:Math.max(t,1.2),z:Math.max(t,1.2),delay:.1}),o.customAnimation.to(this.body.scale,.2,{y:1,x:1,z:1,delay:.2}))}},{key:"showup",value:function(){this.status="showup",this.obj.position.y=25,this.human.rotation.x=this.human.rotation.z=0,(0,o.TweenAnimation)(this.obj.position.y,a.BLOCK.height/2,500,"Bounce.easeOut",function(e,t){this.obj.position.y=e,t&&(this.status="stop")}.bind(this))}},{key:"stopPrepare",value:function(){this.obj.position.y=a.BLOCK.height/2,this.stop(),this.body.scale.set(1,1,1),this.head.position.y=4.725,this.head.position.x=0,this.resetParticles()}},{key:"getBox",value:function(){return[(new r.Box3).setFromObject(this.head),(new r.Box3).setFromObject(this.middle),(new r.Box3).setFromObject(this.bottom)]}},{key:"reset",value:function(){this.stop(),this.obj.position.y=a.BLOCK.height/2,this.obj.position.x=this.obj.position.z=0,this.obj.rotation.z=0,this.obj.rotation.y=0,this.obj.rotation.x=0,this.bottle.rotation.y=0,this.bottle.rotation.z=0,this.bottle.rotation.x=0,this.body&&this.head&&(this.body.scale.set(1,1,1),this.body.rotation.z=0,this.body.rotation.x=0,this.head.position.y=4.725,this.head.position.x=0,this.human.rotation.z=this.human.rotation.x=0),this.direction="straight",this.jumpStatus="init",this.double=1,this.resetParticles(),this.scoreText.obj.visible=!1}}]),e}();t.default=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,this.commandList=[],this.isRunning=!1,this.icTimeout=null,this.cmdHandler=function(){},this.gameId=0,this.seq=0,this.currentSeq=null,this.waited=!1}return n(e,[{key:"onReceiveCommand",value:function(e,t){e._seq=t,this.gameId!=this.game.gameCtrl.modeCtrl.observeCtrl.gameId&&(this.gameId=this.game.gameCtrl.modeCtrl.observeCtrl.gameId,this.seq=t-1);var i=t-this.seq;if(1!=i){var n;i>1&&(n=0),i<1&&(n=1),this.game.sendServerError(n),this.game.socketFirstSync=!0}this.seq=t,(!this.currentSeq||t>this.currentSeq)&&(this.commandList.push(e),this.commandList.sort(function(e,t){return e._seq-t._seq}),this.checkRunningState())}},{key:"checkRunningState",value:function(){this.isRunning||this.runCommand()}},{key:"runCommand",value:function(){var e=this,t=this.commandList[0];if(t)if(this.isRunning=!0,!this.currentSeq||this.currentSeq&&t._seq-this.currentSeq==1)this.waited=!1,this.currentSeq=t._seq,this.commandList.shift(),this.cmdHandler(t);else if(t._seq-this.currentSeq>1){if(this.waited)return this.waited=!1,this.currentSeq=t._seq,this.commandList.shift(),void this.cmdHandler(t);this.waited=!0,this.timer=setTimeout(function(){e.runCommand()},100)}}},{key:"bindCmdHandler",value:function(e){this.cmdHandler=e}},{key:"onCmdComplete",value:function(){this.commandList.length?this.runCommand():this.isRunning=!1}},{key:"destroy",value:function(){this.timer&&(clearTimeout(this.timer),this.timer=null),this.commandList=[],this.gameId=0,this.seq=0,this.currentSeq=null,this.waited=!1,this.icTimeout&&clearTimeout(this.icTimeout),this.icTimeout=null,this.isRunning=!1}}]),e}();t.default=r},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=n(i(39)),a=n(i(35)),s=n(i(36)),l=(i(5),i(1)),c=n(i(6)),h=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t}return r(e,[{key:"init",value:function(){this.gameView=this.game.gameView,this.queryCtrl=new o.default(this.game),this.netWorkCtrl=new s.default(this.game),this.modeCtrl=new a.default(this.game),this.model=this.game.gameModel,this.reporter=this.game.reporter,this.historyTimes=this.game.historyTimes,this.viewer=this.game.viewer,this.reUpLoadShowOverPage=!0}},{key:"firstInitGame",value:function(e){this.queryCtrl.identifyMode(e),this.modeCtrl.initFirstPage(e)}},{key:"identifyModeErr",value:function(e){this.gameView.showIdentifyModeErr(e)}},{key:"onLoginSuccess",value:function(){this.reporter.setTimer(l.REPORTERTIMEOUT),this.checkLaterUpLoad()}},{key:"clickStart",value:function(){this.modeCtrl.clickStart()}},{key:"showFriendRank",value:function(){this.modeCtrl.showFriendRank()}},{key:"clickRank",value:function(){this.modeCtrl.clickRank()}},{key:"gameOver",value:function(e){if(this.model.setScore(e),"observe"!=this.model.mode){var t=this.model.getHighestScore();this.historyTimes.addOne();var i=this.historyTimes.getTimes();this.reporter.playGameReport(e,t,i),this.netWorkCtrl.upDateFriendsScoreList()}"player"==this.model.mode&&this.reporter.playAudienceReport(),"battle"==this.model.mode&&this.reporter.playPKReport(e),this.reporter.sendReport()}},{key:"gameOverShowPage",value:function(){if(this.reUpLoadShowOverPage=!0,"observe"==this.model.mode)this.modeCtrl.showGameOverPage();else{this.model.getHighestScore();var e=this.model.weekBestScore,t=this.model.currentScore;if(t<e)this.modeCtrl.showGameOverPage(),this.historyTimes.checkUp();else{var i={seed:this.game.randomSeed,action:this.game.actionList,musicList:this.game.musicList,touchList:this.game.touchList,steps:this.game.touchMoveList,timestamp:this.game.touchStartTime,version:l.VERSION},n=this.historyTimes.getTimes();this.model.upLoadScoreData={currentScore:t,gameTimes:n,verifyData:i},this.netWorkCtrl.requestSettlement(t,n,this.afterRequestSettlement.bind(this),i)}}}},{key:"afterRequestSettlement",value:function(e,t){if(e){if(this.reUpLoadShowOverPage&&this.modeCtrl.showGameOverPage(t),this.historyTimes.afterUpload(!0),"observe"==this.model.mode)return;var i=this.model.upLoadScoreData.currentScore;if(void 0==i||t&&t.banType)return;i>=this.model.weekBestScore&&(this.model.weekBestScore=i,this.model.saveWeekBestScore(i),i>this.model.getHighestScore()&&this.model.saveHeighestScore(this.model.currentScore))}else this.netWorkCtrl.sendServerError(),this.showReUpLoadScoreModel(t)}},{key:"showReUpLoadScoreModel",value:function(e){var t=this;wx.showModal({title:"提示",content:"分数上传失败,请检查网络状态后重试("+e+")",confirmText:"重试",cancelText:"延后上传",success:function(i){i.confirm?t.reUploadScore():i.cancel?t.reUpLoadShowOverPage&&t.showOverPage(!0):t.showReUpLoadScoreModel(e)},fail:function(){t.reUpLoadShowOverPage&&t.showOverPage(!1)}})}},{key:"showOverPage",value:function(e){if(this.modeCtrl.showGameOverPage(),e&&"observe"!=this.model.mode){if(!this.model.upLoadScoreData.verifyData||!this.model.upLoadScoreData.currentScore)return;var t=this.model.getActionData(),i=this.model.upLoadScoreData.verifyData,n=this.model.upLoadScoreData.currentScore;t&&t.ts>Date.now()&&t.score>=n||this.model.saveLaterUpLoadScore(n,i)}}},{key:"reUploadScore",value:function(){var e=this;c.default.sessionId?this.reUploadScore2():this.netWorkCtrl.requestLogin(function(t){t?e.reUploadScore2():e.showReUpLoadScoreModel("n0")})}},{key:"reUploadScore2",value:function(){var e=this.model.upLoadScoreData,t=e.currentScore,i=e.gameTimes,n=e.verifyData;this.netWorkCtrl.requestSettlement(t,i,this.afterRequestSettlement.bind(this),n)}},{key:"clickReplay",value:function(){this.reporter.playAudienceReportStart(),this.modeCtrl.gameOverClickReplay()}},{key:"friendRankReturn",value:function(){this.modeCtrl.friendRankReturn()}},{key:"netWorkLogin",value:function(){this.netWorkCtrl.netWorkLogin()}},{key:"shareGroupRank",value:function(){this.modeCtrl.shareGroupRank()}},{key:"afterShareGroupRank",value:function(e,t){this.reporter.shareGroupReport(t)}},{key:"shareBattleCard",value:function(){this.modeCtrl.shareBattleCard()}},{key:"afterShareBattle",value:function(e,t){e&&this.reporter.sharePKReport(t)}},{key:"groupPlayGame",value:function(){this.modeCtrl.groupPlayGame()}},{key:"loginBattle",value:function(e){this.reporter.joinPKReport(e),this.reporter.playPKReportStart(e)}},{key:"showPkPage",value:function(e){this.reporter.playPKScore(e)}},{key:"onBattlePlay",value:function(e){this.modeCtrl.battlePlay(e)}},{key:"battleToSingle",value:function(){this.reporter.resetPKReport()}},{key:"shareObservCard",value:function(){this.modeCtrl.shareObservCard()}},{key:"socketJoinSuccess",value:function(e){this.modeCtrl.socketJoinSuccess(e),"observe"==this.model.mode?e?(this.game.socketFirstSync=!0,this.reporter.joinAudienceReportStart()):this.reporter.joinAudienceReport():e&&this.reporter.playAudienceReportStart()}},{key:"afterShareObserveCard",value:function(e){this.reporter.shareAudienceReport(e)}},{key:"showPlayerGG",value:function(e){this.modeCtrl.showPlayerGG(e)}},{key:"showPlayerWaiting",value:function(){this.modeCtrl.showPlayerWaiting()}},{key:"onPlayerOut",value:function(){this.modeCtrl.onPlayerOut()}},{key:"onViewerStart",value:function(){this.game.audioManager.scale_intro.stop(),this.game.deadTimeout&&(clearTimeout(this.game.deadTimeout),this.game.deadTimeout=null),this.game.pendingReset=!1,this.modeCtrl.onViewerStart(),this.reporter.joinAudienceReport()}},{key:"wxOnShow",value:function(e){var t=this;this.netWorkCtrl.requestServerInit(),this.reporter.setTimer(l.REPORTERTIMEOUT),setTimeout(function(){e.query&&e.query.hasOwnProperty("mode")?(t.reUpLoadShowOverPage=!1,t.modeCtrl.reInitFirstPage(e),t.game.guider=!1):"single"!=t.model.mode&&"player"!=t.model.mode&&"battle"!=t.model.mode&&(t.reUpLoadShowOverPage=!1,t.modeCtrl.changeMode("singleCtrl"),t.game.guider=!1)},300)}},{key:"wxOnhide",value:function(){this.reporter.quitReport(),"observe"==this.model.mode&&this.reporter.joinAudienceReport(),this.netWorkCtrl.clearServerInit(),this.reporter.clearTimer(),this.modeCtrl.wxOnhide()}},{key:"onReplayGame",value:function(){"observe"!=this.model.mode&&(this.reporter.playGameReportStart(),this.reporter.gameBeginReport())}},{key:"onPeopleCome",value:function(e){0==e.audience_cmd?(this.viewer.peopleCome(e),this.reporter.playAudienceReportMaxPeople(this.viewer.num)):1==e.audience_cmd&&this.viewer.peopleOut(e)}},{key:"onServerConfigForbid",value:function(){}},{key:"onSocketCloseErr",value:function(){this.gameView.showSocketCloseErr(),this.modeCtrl.changeMode("singleCtrl")}},{key:"appealNotify",value:function(){this.modeCtrl.appealNotify()}},{key:"checkLaterUpLoad",value:function(e){var t=this,i=this.model.getActionData();if(i&&i.ts>Date.now()&&i.score){var n=i.score,r=i.data,o=this.historyTimes.getTimes();e?this.netWorkCtrl.requestSettlement(n,o,this.afterCheckLaterUpLoad.bind(this,n),r):wx.showModal({title:"提示",content:"当前有分数未上传成功，是否重试",confirmText:"重试",cancelText:"取消",success:function(e){e.confirm?t.netWorkCtrl.requestSettlement(n,o,t.afterCheckLaterUpLoad.bind(t,n),r):e.cancel?t.model.clearLaterUpLoadScore():t.checkLaterUpLoad()},fail:function(){t.checkLaterUpLoad()}})}}},{key:"afterCheckLaterUpLoad",value:function(e,t,i){var n=this;if(t)return wx.showToast({title:"分数上传成功",icon:"success",duration:1e3}),this.model.clearLaterUpLoadScore(),e>this.model.weekBestScore&&(this.model.weekBestScore=e,this.model.saveWeekBestScore(e)),void(e>this.model.highestScore&&this.model.saveHeighestScore(e));wx.showModal({title:"提示",content:"分数延后上传失败,请检查网络状态后重试("+i+")",confirmText:"重试",cancelText:"延后上传",success:function(e){e.confirm?n.checkLaterUpLoad(!0):e.cancel||n.afterCheckLaterUpLoad(!1,i)},fail:function(){n.afterCheckLaterUpLoad(!1,i)}})}}]),e}();t.default=h},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=n(i(3)),a=n(i(6)),s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,this.mode="",this.stage="",this.is_from_wn=0,this.firstBlood=!1,this.currentScore=0,this.highestScore=0,this.observeInfo={},this.friendsScore=[],this.weekBestScore=0,this.startTime=Math.floor(Date.now()/1e3),this.upLoadScoreData={}}return r(e,[{key:"setMode",value:function(e){this.mode=e,this.game.mode=e}},{key:"setStage",value:function(e){this.stage=e,this.game.stage=e}},{key:"init",value:function(){a.default.init();o.default.getFirstBlood()||(this.setFirstBlood(!0),o.default.saveFirstBlood()),this.highestScore=o.default.getHeighestScore()||0,a.default.setServerConfig(o.default.getServerConfig()),this.weekBestScore=o.default.getWeekBestScore()||0,this.friendsScore=o.default.getFriendsScore()}},{key:"getServerConfig",value:function(){return a.default.serverConfig}},{key:"setIsFromWn",value:function(e){this.is_from_wn=e,this.game.is_from_wn=e}},{key:"setFirstBlood",value:function(e){this.firstBlood=e,this.game.firstBlood=e}},{key:"getMode",value:function(){return this.mode}},{key:"setScore",value:function(e){this.currentScore=e}},{key:"saveHeighestScore",value:function(e){o.default.saveHeighestScore(e),this.highestScore=e}},{key:"saveLaterUpLoadScore",value:function(e,t){if(e&&t){var i={ts:this.getNextSunday(),score:e,data:t};o.default.saveActionData(i)}}},{key:"clearLaterUpLoadScore",value:function(){o.default.saveActionData("")}},{key:"saveWeekBestScore",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t={ts:this.getNextSunday(),data:e};o.default.saveWeekBestScore(t)}},{key:"getActionData",value:function(){return o.default.getActionData()}},{key:"getHighestScore",value:function(){return this.highestScore}},{key:"saveFriendsScore",value:function(e){this.friendsScore=e;var t={ts:this.getNextSunday(),data:e};o.default.saveFriendsScore(t)}},{key:"getSessionId",value:function(){return a.default.sessionId}},{key:"getPkId",value:function(){return a.default.pkId}},{key:"clearPkId",value:function(){a.default.clearPkId()}},{key:"setShareTicket",value:function(e){a.default.setShareTicket(e)}},{key:"getShareTicket",value:function(){return a.default.shareTicket}},{key:"clearShareTicket",value:function(){a.default.clearShareTicket()}},{key:"setGameId",value:function(e){a.default.setGameId(e)}},{key:"setGameTicket",value:function(e){a.default.setGameTicket(e)}},{key:"clearGameId",value:function(){a.default.clearGameId()}},{key:"clearGameTicket",value:function(){a.default.clearGameTicket()}},{key:"setObserveInfo",value:function(e){this.observeInfo.headimg=e.headimg,this.observeInfo.nickName=e.nickName}},{key:"clearObserveInfo",value:function(){this.observeInfo.headimg=null,this.observeInfo.nickName=null}},{key:"getNextSunday",value:function(){var e=new Date,t=e.getDay();e.setHours(0,0,0,0);var i=7-t+1;8==i&&(i=1);return e.valueOf()+24*i*60*60*1e3}}]),e}();t.default=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t}return n(e,[{key:"init",value:function(){}},{key:"showIdentifyModeErr",value:function(e){this.showModal(e)}},{key:"showNoSession",value:function(){this.showModal()}},{key:"showGetPkIdFail",value:function(){this.showModal()}},{key:"showGroupShareFail",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"网络异常,点击确定回到游戏";this.showModal(e)}},{key:"showGoToBattleFail",value:function(){this.showModal()}},{key:"showUploadPkScoreFail",value:function(){this.showModal("数据上传失败")}},{key:"showShareObserveCardFail",value:function(e){this.showModal(e)}},{key:"showObserveStateFail",value:function(){this.showModal("服务器异常")}},{key:"showModal",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"网络异常,点击确定回到游戏";wx.showModal({title:"提示",content:e,showCancel:!1})}},{key:"showServeConfigForbiddenObserveMode",value:function(){this.showModal("当前围观人数过多，请稍后再试")}},{key:"showServeConfigForbiddenGroupShare",value:function(){this.showModal("查看群排行人数过多，请稍后再试")}},{key:"showSocketCloseErr",value:function(){}},{key:"showSyncopErr",value:function(){}}]),e}();t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i(0)),o=i(1),a=i(5),s=window.innerHeight>window.innerWidth?window.innerHeight:window.innerWidth,l=window.innerHeight<window.innerWidth?window.innerHeight:window.innerWidth,c=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.obj=new r.Object3D,this.obj.name="ground";var i=new r.PlaneGeometry(l/s*o.FRUSTUMSIZE,o.FRUSTUMSIZE);this.materials=[],this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=64,this.canvas.height=64;for(var n=[["rgba(215, 219, 230, 1)","rgba(188, 190, 199, 1)"],["rgba(255, 231, 220, 1)","rgba(255, 196, 204, 1)"],["rgba(255, 224, 163, 1)","rgba(255, 202, 126, 1)"],["rgba(255, 248, 185, 1)","rgba(255, 245, 139, 1)"],["rgba(218, 244, 255, 1)","rgba(207, 233, 210, 1)"],["rgba(219, 235, 255, 1)","rgba(185, 213, 235, 1)"],["rgba(216, 218, 255, 1)","rgba(165, 176, 232, 1)"],["rgba(207, 207, 207, 1)","rgba(199, 196, 201, 1)"]],a=this,c=0;c<7;++c)setTimeout(function(e){return function(){a.generateLaserBodyCanvas(n[e][0],n[e][1]);var t=new r.Texture(a.canvas);t.needsUpdate=!0;var o=new r.MeshBasicMaterial({map:t,opacity:1,transparent:!0});a.materials.push(o);var s=new r.Mesh(i,o);s.position.z=.1*-(e+1),s.name=e,s.updateMatrix(),s.matrixAutoUpdate=!1,a.obj.add(s)}}(c),1e3*c);setTimeout(function(){for(var e=1;e<7;++e)t.obj.children[e].visible=!1},8e3),this.current=0}return n(e,[{key:"generateLaserBodyCanvas",value:function(e,t){this.context.clearRect(0,0,this.canvas.width,this.canvas.height);var i=this.context.createLinearGradient(0,0,0,this.canvas.height);i.addColorStop(0,e),i.addColorStop(1,t),this.context.fillStyle=i,this.context.fillRect(0,0,this.canvas.width,this.canvas.height)}},{key:"changeColor",value:function(){var e=this,t=this.current+1>6?0:this.current+1,i=this.current;a.customAnimation.to(this.materials[this.current],5,{opacity:0,onComplete:function(){e.obj.children[i].visible=!1}}),this.obj.children[t].visible=!0,a.customAnimation.to(this.materials[t],4,{opacity:1}),this.current=t}}]),e}();t.default=c},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(e){return e&&e.__esModule?e:{default:e}}(i(2)),o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.timeOut=null,this.reportList=[],this.pkState={isGroup:0,score:0},this.singleState=0,this.observeState={startTime:0,success:0},this.playerState={startTime:0,maxAudience:0},this.gameStartTime=0;try{var t=wx.getSystemInfoSync();this.clientInfo={platform:t.platform,brand:t.brand,model:t.model,system:t.system}}catch(e){console.log(e)}}return n(e,[{key:"getTime",value:function(){var e=Date.now();return e=Math.floor(e/1e3)}},{key:"enterReport",value:function(e){if(this.gameStartTime=this.getTime(),e){var t={ts:this.getTime(),type:0,scene:e};this.reportList.push(t)}}},{key:"quitReport",value:function(){if(this.gameStartTime){var e={ts:this.getTime(),type:1,duration:this.getTime()-this.gameStartTime};this.reportList.push(e)}}},{key:"playGameReport",value:function(e,t,i){if(this.singleState){var n={ts:this.getTime(),type:2,score:e,best_score:t,break_record:e>t?1:0,duration:this.getTime()-this.singleState,times:i};this.reportList.push(n),this.singleState=0}}},{key:"playGameReportStart",value:function(){this.singleState=this.getTime()}},{key:"shareAudienceReport",value:function(e){var t={ts:this.getTime(),type:3,is_group:e};this.reportList.push(t)}},{key:"playAudienceReport",value:function(){if(this.playerState.startTime){var e={ts:this.getTime(),type:4,duration:this.getTime()-this.playerState.startTime,max_audience:this.playerState.maxAudience};this.reportList.push(e),this.playerState.startTime=0,this.playerState.maxAudience=0}}},{key:"playAudienceReportStart",value:function(){this.playerState.startTime=this.getTime()}},{key:"playAudienceReportMaxPeople",value:function(e){this.playerState.maxAudience<e&&(this.playerState.maxAudience=e)}},{key:"joinAudienceReport",value:function(){var e=0==this.observeState.startTime?0:this.getTime()-this.observeState.startTime,t={ts:this.getTime(),type:5,duration:e,join_audience_success:this.observeState.success};this.reportList.push(t),this.observeState.startTime=0,this.observeState.success=0}},{key:"joinAudienceReportStart",value:function(){this.observeState.startTime=this.getTime(),this.observeState.success=1}},{key:"shareGroupReport",value:function(e){var t={ts:this.getTime(),type:6,is_group:e};this.reportList.push(t)}},{key:"sharePKReport",value:function(e){var t={ts:this.getTime(),type:7,is_group:e};this.reportList.push(t)}},{key:"joinPKReport",value:function(e){var t={ts:this.getTime(),type:8,is_group:e};this.reportList.push(t)}},{key:"playPKReport",value:function(e){var t=0;e==this.pkState.score&&(t=1),e>this.pkState.score&&(t=3);var i={ts:this.getTime(),type:9,is_group:this.pkState.isGroup,result:t};this.reportList.push(i)}},{key:"playPKReportStart",value:function(e){this.pkState.isGroup=e}},{key:"playPKScore",value:function(e){this.pkState.score=e}},{key:"resetPKReport",value:function(){this.pkState.isGroup=0,this.pkState.score=0}},{key:"gameBeginReport",value:function(){var e={ts:this.getTime(),type:10};this.reportList.push(e)}},{key:"sendReport",value:function(){this.reportList.length&&(r.default.sendReport(this.reportList,this.clientInfo),this.reportList=[])}},{key:"clearTimer",value:function(){this.timeOut&&clearInterval(this.timeOut)}},{key:"setTimer",value:function(e){this.timeOut=setInterval(this.sendReport.bind(this),e)}}]),e}();t.default=o},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=n(i(6)),a=n(i(2)),s=function(){function e(t){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.alive=!1,this.noErr=!1,this.game=t,this.handlers={},this.handleSocketErr="",this.heartBeat=[],this.cmdPool={},wx.onSocketOpen(function(e){i.joinGame()}),wx.onSocketClose(function(e){"player"!=i.game.mode||i.noErr||(a.default.quitGame(),i.game.gameCtrl.onSocketCloseErr()),"observe"!=i.game.mode||i.noErr||i.game.gameCtrl.onSocketCloseErr(),i.alive=!1}),wx.onSocketError(function(e){}),wx.onSocketMessage(function(e){i.cleanHeartBeat(),i.heartBeat.push(setTimeout(i.sendHeartBeat.bind(i),5e3));var t;try{t=JSON.parse(e.data)}catch(e){return i.game.handleWxOnError({message:"socket receive wrong msg JSON.parse(res.data) error",stack:""}),void wx.closeSocket()}106===t.cmd&&i.handleACK(t),101===t.cmd&&i.handleJoinGame(t),t.cmd,108===t.cmd&&i.handlePeopleCome(t),102===t.cmd&&i.receiveCommand(t),109==t.cmd&&i.close(),107==t.cmd&&i.handlePlayerOut()})}return r(e,[{key:"cleanHeartBeat",value:function(){if(this.heartBeat.length)for(;this.heartBeat.length;){var e=this.heartBeat.pop();clearTimeout(e)}}},{key:"handleSocketOpen",value:function(){this.joinGame(),this.alive=!0}},{key:"connectSocket",value:function(){var e=this;this.alive=!0,wx.connectSocket({url:"wss://wxagame.weixin.qq.com",fail:function(){e.alive=!1}})}},{key:"addHandler",value:function(e,t){this.handlers[e]?this.handlers[e].push(t):this.handlers[e]=[t]}},{key:"sendCommand",value:function(e,t){var i=o.default.gameId,n=o.default.gameTicket;if(i&&n&&e)if("string"==typeof i){var r={cmd:102,i:i,n:e,k:n,o:[JSON.stringify(t)]};wx.sendSocketMessage({data:JSON.stringify(r)})}else console.warn("Socket send cmd need gameId")}},{key:"sendNullCommand",value:function(){var e=o.default.gameId,t=o.default.gameTicket;if(e&&t)if("string"==typeof e){var i={cmd:102,i:e,k:t,o:[]};wx.sendSocketMessage({data:JSON.stringify(i)})}else console.warn("Socket send cmd need gameId")}},{key:"getCommand",value:function(e){}},{key:"onPeopleCome",value:function(e){this.peopleCome=e}},{key:"onReciveCommand",value:function(e){this.observerMessage=e}},{key:"onJoinSuccess",value:function(e){this.joinSuccess=e}},{key:"onPlayerOut",value:function(e){this.playerOutHandler=e}},{key:"receiveCommand",value:function(e){"function"==typeof this.observerMessage&&e.o&&e.o[0]&&e.o[0].o&&this.observerMessage(e.n,JSON.parse(e.o[0].o))}},{key:"handlePeopleCome",value:function(e){"function"==typeof this.peopleCome&&this.peopleCome(e)}},{key:"receiveACK",value:function(){}},{key:"joinGame",value:function(){var e=o.default.gameId;if(o.default.sessionId&&e){var t={cmd:101,game_id:e,fast:1,session_id:o.default.sessionId};wx.sendSocketMessage({data:JSON.stringify(t)})}}},{key:"handleACK",value:function(e){this.handlers.ack&&this.handlers.ack.forEach(function(t){t(e)})}},{key:"handleJoinGame",value:function(e){if("observe"==this.game.mode)switch(e.ret){case 0:case 2:this.joinSuccess(!0);break;default:this.joinSuccess(!1)}else 0!=e.ret?this.joinSuccess(!1):this.joinSuccess(!0)}},{key:"sendHeartBeat",value:function(){if("player"==this.game.mode)this.sendNullCommand();else{var e={cmd:104};wx.sendSocketMessage({data:JSON.stringify(e)})}}},{key:"quitObserve",value:function(){if(this.alive){var e={cmd:109,fast:1,game_id:o.default.gameId,session_id:o.default.sessionId};wx.sendSocketMessage({data:JSON.stringify(e)})}}},{key:"close",value:function(){var e=this;this.alive&&(this.cleanHeartBeat(),this.alive=!1,this.noErr=!0,wx.closeSocket(),o.default.clearShareTicket(),o.default.clearGameId(),setTimeout(function(){e.reset()},1e3))}},{key:"onSocketErr",value:function(e){this.handleSocketErr=e}},{key:"reset",value:function(){this.alive=!1,this.noErr=!1}},{key:"handlePlayerOut",value:function(){"function"==typeof this.playerOutHandler&&this.playerOutHandler()}}]),e}();t.default=s},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=(function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);t.default=e}(i(0)),i(1)),a=i(5),s=(n(i(3)),n(i(7)),n(i(65)),i(4)),l=i(57),c=i(52),h=i(54),u=i(55),d=i(56),f=i(53),p=i(12),m=i(58),g=window.devicePixelRatio>2?2:window.devicePixelRatio,v=window.innerHeight<window.innerWidth?window.innerHeight:window.innerWidth,y=window.innerHeight>window.innerWidth?window.innerHeight:window.innerWidth,b=y*g,w=["btn","bg","list1","list2"],x=o.FRUSTUMSIZE,_=(wx.loadFont("res/num.ttf"),function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.texture={},this.material={},this.geometry={},this.obj={},this.canvas={},this.context={},this._touchInfo={trackingID:-1,maxDy:0,maxDx:0},this.options=Object.assign({},{},t),this.imgid={btn:0,bg:0,list1:0,list2:0},this.options.onGroupShare=t.onGroupShare,this.options.friendRankReturn=t.friendRankReturn,this.options.groupPlayGame=t.groupPlayGame,this.options.onClickRank=t.onClickRank,this.options.onClickReplay=t.onClickReplay,this.options.onClickShare=t.onClickShare,this.options.onClickPureShare=t.onClickPureShare,this.options.onClickStart=t.onClickStart,this.options.onShowFriendRank=t.onShowFriendRank,this.options.onBattlePlay=t.onBattlePlay,this.options.onLookersStart=t.onLookersStart}return r(e,[{key:"showFriendRankList",value:function(e){this.opt=e,(0,d.drawFriendRankList)({self:this})}},{key:"showGroupRankList",value:function(e,t){(0,d.drawGroupRankList)(this,e,t)}},{key:"showGameOverPage",value:function(e){e=e||{},this.opt=e,(0,f.routeGameOver)(this)}},{key:"showStartPage",value:function(e){s.DEBUG||(this.opt=e||{},(0,l.drawStartPage)(this))}},{key:"showPkPage",value:function(e){this.opt=e,(0,u.drawPkPage)({self:this})}},{key:"showLookersPage",value:function(e){this.opt=e,(0,h.drawLookersPage)({self:this})}},{key:"showBeginnerPage",value:function(){(0,c.drawBeginnerPage)({self:this})}},{key:"hide2D",value:function(){(0,s.hide)(this)}},{key:"hide2DGradually",value:function(){if(!s.DEBUG)for(var e=this,t=0;t<w.length;t++)this.obj[w[t]]&&a.customAnimation.to(this.material[w[t]],1,{opacity:0,onComplete:function(t){return function(){e.material[w[t]].opacity=1,e.obj[w[t]].visible=!1,e.showState=!1,e.options.camera.remove(e.obj[w[t]])}}(t)})}},{key:"_findDelta",value:function(e){var t=this._touchInfo,i=e.touches[0]||e.changedTouches[0];return i?{x:i.pageX-t.x,y:i.pageY-t.y}:null}},{key:"doTouchStartEvent",value:function(e){if(this.showState){var t=e.changedTouches[0].pageX,i=e.changedTouches[0].pageY;if(this.startX=t,this.startY=i,this.canvasType==s.CANVASTYPE.friendRank||this.canvasType==s.CANVASTYPE.groupRank||this.canvasType==s.CANVASTYPE.pk){var n=this._touchInfo,r=this.scrollHandler;if(!r)return;n.trackingID="touch",n.x=e.touches[0].pageX,n.y=e.touches[0].pageY,n.maxDx=0,n.maxDy=0,n.historyX=[0],n.historyY=[0],n.historyTime=[+new Date],n.listener=r,r.onTouchStart&&r.onTouchStart()}else this.canvasType==s.CANVASTYPE.gameOver?(t=this._cxp(t),i=this._cyp(i),(!this.noplay_time||this.noplay_time<0)&&t>117&&t<297&&i>540&&i<660&&this._drawGameOverBtnClick()):this.canvasType==s.CANVASTYPE.start&&(t=this._cxp(t),i=this._cyp(i),t>100&&t<320&&i>515&&i<645&&this._drawStartClick())}}},{key:"doTouchMoveEvent",value:function(e){if(this.showState&&(this.canvasType==s.CANVASTYPE.friendRank||this.canvasType==s.CANVASTYPE.groupRank||this.canvasType==s.CANVASTYPE.pk)){var t=this._touchInfo;if(-1==t.trackingID)return;e.preventDefault();var i=this._findDelta(e);if(!i)return;t.maxDy=Math.max(t.maxDy,Math.abs(i.y)),t.maxDx=Math.max(t.maxDx,Math.abs(i.x));var n=+new Date;for(t.historyX.push(i.x),t.historyY.push(i.y),t.historyTime.push(n);t.historyTime.length>10;)t.historyTime.shift(),t.historyX.shift(),t.historyY.shift();t.listener&&t.listener.onTouchMove&&t.listener.onTouchMove(i.x,i.y,n)}}},{key:"doTouchEndEvent",value:function(e){if(this.showState){var t=e.changedTouches[0].pageX,i=e.changedTouches[0].pageY,n=!0;if(this.canvasType!=s.CANVASTYPE.friendRank&&this.canvasType!=s.CANVASTYPE.groupRank&&this.canvasType!=s.CANVASTYPE.pk&&this.canvasType!=s.CANVASTYPE.gameOver||!(Math.abs(t-this.startX)>5||Math.abs(i-this.startY)>5)||(n=!1),t=this._cxp(t),i=this._cyp(i),n){if(this.canvasType==s.CANVASTYPE.groupRank&&t>134&&t<283&&i>640&&i<727)return(0,s.hide)(this),void(!!this.options.groupPlayGame&&this.options.groupPlayGame());if(this.canvasType==s.CANVASTYPE.friendRank){if(t>120&&t<300&&i>640&&i<720)return void(!!this.options.onGroupShare&&this.options.onGroupShare());if(t>330&&t<408&&i>100&&i<200)return void(this.lastCanvasType==s.CANVASTYPE.gameOver?!!this.options.friendRankReturn&&this.options.friendRankReturn(""):this.lastCanvasType==s.CANVASTYPE.start&&!!this.options.friendRankReturn&&this.options.friendRankReturn(""))}if(this.canvasType==s.CANVASTYPE.gameOver)return void("beginner"!=this.opt.type&&"tired"!=this.opt.type&&!this.opt.banType&&t>25&&t<385&&i>290&&i<500?!!this.options.onClickRank&&this.options.onClickRank():!this.opt.banType&&t>150&&t<260&&i>199&&i<260?!!this.options.onClickShare&&this.options.onClickShare():(!this.noplay_time||this.noplay_time<0)&&t>117&&t<297&&i>540&&i<660?!!this.options.onClickReplay&&this.options.onClickReplay():1==this.opt.banType&&t>150&&t<260&&i>430&&i<500?(0,m.routeVerify)(this):(!this.noplay_time||this.noplay_time<0)&&this._drawGameOverBtnClickRevert());if(this.canvasType==s.CANVASTYPE.gameOverHighest&&(t>340&&t<407&&i>76&&i<138?(this.canvasType=s.CANVASTYPE.gameOver,(0,f.routeGameOver)(this,!0)):t>111&&t<380&&i>540&&i<660?!!this.options.onClickReplay&&this.options.onClickReplay():this.changlleList.length>0&&t>170&&t<230&&i>330&&i<390?!!this.options.onClickPureShare&&this.options.onClickPureShare(this.opt.type):0==this.changlleList.length&&t>170&&t<230&&i>390&&i<440?!!this.options.onClickPureShare&&this.options.onClickPureShare(this.opt.type):this.changlleList.length>5&&t>55&&t<115&&i>437&&i<497?(0,p.reDrawChangeAva)(this,-1):this.changlleList.length>5&&t>297&&t<357&&i>437&&i<497&&(0,p.reDrawChangeAva)(this,1)),this.canvasType==s.CANVASTYPE.start)return void(t>100&&t<320&&i>515&&i<645?!!this.options.onClickStart&&this.options.onClickStart():t>110&&t<280&&i>645&&i<705?!!this.options.onShowFriendRank&&this.options.onShowFriendRank():1==this.opt.banType&&t>110&&t<280&&i>410&&i<470?(0,m.routeVerify)(this):this._drawStartClickRevert());if(this.canvasType==s.CANVASTYPE.pk){if(t>110&&t<310&&i>650&&i<730)return void(!!this.options.onBattlePlay&&this.options.onBattlePlay(""));if(this.opt.organizerInfo.left_time>0&&0==this.opt.organizerInfo.is_self&&t>140&&t<280&&i>325&&i<405)return void(!!this.options.onBattlePlay&&this.options.onBattlePlay("pk"))}if(this.canvasType==s.CANVASTYPE.lookers)return void(t>130&&t<280&&i>650&&i<720&&!!this.options.onLookersStart&&this.options.onLookersStart());this.canvasType==s.CANVASTYPE.verify&&(t>130&&t<280&&i>607&&i<640?this.opt.verify_step>=4?(this.opt.banType=2,this.lastCanvasType==s.CANVASTYPE.gameOver?(0,f.routeGameOver)(this,!0):(0,l.drawStartPage)(this)):(0,m.routeVerify)(this):t>130&&t<280&&i>670&&i<720?(this.opt.verify_step=0,this.lastCanvasType==s.CANVASTYPE.gameOver?(0,f.routeGameOver)(this,!0):(0,l.drawStartPage)(this)):3==this.opt.verify_step&&t>130&&t<370&&i>240&&i<300?(0,m.clickVerifyForm)(this,"name"):3==this.opt.verify_step&&t>130&&t<370&&i>300&&i<360&&(0,m.clickVerifyForm)(this,"mobile"))}var r=this._touchInfo;if(-1!=r.trackingID){e.preventDefault();var o=this._findDelta(e);if(o){var a=r.listener;r.trackingID=-1,r.listener=null;var c={x:0,y:0};if(r.historyTime.length>2)for(var h=r.historyTime.length-1,u=r.historyTime[h],d=r.historyX[h],g=r.historyY[h];h>0;){h--;var v=u-r.historyTime[h];if(v>30&&v<50){c.x=(d-r.historyX[h])/(v/1e3),c.y=(g-r.historyY[h])/(v/1e3);break}}r.historyTime=[],r.historyX=[],r.historyY=[],a&&a.onTouchEnd&&a.onTouchEnd(o.x,o.y,c)}}}}},{key:"updatePosition",value:function(e){var t;e>0&&(e=0);var i=10*(0,s.cwh)(60)/b*x,n=10*(0,s.cwh)(60);this.canvasType!=s.CANVASTYPE.friendRank&&this.canvasType!=s.CANVASTYPE.groupRank||(t=-(this._cy(143)+n/2-b/2)/b*x),this.canvasType==s.CANVASTYPE.pk&&(t=-(this._cy(437)+n/2-b/2)/b*x);var r=Math.floor((t-x*e/y)/i);if(this.lastN!=r&&this.lastN-r<0)r%2==0?this._drawList(10*(r+1),"list2"):this._drawList(10*(r+1),"list1");else if(this.lastN!=r&&this.lastN-r>0){var o=r;-1==o&&(o=1),r%2==0?this._drawList(10*r,"list1"):this._drawList(10*o,"list2")}r%2==0?(this.obj.list1.position.y=t-x*e/y-r*i,this.obj.list2.position.y=t-x*e/y-(r+1)*i):(this.obj.list2.position.y=t-x*e/y-r*i,this.obj.list1.position.y=t-x*e/y-(r+1)*i),this.lastN=r,this.lastScrollY=e}},{key:"_drawList",value:function(e,t){this.canvasType!=s.CANVASTYPE.pk?(0,d.drawRankList)(this,e,t):(0,u.drawPkList)(this,e,t)}},{key:"_drawGameOverBtnClick",value:function(){this.context.btn.clearRect(this._cx(91),this._cy(527),(0,s.cwh)(232),(0,s.cwh)(134)),this._drawImageCenter("res/replay.png",this._cx(207),this._cy(607),(0,s.cwh)(190),(0,s.cwh)(75),"btn",null,this.imgid.btn)}},{key:"_drawGameOverBtnClickRevert",value:function(){this.context.btn.clearRect(this._cx(91),this._cy(527),(0,s.cwh)(232),(0,s.cwh)(134)),this._drawImageCenter("res/replay.png",this._cx(207),this._cy(607),(0,s.cwh)(212),(0,s.cwh)(84),"btn",null,this.imgid.btn)}},{key:"_drawStartClick",value:function(){this.context.btn.clearRect(this._cx(91),this._cy(547),(0,s.cwh)(232),(0,s.cwh)(94)),this._drawImageCenter("res/play.png",this._cx(207),this._cy(587),(0,s.cwh)(190),(0,s.cwh)(75),"btn",null,this.imgid.btn)}},{key:"_drawStartClickRevert",value:function(){this.context.btn.clearRect(this._cx(91),this._cy(547),(0,s.cwh)(232),(0,s.cwh)(94)),this._drawImageCenter("res/play.png",this._cx(207),this._cy(587),(0,s.cwh)(212),(0,s.cwh)(84),"btn",null,this.imgid.btn)}},{key:"_cx",value:function(e){var t=e*v/414;return y/v<736/414&&(t=e*y/736+(v-414*y/736)/2),t*g}},{key:"_cy",value:function(e){return(y/v>736/414?e*v/414+(y-736*v/414)/2:e*y/736)*g}},{key:"_cxp",value:function(e){return e/v*414}},{key:"_cyp",value:function(e){return y/v>736/414?(e-(y-736*v/414)/2)/v*414:e/y*736}},{key:"_drawImageCenter",value:function(e,t,i,n,r,o,a,l,c){"/0"!=e&&"/96"!=e&&"/64"!=e&&e||(e="res/ava.png");var h=new Image,u=this;h.onload=function(){u.imgid[o]==l&&(u.context[o].drawImage(h,t-n/2,i-r/2,n,r),!!a&&a(),c||(0,s.updatePlane)({self:u,type:o}))},h.onerror=function(){!!a&&a()},h.src=e}}]),e}());t.default=_},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i(0)),o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var i=new r.MeshBasicMaterial({color:32960}),n=new r.Mesh(new r.PlaneGeometry(5,5),i),o=n.clone(),a=n.clone();o.position.set(0,-20,-1),n.position.set(-10,-20,-1),a.position.set(10,-20,-1),this.ui=[o,n,a],this.camera=t}return n(e,[{key:"show",value:function(){var e=this;this.ui.forEach(function(t){e.camera.add(t)})}},{key:"hide",value:function(){var e=this;this.ui.forEach(function(t){e.camera.remove(t)})}}]),e}();t.default=o},function(e,t,i){"use strict";function n(e,t,i,n,r,o){return e.moveTo(t,i+o),e.lineTo(t,i+r-o),e.quadraticCurveTo(t,i+r,t+o,i+r),e.lineTo(t+n-o,i+r),e.quadraticCurveTo(t+n,i+r,t+n,i+r-o),e.lineTo(t+n,i+o),e.quadraticCurveTo(t+n,i,t+n-o,i),e.lineTo(t+o,i),e.quadraticCurveTo(t,i,t,i+o),e}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i(0)),a=(i(1),function(e){return e&&e.__esModule?e:{default:e}}(i(9))),s=i(5),l=1.3,c=l/20*21,h=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,this.seed=0,this.startDist=0,this.hitPoint={uuid:"",ready:!1,texture:null},this.loader=new o.TextureLoader,this.text=new a.default("超越！",{fillStyle:2434341,chinese:!0,textAlign:"center"});var i=new o.Shape;i=n(i,-c,-c,2*c,2*c,.5);var r=new o.Shape;r=n(r,-l,-l,2*l,2*l,.5);var s=new o.ShapeGeometry(r);!function(e){e.computeBoundingBox();var t=e.boundingBox.max,i=e.boundingBox.min,n=new o.Vector2(0-i.x,0-i.y),r=new o.Vector2(t.x-i.x,t.y-i.y),a=e.faces;e.faceVertexUvs[0]=[];for(var s=0;s<a.length;s++){var l=e.vertices[a[s].a],c=e.vertices[a[s].b],h=e.vertices[a[s].c];e.faceVertexUvs[0].push([new o.Vector2((l.x+n.x)/r.x,(l.y+n.y)/r.y),new o.Vector2((c.x+n.x)/r.x,(c.y+n.y)/r.y),new o.Vector2((h.x+n.x)/r.x,(h.y+n.y)/r.y)])}e.uvsNeedUpdate=!0}(s),this.avatorFrame=new o.Mesh(s,new o.MeshBasicMaterial({transparent:!0,opacity:1})),this.avatorOuter=new o.Mesh(new o.ShapeGeometry(i),new o.MeshBasicMaterial({color:16777215,transparent:!0,opacity:1})),this.text.obj.scale.set(.8,.8,.8),this.text.obj.position.set(0,2.2,.1),this.avatorFrame.position.set(0,0,.1),this.avatorFrame.material.opacity=0,this.avatorOuter.position.set(0,0,0),this.avatorOuter.material.opacity=0,this.text.material.opacity=0,this.obj=new o.Object3D,this.text.obj.visible=!1,this.obj.add(this.avatorOuter),this.obj.add(this.avatorFrame),this.obj.add(this.text.obj),this.obj.rotateY(-Math.PI/4),this.obj.rotateX(-Math.PI/16*3),this.game.scene.add(this.obj),this.obj.visible=!1}return r(e,[{key:"update",value:function(){this.game.gameModel.friendsScore&&this.game.gameModel.friendsScore.length&&(this.seed++,this.hitPoint.uuid==this.game.currentBlock.obj.uuid&&this.hitPoint.ready&&this.hitPoint.texture&&(this.startDist<2&&(this.startDist++,this.text.obj.visible=!0),this.playAnimate(),this.seed=0),this.seed>=5&&this.checkScore())}},{key:"checkScore",value:function(){var e=this.game.UI.score,t=this.game.gameModel.friendsScore;try{for(var i=0;i<t.length;i++)if(t[i].week_best_score==e){this.hitPoint.uuid=this.game.nextBlock.obj.uuid,this.hitPoint.ready=!1,this.animateAvator(t[i]);break}}catch(e){console.log("RankSystem checkScore err:",e)}}},{key:"animateAvator",value:function(e){var t=this;this.loader.load(e.headimg,function(e){t.hitPoint.uuid==t.game.nextBlock.obj.uuid&&(t.hitPoint.ready=!0,e.minFilter=o.LinearFilter,t.hitPoint.texture=e)})}},{key:"playAnimate",value:function(){var e=this;this.game.bottle.changeScorePos(3);var t=this.game.bottle.obj.position.clone(),i=t.x,n=t.z;this.obj.position.set(i,10,n),this.avatorFrame.material.map=this.hitPoint.texture,this.obj.visible=!0,s.customAnimation.to(this.obj.position,.4,{y:13}),s.customAnimation.to(this.text.material,.4,{opacity:1}),s.customAnimation.to(this.avatorOuter.material,.4,{opacity:1}),s.customAnimation.to(this.avatorFrame.material,.4,{opacity:1}),s.customAnimation.to(this.text.material,.4,{opacity:0,delay:.6,onComplete:function(){e.resetAvator(),e.game.bottle.changeScorePos(0)}}),s.customAnimation.to(this.avatorOuter.material,.4,{opacity:0,delay:.6}),s.customAnimation.to(this.avatorFrame.material,.4,{opacity:0,delay:.6}),this.hitPoint.uuid="",this.hitPoint.ready=!1,this.hitPoint.texture=null}},{key:"resetAvator",value:function(){this.obj.visible=!1,this.text.obj.visible=!1,this.avatorFrame.material.opacity=0,this.avatorFrame.material.map&&this.avatorFrame.material.map.dispose(),this.avatorFrame.material.map="",this.avatorOuter.material.opacity=0,this.text.material.opacity=0}},{key:"reset",value:function(){this.seed=0,this.seed=0,this.startDist=0,this.startDist=0,this.hitPoint={uuid:"",ready:!1,texture:null},this.obj.visible=!1}}]),e}();t.default=h},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=n(i(3)),a=n(i(2)),s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.times=o.default.getHistoryTimes(),this.times||(this.times={accurate:0,bonus:0}),this.game=t,this.limitScore=5}return r(e,[{key:"verifyScore",value:function(e){e>=this.times.accurate?(this.times.accurate=e,this.times.bonus>=this.limitScore?this.upLoadHistoryTimes():o.default.saveHistoryTimes(this.times)):this.upLoadHistoryTimes()}},{key:"addOne",value:function(){this.times.bonus++}},{key:"checkUp",value:function(){this.times.bonus>=this.limitScore?this.upLoadHistoryTimes():o.default.saveHistoryTimes(this.times)}},{key:"upLoadHistoryTimes",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=this.times.accurate+this.times.bonus;a.default.requestSettlement(e,i,this.afterUpload.bind(this),t)}},{key:"afterUpload",value:function(e){e&&(this.times.accurate+=this.times.bonus,this.times.bonus=0),o.default.saveHistoryTimes(this.times)}},{key:"getTimes",value:function(){return this.times.accurate+this.times.bonus}}]),e}();t.default=s},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i(0)),a={duration:100,height:2,width:.5,distance:.5},s=function(){function e(t,i){n(this,e),this.scene=t,this.bottle=i,this.tailsRemainPool=[],this.tailsUsingPool=[],this.lastDotPosition=this.bottle.obj.position.clone(),this.nowPosition=this.bottle.obj.position.clone(),this.distance=a.distance,this.init()}return r(e,[{key:"init",value:function(){var e=a.width,t=a.height;this.geometry=new o.PlaneBufferGeometry(e,t),this.material=new o.MeshBasicMaterial({color:16777215,side:o.DoubleSide,transparent:!0,opacity:.3});for(var i=0;i<20;i++){var n=new l(this.geometry,this.material);this.scene.add(n.mesh),this.tailsRemainPool.push(n)}}},{key:"update",value:function(e){if(this.updateActiveCell(e),"prepare"==this.bottle.status&&(this.nowPosition=this.bottle.obj.position.clone(),this.lastDotPosition=this.bottle.obj.position.clone()),"jump"==this.bottle.status){var t=void 0;if(this.nowPosition=this.bottle.obj.position.clone(),(t=this.nowPosition.clone().distanceTo(this.lastDotPosition.clone()))<5){if(t>=this.distance)for(var i=t/this.distance,n=Math.floor(i),r=this.lastDotPosition.clone(),o=this.nowPosition.clone(),s=e/a.duration,l=1;l<=n;l++){o=this.lastDotPosition.clone().lerp(this.nowPosition.clone(),l/i);var c=1+s*(l/i-1);c=c<=0?0:c,this.layEgg(r.clone(),o.clone(),c),r=o.clone(),l==n&&(this.lastDotPosition=o.clone())}}else this.lastDotPosition=this.nowPosition.clone()}}},{key:"updateActiveCell",value:function(e){for(var t=this.tailsUsingPool,i=1/a.duration,n=(a.duration,0);n<t.length;n++){t[n].tickTime+=e;var r=t[n].mesh.scale.y-i*e;if(r>0){if(t[n].mesh.scale.y=r>0?r:0,t[n].tickTime>=a.duration){t[n].reset();var o=t.shift();this.tailsRemainPool.push(o),n--}}else{t[n].reset();var s=t.shift();this.tailsRemainPool.push(s),n--}}}},{key:"correctPosition",value:function(){this.lastDotPosition=this.bottle.obj.position.clone()}},{key:"layEgg",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=this.getMesh();this.tailsUsingPool.push(n),n.mesh.position.set(t.x,t.y,t.z),n.mesh.scale.y=i,n.mesh.lookAt(e),n.mesh.rotateY(Math.PI/2),n.mesh.visible=!0}},{key:"getMesh",value:function(){var e=this.tailsRemainPool.shift();return e||(e=new l(this.geometry,this.material),this.scene.add(e.mesh)),e}},{key:"allReset",value:function(){this.tailsRemainPool.forEach(function(e){e.reset()})}}]),e}();t.default=s;var l=function(){function e(t,i){n(this,e),this.tickTime=0,this.mesh=new o.Mesh(t,i),this.mesh.visible=!1,this.mesh.name="tail"}return r(e,[{key:"reset",value:function(){this.tickTime=0,this.mesh.scale.set(1,1,1),this.mesh.visible=!1}}]),e}()},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=(function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);t.default=e}(i(0)),i(1)),o=(i(5),function(e){return e&&e.__esModule?e:{default:e}}(i(9))),a=window.innerHeight>window.innerWidth?window.innerHeight:window.innerWidth,s=(window.innerHeight<window.innerWidth?window.innerHeight:window.innerWidth,function(){function e(t,i,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);this.game=r,this.full2D=n,this.scene=t,this.camera=i,this.score=0,this.double=1,this.scoreText=new o.default("0",{fillStyle:2434341,sumScore:!0,opacity:.8}),this.scoreText.obj.position.set(-13,21,-10),this.scoreText.obj.updateMatrix(),this.scoreText.obj.matrixAutoUpdate=!1,this.camera.add(this.scoreText.obj)}return n(e,[{key:"reset",value:function(){this.scoreText.setScore(0),this.score=0,this.double=1}},{key:"update",value:function(){}},{key:"hideScore",value:function(){this.scoreText.obj.visible=!1}},{key:"showScore",value:function(){this.scoreText.obj.visible=!0}},{key:"addScore",value:function(e,t,i,n){if(n)return this.score+=e,void this.setScore(this.score);t?1===this.double?this.double=2:this.double+=2:this.double=1,i&&this.double<=2&&(this.double*=2),this.double=Math.min(32,this.double),e*=this.double,this.score+=e,this.setScore(this.score)}},{key:"setScore",value:function(e){this.scoreText.setScore(e),r.BLOCK.minRadiusScale-=.005,r.BLOCK.minRadiusScale=Math.max(.25,r.BLOCK.minRadiusScale),r.BLOCK.maxRadiusScale-=.005,r.BLOCK.maxRadiusScale=Math.max(r.BLOCK.maxRadiusScale,.6),r.BLOCK.maxDistance+=.03,r.BLOCK.maxDistance=Math.min(22,r.BLOCK.maxDistance)}}]),e}());t.default=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=i(1),o=function(){function e(t){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,this.musicPool=["success","combo1","combo2","combo3","combo4","combo5","combo6","combo7","combo8","scale_intro","scale_loop","restart","fall","fall_2","pop","icon","sing","store","water"],this.musicPool.forEach(function(e){setTimeout(function(e){this[e]=wx.createInnerAudioContext(),this[e].src=r.AUDIO[e]}.bind(i,e),1)}),setTimeout(function(){i.scale_loop.loop=!0,i.icon.onEnded(function(){i.icon.destroy()}),i.store.onPlay(function(){i.store.before&&i.store.before()}),i.store.onEnded(function(){i.store.after&&i.store.after(),i.timer=setTimeout(function(){i.canTimer&&(i.store.seek(0),i.store.play())},3e3)}),i.sing.onEnded(function(){i.timer=setTimeout(function(){i.canTimer&&(i.sing.seek(0),i.sing.play())},3e3)}),i.water.onEnded(function(){i.timer=setTimeout(function(){i.canTimer&&(i.water.seek(0),i.water.play())},3e3)}),i.scale_intro.onEnded(function(){"prepare"==i.game.bottle.status&&i.scale_loop.play()})},50)}return n(e,[{key:"resetAudio",value:function(){var e=this;this.musicPool.forEach(function(t){e[t].stop()})}},{key:"register",value:function(e,t,i){this[e].before=t,this[e].after=i}},{key:"setTimerFlag",value:function(e){this.canTimer=e}},{key:"clearTimer",value:function(){this.timer&&(clearTimeout(this.timer),this.timer=null)}},{key:"replay",value:function(e){var t=this[e];t?(t.stop(),t.play()):console.warn("there is no music",e)}}]),e}();t.default=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=(function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);t.default=e}(i(0)),function(e){return e&&e.__esModule?e:{default:e}}(i(48))),o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.num=0,this.list=[],this.imgPlanes=[],this.camera=t,this.lookers=new r.default({camera:t}),this.isOpen=!1}return n(e,[{key:"peopleCome",value:function(e){this.list.findIndex(function(t){return!!t&&t.audience_openid==e.audience_openid})>-1||(this.list.push(e),this.num++,this.isOpen&&this.showAvatar())}},{key:"peopleOut",value:function(e){var t=this.list.findIndex(function(t){return!!t&&t.audience_openid==e.audience_openid});t<0||(this.num=this.num-1<0?0:this.num-1,this.list.splice(t,1),this.isOpen&&this.showAvatar())}},{key:"showAvatar",value:function(){if(this.num>0){for(var e=[],t=1;t<4;t++)this.list.length-t>=0&&e.unshift(this.list[this.list.length-t].audience_headimg);this.lookers.showLookers({avaImg:!0,icon:!0,wording:!1,num:this.num,avatar:e})}else this.lookers.showLookers({avaImg:!1,icon:!0,wording:!1})}},{key:"open",value:function(){this.isOpen=!0,this.showAvatar()}},{key:"close",value:function(){this.isOpen=!1,this.hideAll()}},{key:"reset",value:function(){this.num=0,this.list=[],this.lookers.hideLookers()}},{key:"hideAll",value:function(){this.lookers.hideLookers()}}]),e}();t.default=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i(0)),o=i(1),a=new r.RingBufferGeometry(o.WAVE.innerRadius,o.WAVE.outerRadius,o.WAVE.thetaSeg),s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var t=new r.MeshBasicMaterial({color:o.COLORS.pureWhite,transparent:!0});this.obj=new r.Mesh(a,t),this.obj.rotation.x=-Math.PI/2,this.obj.name="wave"}return n(e,[{key:"reset",value:function(){this.obj.scale.set(1,1,1),this.obj.material.opacity=1,this.obj.visible=!1}}]),e}();t.default=s},function(e,t,i){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){function t(n){if(i[n])return i[n].exports;var r=i[n]={exports:{},id:n,loaded:!1};return e[n].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var i={};t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){var n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i(1)),r=GameGlobal;GameGlobal.__isAdapterInjected||(GameGlobal.__isAdapterInjected=!0,function(){n.addEventListener=n.canvas.addEventListener=function(e,t){n.document.addEventListener(e,t)},n.removeEventListener=n.canvas.removeEventListener=function(e,t){n.document.removeEventListener(e,t)};var e=wx.getSystemInfoSync().platform;if("undefined"==typeof __devtoolssubcontext&&"devtools"===e){for(var t in n){var i=Object.getOwnPropertyDescriptor(r,t);i&&!0!==i.configurable||Object.defineProperty(window,t,{value:n[t]})}for(var o in n.document){var a=Object.getOwnPropertyDescriptor(r.document,o);a&&!0!==a.configurable||Object.defineProperty(r.document,o,{value:n.document[o]})}window.parent=window}else{for(var s in n)r[s]=n[s];r.window=n,window=r,window.top=window.parent=window}}())},function(e,t,i){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.cancelAnimationFrame=t.requestAnimationFrame=t.clearInterval=t.clearTimeout=t.setInterval=t.setTimeout=t.canvas=t.location=t.localStorage=t.HTMLElement=t.FileReader=t.Audio=t.Image=t.WebSocket=t.XMLHttpRequest=t.navigator=t.document=void 0;var r=i(2);Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})});var o=i(3);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var a=n(i(9)),s=n(i(10)),l=n(i(17)),c=n(i(18)),h=n(i(19)),u=n(i(11)),d=n(i(12)),f=n(i(20)),p=n(i(4)),m=n(i(21)),g=n(i(22));t.document=s.default,t.navigator=l.default,t.XMLHttpRequest=c.default,t.WebSocket=h.default,t.Image=u.default,t.Audio=d.default,t.FileReader=f.default,t.HTMLElement=p.default,t.localStorage=m.default,t.location=g.default;var v=new a.default;t.canvas=v,t.setTimeout=setTimeout,t.setInterval=setInterval,t.clearTimeout=clearTimeout,t.clearInterval=clearInterval,t.requestAnimationFrame=requestAnimationFrame,t.cancelAnimationFrame=cancelAnimationFrame},function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=wx.getSystemInfoSync(),n=i.screenWidth,r=i.screenHeight,o=i.devicePixelRatio,a=t.innerWidth=n,s=t.innerHeight=r;t.devicePixelRatio=o;t.screen={availWidth:a,availHeight:s},t.performance={now:function(){return Date.now()/1e3}},t.ontouchstart=null,t.ontouchmove=null,t.ontouchend=null},function(e,t,i){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":n(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":n(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.HTMLCanvasElement=t.HTMLImageElement=void 0;var s=function(e){return e&&e.__esModule?e:{default:e}}(i(4));t.HTMLImageElement=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"img"))}return a(t,s.default),t}(),t.HTMLCanvasElement=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"canvas"))}return a(t,s.default),t}()},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=function(e){return e&&e.__esModule?e:{default:e}}(i(5)),a=i(8),s=i(2),l=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":n(t))&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.className="",i.childern=[],i.style={width:s.innerWidth+"px",height:s.innerHeight+"px"},i.insertBefore=a.noop,i.innerHTML="",i.tagName=e.toUpperCase(),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":n(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),r(t,[{key:"setAttribute",value:function(e,t){this[e]=t}},{key:"getAttribute",value:function(e){return this[e]}},{key:"getBoundingClientRect",value:function(){return{top:0,left:0,width:s.innerWidth,height:s.innerHeight}}},{key:"focus",value:function(){}},{key:"clientWidth",get:function(){var e=parseInt(this.style.fontSize,10)*this.innerHTML.length;return Number.isNaN(e)?0:e}},{key:"clientHeight",get:function(){var e=parseInt(this.style.fontSize,10);return Number.isNaN(e)?0:e}}]),t}();t.default=l},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){return e&&e.__esModule?e:{default:e}}(i(6)),o=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":n(t))&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.className="",e.children=[],e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":n(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.default),t}();t.default=o},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=function(e){return e&&e.__esModule?e:{default:e}}(i(7)),a=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":n(t))&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.childNodes=[],e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":n(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),r(t,[{key:"appendChild",value:function(e){if(!(e instanceof t))throw new TypeError("Failed to executed 'appendChild' on 'Node': parameter 1 is not of type 'Node'.");this.childNodes.push(e)}},{key:"cloneNode",value:function(){var e=Object.create(this);return Object.assign(e,this),e}},{key:"removeChild",value:function(e){var t=this.childNodes.findIndex(function(t){return t===e});return t>-1?this.childNodes.splice(t,1):null}}]),t}();t.default=a},function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),n=new WeakMap,r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n.set(this,{})}return i(e,[{key:"addEventListener",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.get(this);r||(r={},n.set(this,r)),r[e]||(r[e]=[]),r[e].push(t),i.capture&&console.warn("EventTarget.addEventListener: options.capture is not implemented."),i.once&&console.warn("EventTarget.addEventListener: options.once is not implemented."),i.passive&&console.warn("EventTarget.addEventListener: options.passive is not implemented.")}},{key:"removeEventListener",value:function(e,t){var i=n.get(this)[e];if(i&&i.length>0)for(var r=i.length;r--;r>0)if(i[r]===t){i.splice(r,1);break}}},{key:"dispatchEvent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=n.get(this)[e.type];if(t)for(var i=0;i<t.length;i++)t[i](e)}}]),e}();t.default=r},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.noop=function(){}},function(e,t,i){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e=wx.createCanvas();return e.type="canvas",e.__proto__.__proto__=new r.default("canvas"),e.getContext,e.getBoundingClientRect=function(){return{top:0,left:0,width:window.innerWidth,height:window.innerHeight}},e};i(3);var r=n(i(4));n(i(10))},function(e,t,i){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i(1)),o=n(i(4)),a=n(i(11)),s=n(i(12)),l=n(i(9));i(15);var c={},h={readyState:"complete",visibilityState:"visible",documentElement:r,hidden:!1,style:{},location:r.location,ontouchstart:null,ontouchmove:null,ontouchend:null,head:new o.default("head"),body:new o.default("body"),createElement:function(e){return"canvas"===e?new l.default:"audio"===e?new s.default:"img"===e?new a.default:new o.default(e)},getElementById:function(e){return e===r.canvas.id?r.canvas:null},getElementsByTagName:function(e){return"head"===e?[h.head]:"body"===e?[h.body]:"canvas"===e?[r.canvas]:[]},querySelector:function(e){return"head"===e?h.head:"body"===e?h.body:"canvas"===e?r.canvas:e==="#"+r.canvas.id?r.canvas:null},querySelectorAll:function(e){return"head"===e?[h.head]:"body"===e?[h.body]:"canvas"===e?[r.canvas]:[]},addEventListener:function(e,t){c[e]||(c[e]=[]),c[e].push(t)},removeEventListener:function(e,t){var i=c[e];if(i&&i.length>0)for(var n=i.length;n--;n>0)if(i[n]===t){i.splice(n,1);break}},dispatchEvent:function(e){var t=c[e.type];if(t)for(var i=0;i<t.length;i++)t[i](e)}};t.default=h},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return wx.createImage()}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=function(e){return e&&e.__esModule?e:{default:e}}(i(13)),a=0,s=1,l=2,c=3,h=4,u=new WeakMap,d=new WeakMap,f=(new WeakMap,new WeakMap,function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":n(t))&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));i.HAVE_NOTHING=a,i.HAVE_METADATA=s,i.HAVE_CURRENT_DATA=l,i.HAVE_FUTURE_DATA=c,i.HAVE_ENOUGH_DATA=h,i.readyState=a,d.set(i,"");var r=wx.createInnerAudioContext();return u.set(i,r),r.onCanplay(function(){i.dispatchEvent({type:"load"}),i.dispatchEvent({type:"loadend"}),i.dispatchEvent({type:"canplay"}),i.dispatchEvent({type:"canplaythrough"}),i.dispatchEvent({type:"loadedmetadata"}),i.readyState=l}),r.onPlay(function(){i.dispatchEvent({type:"play"})}),r.onPause(function(){i.dispatchEvent({type:"pause"})}),r.onEnded(function(){i.dispatchEvent({type:"ended"}),i.readyState=h}),r.onError(function(){i.dispatchEvent({type:"error"})}),e&&(u.get(i).src=e),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":n(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),r(t,[{key:"load",value:function(){console.warn("HTMLAudioElement.load() is not implemented.")}},{key:"play",value:function(){u.get(this).play()}},{key:"pause",value:function(){u.get(this).pause()}},{key:"canPlayType",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return"string"!=typeof e?"":e.indexOf("audio/mpeg")>-1||e.indexOf("audio/mp4")?"probably":""}},{key:"cloneNode",value:function(){var e=new t;return e.loop=u.get(this).loop,e.autoplay=u.get(this).loop,e.src=this.src,e}},{key:"currentTime",get:function(){return u.get(this).currentTime},set:function(e){u.get(this).seek(e)}},{key:"src",get:function(){return d.get(this)},set:function(e){d.set(this,e),u.get(this).src=e}},{key:"loop",get:function(){return u.get(this).loop},set:function(e){u.get(this).loop=e}},{key:"autoplay",get:function(){return u.get(this).autoplay},set:function(e){u.get(this).autoplay=e}},{key:"paused",get:function(){return u.get(this).paused}}]),t}());t.default=f},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){return e&&e.__esModule?e:{default:e}}(i(14)),o=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":n(t))&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"audio"))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":n(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.default),t}();t.default=o},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=function(e){return e&&e.__esModule?e:{default:e}}(i(4)),a=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":n(t))&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":n(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),r(t,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),t}();t.default=a},function(e,t,i){i(16)},function(e,t,i){function n(e){return function(t){var i=new s(e);i.touches=t.touches,i.targetTouches=Array.prototype.slice.call(t.touches),i.changedTouches=t.changedTouches,i.timeStamp=t.timeStamp,o.default.dispatchEvent(i)}}var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i(1)),o=function(e){return e&&e.__esModule?e:{default:e}}(i(10)),a=i(8),s=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.target=r.canvas,this.currentTarget=r.canvas,this.touches=[],this.targetTouches=[],this.changedTouches=[],this.preventDefault=a.noop,this.stopPropagation=a.noop,this.type=t};wx.onTouchStart(n("touchstart")),wx.onTouchMove(n("touchmove")),wx.onTouchEnd(n("touchend")),wx.onTouchCancel(n("touchcancel"))},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var n=i(8),r={platform:wx.getSystemInfoSync().platform,language:"zh-cn",appVersion:"5.0 (iPhone; CPU iPhone OS 9_1 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 10_3_1 like Mac OS X) AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/zh_CN",onLine:!0,geolocation:{getCurrentPosition:n.noop,watchPosition:n.noop,clearWatch:n.noop}};t.default=r},function(e,t){function i(e){if("function"==typeof this["on"+e]){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];this["on"+e].apply(this,i)}}function n(e){this.readyState=e,i.call(this,"readystatechange")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=new WeakMap,a=new WeakMap,s=new WeakMap,l=new WeakMap,c=new WeakMap,h=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.onabort=null,this.onerror=null,this.onload=null,this.onloadstart=null,this.onprogress=null,this.ontimeout=null,this.onloadend=null,this.onreadystatechange=null,this.readyState=0,this.response=null,this.responseText=null,this.responseType="",this.responseXML=null,this.status=0,this.statusText="",this.upload={},this.withCredentials=!1,s.set(this,{"content-type":"application/x-www-form-urlencoded"}),l.set(this,{})}return r(e,[{key:"abort",value:function(){var e=c.get(this);e&&e.abort()}},{key:"getAllResponseHeaders",value:function(){var e=l.get(this);return Object.keys(e).map(function(t){return t+": "+e[t]}).join("\n")}},{key:"getResponseHeader",value:function(e){return l.get(this)[e]}},{key:"open",value:function(t,i){a.set(this,t),o.set(this,i),n.call(this,e.OPENED)}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(this.readyState!==e.OPENED)throw new Error("Failed to execute 'send' on 'XMLHttpRequest': The object's state must be OPENED.");wx.request({data:r,url:o.get(this),method:a.get(this),header:s.get(this),responseType:this.responseType,success:function(r){var o=r.data,a=r.statusCode,s=r.header;if("string"!=typeof o&&!(o instanceof ArrayBuffer))try{o=JSON.stringify(o)}catch(e){o=o}if(t.status=a,l.set(t,s),i.call(t,"loadstart"),n.call(t,e.HEADERS_RECEIVED),n.call(t,e.LOADING),t.response=o,o instanceof ArrayBuffer){t.responseText="";for(var c=new Uint8Array(o),h=c.byteLength,u=0;u<h;u++)t.responseText+=String.fromCharCode(c[u])}else t.responseText=o;n.call(t,e.DONE),i.call(t,"load"),i.call(t,"loadend")},fail:function(e){var n=e.errMsg;-1!==n.indexOf("abort")?i.call(t,"abort"):i.call(t,"error",n),i.call(t,"loadend")}})}},{key:"setRequestHeader",value:function(e,t){var i=s.get(this);i[e]=t,s.set(this,i)}}]),e}();h.UNSEND=0,h.OPENED=1,h.HEADERS_RECEIVED=2,h.LOADING=3,h.DONE=4,t.default=h},function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),n=new WeakMap,r=function(){function e(t){var i=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.binaryType="",this.bufferedAmount=0,this.extensions="",this.onclose=null,this.onerror=null,this.onmessage=null,this.onopen=null,this.protocol="",this.readyState=3,"string"!=typeof t||!/(^ws:\/\/)|(^wss:\/\/)/.test(t))throw new TypeError("Failed to construct 'WebSocket': The URL '"+t+"' is invalid");this.url=t,this.readyState=e.CONNECTING;var o=wx.connectSocket({url:t,protocols:Array.isArray(r)?r:[r]});return n.set(this,o),o.onClose(function(t){i.readyState=e.CLOSED,"function"==typeof i.onclose&&i.onclose(t)}),o.onMessage(function(e){"function"==typeof i.onmessage&&i.onmessage(e)}),o.onOpen(function(){i.readyState=e.OPEN,"function"==typeof i.onopen&&i.onopen()}),o.onError(function(e){"function"==typeof i.onerror&&i.onerror(new Error(e.errMsg))}),this}return i(e,[{key:"close",value:function(t,i){this.readyState=e.CLOSING;n.get(this).close({code:t,reason:i})}},{key:"send",value:function(e){if("string"!=typeof e&&!(e instanceof ArrayBuffer))throw new TypeError("Failed to send message: The data "+e+" is invalid");n.get(this).send({data:e})}}]),e}();r.CONNECTING=0,r.OPEN=1,r.CLOSING=2,r.CLOSED=3,t.default=r},function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default=function e(){!function(t,i){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this)}},function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i={get length(){return wx.getStorageInfoSync().keys.length},key:function(e){return wx.getStorageInfoSync().keys[e]},getItem:function(e){return wx.getStorageSync(e)},setItem:function(e,t){return wx.setStorageSync(e,t)},removeItem:function(e){wx.removeStorageSync(e)},clear:function(){wx.clearStorageSync()}};t.default=i},function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default={href:"game.js",reload:function(){}}}])},function(e,t){e.exports=function(e,t){for(var i=e[0],n=e[1],r=!1,o=0,a=t.length-1;o<t.length;a=o++){var s=t[o][0],l=t[o][1],c=t[a][0],h=t[a][1];l>n!=h>n&&i<(c-s)*(n-l)/(h-l)+s&&(r=!r)}return r}},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=n(i(46)),a=n(i(45)),s=n(i(2)),l=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name="battlePage",this.game=t,this.gameCtrl=this.game.gameCtrl,this.model=this.game.gameModel,this.view=this.game.gameView,this.modeCtrl=i,this.netWorkCtrl=this.gameCtrl.netWorkCtrl,this.currentPage=null,this.pkPage=new o.default(t),this.gamePage=new a.default(t),this.shareTicket="",this.pkId="",this.shareInfoTimeout=null,this.battleScore=void 0}return r(e,[{key:"init",value:function(e){var t=this.model.getSessionId();this.shareTicket=e.shareTicket,this.pkId=e.query.pkId,this.model.setStage(""),wx.showLoading(),t?this.afterLogin(!0):this.netWorkCtrl.netWorkLogin(this.afterLogin.bind(this))}},{key:"afterLogin",value:function(e){var t=this;e?(this.setShareInfoTimeout(),wx.getShareInfo({shareTicket:this.shareTicket,success:function(e){null!=t.shareInfoTimeout&&(t.clearShareInfoTimeout(),t.model.setShareTicket(e.rawData),t.gotoBattlePage(),t.gameCtrl.loginBattle(1))},fail:function(e){null!=t.shareInfoTimeout&&(t.clearShareInfoTimeout(),t.gotoBattlePage(),t.gameCtrl.loginBattle(0))}})):this.goToBattleFail()}},{key:"gotoBattlePage",value:function(){s.default.getBattleData(this.gotoBattlePageAfterHaveData.bind(this),this.pkId)}},{key:"gotoBattlePageAfterHaveData",value:function(e,t){if(wx.hideLoading(),e){var i=[];t.data.challenger.length&&t.data.challenger.forEach(function(e){i.push({headimg:e.headimg,is_self:e.is_self?1:0,nickname:e.nickname,score_info:[{score:e.score}]})},this),i.sort(function(e,t){return t.score_info[0].score-e.score_info[0].score});var n={organizerInfo:{headimg:t.data.owner.headimg,nickname:t.data.owner.nickname,score_info:[{score:t.data.owner.score}],left_time:t.data.left_time,is_self:t.data.is_owner?1:0},pkListInfo:i,gg_score:this.battleScore};this.currentPage&&this.currentPage.hide(),this.pkPage.show(n),this.model.setStage(this.pkPage.name),this.currentPage=this.pkPage,this.gameCtrl.showPkPage(t.data.owner.score)}else this.goToBattleFail()}},{key:"goToBattleFail",value:function(){this.view.showGoToBattleFail(),this.modeCtrl.changeMode("singleCtrl")}},{key:"setShareInfoTimeout",value:function(){this.shareInfoTimeout=setTimeout(this.handleShareInfoTimeout.bind(this),5e3)}},{key:"clearShareInfoTimeout",value:function(){null!=this.shareInfoTimeout&&(clearTimeout(this.shareInfoTimeout),this.shareInfoTimeout=null)}},{key:"handleShareInfoTimeout",value:function(){this.clearShareInfoTimeout(),this.goToBattleFail()}},{key:"destroy",value:function(){this.currentPage&&this.currentPage.hide(),this.model.setStage(""),wx.hideLoading(),this.shareTicket="",this.pkId="",this.clearShareInfoTimeout(),this.model.clearShareTicket(),this.game.resetScene(),this.battleScore=void 0}},{key:"battlePlay",value:function(e){e?(this.currentPage&&this.currentPage.hide(),this.gamePage.show(),this.game.replayGame(),this.model.setStage(this.gamePage.name),this.currentPage=this.gamePage):(this.modeCtrl.directPlaySingleGame(),this.gameCtrl.battleToSingle())}},{key:"showGameOverPage",value:function(){this.currentPage&&this.currentPage.hide(),this.model.setStage(""),this.currentPage=null;var e=this.model.currentScore;this.battleScore=e,wx.showLoading(),s.default.updatepkinfo(this.gotoBattlePageAgain.bind(this),this.pkId,e)}},{key:"gotoBattlePageAgain",value:function(e){e||this.view.showUploadPkScoreFail(),this.gotoBattlePage()}},{key:"wxOnhide",value:function(){}}]),e}();t.default=l},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=n(i(47)),a=n(i(2)),s=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name="groupShare",this.game=t,this.gameCtrl=this.game.gameCtrl,this.model=this.game.gameModel,this.view=this.game.gameView,this.netWorkCtrl=this.gameCtrl.netWorkCtrl,this.modeCtrl=i,this.groupPage=new o.default(t),this.shareTicket="",this.shareInfoTimeout=null}return r(e,[{key:"init",value:function(e){var t=this.model.getServerConfig();if(t&&!t.group_score_switch)return this.view.showServeConfigForbiddenGroupShare(),void this.modeCtrl.changeMode("singleCtrl");this.model.setStage("");var i=this.model.getSessionId();this.shareTicket=e.shareTicket,wx.showLoading(),i?this.afterLogin(!0):this.netWorkCtrl.netWorkLogin(this.afterLogin.bind(this))}},{key:"afterLogin",value:function(e){var t=this;e?(this.setShareInfoTimeout(),wx.getShareInfo({shareTicket:this.shareTicket,success:function(e){null!=t.shareInfoTimeout&&(t.clearShareInfoTimeout(),t.model.setShareTicket(e.rawData),a.default.getGroupScore(function(e,i){if(e){var n=i.data.user_info||[],r=i.data.my_user_info||{};t.showGroupRankPage(n,r)}else t.goToGroupShareFail();wx.hideLoading()}))},fail:function(e){null!=t.shareInfoTimeout&&(t.clearShareInfoTimeout(),wx.hideLoading(),t.goToGroupShareFail("群里的群分享才有效哦~"))}})):(wx.hideLoading(),this.goToGroupShareFail())}},{key:"setShareInfoTimeout",value:function(){this.shareInfoTimeout=setTimeout(this.handleShareInfoTimeout.bind(this),5e3)}},{key:"clearShareInfoTimeout",value:function(){null!=this.shareInfoTimeout&&(clearTimeout(this.shareInfoTimeout),this.shareInfoTimeout=null)}},{key:"handleShareInfoTimeout",value:function(){this.clearShareInfoTimeout(),this.goToGroupShareFail()}},{key:"goToGroupShareFail",value:function(e){this.view.showGroupShareFail(e),this.modeCtrl.changeMode("singleCtrl")}},{key:"showGroupRankPage",value:function(e,t){this.groupPage.show(e,t),this.model.setStage(this.groupPage.name),this.currentPage=this.groupPage}},{key:"destroy",value:function(){wx.hideLoading(),this.currentPage&&this.currentPage.hide(),this.model.setStage(""),this.shareTicket="",this.model.clearShareTicket(),this.clearShareInfoTimeout(),this.game.resetScene()}},{key:"groupPlayGame",value:function(){this.modeCtrl.directPlaySingleGame()}},{key:"wxOnhide",value:function(){}}]),e}();t.default=s},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=n(i(11)),a=n(i(34)),s=n(i(33)),l=n(i(37)),c=n(i(38)),h=n(i(40)),u=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,this.singleCtrl=new o.default(t,this),this.groupShareCtrl=new a.default(t,this),this.battleCtrl=new s.default(t,this),this.observeCtrl=new l.default(t,this),this.playerCtrl=new c.default(t,this),this.reviewCtrl=new h.default(t,this),this.model=t.gameModel,this.gameCtrl=t.gameCtrl,this.currentCtrl=null}return r(e,[{key:"initFirstPage",value:function(e){switch(this.model.getMode()){case"single":this.currentCtrl=this.singleCtrl,this.singleCtrl.init(e),this.gameCtrl.netWorkLogin();break;case"groupShare":this.currentCtrl=this.groupShareCtrl,this.groupShareCtrl.init(e);break;case"battle":this.currentCtrl=this.battleCtrl,this.battleCtrl.init(e);break;case"observe":this.currentCtrl=this.observeCtrl,this.observeCtrl.init(e);break;default:this.currentCtrl=this.singleCtrl,this.model.setMode("single"),this.singleCtrl.init(e),this.gameCtrl.netWorkLogin()}}},{key:"reInitFirstPage",value:function(e){this.currentCtrl&&(this.currentCtrl.destroy(),this.currentCtrl=null),this.gameCtrl.queryCtrl.identifyMode(e),this.initFirstPage(e)}},{key:"clickStart",value:function(){this.currentCtrl&&this.currentCtrl.clickStart&&this.currentCtrl.clickStart()}},{key:"showGameOverPage",value:function(e){this.currentCtrl&&this.currentCtrl.showGameOverPage&&this.currentCtrl.showGameOverPage(e)}},{key:"gameOverClickReplay",value:function(){this.currentCtrl&&(this.currentCtrl.gameOverClickReplay?this.currentCtrl.gameOverClickReplay():this.game.handleWxOnError({message:"cannot Find this.currentCtrl.gameOverClickReplay",stack:this.game.mode+""+this.game.stage}))}},{key:"showFriendRank",value:function(){this.currentCtrl&&this.currentCtrl.showFriendRank&&this.currentCtrl.showFriendRank()}},{key:"friendRankReturn",value:function(){this.currentCtrl&&this.currentCtrl.friendRankReturn&&this.currentCtrl.friendRankReturn()}},{key:"shareGroupRank",value:function(){this.currentCtrl&&this.currentCtrl.shareGroupRank&&this.currentCtrl.shareGroupRank()}},{key:"clickRank",value:function(){this.currentCtrl&&this.currentCtrl.clickRank&&this.currentCtrl.clickRank()}},{key:"shareBattleCard",value:function(){this.currentCtrl&&this.currentCtrl.shareBattleCard&&this.currentCtrl.shareBattleCard()}},{key:"changeMode",value:function(e){this.currentCtrl&&this.currentCtrl.destroy&&this.currentCtrl.destroy(),this.model.setMode(this[e].name),this.currentCtrl=this[e],this[e].init()}},{key:"singleChangeToPlayer",value:function(){this.model.setMode(this.playerCtrl.name),this.currentCtrl=this.playerCtrl,this.playerCtrl.init()}},{key:"groupPlayGame",value:function(){this.currentCtrl&&this.currentCtrl.groupPlayGame&&this.currentCtrl.groupPlayGame()}},{key:"directPlaySingleGame",value:function(){this.currentCtrl&&this.currentCtrl.destroy(),this.model.setMode(this.singleCtrl.name),this.currentCtrl=this.singleCtrl,this.singleCtrl.clickStart()}},{key:"battlePlay",value:function(e){this.currentCtrl&&this.currentCtrl.battlePlay&&this.currentCtrl.battlePlay(e)}},{key:"shareObservCard",value:function(){this.currentCtrl&&this.currentCtrl.shareObservCard&&this.currentCtrl.shareObservCard()}},{key:"socketJoinSuccess",value:function(e){this.currentCtrl&&this.currentCtrl.socketJoinSuccess&&this.currentCtrl.socketJoinSuccess(e)}},{key:"showPlayerGG",value:function(e){this.currentCtrl&&this.currentCtrl.showPlayerGG&&this.currentCtrl.showPlayerGG(e)}},{key:"showPlayerWaiting",value:function(){this.currentCtrl&&this.currentCtrl.showPlayerWaiting&&this.currentCtrl.showPlayerWaiting()}},{key:"review",value:function(){}},{key:"onPlayerOut",value:function(){this.currentCtrl&&(this.currentCtrl.onPlayerOut?this.currentCtrl.onPlayerOut():this.game.handleWxOnError({message:"cannot Find this.currentCtrl.onPlayerOut",stack:this.game.mode+""+this.game.stage}))}},{key:"onViewerStart",value:function(){this.currentCtrl&&this.currentCtrl.onViewerStart&&this.currentCtrl.onViewerStart()}},{key:"wxOnhide",value:function(){this.currentCtrl&&this.currentCtrl.wxOnhide&&this.currentCtrl.wxOnhide()}},{key:"appealNotify",value:function(){this.currentCtrl&&this.currentCtrl.appealNotify&&this.currentCtrl.appealNotify()}}]),e}();t.default=u},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(e){return e&&e.__esModule?e:{default:e}}(i(2)),o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,this.gameCtrl=t.gameCtrl,this.model=t.gameModel,this.loginCb=null,this.serverConfigInterval=null,this.historyTimes=this.game.historyTimes}return n(e,[{key:"netWorkLogin",value:function(e){e&&(this.loginCb=e),r.default.requestLogin(this.afterRequestLogin.bind(this))}},{key:"afterRequestLogin",value:function(e){this.loginCb&&this.loginCb(e),e&&(r.default.getUserInfo(this.afterGetUserInfo.bind(this)),r.default.requestFriendsScore(this.updateFriendsScore.bind(this)),this.requestServerInit(),this.gameCtrl.onLoginSuccess())}},{key:"afterGetUserInfo",value:function(e){e.appeal_notify&&this.gameCtrl.appealNotify()}},{key:"requestServerInit",value:function(){r.default.requestInit(),this.serverConfigInterval=setInterval(r.default.requestInit.bind(r.default),6e4)}},{key:"clearServerInit",value:function(){this.serverConfigInterval&&clearInterval(this.serverConfigInterval)}},{key:"upDateFriendsScoreList",value:function(){this.model.getSessionId()&&r.default.requestFriendsScore(this.updateFriendsScore2.bind(this))}},{key:"updateFriendsScore",value:function(e,t){if(e&&(t.user_info.sort(function(e,t){return-(e.week_best_score||0)+(t.week_best_score||0)}),this.model.saveFriendsScore(t.user_info),t.my_user_info)){var i=t.my_user_info.history_best_score||0;this.model.saveHeighestScore(i);var n=t.my_user_info.week_best_score||0;this.model.weekBestScore=n,this.model.saveWeekBestScore(n);var r=t.my_user_info.times;this.historyTimes.verifyScore(r)}}},{key:"updateFriendsScore2",value:function(e,t){e&&(t.user_info.sort(function(e,t){return-(e.week_best_score||0)+(t.week_best_score||0)}),this.model.saveFriendsScore(t.user_info))}},{key:"uploadScore",value:function(e){r.default.requestSettlement(e)}},{key:"requestSettlement",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};r.default.requestSettlement(e,t,i,n)}},{key:"requestLogin",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};r.default.requestLogin(e)}},{key:"sendServerError",value:function(){r.default.sendServerError(3)}}]),e}();t.default=o},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=n(i(51)),a=n(i(49)),s=n(i(50)),l=n(i(2)),c=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,this.name="observe",this.gameCtrl=this.game.gameCtrl,this.model=this.game.gameModel,this.view=this.game.gameView,this.modeCtrl=i,this.netWorkCtrl=this.gameCtrl.netWorkCtrl,this.gameSocket=this.game.gameSocket,this.currentPage=null,this.waitingPage=new o.default(t),this.ggPage=new a.default(t),this.outPage=new s.default(t),this.gameId="",this.longTimeout=null}return r(e,[{key:"init",value:function(e){var t=this.model.getServerConfig();if(t&&!t.audience_mode_switch)return this.view.showServeConfigForbiddenObserveMode(),void this.modeCtrl.changeMode("singleCtrl");this.model.setStage("");var i=this.model.getSessionId();this.gameId=e.query.gameId,this.model.setObserveInfo({headimg:e.query.headimg,nickName:e.query.nickName}),this.model.setGameId(this.gameId),wx.showLoading(),i?this.afterLogin(!0):this.netWorkCtrl.netWorkLogin(this.afterLogin.bind(this))}},{key:"afterLogin",value:function(e){e?(this.setLongTimeHandle(),this.gameSocket.connectSocket(),this.model.setStage("")):this.goToObserveStateFail()}},{key:"socketJoinSuccess",value:function(e){this.clearLongTimeHandle(),wx.hideLoading(),e?(this.waitingPage.show(),this.model.setStage(this.waitingPage.name),this.currentPage=this.waitingPage,this.game.UI.setScore(0),this.checkPlayerTimeout=setInterval(this.checkPlayerState.bind(this),1e4)):this.showPlayerDead()}},{key:"goToObserveStateFail",value:function(){this.view.showObserveStateFail(),this.modeCtrl.changeMode("singleCtrl")}},{key:"setLongTimeHandle",value:function(){this.longTimeout=setTimeout(this.handleLongTime.bind(this),9e3)}},{key:"handleLongTime",value:function(){this.goToObserveStateFail()}},{key:"clearLongTimeHandle",value:function(){null!=this.longTimeout&&(clearTimeout(this.longTimeout),this.longTimeout=null)}},{key:"showPlayerDead",value:function(){this.gameSocket.close(),this.clearCheckPlayerTimeout(),this.currentPage&&this.currentPage.hide(),this.outPage.show(),this.model.setStage(this.outPage.name),this.currentPage=this.outPage}},{key:"checkPlayerState",value:function(){l.default.syncop(this.judgePlayerState.bind(this))}},{key:"judgePlayerState",value:function(e,t){e?0!=t.data.state&&(this.clearCheckPlayerTimeout(),this.showPlayerDead()):this.handleSyncopErr()}},{key:"handleSyncopErr",value:function(){this.view.showSyncopErr(),this.goToObserveStateFail()}},{key:"clearCheckPlayerTimeout",value:function(){null!=this.checkPlayerTimeout&&(clearInterval(this.checkPlayerTimeout),this.checkPlayerTimeout=null)}},{key:"destroy",value:function(){this.currentPage&&this.currentPage.hide(),this.currentPage=null,this.model.setStage(""),this.model.clearGameId(),this.clearLongTimeHandle(),this.clearCheckPlayerTimeout(),wx.hideLoading(),this.gameSocket.alive&&this.gameSocket.close(),this.model.clearObserveInfo(),this.game.instructionCtrl.destroy(),this.game.deadTimeout&&(clearTimeout(this.game.deadTimeout),this.game.deadTimeout=null),this.game.pendingReset=!1,this.game.resetScene()}},{key:"showPlayerWaiting",value:function(){this.currentPage!=this.waitingPage&&(null!=this.currentPage&&this.currentPage.hide(),this.waitingPage.show(),this.model.setStage(this.waitingPage.name),this.currentPage=this.waitingPage)}},{key:"showPlayerGG",value:function(e){null!=this.currentPage&&this.currentPage.hide(),this.ggPage.show(e),this.model.setStage(this.ggPage.name),this.currentPage=this.ggPage}},{key:"onPlayerOut",value:function(){this.showPlayerDead()}},{key:"onViewerStart",value:function(){this.gameSocket.quitObserve(),this.game.instructionCtrl.destroy(),this.modeCtrl.directPlaySingleGame()}},{key:"showGameOverPage",value:function(){}},{key:"wxOnhide",value:function(){this.clearCheckPlayerTimeout(),this.gameSocket.quitObserve(),this.gameSocket.close(),this.game.resetScene()}},{key:"wxOnshow",value:function(){}}]),e}();t.default=c},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=function e(t,i,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,i);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,n)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(n)},a=n(i(11)),s=i(8),l=n(i(59)),c=n(i(2)),h=function(e){function t(e,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i));return n.name="player",n.currentPage=null,n.gamePage=new l.default(e),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),r(t,[{key:"init",value:function(){switch(this.model.stage){case"game":this.currentPage=this.gamePage,this.currentPage.show();break;case"singleSettlementPgae":this.currentPage=this.gameOverPage;break;default:this.model.setStage(this.gamePage.name),this.currentPage=this.gamePage,this.currentPage.show()}}},{key:"showGameOverPage",value:function(e){this.game.seq++,this.gameSocket.sendCommand(this.game.seq,{type:-1,s:this.game.currentScore}),o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"showGameOverPage",this).call(this,e)}},{key:"shareObservCard",value:function(){this.shareObservCardA()}},{key:"shareObservCardA",value:function(){this.shareObservCardB()}},{key:"shareObservCardB",value:function(){var e=this;this.model.setStage("loading"),(0,s.shareObserve)(function(t,i){t&&e.gameCtrl.afterShareObserveCard(i),setTimeout(function(){"loading"==e.model.stage&&e.model.setStage("game")},50)})}},{key:"gameOverClickReplay",value:function(){o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"gameOverClickReplay",this).call(this),this.game.seq++,this.gameSocket.sendCommand(this.game.seq,{type:0,seed:this.game.randomSeed})}},{key:"destroy",value:function(){this.currentPage&&this.currentPage.hide(),this.currentPage=null,this.model.setStage(""),this.gameSocket.alive&&this.gameSocket.close(),this.model.clearGameId(),this.model.clearGameTicket(),this.game.viewer.reset(),this.game.deadTimeout&&(clearTimeout(this.game.deadTimeout),this.game.deadTimeout=null),this.game.pendingReset=!1,this.game.resetScene()}},{key:"wxOnhide",value:function(){var e=this;"loading"!=this.model.stage&&"singleSettlementPgae"!=this.model.stage&&"friendRankList"!=this.model.stage&&(c.default.quitGame(),this.gameSocket.cleanHeartBeat(),this.gameSocket.close(),setTimeout(function(){e.modeCtrl.changeMode("singleCtrl")},100))}},{key:"wxOnshow",value:function(){}}]),t}();t.default=h},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,this.model=this.game.gameModel,this.gameCtrl=this.game.gameCtrl}return n(e,[{key:"identifyMode",value:function(e){if(e.query&&e.query.hasOwnProperty("mode"))switch(e.query.mode){case"groupShare":e.shareTicket?this.model.setMode("groupShare"):(this.gameCtrl.identifyModeErr("获取群信息失败"),this.model.setMode("single"));break;case"battle":e.query.pkId?this.model.setMode("battle"):(this.gameCtrl.identifyModeErr("获取PK信息失败"),this.model.setMode("single"));break;case"observe":e.query.gameId?this.model.setMode("observe"):(this.gameCtrl.identifyModeErr("获取围观信息失败"),this.model.setMode("single"));break;default:this.model.setMode("single")}else this.model.setMode("single")}}]),e}();t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t}return n(e,[{key:"_play",value:function(){var e=this;if(this.index<this.actionList.length){var t=this.actionList[this.index][1],i=this.musicList[this.index+1],n=this.actionList[this.index][2],r=this.actionList[this.index][0],o=0==this.index?0:this.touchStartList[this.index]-this.touchStartList[this.index-1];this.timer=setTimeout(function(){++e.index,e.game.touchStartAnim(!0),e.jumpTimer=setTimeout(function(){e.game.touchEndAnim(r,t,n,i)},1e3*r),e._play()},o)}}},{key:"play",value:function(e,t,i,n){this.actionList=t,this.musicList=i,this.touchStartList=n,this.index=0,this.game.resetScene(e),this._play()}},{key:"destroy",value:function(){this.timer&&(clearTimeout(this.timer),this.timer=null),this.jumpTimer&&(clearTimeout(this.jumpTimer),this.jumpTimer=null)}}]),e}();t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n;(new(function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i(0)).FontLoader)).load(JSON.stringify({glyphs:{0:{ha:868,x_min:0,x_max:696,o:"m 0 868 l 696 868 l 696 693 l 0 693 l 0 868 m 696 0 l 0 0 l 0 175 l 696 175 l 696 0 m 0 694 l 175 694 l 175 174 l 0 174 l 0 694 m 521 694 l 696 694 l 696 174 l 521 174 l 521 694 z "},1:{ha:521,x_min:0,x_max:347,o:"m 174 0 l 347 0 l 347 868 l 0 868 l 0 694 l 174 694 l 174 0 z "},2:{ha:868,x_min:0,x_max:694,o:"m 0 868 l 0 694 l 521 694 l 521 521 l 0 521 l 0 0 l 694 0 l 694 174 l 174 174 l 174 347 l 694 347 l 694 868 l 0 868 z "},3:{ha:868,x_min:0,x_max:694,o:"m 694 0 l 694 868 l 0 868 l 0 694 l 521 694 l 521 521 l 0 521 l 0 347 l 521 347 l 521 174 l 0 174 l 0 0 l 694 0 z "},4:{ha:868,x_min:0,x_max:694,o:"m 521 347 l 174 347 l 174 868 l 0 868 l 0 174 l 521 174 l 521 0 l 694 0 l 694 868 l 521 868 l 521 347 z "},5:{ha:868,x_min:0,x_max:694,o:"m 694 694 l 694 868 l 0 868 l 0 347 l 521 347 l 521 174 l 0 174 l 0 0 l 694 0 l 694 521 l 174 521 l 174 694 l 694 694 z "},6:{ha:868,x_min:0,x_max:694,o:"m 0 869 l 175 869 l 175 0 l 0 0 l 0 869 m 174 519 l 694 519 l 694 346 l 174 346 l 174 519 m 174 869 l 519 869 l 519 694 l 174 694 l 174 869 m 174 174 l 694 174 l 694 0 l 174 0 l 174 174 m 521 347 l 694 347 l 694 174 l 521 174 l 521 347 z "},7:{ha:868,x_min:0,x_max:694,o:"m 0 868 l 0 694 l 521 694 l 521 521 l 694 521 l 694 868 l 0 868 m 347 347 l 521 347 l 521 521 l 347 521 l 347 347 m 174 0 l 347 0 l 347 347 l 174 347 l 174 0 z "},8:{ha:868,x_min:0,x_max:694,o:"m 0 868 l 174 868 l 174 0 l 0 0 l 0 868 m 521 868 l 694 868 l 694 0 l 521 0 l 521 868 m 174 174 l 521 174 l 521 0 l 174 0 l 174 174 m 174 868 l 521 868 l 521 693 l 174 693 l 174 868 m 174 521 l 521 521 l 521 346 l 174 346 l 174 521 z "},9:{ha:868,x_min:0,x_max:696,o:"m 0 521 l 696 521 l 696 346 l 0 346 l 0 521 m 0 868 l 694 868 l 694 694 l 0 694 l 0 868 m 0 696 l 175 696 l 175 519 l 0 519 l 0 696 m 521 696 l 694 696 l 694 521 l 521 521 l 521 696 m 521 349 l 696 349 l 696 -1 l 521 -1 l 521 349 m 174 174 l 521 174 l 521 -1 l 174 -1 l 174 174 z "},"+":{ha:694,x_min:0,x_max:521,o:"m 174 174 l 347 174 l 347 347 l 521 347 l 521 521 l 347 521 l 347 694 l 174 694 l 174 521 l 0 521 l 0 347 l 174 347 l 174 174 z "},"了":{ha:1389,x_min:72,x_max:1278,o:"m 659 954 q 1092 1246 891 1096 l 72 1246 l 72 1358 l 1278 1358 l 1278 1225 q 781 899 1035 1058 l 781 400 q 730 216 781 266 q 544 159 680 161 q 323 164 469 159 q 301 293 315 231 q 534 277 437 278 q 659 400 659 275 l 659 954 z "},"住":{ha:1389,x_min:18,x_max:1364,o:"m 423 279 l 841 279 l 841 694 l 502 694 l 502 793 l 841 793 l 841 1122 l 464 1122 l 464 1221 l 1324 1221 l 1324 1122 l 949 1122 l 949 793 l 1286 793 l 1286 694 l 949 694 l 949 279 l 1364 279 l 1364 180 l 423 180 l 423 279 m 18 788 q 346 1462 235 1084 l 457 1430 q 339 1135 401 1274 l 339 129 l 233 129 l 233 926 q 64 670 152 783 q 18 788 45 730 m 773 1407 l 860 1462 q 996 1287 935 1373 l 897 1225 q 773 1407 837 1325 z "},"力":{ha:1389,x_min:30,x_max:1265,o:"m 87 1154 l 526 1154 q 532 1458 530 1303 l 650 1458 q 643 1154 647 1314 l 1265 1154 q 1234 406 1249 625 q 985 170 1217 172 q 716 175 873 170 q 696 302 711 228 l 700 302 q 974 288 876 286 q 1119 433 1105 290 q 1143 1044 1135 677 l 640 1044 q 528 513 628 690 q 110 132 420 315 q 30 235 72 180 q 415 567 323 399 q 522 1044 510 720 l 87 1044 l 87 1154 z "},"太":{ha:1389,x_min:19,x_max:1367,o:"m 19 229 q 616 1019 548 514 l 43 1019 l 43 1123 l 624 1123 q 629 1453 629 1260 l 747 1453 q 743 1123 747 1280 l 1344 1123 l 1344 1019 l 749 1019 q 1367 262 891 467 q 1270 155 1303 199 q 694 878 831 401 q 102 129 581 411 q 19 229 75 164 m 540 408 l 625 476 q 817 267 723 372 l 720 190 q 540 408 636 297 z "},"好":{ha:1389,x_min:24,x_max:1370,o:"m 591 376 l 511 290 q 358 430 434 362 q 90 145 258 275 q 27 232 61 187 q 283 496 189 349 q 79 671 176 590 q 168 1073 127 842 l 24 1073 l 24 1173 l 184 1173 q 227 1459 206 1309 l 336 1444 q 290 1173 312 1295 l 547 1173 l 547 1086 q 414 521 515 718 q 591 376 503 449 m 545 849 l 918 849 l 918 1061 q 1165 1268 1053 1175 l 594 1268 l 594 1366 l 1314 1366 l 1314 1260 q 1025 1015 1168 1135 l 1025 849 l 1370 849 l 1370 751 l 1025 751 l 1025 316 q 850 152 1025 152 q 673 156 793 152 q 655 263 666 206 q 836 251 777 252 q 918 332 918 251 l 918 751 l 545 751 l 545 849 m 442 1073 l 271 1073 q 189 699 224 812 l 332 585 q 442 1073 423 774 z "},"很":{ha:1389,x_min:22,x_max:1370,o:"m 552 1381 l 1248 1381 l 1248 716 l 1145 716 l 1145 750 l 886 750 q 1002 526 928 627 q 1248 688 1134 605 l 1313 604 q 1058 457 1188 528 q 1370 235 1183 323 q 1287 138 1331 191 q 785 750 902 370 l 655 750 l 655 297 q 899 408 753 336 q 921 308 909 351 q 658 175 825 267 q 579 117 617 151 l 507 210 q 552 316 552 254 l 552 1381 m 22 650 q 395 1111 245 842 l 488 1058 q 343 844 419 944 l 343 123 l 239 123 l 239 715 q 69 545 157 623 q 22 650 49 600 m 1145 1289 l 655 1289 l 655 1112 l 1145 1112 l 1145 1289 m 28 1070 q 376 1458 243 1234 l 469 1404 q 79 972 312 1164 q 28 1070 54 1024 m 655 841 l 1145 841 l 1145 1021 l 655 1021 l 655 841 z "},"快":{ha:1389,x_min:18,x_max:1354,o:"m 407 779 l 768 779 q 783 1115 779 891 l 499 1115 l 499 1210 l 784 1210 q 784 1447 784 1317 l 891 1447 q 890 1210 891 1320 l 1221 1210 l 1221 779 l 1354 779 l 1354 684 l 914 684 q 1345 232 1025 374 q 1256 127 1312 199 q 840 623 948 302 q 442 117 758 317 q 363 208 397 175 q 754 684 688 399 l 407 684 l 407 779 m 209 1447 l 311 1447 l 311 1149 l 363 1184 q 515 994 452 1086 l 435 936 q 311 1108 376 1028 l 311 122 l 209 122 l 209 1447 m 1115 1115 l 888 1115 q 876 779 886 899 l 1115 779 l 1115 1115 m 77 1135 l 168 1122 q 109 776 148 959 q 18 798 71 785 q 77 1135 50 937 z "},"棒":{ha:1389,x_min:8,x_max:1375,o:"m 487 423 l 837 423 l 837 557 l 605 557 l 605 636 q 456 517 538 574 q 385 595 434 545 q 654 841 556 701 l 449 841 l 449 926 l 705 926 q 749 1039 732 981 l 528 1039 l 528 1124 l 770 1124 q 789 1236 781 1177 l 488 1236 l 488 1321 l 798 1321 q 806 1457 803 1386 l 906 1457 q 898 1321 903 1386 l 1312 1321 l 1312 1236 l 888 1236 q 871 1124 882 1176 l 1275 1124 l 1275 1039 l 852 1039 q 814 926 838 982 l 1366 926 l 1366 841 l 1085 841 q 1375 621 1191 690 q 1313 530 1341 576 q 1161 632 1229 575 l 1161 557 l 936 557 l 936 423 l 1290 423 l 1290 338 l 936 338 l 936 122 l 837 122 l 837 338 l 487 338 l 487 423 m 8 609 q 206 1101 130 807 l 24 1101 l 24 1195 l 209 1195 l 209 1459 l 304 1459 l 304 1195 l 461 1195 l 461 1101 l 304 1101 l 304 869 l 353 909 q 472 769 419 834 l 401 711 q 304 840 359 772 l 304 123 l 209 123 l 209 886 q 52 490 141 642 q 8 609 34 549 m 837 760 l 936 760 l 936 643 l 1147 643 q 989 841 1050 730 l 770 841 q 612 643 709 736 l 837 643 l 837 760 z "},"稳":{ha:1389,x_min:7,x_max:1386,o:"m 530 690 l 1183 690 l 1183 808 l 556 808 l 556 897 l 1183 897 l 1183 1013 l 559 1013 l 559 1099 l 540 1080 q 461 1146 506 1112 q 711 1469 614 1286 l 817 1449 q 749 1339 784 1393 l 1153 1339 l 1153 1252 q 1042 1104 1099 1179 l 1286 1104 l 1286 551 l 1183 551 l 1183 600 l 530 600 l 530 690 m 7 519 q 214 964 134 696 l 31 964 l 31 1058 l 222 1058 l 222 1275 q 58 1261 141 1268 q 39 1358 52 1303 q 484 1402 260 1371 l 506 1303 q 323 1284 415 1293 l 323 1058 l 492 1058 l 492 964 l 323 964 l 323 802 l 378 845 q 524 682 456 766 l 444 617 q 323 772 385 701 l 323 125 l 222 125 l 222 726 q 53 407 152 538 q 7 519 33 464 m 640 519 l 743 519 l 743 327 q 830 248 743 248 l 960 248 q 1061 316 1046 248 q 1081 442 1073 370 q 1184 401 1126 422 q 1154 274 1171 332 q 990 156 1124 156 l 810 156 q 640 321 640 156 l 640 519 m 1031 1251 l 689 1251 q 564 1104 629 1172 l 925 1104 q 1031 1251 982 1181 m 494 519 l 585 487 q 477 217 538 345 q 385 259 434 240 q 494 519 449 374 m 1177 477 l 1264 517 q 1386 274 1340 372 l 1293 229 q 1177 477 1248 339 m 795 544 l 868 594 q 1009 419 948 502 l 926 361 q 795 544 867 456 z "},"给":{ha:1389,x_min:18,x_max:1378,o:"m 551 693 l 1237 693 l 1237 121 l 1134 121 l 1134 212 l 654 212 l 654 119 l 551 119 l 551 693 m 184 646 q 467 667 191 646 q 454 581 460 625 q 68 543 228 560 l 46 628 q 252 914 127 705 q 46 899 165 909 l 18 983 q 273 1450 134 1116 l 380 1412 q 136 991 247 1157 q 297 994 217 993 q 399 1180 346 1078 l 499 1137 q 184 646 311 823 m 1134 601 l 654 601 l 654 304 l 1134 304 l 1134 601 m 971 1450 l 943 1404 q 1378 975 1101 1145 q 1299 888 1339 936 q 886 1313 1034 1077 q 502 871 738 1063 q 423 945 476 901 q 850 1450 697 1154 l 971 1450 m 597 947 l 1191 947 l 1191 854 l 597 854 l 597 947 m 23 331 q 476 425 275 378 q 477 330 475 376 q 58 232 201 273 l 23 331 z "},"超":{ha:1389,x_min:23,x_max:1370,o:"m 23 248 q 134 791 126 427 l 235 785 q 214 541 231 654 q 343 370 263 435 l 343 873 l 30 873 l 30 971 l 301 971 l 301 1166 l 77 1166 l 77 1264 l 301 1264 l 301 1457 l 407 1457 l 407 1264 l 609 1264 l 609 1166 l 407 1166 l 407 971 l 627 971 l 627 873 l 445 873 l 445 662 l 639 662 l 639 566 l 445 566 l 445 311 q 671 269 543 270 q 1370 274 929 264 q 1332 170 1345 214 q 637 172 922 167 q 193 408 309 180 q 83 121 153 232 q 23 248 56 184 m 711 836 l 1278 836 l 1278 351 l 1177 351 l 1177 410 l 811 410 l 811 343 l 711 343 l 711 836 m 644 1308 l 644 1398 l 1293 1398 q 1274 1086 1286 1214 q 1112 928 1259 932 q 943 932 1039 926 q 922 1039 935 981 q 1092 1024 1023 1023 q 1177 1111 1169 1024 q 1191 1308 1187 1190 l 933 1308 q 705 879 922 1001 q 640 964 680 921 q 831 1308 827 1067 l 644 1308 m 1177 745 l 811 745 l 811 500 l 1177 500 l 1177 745 z "},"越":{ha:1389,x_min:26,x_max:1370,o:"m 26 233 q 134 791 130 422 l 228 785 q 213 538 227 652 q 339 373 262 435 l 339 873 l 30 873 l 30 966 l 298 966 l 298 1166 l 77 1166 l 77 1259 l 298 1259 l 298 1455 l 393 1455 l 393 1259 l 602 1259 l 602 1166 l 393 1166 l 393 966 l 624 966 l 624 873 l 434 873 l 434 658 l 608 658 l 608 566 l 434 566 l 434 315 q 666 269 534 270 q 1370 274 981 264 q 1332 168 1345 214 q 637 172 947 168 q 191 406 316 178 q 83 121 155 232 q 26 233 56 184 m 770 395 q 987 644 895 511 q 917 1112 933 829 l 758 1112 l 758 650 q 897 773 819 703 q 917 674 905 720 q 755 529 837 606 q 692 457 726 500 l 624 525 q 666 658 666 579 l 666 1200 l 913 1200 q 909 1459 909 1328 l 1001 1459 q 1005 1200 1000 1336 l 1340 1200 l 1340 1112 l 1009 1112 q 1058 750 1020 902 q 1180 1017 1133 878 l 1271 979 q 1093 632 1196 792 q 1154 507 1120 560 q 1202 467 1179 467 q 1230 517 1222 467 q 1253 726 1242 604 q 1347 692 1316 703 q 1318 471 1332 544 q 1215 355 1298 355 q 1088 431 1142 355 q 1027 538 1054 476 q 844 331 944 426 q 770 395 818 362 m 1074 1404 l 1145 1455 q 1278 1298 1203 1392 l 1199 1242 q 1074 1404 1130 1340 z "},"！":{ha:1389,x_min:608,x_max:781,o:"m 761 1321 l 746 570 l 639 570 l 624 1321 l 761 1321 m 694 426 q 755 401 730 426 q 781 340 781 376 q 755 279 781 304 q 694 255 730 255 q 633 279 659 255 q 608 340 608 304 q 633 401 608 376 q 694 426 659 426 z "}},familyName:"Microsoft YaHei",ascender:1636,descender:-296,underlinePosition:-119,underlineThickness:80,boundingBox:{yMin:-186,xMin:-220,yMax:1706,xMax:1763},resolution:1e3,original_font_information:{format:0,copyright:"`2005 Microsoft Corporation. All rights reserved.",fontFamily:"Microsoft YaHei",fontSubfamily:"Regular",uniqueID:"Microsoft YaHei-Regular",fullName:"Microsoft YaHei",version:"Version 0.71",postScriptName:"MicrosoftYaHei",trademark:"Microsoft YaHei is either a registered trademark or a trademark of Microsoft Corporation in the United States and/or other countries.",manufacturer:"Microsoft Corporation",designer:"Founder",description:"Microsoft YaHei is a Simplified Chinese font developed by taking advantage of ClearType technology, and it provides excellent reading experience particularly onscreen. The font is very legible at small sizes.",manufacturerURL:"http://www.microsoft.com/typography",designerURL:"http://www.founder.com.cn/cn",licence:"\r\nNOTIFICATION OF LICENSE AGREEMENT \r\n\r\nThis font software is part of the Microsoft software product in which it was included and is provided under the end user license agreement (“EULA”) for that Microsoft software product. The terms and conditions of the EULA govern the use of font software. Please refer to the applicable Microsoft product EULA if you have any questions about how you may use this font software. Microsoft reserves all rights that are not expressly granted in the EULA. For products that may have installed this font please see the license link.\r\n",licenceURL:"http://www.microsoft.com/typography/fonts"},cssFontWeight:"normal",cssFontStyle:"normal"}),function(e){n=e}),t.default=n},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function r(){var e=Date.now(),t=e-N;N=e,requestAnimationFrame(r,!0),t>100||z.update(t/1e3)}var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();i(31);var a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i(0)),s=n(i(13)),l=n(i(27)),c=n(i(30)),h=n(i(19)),u=n(i(14)),d=i(1),f=n(i(28)),p=n(i(26)),m=n(i(32)),g=n(i(2)),v=n(i(3)),y=n(i(6)),b=n(i(24)),w=n(i(21)),x=n(i(22)),_=(n(i(23)),i(8)),M=n(i(29)),T=i(5),S=n(i(25)),E=n(i(20)),C=n(i(16)),P=n(i(18)),L=n(i(17)),k=i(10),A=n(i(15)),R=window.innerHeight>window.innerWidth?window.innerHeight:window.innerWidth,O=window.innerHeight<window.innerWidth?window.innerHeight:window.innerWidth,I=wx.getSystemInfoSync()||{},B="ios"==I.platform,D=I.model,U=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=t,this.is_from_wn=0,this.firstInit=!0,this.distance=0,this.heightestScore=0,this.stage="",this.succeedTime=0,this.lastAddBonus=-2,this.lastStage="",this.deadTimeout=null,this.currentScore=0,this.seq=0,this.thirdBlock=null,this.straight=!0,this.firstBlood=!1,this.lastHardLevel=200,this.guider=!1,this.hardDistances=[],this.socketFirstSync=!1,this.init(),this.randomSeed=Date.now(),(0,k.setRandomSeed)(this.randomSeed),this.actionList=[],this.musicList=[],this.touchList=[],this.touchMoveList=[],this.onceTouchMoveList=[],this.touchStartTime=[],this.blocks=[],this.liveTime=0,wx.setKeepScreenOn&&wx.setKeepScreenOn({keepScreenOn:!0})}return o(e,[{key:"moveGradually",value:function(e,t){if(this.animating&&!this.guider){(0,T.TweenAnimation)(this.bottle.obj.position.x,this.bottle.obj.position.x-e.x,500*t,"Linear",function(e,t){this.bottle.obj.position.x=e,t&&(this.bottle.obj.position.x=-.098)}.bind(this));for(var i=0,n=this.blocksInUse.length;i<n;++i)(0,T.TweenAnimation)(this.blocksInUse[i].obj.position.x,this.blocksInUse[i].obj.position.x-e.x,500*t,"Linear",function(e){this.obj.position.x=e}.bind(this.blocksInUse[i]));this.blocks[0]&&(0,T.TweenAnimation)(this.blocks[0].obj.position.x,this.blocks[0].obj.position.x-e.x,500*t,"Linear",function(e){this.obj.position.x=e}.bind(this.blocks[0]))}else(0,T.TweenAnimation)(this.camera.position.x,this.camera.position.x+e.x,500*t,"Quad.easeOut",function(e){this.camera.position.x=e}.bind(this)),(0,T.TweenAnimation)(this.camera.position.z,this.camera.position.z+e.z,500*t,"Quad.easeOut",function(e){this.camera.position.z=e}.bind(this))}},{key:"update",value:function(e){var t=this;this.tailSystem&&this.tailSystem.update(1e3*e),this.bottle.update(e),this.UI.update(),this.renderer.shadowMap.enabled&&(this.shadowTarget.position.x=this.bottle.obj.position.x,this.shadowTarget.position.z=this.bottle.obj.position.z,this.shadowLight.position.x=this.bottle.obj.position.x+0,this.shadowLight.position.z=this.bottle.obj.position.z+10);for(var i=0,n=this.blocksInUse.length;i<n;++i)this.blocksInUse[i].update();if(this.guider&&this.blocks[0]&&this.blocks[0].update(),("forerake"===this.bottle.status||"hypsokinesis"===this.bottle.status)&&5!=this.hit)for(var r=this.bottle.getBox(),o="forerake"===this.bottle.status?this.nextBlock.getBox():this.currentBlock.getBox(),i=0,n=r.length;i<n;++i)if(r[i].intersectsBox(o)){0==i?(this.bottle.rotate(),this.suspendTimer&&(clearTimeout(this.suspendTimer),this.suspendTimer=null)):1==i?(this.bottle.suspend(),this.suspendTimer&&(clearTimeout(this.suspendTimer),this.suspendTimer=null)):2!=i||this.suspendTimer||(this.suspendTimer=setTimeout(function(){t.bottle.suspend(),t.suspendTimer=null},90*this.distance));break}if(this.bottle.obj.position.y<=d.BLOCK.height/2+.1&&"jump"===this.bottle.status&&this.bottle.flyingTime>.3&&!this.pendingReset){if(1===this.hit||7===this.hit){if(this.bottle.stop(),this.bottle.changeScorePos(0),this.succeed(),this.animating)return;1===this.hit?(this.audioManager["combo"+Math.min(this.doubleHit+1,8)].seek(0),this.audioManager["combo"+Math.min(this.doubleHit+1,8)].play(),++this.doubleHit,this.addWave(Math.min(this.doubleHit,4)),this.bottle.showAddScore(1,!0,this.quick),this.UI.addScore(1,!0,this.quick),this.currentScore=this.UI.score,"observe"!=this.mode&&this.showCombo()):(this.doubleHit=0,this.UI.addScore(1,!1,this.quick),this.currentScore=this.UI.score,this.bottle.showAddScore(1,!1,this.quick)),this.audioManager.success.seek(0),this.audioManager.success.play(),"observe"!=this.mode&&this.rankSystem.update()}else 2===this.hit?(this.bottle.stop(),this.bottle.obj.position.y=d.BLOCK.height/2,this.bottle.obj.position.x=this.bottle.destination[0],this.bottle.obj.position.z=this.bottle.destination[1]):3===this.hit?(this.bottle.hypsokinesis(),this.audioManager.fall_2.play(),this.bottle.obj.position.y=d.BLOCK.height/2):4===this.hit||5===this.hit?(this.bottle.forerake(),this.audioManager.fall_2.play(),this.bottle.obj.position.y=d.BLOCK.height/2):0===this.hit?(this.bottle.fall(),this.audioManager.fall.play(),this.bottle.obj.position.y=d.BLOCK.height/2):6===this.hit?(this.bottle.stop(),this.audioManager.fall.play(),this.bottle.obj.position.y=d.BLOCK.height/2):-1===this.hit&&(this.bottle.stop(),this.bottle.obj.position.y=d.BLOCK.height/2,this.bottle.obj.position.x=0);if(0===this.hit||3===this.hit||4===this.hit||5===this.hit||6===this.hit){if(this.guider)if(this.UI.score>0)this.guider=!1;else{if(!(this.liveTime>3))return void this.live();this.guider=!1,this.full2D.hide2DGradually()}this.pendingReset=!0,this.currentScore=this.UI.score,this.gameCtrl.gameOver(this.currentScore),this.deadTimeout=setTimeout(function(){T.TweenAnimation.killAll(),t.pendingReset=!1,t.gameCtrl.gameOverShowPage(),"observe"==t.mode&&t.instructionCtrl.onCmdComplete()},2e3)}else"observe"==this.mode&&this.instructionCtrl.onCmdComplete()}if("prepare" == this.bottle.status) {var i=(Date.now()-this.mouseDownTime)/1e3;var vz=Math.min(i*d.BOTTLE.velocityZIncrement,150);vz=+vz.toFixed(2);var vy=Math.min(d.BOTTLE.velocityY+i*d.BOTTLE.velocityYIncrement,180);vy=+vy.toFixed(2);this.vectorHelperOne.set(this.nextBlock.obj.position.x-this.bottle.obj.position.x,this.nextBlock.obj.position.z-this.bottle.obj.position.z);this.vectorHelperOne.x=+this.vectorHelperOne.x.toFixed(2);this.vectorHelperOne.y=+this.vectorHelperOne.y.toFixed(2);var r=vy/d.GAME.gravity*2;var n=this.bottle.obj.position.y.toFixed(2);var a=d.BLOCK.height/2-n;r=+(r-=+((-vy+Math.sqrt(Math.pow(vy,2)-2*d.GAME.gravity*a))/-d.GAME.gravity).toFixed(2)).toFixed(2);var s=[];this.vectorHelperTwo.set(this.bottle.obj.position.x,this.bottle.obj.position.z);var l=this.vectorHelperOne.setLength(vz * r);this.vectorHelperTwo.add(l);s.push(+this.vectorHelperTwo.x.toFixed(2),+this.vectorHelperTwo.y.toFixed(2));this.helperArrow.position.set(s[0],this.nextBlock.obj.position.y+d.BLOCK.height/2+.15,s[1]);var array=this.helperLine.geometry.attributes.position.array;array[0]=this.currentBlock.obj.position.x;array[1]=this.currentBlock.obj.position.y+d.BLOCK.height/2+.15;array[2]=this.currentBlock.obj.position.z;array[3]=s[0];array[4]=this.nextBlock.obj.position.y+d.BLOCK.height/2+.15;array[5]=s[1];this.helperLine.geometry.computeBoundingSphere();this.helperLine.geometry.attributes.position.needsUpdate=true;}else{this.helperArrow.position.set(-300,0,0);var array=this.helperLine.geometry.attributes.position.array;array[0]=-300;array[1]=0;array[2]=0;array[3]=-500;array[4]=0;array[5]=0;this.helperLine.geometry.computeBoundingSphere();this.helperLine.geometry.attributes.position.needsUpdate = true;}this.renderer.render(this.scene,this.camera)}},{key:"succeed",value:function(){var e=this;if(++this.succeedTime,"review"!=this.mode&&(this.musicScore=!1),this.lastSucceedTime=Date.now(),this.succeedTime%15==0&&this.ground.changeColor(),this.blocksInUse.length>=9){var t=this.blocksInUse.shift();t.obj.visible=!1,this.blocksPool.push(t)}var i=this.nextBlock.obj.position.clone().sub(this.currentBlock.obj.position);this.bottle.obj.position.x=this.bottle.destination[0],this.bottle.obj.position.z=this.bottle.destination[1],this.bottle.squeeze();var n=this.thirdBlock;if(this.audioManager.setTimerFlag(!0),!this.firstAnimating){if(this.guider&&(this.guider=!1,this.full2D.hide2DGradually()),this.animating);else{if(this.nextBlock.whenSucceed&&this.nextBlock.whenSucceed(),15==this.nextBlock.order)this.nextBlock.glow();else if(19==this.nextBlock.order){var r=this.nextBlock,o=function(){e.audioManager.sing.seek(0),e.audioManager.sing.play(),r.playMusic(),e.musicScore=!0,e.UI.addScore(30,!1,!1,!0),e.bottle.showAddScore(30,!1,!1,!0)};this.musicTimer=setTimeout(function(){o()},2e3)}else if(24==this.nextBlock.order){r=this.nextBlock;this.audioManager.register("store",function(){r.openDoor()},function(){r.closeDoor()});o=function(){e.audioManager.store.seek(0),e.audioManager.store.play(),e.musicScore=!0,e.UI.addScore(15,!1,!1,!0),e.bottle.showAddScore(15,!1,!1,!0)};this.musicTimer=setTimeout(function(){o()},2e3)}else if(26==this.nextBlock.order){o=function(){e.audioManager.water.seek(0),e.audioManager.water.play(),e.UI.addScore(5,!1,!1,!0),e.musicScore=!0,e.bottle.showAddScore(5,!1,!1,!0)};this.musicTimer=setTimeout(function(){o()},2e3)}else if(17==this.nextBlock.order){var r=this.nextBlock,o=function(){r.rotateBox(),e.musicScore=!0,e.UI.addScore(10,!1,!1,!0),e.bottle.showAddScore(10,!1,!1,!0)};this.musicTimer=setTimeout(function(){o()},2e3)}else if(this.nextBlock.scoreBonus>0||this.nextBlock.musicName){var r=this.nextBlock,o=function(){r.musicName&&(e.audioManager[r.musicName].seek(0),e.audioManager[r.musicName].play()),r.scoreBonus>0&&(e.UI.addScore(r.scoreBonus,!1,!1,!0),e.bottle.showAddScore(r.scoreBonus,!1,!1,!0))};this.musicTimer=setTimeout(function(){o()},2e3)}var a=this.nextBlock.obj.position.clone(),s=this.nextBlock.radius+this.distance+n.radius;this.straight;this.straight?(a.x+=s,this.bottle.lookAt("straight",a.clone())):(a.z-=s,this.bottle.lookAt("left",a.clone())),n.obj.position.x=a.x,n.obj.position.z=a.z,this.audioManager.pop.seek(0),this.audioManager.pop.play()}n.popup();var l=n.obj.position.clone().sub(this.nextBlock.obj.position),c=i.add(l);c.x/=2,c.z/=2,this.scene.add(n.obj),this.currentBlock=this.nextBlock,this.nextBlock=n;var h=c.length()/10;d.GAME.canShadow&&this.bottle.scatterParticles(),this.animating&&(c.x=19.8),this.moveGradually(c,h),this.bottle.human.rotation.z=0,this.bottle.human.rotation.x=0}}},{key:"handleWxOnHideEvent",value:function(){this.show=!1,"prepare"==this.bottle.status&&(this.touchObserve=!0),this.animateTimer&&(clearTimeout(this.animateTimer),this.animateTimer=null),this.onshowAnimateTimer&&(clearTimeout(this.onshowAnimateTimer),this.onshowAnimateTimer=null),this.gameCtrl.wxOnhide()}},{key:"init",value:function(){var e=this;v.default.getFirstBlood()||this.options.query.mode||(this.guider=!0),this.gameCtrl=new C.default(this),this.gameView=new P.default(this),this.gameModel=new L.default(this),this.instructionCtrl=new A.default(this),this.historyTimes=new S.default(this),this.reporter=new E.default,this.audioManager=new f.default(this),this.gameSocket=new w.default(this),this.scene=new a.Scene;var t=d.FRUSTUMSIZE,i=O/R;this.camera=new a.OrthographicCamera(t*i/-2,t*i/2,t/2,t/-2,-10,85),this.camera.position.set(-17,30,26),this.camera.lookAt(new a.Vector3(13,0,-4)),this.scene.add(this.camera),this.renderer=new a.WebGLRenderer({antialias:!0,canvas:canvas,preserveDrawingBuffer:!0}),window.renderer=this.renderer,this.blocksPool=[],this.blocksInUse=[],this.doubleHit=0,B&&(D.indexOf("iPhone 4")>=0||D.indexOf("iPhone 5")>=0||I.system.indexOf("iOS 9")>=0||I.system.indexOf("iOS 8")>=0||D.indexOf("iPhone 6")>=0&&D.indexOf("iPhone 6s")<0)?(this.renderer.shadowMap.enabled=!1,d.GAME.canShadow=!1,this.renderer.setPixelRatio(1.5)):void 0!==I.benchmarkLevel&&I.benchmarkLevel<5&&-1!=I.benchmarkLevel?(d.GAME.canShadow=!1,this.renderer.shadowMap.enabled=!1,this.renderer.setPixelRatio(window.devicePixelRatio?B?Math.min(window.devicePixelRatio,2):window.devicePixelRatio:1)):(this.renderer.setPixelRatio(window.devicePixelRatio?B?Math.min(window.devicePixelRatio,2):window.devicePixelRatio:1),this.renderer.shadowMap.enabled=!0),this.renderer.setSize(O,R),this.renderer.localClippingEnabled=!0,this.ground=new h.default,this.ground.obj.position.z=-84,this.camera.add(this.ground.obj),this.waves=[];for(o=0;o<4;++o){var n=new c.default;this.waves.push(n),n.obj.visible=!1,this.scene.add(n.obj)}var r=new a.MeshBasicMaterial({color:16119285});this.vectorHelperOne=new a.Vector2(0, 0);this.vectorHelperTwo=new a.Vector2(0, 0);this.helperLine=new a.Line();this.helperLine.material.color.setHex(0x0000ff);var pointsOfHelperLine=new Float32Array(6);this.helperLine.geometry.addAttribute("position",new a.BufferAttribute(pointsOfHelperLine,3));this.helperLine.geometry.attributes.position.setDynamic(true);this.helperLine.name="helper_line";this.scene.add(this.helperLine);this.helperArrow=new a.Mesh(new a.CircleGeometry(.6, 50),new a.MeshBasicMaterial({color: 255}));this.helperArrow.name="helper_arrow";this.helperArrow.position.x=-500;this.helperArrow.rotation.x=-Math.PI/2;this.scene.add(this.helperArrow);this.combo=new a.Mesh(new a.CircleGeometry(.6,30),r),this.combo.name="combo",this.combo.position.x=-50,this.combo.rotation.x=-Math.PI/2,this.scene.add(this.combo),this.renderer.shadowMap.enabled&&(this.shadowTarget=new a.Mesh(new a.PlaneGeometry(.1,.1),r),this.shadowTarget.visible=!1,this.shadowTarget.name="shadowTarget",this.scene.add(this.shadowTarget)),this.currentBlock=new s.default(0),this.initNextBlock=this.nextBlock=new s.default(1),this.nextBlock.obj.position.x=20,this.bottle=new u.default,this.bottle.obj.position.set(-10,-d.BLOCK.height/2,0),this.scene.add(this.bottle.obj),this.guider&&(this.bottle.obj.position.set(-11,50,0),this.camera.position.x-=19,setTimeout(function(){e.bottle.showup()},800),this.currentBlock.obj.position.x=-11,this.currentBlock.change(null,"gray",.7),this.scene.add(this.currentBlock.obj),this.guiderTimer=setInterval(function(){e.bottle.velocity.vz=0,e.bottle.velocity.vy=150,e.direction=new a.Vector2(1,0);var t=new a.Vector3(1,0,0);e.bottle.jump(t.normalize()),e.hit=e.checkHit2(e.bottle,e.currentBlock)},3e3)),this.blocksInUse.push(this.nextBlock),this.blocksInUse.push(this.currentBlock);for(var o=2;o<30;++o){var m=new s.default(o);this.blocksPool.push(m)}this.full2D=new x.default({camera:this.camera,onClickRank:this.gameCtrl.clickRank.bind(this.gameCtrl),onClickReplay:this.gameCtrl.clickReplay.bind(this.gameCtrl),onClickShare:this.gameCtrl.shareBattleCard.bind(this.gameCtrl),onClickStart:this.gameCtrl.clickStart.bind(this.gameCtrl),onShowFriendRank:this.gameCtrl.showFriendRank.bind(this.gameCtrl),onBattlePlay:this.gameCtrl.onBattlePlay.bind(this.gameCtrl),onGroupShare:this.gameCtrl.shareGroupRank.bind(this.gameCtrl),friendRankReturn:this.gameCtrl.friendRankReturn.bind(this.gameCtrl),groupPlayGame:this.gameCtrl.groupPlayGame.bind(this.gameCtrl),onLookersStart:this.gameCtrl.onViewerStart.bind(this.gameCtrl),onReturnWechat:function(){wx.exitMiniProgram()},onClickPureShare:function(t){(0,_.pureShare)(t,e.gameModel.currentScore)}}),this.UI=new l.default(this.scene,this.camera,this.full2D,this),d.GAME.canShadow&&(this.tailSystem=new p.default(this.scene,this.bottle)),this.addLight(),this.bindEvent(),this.viewer=new M.default(this.camera),this.rankSystem=new b.default(this),setTimeout(function(){e.audioManager.icon.play()},100),this.UI.hideScore(),this.gameModel.init(),this.gameCtrl.init(),this.gameView.init(),wx.onShow(this.handleWxOnShowEvent.bind(this)),wx.onHide(this.handleWxOnHideEvent.bind(this)),wx.onError(this.handleWxOnError.bind(this)),wx.onAudioInterruptionBegin&&wx.onAudioInterruptionBegin(this.handleInterrupt.bind(this)),this.gameCtrl.firstInitGame(this.options),wx.showShareMenu(),wx.onShareAppMessage(function(){return{title:"一起来，跳一跳",imageUrl:"http://mmbiz.qpic.cn/mmbiz_png/icTdbqWNOwNTTiaKet81gQJHS4AOib6MiaPhwEaqw1NPcZGtgAGTlVJ4lrBAGtchhnXanMyo7q7toRpD4DukV5F2TA/0?wx_fmt=png"}})}},{key:"loopAnimate",value:function(){var e=this;this.bottle.velocity.vz=Math.min(.7*d.BOTTLE.velocityZIncrement,180),this.bottle.velocity.vy=Math.min(d.BOTTLE.velocityY+.7*d.BOTTLE.velocityYIncrement,180);var t=new a.Vector3(this.nextBlock.obj.position.x-this.bottle.obj.position.x,0,this.nextBlock.obj.position.z-this.bottle.obj.position.z);this.direction=new a.Vector2(this.nextBlock.obj.position.x-this.bottle.obj.position.x,this.nextBlock.obj.position.z-this.bottle.obj.position.z),this.hit=this.checkHit2(this.bottle,this.currentBlock,this.nextBlock),this.thirdBlock=this.generateNextBlock(),this.thirdBlock.obj.position.set(39.7,0,0),this.tailSystem&&this.tailSystem.correctPosition(),this.bottle.jump(t.normalize()),this.animateTimer=setTimeout(function(){e.loopAnimate()},3e3)}},{key:"animate",value:function(){var e=this;this.firstAnimating=!0;for(var t=this,i=0;i<7;++i)setTimeout(function(e){return function(){if(("single"==t.mode&&("startPage"==t.stage||"friendRankList"==t.stage)||t.guider)&&t.blocks&&t.blocks.length<7){var i=new s.default(-1,e);i.showup(e),t.scene.add(i.obj),t.blocks.push(i),0==e&&(this.nextBlock=i)}}}(i),200*i);setTimeout(function(){if("single"==t.mode&&("startPage"==t.stage||"friendRankList"==t.stage)||t.guider){e.bottle.velocity.vz=Math.min(.4*d.BOTTLE.velocityZIncrement,180),e.bottle.velocity.vy=Math.min(d.BOTTLE.velocityY+.4*d.BOTTLE.velocityYIncrement,180),e.direction=new a.Vector2(e.nextBlock.obj.position.x-e.bottle.obj.position.x,e.nextBlock.obj.position.z-e.bottle.obj.position.z);var i=new a.Vector3(e.nextBlock.obj.position.x-e.bottle.obj.position.x,0,e.nextBlock.obj.position.z-e.bottle.obj.position.z);e.bottle.jump(i.normalize()),e.hit=-1,e.nextBlock=e.initNextBlock;for(var n=0,r=e.blocks.length;n<r;++n)T.customAnimation.to(e.blocks[n].hitObj.material,1,{opacity:0,delay:.2*n+.5});for(var n=1,r=e.blocks.length;n<r;++n)T.customAnimation.to(e.blocks[n].obj.position,.5,{z:n%2==0?60:-60,delay:.1*n+2.2});if(e.guider){T.customAnimation.to(e.currentBlock.obj.position,.5,{z:-60,delay:2.1});var o=e.currentBlock;setTimeout(function(){o.obj.visible=!1},3e3)}e.currentBlock=e.blocks[0],e.beginnerTimer=setTimeout(function(){if("single"==t.mode&&("startPage"==t.stage||"friendRankList"==t.stage)||t.guider){t.guider&&e.full2D.showBeginnerPage(),e.nextBlock.popup(),e.nextBlock.greenMaterial.color.setHex(6118749),e.nextBlock.whiteMaterial.color.setHex(11184810),e.scene.add(e.nextBlock.obj);for(var i=1,n=e.blocks.length;i<n;++i)e.blocks[i].obj.visible=!1;e.guider&&(e.animating=!1),e.firstAnimating=!1}},3e3),e.loopAnimateTimer=setTimeout(function(){"single"!=t.mode||"startPage"!=t.stage&&"friendRankList"!=t.stage||t.show&&e.loopAnimate()},4500)}},1500)}},{key:"handleWxOnShowEvent",value:function(e){var t=this;wx.setKeepScreenOn&&wx.setKeepScreenOn({keepScreenOn:!0}),this.show=!0,this.reporter.enterReport(e.scene),this.guiderTimer&&!this.guider&&(clearInterval(this.guiderTimer),this.guiderTimer=null),this.onshowAnimateTimer=setTimeout(function(e){return function(){"single"==t.mode&&"startPage"==t.stage&&!t.animateTimer&&t.show&&(t.blocks&&t.blocks.length>0&&!t.firstAnimating?t.loopAnimate():t.animating||!e||t.guider||(t.animating=!0,t.animate()))}}(this.firstInit),1e3),this.firstInit?this.firstInit=!1:this.gameCtrl.wxOnShow(e)}},{key:"showCombo",value:function(){var e=this;setTimeout(function(){e.combo.position.set(e.nextBlock.obj.position.x,d.BLOCK.height/2+.15,e.nextBlock.obj.position.z)},200)}},{key:"hideCombo",value:function(){this.combo.position.set(-30,0,0)}},{key:"replayGame",value:function(e){this.currentScore=0,this.gameCtrl.onReplayGame(),this.audioManager.restart.seek(0),this.audioManager.restart.play(),this.guider?(this.guiderTimer&&(clearInterval(this.guiderTimer),this.guiderTimer=null),this.animating=!0,this.animate(),this.moveGradually(new a.Vector3(19,0,0),3)):(this.resetScene(e),this.bottle.showup())}},{key:"addWave",value:function(e){for(var t=this,i=0;i<e;++i)setTimeout(function(e){return function(){t.waves[e].obj.visible=!0,t.waves[e].obj.position.set(t.bottle.obj.position.x,d.BLOCK.height/2+.1*e+1,t.bottle.obj.position.z),(0,T.TweenAnimation)(t.waves[e].obj.scale.x,4,2/(e/2.5+2)*500,"Linear",function(i,n){t.waves[e].obj.scale.x=i,t.waves[e].obj.scale.y=i,t.waves[e].obj.scale.z=i}),(0,T.TweenAnimation)(t.waves[e].obj.material.opacity,0,2/(e/2.5+2)*500,"Linear",function(i,n){t.waves[e].obj.material.opacity=i,n&&t.waves[e].reset()})}}(i),200*i)}},{key:"addLight",value:function(){var e=new a.AmbientLight(16777215,.8);if(this.shadowLight=new a.DirectionalLight(16777215,.28),this.shadowLight.position.set(0,15,10),this.renderer.shadowMap.enabled){this.shadowLight.castShadow=!0,this.shadowLight.target=this.shadowTarget,this.shadowLight.shadow.camera.near=5,this.shadowLight.shadow.camera.far=32,this.shadowLight.shadow.camera.left=-10,this.shadowLight.shadow.camera.right=10,this.shadowLight.shadow.camera.top=10,this.shadowLight.shadow.camera.bottom=-10,this.shadowLight.shadow.mapSize.width=512,this.shadowLight.shadow.mapSize.height=512;var t=new a.PlaneGeometry(65,25);this.shadowGround=new a.Mesh(t,new a.ShadowMaterial({transparent:!0,color:0,opacity:.3})),this.shadowGround.receiveShadow=!0,this.shadowGround.position.x=-25,this.shadowGround.position.y=-18,this.shadowGround.position.z=-15,this.shadowGround.rotation.x=-Math.PI/2,this.shadowLight.add(this.shadowGround)}this.scene.add(this.shadowLight),this.scene.add(e)}},{key:"checkHit2",value:function(e,t,i,n){var r=e.velocity.vy/d.GAME.gravity*2;n=n||+e.obj.position.y.toFixed(2);var o=d.BLOCK.height/2-n;r=+(r-=+((-e.velocity.vy+Math.sqrt(Math.pow(e.velocity.vy,2)-2*d.GAME.gravity*o))/-d.GAME.gravity).toFixed(2)).toFixed(2);var s=[],l=new a.Vector2(e.obj.position.x,e.obj.position.z),c=this.direction.setLength(e.velocity.vz*r);if(l.add(c),e.destination=[+l.x.toFixed(2),+l.y.toFixed(2)],s.push(+l.x.toFixed(2),+l.y.toFixed(2)),this.animating)return 7;if(i){var h,u=Math.pow(s[0]-i.obj.position.x,2)+Math.pow(s[1]-i.obj.position.z,2),f=i.getVertices();if((0,m.default)(s,f))return Math.abs(u)<.5?1:7;(0,m.default)([s[0]-d.BOTTLE.bodyWidth/2,s[1]],f)||(0,m.default)([s[0],s[1]+d.BOTTLE.bodyDepth/2],f)?h=5:((0,m.default)([s[0],s[1]-d.BOTTLE.bodyDepth/2],f)||(0,m.default)([s[0]+d.BOTTLE.bodyDepth/2,s[1]],f))&&(h=3)}var p=t.getVertices();return(0,m.default)(s,p)?2:(0,m.default)([s[0],s[1]+d.BOTTLE.bodyDepth/2],p)||(0,m.default)([s[0]-d.BOTTLE.bodyWidth/2,s[1]],p)?h?6:4:h||void 0||0}},{key:"shuffleArray",value:function(e){for(var t=e.length-1;t>0;t--){var i=Math.floor((0,k.random)()*(t+1)),n=e[t];e[t]=e[i],e[i]=n}}},{key:"generateNextBlock",value:function(){var e,t=5;this.UI.score>1e3?t=6:this.succeedTime>3e3&&(t=7),this.animating||this.shuffleArray(this.blocksPool);for(var i=0,n=this.blocksPool.length;i<n;++i)if(this.succeedTime-this.lastAddBonus>=t&&this.blocksPool[i].order>=13||this.succeedTime-this.lastAddBonus<t&&this.blocksPool[i].order<13){if((e=this.blocksPool[i]).order>=13){if(this.lastBonusOrder&&this.lastBonusOrder==e.order||this.UI.score<100&&29==e.order)continue;this.lastAddBonus=this.succeedTime,this.lastBonusOrder=e.order}this.blocksInUse.push(e),this.blocksPool.splice(i,1);break}if(!e){for(var r=this.blocksInUse.shift();r.order>=13;)r.obj.visible=!1,this.blocksPool.push(r),r=this.blocksInUse.shift();e=r,this.blocksInUse.push(e)}return e.obj.visible=!1,e.change(),e}},{key:"live",value:function(){var e=this;++this.liveTime,this.firstAnimating=!1,this.animateTimer&&(clearTimeout(this.animateTimer),this.animateTimer=null),T.TweenAnimation.killAll(),this.animating=!1,d.BLOCK.minRadiusScale=.8,d.BLOCK.maxRadiusScale=1,d.BLOCK.minDistance=1,d.BLOCK.maxDistance=17,setTimeout(function(){e.bottle.reset(),e.bottle.obj.position.x=0,e.bottle.showup()},2e3),this.actionList=[],this.musicList=[],this.touchList=[],this.touchMoveList=[],this.touchStartTime=[],wx.triggerGC&&wx.triggerGC()}},{key:"resetScene",value:function(e){if(this.touchObserve=!1,this.firstAnimating=!1,this.blocks&&this.blocks.length>0)for(var t=0,i=this.blocks.length;t<i;++t)this.scene.remove(this.blocks[t].obj);this.blocks=null,"observe"==this.mode&&(this.audioManager.scale_intro.stop(),this.audioManager.scale_loop.stop()),this.randomSeed=e||Date.now(),(0,k.setRandomSeed)(this.randomSeed),this.actionList=[],this.musicList=[],this.touchList=[],this.touchStartTime=[],this.touchMoveList=[],this.animateTimer&&(clearTimeout(this.animateTimer),this.animateTimer=null),this.loopAnimateTimer&&(clearTimeout(this.loopAnimateTimer),this.loopAnimateTimer=null),this.beginnerTimer&&(clearTimeout(this.beginnerTimer),this.beginnerTimer=null),this.currentBlock&&this.currentBlock.reset(),T.TweenAnimation.killAll(),this.animating=!1,d.BLOCK.minRadiusScale=.8,d.BLOCK.maxRadiusScale=1,d.BLOCK.minDistance=1,d.BLOCK.maxDistance=17;for(var t=0,i=this.blocksInUse.length;t<i;++t){var n=this.blocksInUse.pop();n.obj.visible=!1,n.reset(),this.blocksPool.push(n)}for(var t=0,i=this.waves.length;t<i;++t)this.waves[t].reset();this.blocksPool.sort(function(e,t){return e.order-t.order}),this.currentBlock=this.blocksPool.shift(),this.currentBlock.obj.visible=!0,this.scene.add(this.currentBlock.obj),this.blocksInUse.push(this.currentBlock),this.shadowTarget&&this.shadowTarget.position.set(0,0,0),this.nextBlock=this.blocksPool.shift(),this.currentBlock.change(null,null,1),this.nextBlock.change(null,null,1),this.nextBlock.obj.position.set(20,0,0),this.currentBlock.obj.position.set(0,0,0),this.nextBlock.obj.visible=!0,this.scene.add(this.nextBlock.obj),this.blocksInUse.push(this.nextBlock),this.bottle.reset(),this.thirdBlock=null,this.UI.reset(),this.rankSystem.reset(),this.hit=null,this.lastAddBonus=-2,this.lastBonusOrder=null,this.succeedTime=0,this.doubleHit=0,this.camera.position.set(-17,30,26),this.shadowLight.position.set(0,15,10),wx.triggerGC&&wx.triggerGC()}},{key:"generateHardDistances",value:function(){for(var e=2+Math.floor(2*(0,k.random)()),t=[],i=0;i<e;++i)i<e-1?t.push(d.BLOCK.minDistance+2*(0,k.random)()):t.push(d.BLOCK.maxDistance-2*(0,k.random)());return t}},{key:"touchStartAnim",value:function(e){this.stopBlockMusic(),this.audioManager.scale_intro.seek(0),this.audioManager.scale_intro.play(),this.bottle.prepare(),this.currentBlock.shrink(),e||(this.mouseDownTime=Date.now(),this.onceTouchMoveList=[])}},{key:"touchEndAnim",value:function(e,t,i,n){this.audioManager.scale_intro.stop(),this.audioManager.scale_loop.stop(),this.currentBlock.rebound(),this.musicScore=n||this.musicScore,this.duration=e||(Date.now()-this.mouseDownTime)/1e3,this.bottle.velocity.vz=Math.min(this.duration*d.BOTTLE.velocityZIncrement,150),this.bottle.velocity.vz=+this.bottle.velocity.vz.toFixed(2),this.bottle.velocity.vy=Math.min(d.BOTTLE.velocityY+this.duration*d.BOTTLE.velocityYIncrement,180),this.bottle.velocity.vy=+this.bottle.velocity.vy.toFixed(2),this.direction=new a.Vector2(this.nextBlock.obj.position.x-this.bottle.obj.position.x,this.nextBlock.obj.position.z-this.bottle.obj.position.z),this.direction.x=+this.direction.x.toFixed(2),this.direction.y=+this.direction.y.toFixed(2);var r=new a.Vector3(this.direction.x,0,this.direction.y);if(this.bottle.jump(r.normalize()),this.hideCombo(),this.hit=this.checkHit2(this.bottle,this.currentBlock,this.nextBlock,t),15==this.currentBlock.order&&this.currentBlock.hideGlow(),this.distance=d.BLOCK.minDistance+(0,k.random)()*(d.BLOCK.maxDistance-d.BLOCK.minDistance),this.distance=+this.distance.toFixed(2),this.straight=(0,k.random)()>.5?1:0,1===this.hit||7===this.hit){var o=this.generateNextBlock();this.thirdBlock=o,this.quick=i||Date.now()-this.lastSucceedTime<800||!1}}},{key:"addAdBlocks",value:function(e){if(e&&e.resource){this.adBlockCount=0;for(var t=e.resource,i=0,n=t.length;i<n;++i)++this.adBlockCount,this.blocksPool.push(new s.default(this.blocksPool.length+2,t[i],this.audioManager))}}},{key:"removeAdBlocks",value:function(){for(var e=0;e<this.adBlockCount;++e){var t=this.blocksPool.pop();t.hitObj.material.map&&t.hitObj.material.map.dispose(),t=null}this.adBlockCount=0}},{key:"bindEvent",value:function(){var e=this;e.instructionCtrl.bindCmdHandler(function(t){if(-1==t.type)return e.gameCtrl.showPlayerGG(t.s),void e.instructionCtrl.onCmdComplete();if(0==t.type)return e.socketFirstSync=!0,e.bottle.reset(),e.UI.scoreText.changeStyle({textAlign:"center"}),e.UI.setScore(0),void e.instructionCtrl.onCmdComplete();if(e.gameCtrl.showPlayerWaiting(),t.score!=e.UI.score&&(e.UI.score=t.score,e.UI.setScore(t.score)),t&&t.b&&t.b.vy){if(e.socketFirstSync&&(e.socketFirstSync=!1,e.camera.position.set(t.ca.x,t.ca.y,t.ca.z),e.ground.obj.position.set(t.gd.x,t.gd.y,t.gd.z)),e.currentBlock.order!=t.c.order||e.nextBlock.order!=t.n.order){for(var i=0,n=e.blocksInUse.length;i<n;++i){var r=e.blocksInUse.pop();e.scene.remove(r.obj),e.blocksPool.push(r)}var o=e.blocksPool.findIndex(function(e){return e.order==t.c.order});e.currentBlock=e.blocksPool[o];h=e.blocksPool.splice(o,1);e.blocksInUse.push(h[0]);var s=e.blocksPool.findIndex(function(e){return e.order==t.n.order});e.nextBlock=e.blocksPool[s];h=e.blocksPool.splice(s,1);e.blocksInUse.push(h[0])}e.scene.add(e.currentBlock.obj),e.scene.add(e.nextBlock.obj),e.currentBlock.obj.visible=!0,e.nextBlock.obj.visible=!0,e.currentBlock.obj.position.x=t.c.x,e.currentBlock.obj.position.z=t.c.z,e.currentBlock.change(t.c.r,t.c.type,t.c.rs),e.nextBlock.obj.position.x=t.n.x,e.nextBlock.obj.position.z=t.n.z,e.nextBlock.change(t.n.r,t.n.type,t.n.rs),e.bottle.obj.position.set(t.b.x,d.BLOCK.height/2,t.b.z),e.bottle.velocity.vz=t.b.vz,e.bottle.velocity.vy=t.b.vy,e.distance=t.di,e.straight=t.s;var l=new a.Vector3(e.nextBlock.obj.position.x-e.bottle.obj.position.x,0,e.nextBlock.obj.position.z-e.bottle.obj.position.z);if(e.direction=new a.Vector2(e.nextBlock.obj.position.x-e.bottle.obj.position.x,e.nextBlock.obj.position.z-e.bottle.obj.position.z),e.checkHit2(e.bottle,e.currentBlock,e.nextBlock,t.b.y),e.quick=t.q,t.t){var c=e.blocksPool.findIndex(function(e){return e.order==t.t.order});if(c>-1){e.thirdBlock=e.blocksPool[c];var h=e.blocksPool.splice(c,1);e.blocksInUse.push(e.thirdBlock)}else e.thirdBlock=e.blocksInUse.find(function(e){return e.order==t.t.order}),e.scene.remove(e.thirdBlock.obj);e.thirdBlock.change(t.t.r,t.t.type,t.t.rs)}e.hit=t.h,e.tailSystem&&e.tailSystem.correctPosition(),e.audioManager.scale_intro.seek(0),e.audioManager.scale_intro.play(),e.bottle.prepare(),e.currentBlock.shrink();var u={x:t.ca.x,y:t.ca.y,z:t.ca.z},f={x:t.gd.x,y:t.gd.y,z:t.gd.z};e.stopBlockMusic(),e.instructionCtrl.icTimeout=setTimeout(function(){e.audioManager.scale_intro.stop(),e.audioManager.scale_loop.stop(),15==e.currentBlock.order&&e.currentBlock.hideGlow(),e.currentBlock.rebound(),e.camera.position.set(u.x,u.y,u.z),e.ground.obj.position.set(f.x,f.y,f.z),u=null,f=null,e.bottle.jump(l.normalize())},1e3*t.d),t=null}else e.instructionCtrl.onCmdComplete()}),e.gameSocket.onReciveCommand(function(t,i){"observe"==e.mode&&e.instructionCtrl.onReceiveCommand(i,t)}),e.gameSocket.onPeopleCome(function(t){e.gameCtrl.onPeopleCome(t)}),e.gameSocket.onPlayerOut(function(){e.gameCtrl.onPlayerOut()}),e.gameSocket.onJoinSuccess(function(t){e.gameCtrl.socketJoinSuccess(t),"observe"==e.mode&&(e.bottle.obj.position.set(8,-d.BLOCK.height/2,0),e.camera.position.set(-17,30,26),e.shadowLight.position.set(0,15,10),e.currentBlock&&(e.currentBlock.obj.visible=!1),e.nextBlock&&(e.nextBlock.obj.visible=!1))}),canvas.addEventListener("touchstart",function(t){if(t.touches.length>=2)e.touchObserve=!0;else{if(("single"==e.mode||"player"==e.mode)&&"game"==e.stage&&!e.is_from_wn&&!e.guider&&t.changedTouches[0].clientX<.13*O&&t.changedTouches[0].clientY>.88*R)return"prepare"==e.bottle.status&&(e.touchObserve=!0),void e.gameCtrl.shareObservCard();if("friendRankList"!=e.stage&&"battlePage"!=e.stage&&"groupRankList"!=e.stage&&"singleSettlementPgae"!=e.stage&&"startPage"!=e.stage)if("viewerWaiting"!=e.stage&&"viewerGG"!=e.stage&&"viewerOut"!=e.stage){if("game"==e.stage){if("observe"===e.mode)return;if(!("prepare"!==e.bottle.status||e.pendingReset||e.guider&&e.animating)&&1==t.targetTouches.length)return e.touchObserve?void(e.touchObserve=!1):void e.handleInterrupt();"stop"!==e.bottle.status||e.pendingReset||e.guider&&e.animating||e.touchStartAnim()}}else e.full2D.doTouchEndEvent(t);else e.full2D.doTouchStartEvent(t)}});canvas.addEventListener("touchcancel",function(e){}),canvas.addEventListener("touchend",function(t){t.changedTouches[0].clientX,t.changedTouches[0].clientY;"singleSettlementPgae"!=e.stage&&"startPage"!=e.stage&&"viewerWaiting"!=e.stage&&"viewerGG"!=e.stage&&"viewerOut"!=e.stage&&"friendRankList"!=e.stage&&"battlePage"!=e.stage&&"groupRankList"!=e.stage?"game"==e.stage&&("prepare"!==e.bottle.status||e.pendingReset||e.guider&&e.animating||(e.touchEndAnim(),"player"===e.mode&&(++e.seq,e.gameSocket.sendCommand(e.seq,{type:1,c:{x:e.currentBlock.obj.position.x,z:e.currentBlock.obj.position.z,order:e.currentBlock.order,type:e.currentBlock.type,r:e.currentBlock.radius,rs:e.currentBlock.radiusScale},n:{x:e.nextBlock.obj.position.x,z:e.nextBlock.obj.position.z,order:e.nextBlock.order,type:e.nextBlock.type,r:e.nextBlock.radius,rs:e.nextBlock.radiusScale},d:e.duration,b:{x:e.bottle.obj.position.x,y:+e.bottle.obj.position.y.toFixed(2),z:e.bottle.obj.position.z,vy:e.bottle.velocity.vy,vz:e.bottle.velocity.vz},t:1===e.hit||7===e.hit?{order:e.thirdBlock.order,type:e.thirdBlock.type,r:e.thirdBlock.radius,rs:e.thirdBlock.radiusScale}:null,h:e.hit,di:e.distance,s:e.straight,q:e.quick,ca:{x:e.camera.position.x,y:e.camera.position.y,z:e.camera.position.z},gd:{x:e.ground.obj.position.x,y:e.ground.obj.position.y,z:e.ground.obj.position.z},score:e.UI.score})),"observe"!=e.mode&&"review"!=e.mode&&(e.actionList.push([e.duration,+e.bottle.obj.position.y.toFixed(2),e.quick]),e.musicList.push(e.musicScore),e.touchStartTime.push(e.mouseDownTime),t.changedTouches&&t.changedTouches[0]&&(e.touchMoveList.push(e.onceTouchMoveList),e.touchList.push([t.changedTouches[0].clientX,t.changedTouches[0].clientY]))))):e.full2D.doTouchEndEvent(t)}),canvas.addEventListener("touchmove",function(t){if("prepare"==e.bottle.status){if(e.onceTouchMoveList.length>=10)return;e.onceTouchMoveList.push(t.changedTouches[0].clientX,t.changedTouches[0].clientY)}"battlePage"!=e.stage&&"friendRankList"!=e.stage&&"groupRankList"!=e.stage||e.full2D.doTouchMoveEvent(t)})}},{key:"stopBlockMusic",value:function(){19==this.currentBlock.order?(this.audioManager.sing.stop(),this.currentBlock.stopMusic()):24==this.currentBlock.order?(this.audioManager.store.stop(),this.currentBlock.closeDoor()):26==this.currentBlock.order&&this.audioManager.water.stop(),this.audioManager.clearTimer(),this.audioManager.setTimerFlag(!1),this.musicTimer&&(clearTimeout(this.musicTimer),this.musicTimer=null)}},{key:"handleNetworkFucked",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"网络异常,点击确定进入游戏";this.rollBackToSingle(),e&&wx.showModal({title:"提示",content:t,showCancel:!1})}},{key:"handleSocketFucked",value:function(){this.gameSocket.close(),"player"==this.mode&&(this.shareObservCardFail(),this.updateUI()),"observe"==this.mode&&this.handleNetworkFucked(!0)}},{key:"handleInterrupt",value:function(){"prepare"==this.bottle.status&&(this.bottle.velocity.vz=0,this.bottle.velocity.vy=150,this.bottle.jump(new a.Vector3(1,0,0).normalize()),this.currentBlock.rebound(),this.audioManager.scale_loop.stop(),this.direction=new a.Vector2(1,0),this.hit=this.checkHit2(this.bottle,this.currentBlock,this.nextBlock))}},{key:"handleWxOnError",value:function(e){var t=(void 0==y.default.serverConfig.bad_js_ratio?1e6:y.default.serverConfig.bad_js_ratio)/1e6||1;Math.random()<=t&&g.default.badReport(e.message,e.stack)}},{key:"sendServerError",value:function(e){g.default.sendServerError(e)}}]),e}();if(wx.getLaunchOptionsSync)z=new U(wx.getLaunchOptionsSync());else var z=new U;var N=Date.now(),j=requestAnimationFrame,F=[],G=void 0;window.requestAnimationFrame=function(e,t){t?G=e:F.push(e)},function e(){var t=[],i=G;F.forEach(function(e){t.push(e)}),G=void 0,F.length=0,t.forEach(function(e){"function"==typeof e&&e()}),"function"==typeof i&&i(),j(e)}(),r()},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=n||function(e,t){var i={},n=i.lib={},r=function(){},o=n.Base={extend:function(e){r.prototype=this;var t=new r;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},a=n.WordArray=o.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=void 0!=t?t:4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,i=e.words,n=this.sigBytes;if(e=e.sigBytes,this.clamp(),n%4)for(var r=0;r<e;r++)t[n+r>>>2]|=(i[r>>>2]>>>24-r%4*8&255)<<24-(n+r)%4*8;else if(65535<i.length)for(r=0;r<e;r+=4)t[n+r>>>2]=i[r>>>2];else t.push.apply(t,i);return this.sigBytes+=e,this},clamp:function(){var t=this.words,i=this.sigBytes;t[i>>>2]&=4294967295<<32-i%4*8,t.length=e.ceil(i/4)},clone:function(){var e=o.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var i=[],n=0;n<t;n+=4)i.push(4294967296*e.random()|0);return new a.init(i,t)}}),s=i.enc={},l=s.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var i=[],n=0;n<e;n++){var r=t[n>>>2]>>>24-n%4*8&255;i.push((r>>>4).toString(16)),i.push((15&r).toString(16))}return i.join("")},parse:function(e){for(var t=e.length,i=[],n=0;n<t;n+=2)i[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new a.init(i,t/2)}},c=s.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var i=[],n=0;n<e;n++)i.push(String.fromCharCode(t[n>>>2]>>>24-n%4*8&255));return i.join("")},parse:function(e){for(var t=e.length,i=[],n=0;n<t;n++)i[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new a.init(i,t)}},h=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},u=n.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=h.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var i=this._data,n=i.words,r=i.sigBytes,o=this.blockSize,s=r/(4*o);if(t=(s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0))*o,r=e.min(4*t,r),t){for(var l=0;l<t;l+=o)this._doProcessBlock(n,l);l=n.splice(0,t),i.sigBytes-=r}return new a.init(l,r)},clone:function(){var e=o.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});n.Hasher=u.extend({cfg:o.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){u.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,i){return new e.init(i).finalize(t)}},_createHmacHelper:function(e){return function(t,i){return new d.HMAC.init(e,i).finalize(t)}}});var d=i.algo={};return i}(Math);!function(){var e=n,t=e.lib.WordArray;e.enc.Base64={stringify:function(e){var t=e.words,i=e.sigBytes,n=this._map;e.clamp(),e=[];for(var r=0;r<i;r+=3)for(var o=(t[r>>>2]>>>24-r%4*8&255)<<16|(t[r+1>>>2]>>>24-(r+1)%4*8&255)<<8|t[r+2>>>2]>>>24-(r+2)%4*8&255,a=0;4>a&&r+.75*a<i;a++)e.push(n.charAt(o>>>6*(3-a)&63));if(t=n.charAt(64))for(;e.length%4;)e.push(t);return e.join("")},parse:function(e){var i=e.length,n=this._map;(r=n.charAt(64))&&-1!=(r=e.indexOf(r))&&(i=r);for(var r=[],o=0,a=0;a<i;a++)if(a%4){var s=n.indexOf(e.charAt(a-1))<<a%4*2,l=n.indexOf(e.charAt(a))>>>6-a%4*2;r[o>>>2]|=(s|l)<<24-o%4*8,o++}return t.create(r,o)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(e){function t(e,t,i,n,r,o,a){return((e=e+(t&i|~t&n)+r+a)<<o|e>>>32-o)+t}function i(e,t,i,n,r,o,a){return((e=e+(t&n|i&~n)+r+a)<<o|e>>>32-o)+t}function r(e,t,i,n,r,o,a){return((e=e+(t^i^n)+r+a)<<o|e>>>32-o)+t}function o(e,t,i,n,r,o,a){return((e=e+(i^(t|~n))+r+a)<<o|e>>>32-o)+t}for(var a=n,s=(c=a.lib).WordArray,l=c.Hasher,c=a.algo,h=[],u=0;64>u;u++)h[u]=4294967296*e.abs(e.sin(u+1))|0;c=c.MD5=l.extend({_doReset:function(){this._hash=new s.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,n){for(a=0;16>a;a++){l=e[s=n+a];e[s]=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8)}var a=this._hash.words,s=e[n+0],l=e[n+1],c=e[n+2],u=e[n+3],d=e[n+4],f=e[n+5],p=e[n+6],m=e[n+7],g=e[n+8],v=e[n+9],y=e[n+10],b=e[n+11],w=e[n+12],x=e[n+13],_=e[n+14],M=e[n+15],T=a[0],S=a[1],E=a[2],C=a[3],S=o(S=o(S=o(S=o(S=r(S=r(S=r(S=r(S=i(S=i(S=i(S=i(S=t(S=t(S=t(S=t(S,E=t(E,C=t(C,T=t(T,S,E,C,s,7,h[0]),S,E,l,12,h[1]),T,S,c,17,h[2]),C,T,u,22,h[3]),E=t(E,C=t(C,T=t(T,S,E,C,d,7,h[4]),S,E,f,12,h[5]),T,S,p,17,h[6]),C,T,m,22,h[7]),E=t(E,C=t(C,T=t(T,S,E,C,g,7,h[8]),S,E,v,12,h[9]),T,S,y,17,h[10]),C,T,b,22,h[11]),E=t(E,C=t(C,T=t(T,S,E,C,w,7,h[12]),S,E,x,12,h[13]),T,S,_,17,h[14]),C,T,M,22,h[15]),E=i(E,C=i(C,T=i(T,S,E,C,l,5,h[16]),S,E,p,9,h[17]),T,S,b,14,h[18]),C,T,s,20,h[19]),E=i(E,C=i(C,T=i(T,S,E,C,f,5,h[20]),S,E,y,9,h[21]),T,S,M,14,h[22]),C,T,d,20,h[23]),E=i(E,C=i(C,T=i(T,S,E,C,v,5,h[24]),S,E,_,9,h[25]),T,S,u,14,h[26]),C,T,g,20,h[27]),E=i(E,C=i(C,T=i(T,S,E,C,x,5,h[28]),S,E,c,9,h[29]),T,S,m,14,h[30]),C,T,w,20,h[31]),E=r(E,C=r(C,T=r(T,S,E,C,f,4,h[32]),S,E,g,11,h[33]),T,S,b,16,h[34]),C,T,_,23,h[35]),E=r(E,C=r(C,T=r(T,S,E,C,l,4,h[36]),S,E,d,11,h[37]),T,S,m,16,h[38]),C,T,y,23,h[39]),E=r(E,C=r(C,T=r(T,S,E,C,x,4,h[40]),S,E,s,11,h[41]),T,S,u,16,h[42]),C,T,p,23,h[43]),E=r(E,C=r(C,T=r(T,S,E,C,v,4,h[44]),S,E,w,11,h[45]),T,S,M,16,h[46]),C,T,c,23,h[47]),E=o(E,C=o(C,T=o(T,S,E,C,s,6,h[48]),S,E,m,10,h[49]),T,S,_,15,h[50]),C,T,f,21,h[51]),E=o(E,C=o(C,T=o(T,S,E,C,w,6,h[52]),S,E,u,10,h[53]),T,S,y,15,h[54]),C,T,l,21,h[55]),E=o(E,C=o(C,T=o(T,S,E,C,g,6,h[56]),S,E,M,10,h[57]),T,S,p,15,h[58]),C,T,x,21,h[59]),E=o(E,C=o(C,T=o(T,S,E,C,d,6,h[60]),S,E,b,10,h[61]),T,S,c,15,h[62]),C,T,v,21,h[63]);a[0]=a[0]+T|0,a[1]=a[1]+S|0,a[2]=a[2]+E|0,a[3]=a[3]+C|0},_doFinalize:function(){var t=this._data,i=t.words,n=8*this._nDataBytes,r=8*t.sigBytes;i[r>>>5]|=128<<24-r%32;var o=e.floor(n/4294967296);for(i[15+(r+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),i[14+(r+64>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),t.sigBytes=4*(i.length+1),this._process(),i=(t=this._hash).words,n=0;4>n;n++)r=i[n],i[n]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8);return t},clone:function(){var e=l.clone.call(this);return e._hash=this._hash.clone(),e}}),a.MD5=l._createHelper(c),a.HmacMD5=l._createHmacHelper(c)}(Math),function(){var e=n,t=e.lib,i=t.Base,r=t.WordArray,o=(t=e.algo).EvpKDF=i.extend({cfg:i.extend({keySize:4,hasher:t.MD5,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var i=(s=this.cfg).hasher.create(),n=r.create(),o=n.words,a=s.keySize,s=s.iterations;o.length<a;){l&&i.update(l);var l=i.update(e).finalize(t);i.reset();for(var c=1;c<s;c++)l=i.finalize(l),i.reset();n.concat(l)}return n.sigBytes=4*a,n}});e.EvpKDF=function(e,t,i){return o.create(i).compute(e,t)}}(),n.lib.Cipher||function(e){var t=(p=n).lib,i=t.Base,r=t.WordArray,o=t.BufferedBlockAlgorithm,a=p.enc.Base64,s=p.algo.EvpKDF,l=t.Cipher=o.extend({cfg:i.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,i){this.cfg=this.cfg.extend(i),this._xformMode=e,this._key=t,this.reset()},reset:function(){o.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(e){return{encrypt:function(t,i,n){return("string"==typeof i?m:f).encrypt(e,t,i,n)},decrypt:function(t,i,n){return("string"==typeof i?m:f).decrypt(e,t,i,n)}}}});t.StreamCipher=l.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var c=p.mode={},h=function(e,t,i){var n=this._iv;n?this._iv=void 0:n=this._prevBlock;for(var r=0;r<i;r++)e[t+r]^=n[r]},u=(t.BlockCipherMode=i.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}})).extend();u.Encryptor=u.extend({processBlock:function(e,t){var i=this._cipher,n=i.blockSize;h.call(this,e,t,n),i.encryptBlock(e,t),this._prevBlock=e.slice(t,t+n)}}),u.Decryptor=u.extend({processBlock:function(e,t){var i=this._cipher,n=i.blockSize,r=e.slice(t,t+n);i.decryptBlock(e,t),h.call(this,e,t,n),this._prevBlock=r}}),c=c.CBC=u,u=(p.pad={}).Pkcs7={pad:function(e,t){for(var i=4*t,n=(i=i-e.sigBytes%i)<<24|i<<16|i<<8|i,o=[],a=0;a<i;a+=4)o.push(n);i=r.create(o,i),e.concat(i)},unpad:function(e){e.sigBytes-=255&e.words[e.sigBytes-1>>>2]}},t.BlockCipher=l.extend({cfg:l.cfg.extend({mode:c,padding:u}),reset:function(){l.reset.call(this);var e=(t=this.cfg).iv,t=t.mode;if(this._xformMode==this._ENC_XFORM_MODE)var i=t.createEncryptor;else i=t.createDecryptor,this._minBufferSize=1;this._mode=i.call(t,this,e&&e.words)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);var t=this._process(!0)}else t=this._process(!0),e.unpad(t);return t},blockSize:4});var d=t.CipherParams=i.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),c=(p.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext;return((e=e.salt)?r.create([1398893684,1701076831]).concat(e).concat(t):t).toString(a)},parse:function(e){var t=(e=a.parse(e)).words;if(1398893684==t[0]&&1701076831==t[1]){var i=r.create(t.slice(2,4));t.splice(0,4),e.sigBytes-=16}return d.create({ciphertext:e,salt:i})}},f=t.SerializableCipher=i.extend({cfg:i.extend({format:c}),encrypt:function(e,t,i,n){n=this.cfg.extend(n);var r=e.createEncryptor(i,n);return t=r.finalize(t),r=r.cfg,d.create({ciphertext:t,key:i,iv:r.iv,algorithm:e,mode:r.mode,padding:r.padding,blockSize:e.blockSize,formatter:n.format})},decrypt:function(e,t,i,n){return n=this.cfg.extend(n),t=this._parse(t,n.format),e.createDecryptor(i,n).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),p=(p.kdf={}).OpenSSL={execute:function(e,t,i,n){return n||(n=r.random(8)),e=s.create({keySize:t+i}).compute(e,n),i=r.create(e.words.slice(t),4*i),e.sigBytes=4*t,d.create({key:e,iv:i,salt:n})}},m=t.PasswordBasedCipher=f.extend({cfg:f.cfg.extend({kdf:p}),encrypt:function(e,t,i,n){return n=this.cfg.extend(n),i=n.kdf.execute(i,e.keySize,e.ivSize),n.iv=i.iv,(e=f.encrypt.call(this,e,t,i.key,n)).mixIn(i),e},decrypt:function(e,t,i,n){return n=this.cfg.extend(n),t=this._parse(t,n.format),i=n.kdf.execute(i,e.keySize,e.ivSize,t.salt),n.iv=i.iv,f.decrypt.call(this,e,t,i.key,n)}})}(),function(){for(var e=n,t=e.lib.BlockCipher,i=e.algo,r=[],o=[],a=[],s=[],l=[],c=[],h=[],u=[],d=[],f=[],p=[],m=0;256>m;m++)p[m]=128>m?m<<1:m<<1^283;for(var g=0,v=0,m=0;256>m;m++){var y=(y=v^v<<1^v<<2^v<<3^v<<4)>>>8^255&y^99;r[g]=y,o[y]=g;var b=p[g],w=p[b],x=p[w],_=257*p[y]^16843008*y;a[g]=_<<24|_>>>8,s[g]=_<<16|_>>>16,l[g]=_<<8|_>>>24,c[g]=_,_=16843009*x^65537*w^257*b^16843008*g,h[y]=_<<24|_>>>8,u[y]=_<<16|_>>>16,d[y]=_<<8|_>>>24,f[y]=_,g?(g=b^p[p[p[x^b]]],v^=p[p[v]]):g=v=1}var M=[0,1,2,4,8,16,32,64,128,27,54],i=i.AES=t.extend({_doReset:function(){for(var e=(i=this._key).words,t=i.sigBytes/4,i=4*((this._nRounds=t+6)+1),n=this._keySchedule=[],o=0;o<i;o++)if(o<t)n[o]=e[o];else{var a=n[o-1];o%t?6<t&&4==o%t&&(a=r[a>>>24]<<24|r[a>>>16&255]<<16|r[a>>>8&255]<<8|r[255&a]):(a=a<<8|a>>>24,a=r[a>>>24]<<24|r[a>>>16&255]<<16|r[a>>>8&255]<<8|r[255&a],a^=M[o/t|0]<<24),n[o]=n[o-t]^a}for(e=this._invKeySchedule=[],t=0;t<i;t++)o=i-t,a=t%4?n[o]:n[o-4],e[t]=4>t||4>=o?a:h[r[a>>>24]]^u[r[a>>>16&255]]^d[r[a>>>8&255]]^f[r[255&a]]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,a,s,l,c,r)},decryptBlock:function(e,t){var i=e[t+1];e[t+1]=e[t+3],e[t+3]=i,this._doCryptBlock(e,t,this._invKeySchedule,h,u,d,f,o),i=e[t+1],e[t+1]=e[t+3],e[t+3]=i},_doCryptBlock:function(e,t,i,n,r,o,a,s){for(var l=this._nRounds,c=e[t]^i[0],h=e[t+1]^i[1],u=e[t+2]^i[2],d=e[t+3]^i[3],f=4,p=1;p<l;p++)var m=n[c>>>24]^r[h>>>16&255]^o[u>>>8&255]^a[255&d]^i[f++],g=n[h>>>24]^r[u>>>16&255]^o[d>>>8&255]^a[255&c]^i[f++],v=n[u>>>24]^r[d>>>16&255]^o[c>>>8&255]^a[255&h]^i[f++],d=n[d>>>24]^r[c>>>16&255]^o[h>>>8&255]^a[255&u]^i[f++],c=m,h=g,u=v;m=(s[c>>>24]<<24|s[h>>>16&255]<<16|s[u>>>8&255]<<8|s[255&d])^i[f++],g=(s[h>>>24]<<24|s[u>>>16&255]<<16|s[d>>>8&255]<<8|s[255&c])^i[f++],v=(s[u>>>24]<<24|s[d>>>16&255]<<16|s[c>>>8&255]<<8|s[255&h])^i[f++],d=(s[d>>>24]<<24|s[c>>>16&255]<<16|s[h>>>8&255]<<8|s[255&u])^i[f++],e[t]=m,e[t+1]=g,e[t+2]=v,e[t+3]=d},keySize:8});e.AES=t._createHelper(i)}(),t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={Linear:function(e,t,i,n){return i*e/n+t},Quad:{easeIn:function(e,t,i,n){return i*(e/=n)*e+t},easeOut:function(e,t,i,n){return-i*(e/=n)*(e-2)+t},easeInOut:function(e,t,i,n){return(e/=n/2)<1?i/2*e*e+t:-i/2*(--e*(e-2)-1)+t}},Cubic:{easeIn:function(e,t,i,n){return i*(e/=n)*e*e+t},easeOut:function(e,t,i,n){return i*((e=e/n-1)*e*e+1)+t},easeInOut:function(e,t,i,n){return(e/=n/2)<1?i/2*e*e*e+t:i/2*((e-=2)*e*e+2)+t}},Quart:{easeIn:function(e,t,i,n){return i*(e/=n)*e*e*e+t},easeOut:function(e,t,i,n){return-i*((e=e/n-1)*e*e*e-1)+t},easeInOut:function(e,t,i,n){return(e/=n/2)<1?i/2*e*e*e*e+t:-i/2*((e-=2)*e*e*e-2)+t}},Quint:{easeIn:function(e,t,i,n){return i*(e/=n)*e*e*e*e+t},easeOut:function(e,t,i,n){return i*((e=e/n-1)*e*e*e*e+1)+t},easeInOut:function(e,t,i,n){return(e/=n/2)<1?i/2*e*e*e*e*e+t:i/2*((e-=2)*e*e*e*e+2)+t}},Sine:{easeIn:function(e,t,i,n){return-i*Math.cos(e/n*(Math.PI/2))+i+t},easeOut:function(e,t,i,n){return i*Math.sin(e/n*(Math.PI/2))+t},easeInOut:function(e,t,i,n){return-i/2*(Math.cos(Math.PI*e/n)-1)+t}},Expo:{easeIn:function(e,t,i,n){return 0==e?t:i*Math.pow(2,10*(e/n-1))+t},easeOut:function(e,t,i,n){return e==n?t+i:i*(1-Math.pow(2,-10*e/n))+t},easeInOut:function(e,t,i,n){return 0==e?t:e==n?t+i:(e/=n/2)<1?i/2*Math.pow(2,10*(e-1))+t:i/2*(2-Math.pow(2,-10*--e))+t}},Circ:{easeIn:function(e,t,i,n){return-i*(Math.sqrt(1-(e/=n)*e)-1)+t},easeOut:function(e,t,i,n){return i*Math.sqrt(1-(e=e/n-1)*e)+t},easeInOut:function(e,t,i,n){return(e/=n/2)<1?-i/2*(Math.sqrt(1-e*e)-1)+t:i/2*(Math.sqrt(1-(e-=2)*e)+1)+t}},Elastic:{easeIn:function(e,t,i,n,r,o){var a;return 0==e?t:1==(e/=n)?t+i:(void 0===o&&(o=.3*n),!r||r<Math.abs(i)?(a=o/4,r=i):a=o/(2*Math.PI)*Math.asin(i/r),-r*Math.pow(2,10*(e-=1))*Math.sin((e*n-a)*(2*Math.PI)/o)+t)},easeOut:function(e,t,i,n,r,o){var a;return 0==e?t:1==(e/=n)?t+i:(void 0===o&&(o=.3*n),!r||r<Math.abs(i)?(r=i,a=o/4):a=o/(2*Math.PI)*Math.asin(i/r),r*Math.pow(2,-10*e)*Math.sin((e*n-a)*(2*Math.PI)/o)+i+t)},easeInOut:function(e,t,i,n,r,o){var a;return 0==e?t:2==(e/=n/2)?t+i:(void 0===o&&(o=n*(.3*1.5)),!r||r<Math.abs(i)?(r=i,a=o/4):a=o/(2*Math.PI)*Math.asin(i/r),e<1?r*Math.pow(2,10*(e-=1))*Math.sin((e*n-a)*(2*Math.PI)/o)*-.5+t:r*Math.pow(2,-10*(e-=1))*Math.sin((e*n-a)*(2*Math.PI)/o)*.5+i+t)}},Back:{easeIn:function(e,t,i,n,r){return void 0===r&&(r=1.70158),i*(e/=n)*e*((r+1)*e-r)+t},easeOut:function(e,t,i,n,r){return void 0===r&&(r=1.70158),i*((e=e/n-1)*e*((r+1)*e+r)+1)+t},easeInOut:function(e,t,i,n,r){return void 0===r&&(r=1.70158),(e/=n/2)<1?i/2*(e*e*((1+(r*=1.525))*e-r))+t:i/2*((e-=2)*e*((1+(r*=1.525))*e+r)+2)+t}},Bounce:{easeIn:function(e,t,i,r){return i-n.Bounce.easeOut(r-e,0,i,r)+t},easeOut:function(e,t,i,n){return(e/=n)<1/2.75?i*(7.5625*e*e)+t:e<2/2.75?i*(7.5625*(e-=1.5/2.75)*e+.75)+t:e<2.5/2.75?i*(7.5625*(e-=2.25/2.75)*e+.9375)+t:i*(7.5625*(e-=2.625/2.75)*e+.984375)+t},easeInOut:function(e,t,i,r){return e<r/2?.5*n.Bounce.easeIn(2*e,0,i,r)+t:.5*n.Bounce.easeOut(2*e-r,0,i,r)+.5*i+t}}};t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,this.model=this.game.gameModel,this.full2D=this.game.full2D,this.UI=this.game.UI,this.viewer=this.game.viewer,this.name="game"}return n(e,[{key:"show",value:function(){this.UI.showScore(),this.UI.scoreText.obj.position.y=21,this.UI.scoreText.obj.position.x=-13,this.UI.scoreText.changeStyle({textAlign:"left"})}},{key:"hide",value:function(){this.UI.hideScore()}}]),e}();t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,this.model=this.game.gameModel,this.full2D=this.game.full2D,this.name="battlePage"}return n(e,[{key:"show",value:function(e){this.full2D.showPkPage(e)}},{key:"hide",value:function(){this.full2D.hide2D()}}]),e}();t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,this.model=this.game.gameModel,this.full2D=this.game.full2D,this.name="groupRankList"}return n(e,[{key:"show",value:function(e,t){this.full2D.showGroupRankList(e,t)}},{key:"hide",value:function(){this.full2D.hide2D()}}]),e}();t.default=r},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i(0)),a=i(1),s=(n(i(3)),n(i(7)),window.devicePixelRatio>2?2:window.devicePixelRatio),l=window.innerHeight<window.innerWidth?window.innerHeight:window.innerWidth,c=window.innerHeight>window.innerWidth?window.innerHeight:window.innerWidth,h=c*s,u=l*s,d=a.FRUSTUMSIZE,f=u/h*d,p=["bg"],m=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.texture={},this.material={},this.geometry={},this.obj={},this.canvas={},this.context={},this._touchInfo={trackingID:-1,maxDy:0,maxDx:0},this.cwidth=u,this.cheight=50,this.options=Object.assign({},{},t),this._createPlane()}return r(e,[{key:"showLookers",value:function(e){this.showState=!0,e=e||{},this._drawLookers(e)}},{key:"showLookersShare",value:function(e){this.showState=!0,e=e||{}}},{key:"hideLookers",value:function(){this.showState=!1;for(var e=0;e<p.length;e++)this.obj[p[e]].visible=!1,this.options.camera.remove(this.obj[p[e]])}},{key:"_drawLookers",value:function(e){var t=this,i=this.context.bg;i.fillStyle="pink",i.strokeStyle="red",i.lineWidth=2*s,i.clearRect(0,0,this._cx(414),this._cx(this.cheight));var n=this.cheight;if(e.avaImg){for(var r=u-e.avatar.length*this._cx(32),o=this,a=function(){var i=l*t._cx(36)+r;t._drawImageCenter(e.avatar[l],i,n/2,o._cx(25),o._cx(25),"bg",function(){o._drawImageCenter("res/ava_big1.png",i,n/2,o._cx(29),o._cx(29),"bg")})},l=0;l<e.avatar.length;l++)a();i.fillStyle="rgba(0,0,0,0.56)",i.font=this._cf(14),i.textAlign="right",i.textBaseline="middle",i.fillText("有"+e.num+"位好友正在围观",r-this._cx(20),this._cx(16))}e.icon&&this._drawImageCenter("res/observShare.png",this._cx(35),n/2,this._cx(14),this._cx(16),"bg"),e.wording&&(i.fillStyle="rgba(0,0,0,0.56)",i.font=this._cf(14),i.textAlign="left",i.textBaseline="middle",i.fillText("邀请围观",this._cx(55),this._cx(16))),this._updatePlane("bg")}},{key:"_createPlane",value:function(){for(var e=0;e<p.length;e++)this.canvas[p[e]]=document.createElement("canvas"),this.context[p[e]]=this.canvas[p[e]].getContext("2d"),this.canvas[p[e]].width=u,this.canvas[p[e]].height=this.cheight*s,this.texture[p[e]]=new o.Texture(this.canvas[p[e]]),this.material[p[e]]=new o.MeshBasicMaterial({map:this.texture[p[e]],transparent:!0}),this.geometry[p[e]]=new o.PlaneGeometry(f,this.cheight/c*d),this.obj[p[e]]=new o.Mesh(this.geometry[p[e]],this.material[p[e]]),this.material[p[e]].map.minFilter=o.LinearFilter,this.obj[p[e]].position.y=-(.5-this.cheight/2/c)*d,this.obj[p[e]].position.x=0,this.obj[p[e]].position.z=9-.001*e}},{key:"_updatePlane",value:function(e){this.showState&&(this.texture[e].needsUpdate=!0,this.obj[e].visible=!0,this.options.camera.add(this.obj[e]))}},{key:"_drawImageCenter",value:function(e,t,i,n,r,o,a){"/0"!=e&&"/96"!=e&&"/64"!=e&&e||(e="res/ava.png");var s=new Image,l=this,c=this.context[o];s.onload=function(){c.drawImage(s,t-n/2,i-r/2,n,r),!!a&&a(),l._updatePlane(o)},s.onerror=function(){!!a&&a()},s.src=e}},{key:"_cx",value:function(e){return e*l/414*s}},{key:"_cf",value:function(e){return e*s*l/414+"px Helvetica"}}]),e}();t.default=m},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,this.model=this.game.gameModel,this.full2D=this.game.full2D,this.UI=this.game.UI,this.name="viewerGG"}return n(e,[{key:"show",value:function(e){var t=this.model.observeInfo;this.full2D.showLookersPage({type:"gg",score:e,headimg:t.headimg,nickname:t.nickName}),this.UI.hideScore()}},{key:"hide",value:function(){this.full2D.hide2D()}}]),e}();t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,this.model=this.game.gameModel,this.full2D=this.game.full2D,this.UI=this.game.UI,this.name="viewerOut"}return n(e,[{key:"show",value:function(){var e=this.model.observeInfo;this.full2D.showLookersPage({type:"out",headimg:e.headimg,nickname:e.nickName}),this.UI.hideScore()}},{key:"hide",value:function(){this.full2D.hide2D()}}]),e}();t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,this.model=this.game.gameModel,this.full2D=this.game.full2D,this.UI=this.game.UI,this.name="viewerWaiting"}return n(e,[{key:"show",value:function(){var e=this.model.observeInfo;this.full2D.showLookersPage({type:"in",headimg:e.headimg,nickname:e.nickName}),this.UI.scoreText.obj.position.x=0,this.UI.scoreText.obj.position.y=11,this.UI.scoreText.changeStyle({textAlign:"center"}),this.UI.showScore()}},{key:"hide",value:function(){this.full2D.hide2D(),this.UI.hideScore(),this.UI.scoreText.obj.position.y=21,this.UI.scoreText.obj.position.x=-13,this.UI.scoreText.changeStyle({textAlign:"left"})}}]),e}();t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.drawBeginnerPage=function(e){var t=(e=Object.assign({},{self:{}},e)).self;(0,n.routeCanvas)(t,"beginner"),(0,n.createPlane)({self:t});var i=t.context.bg;i.clearRect(0,0,n.WIDTH,n.HEIGHT),i.fillStyle="rgba(255,255,255,0.3)",i.fillRect((0,n.cx)(103),(0,n.cy)(134),(0,n.cwh)(206),(0,n.cwh)(115)),(0,n.drawText)({t:"长按屏幕并释放",self:t,size:17,pos:[207,172],color:"black"}),(0,n.drawText)({t:"控制",self:t,size:17,pos:[149,213],color:"black",align:"left"}),(0,n.drawText)({t:"向前跳",self:t,size:17,pos:[265,213],color:"black",align:"right"}),(0,n.drawImageCenter)({self:t,src:"res/i.png",pos:[198,211,13.2,35.6],type:"bg",imgid:t.imgid.bg}),(0,n.updatePlane)({self:t,type:"bg"})};var n=i(4)},function(e,t,i){"use strict";function n(e){e.imgid.bg++;var t=e.opt;t.score=t.score||0,t.highest_score=t.highest_score||0,t.banType=t.banType||0;var i=e.context.bg;i.clearRect(0,0,r.WIDTH,r.HEIGHT),i.fillStyle="rgba(0,0,0, 0.8)",i.fillRect(0,0,r.WIDTH,r.HEIGHT);var n=0;t.banType?n=69:((0,r.drawImageCenter)({self:e,src:"res/btn.png",pos:[207,214,86,32],type:"bg",imgid:e.imgid.bg}),(0,r.drawText)({self:e,size:13,t:"发起挑战",pos:[207,214]})),(0,r.drawText)({self:e,size:14,t:"本次得分",pos:[207,84+n]}),(0,r.drawText)({self:e,size:88,special:!0,t:t.score,pos:[212,150+n]}),i.fillStyle="rgba(255,255,255,0.2)",i.fillRect((0,r.cx)(162),(0,r.cy)(78+n),(0,r.cwh)(9),(0,r.cwh)(3)),i.fillRect((0,r.cx)(162),(0,r.cy)(84+n),(0,r.cwh)(9),(0,r.cwh)(3)),i.fillRect((0,r.cx)(241),(0,r.cy)(78+n),(0,r.cwh)(9),(0,r.cwh)(3)),i.fillRect((0,r.cx)(241),(0,r.cy)(84+n),(0,r.cwh)(9),(0,r.cwh)(3));var o=!1;if((t.game_cnt>5||t.score>5)&&t.score<t.highest_score&&1!=e.myidx&&!e._has_show_tired&&+new Date/1e3-t.start_time>1800&&(o=!0,e._has_show_tired=!0),o)i.lineWidth=4*r.Dpr,i.strokeStyle="#fff",i.fillStyle="#fff",(0,r.roundedRect)((0,r.cx)(31),(0,r.cy)(298),(0,r.cwh)(354),(0,r.cwh)(210),1*r.Dpr,i),i.fill(),(0,r.drawText)({self:e,t:"玩了这么久",pos:[80,370],size:17,color:"black",align:"left"}),(0,r.drawText)({self:e,t:"休息一下吧",pos:[80,410],size:17,color:"black",align:"left"}),(0,r.drawImageCenter)({self:e,src:"res/tired.png",pos:[297,397,179,185],type:"bg",imgid:e.imgid.bg}),e.opt.type="tired";else if(t.banType)(0,r.drawText)({self:e,t:"游戏中存在可疑操作，该分数",pos:[207,373],size:17}),(0,r.drawText)({self:e,t:"将不在排行榜中显示",pos:[207,399],size:17}),i.beginPath(),i.lineWidth=.5*r.Dpr,i.strokeStyle="rgba(255,255,255,0.1)",i.moveTo((0,r.cx)(0),(0,r.cy)(296)),i.lineTo((0,r.cx)(414),(0,r.cy)(296)),i.moveTo((0,r.cx)(0),(0,r.cy)(526)),i.lineTo((0,r.cx)(414),(0,r.cy)(526)),i.stroke(),i.closePath(),1==t.banType&&((0,r.drawImageCenter)({self:e,src:"http://mmbiz.qpic.cn/mmbiz_png/icTdbqWNOwNTTiaKet81gQJNNcIVa8Pr2VajbZ52iaZX9Vlib0QAKEJGDIV8F9iaFeqXoawUbQkDP8zc6fbm95nKLgw/0?wx_fmt=png",pos:[207,459,138,44],type:"bg",imgid:e.imgid.bg}),(0,r.drawText)({self:e,t:"我要申诉",pos:[207,459],size:17}));else{i.lineWidth=.5*r.Dpr,i.fillStyle="rgba(0,0,0,0.3)",i.strokeStyle="rgba(255,255,255,0.3)",(0,r.roundedRect)((0,r.cx)(30),(0,r.cy)(297),(0,r.cwh)(354),(0,r.cwh)(192),4*r.Dpr,i),i.fill(),i.fillStyle="rgba(255,255,255,0.06)",i.fillRect((0,r.cx)(150),(0,r.cy)(336),(0,r.cwh)(115),(0,r.cwh)(153)),i.beginPath(),i.lineWidth=.5*r.Dpr,i.strokeStyle="rgba(255,255,255,0.4)",i.moveTo((0,r.cx)(30),(0,r.cy)(336)),i.lineTo((0,r.cx)(384),(0,r.cy)(336)),i.stroke(),i.closePath(),(0,r.drawText)({self:e,t:"排行榜 · 每周一凌晨刷新",color:"rgba(255,255,255,0.6)",align:"left",size:12,pos:[46,316]}),(0,r.drawText)({self:e,t:"查看全部排行",align:"left",size:12,pos:[291,316]}),(0,r.drawImageCenter)({self:e,src:"res/r_arr.png",pos:[371,315,6.6,10],type:"bg",imgid:e.imgid.bg});var a=e.myidx-2,s=0;1==e.sotedRankList.length&&(s=1);for(var l=0;l<3;l++)if(1==e.myidx&&0==l&&a++,e.myidx!=e.sotedRankList.length||2!=l){var c="";c=e.myidx==a+1+l?"#41bf8c":"#888",e.sotedRankList[a+l]&&function(){(0,r.drawText)({self:e,color:c,italic:!0,bold:!0,size:16,t:a+1+l,pos:[90+118*(l+s),356]}),(0,r.drawText)({self:e,color:"#888",t:(0,r.cname)(e.sotedRankList[a+l].nickname,14),pos:[90+118*(l+s),435],size:14}),(0,r.drawText)({self:e,size:22,special:!0,t:e.sotedRankList[a+l].week_best_score||0,pos:[90+118*(l+s),463]});var t=90+118*(l+s);(0,r.drawImageCenter)({self:e,round:!0,src:e.sotedRankList[a+l].headimg,pos:[t,393,42,42],type:"bg",cb:function(){(0,r.drawImageCenter)({self:e,src:"res/ava_rank.png",pos:[t,393,58,58],type:"bg",imgid:e.imgid.bg})},imgid:e.imgid.bg,noupdate:!0})}()}}h=e.context.btn;if(h.clearRect(0,0,r.WIDTH,r.HEIGHT),o)(0,r.drawImageCenter)({self:e,src:"res/noplay.png",pos:[207,607,212,84],type:"btn",cb:function(){e.noplay_time=5,(0,r.drawText)({self:e,type:"btn",color:"#00C777",size:22,t:e.noplay_time,pos:[140,607]}),(0,r.updatePlane)({self:e,type:"btn"}),e.timer=setInterval(function(){e.noplay_time--,e.noplay_time<=0?(clearInterval(e.timer),h.clearRect(0,0,r.WIDTH,r.HEIGHT),(0,r.drawImageCenter)({self:e,src:"res/replay.png",pos:[207,607,212,84],type:"btn",imgid:e.imgid.btn})):(h.fillStyle="white",h.fillRect((0,r.cx)(125),(0,r.cy)(590),(0,r.cwh)(30),(0,r.cwh)(30)),(0,r.drawText)({self:e,color:"#00C777",size:22,t:e.noplay_time,pos:[140,607],type:"btn"}),(0,r.updatePlane)({self:e,type:"btn"}))},1e3)},imgid:e.imgid.btn});else{var h;(h=e.context.btn).clearRect((0,r.cx)(91),(0,r.cy)(547),(0,r.cwh)(232),(0,r.cwh)(94)),(0,r.drawImageCenter)({self:e,src:"res/replay.png",pos:[207,607,212,84],type:"btn",imgid:e.imgid.btn})}(0,r.drawText)({self:e,t:"历史最高分："+Math.max(t.highest_score,t.score),size:14,pos:[207,703]}),(0,r.updatePlane)({self:e,type:"bg"})}Object.defineProperty(t,"__esModule",{value:!0}),t.routeGameOver=function(e,t){(0,r.createPlane)({self:e});var i=e.opt;e.myUserInfo=o.default.getMyUserInfo()||{headimg:"",nickname:"",week_best_score:0,score_info:[{score:0}]},e.myUserInfo.last_week_best_score=i.week_best_score,e.myUserInfo.week_best_score=Math.max(i.week_best_score,i.score)||0;var s=o.default.getFriendsScore()||[];s.push(e.myUserInfo);var l=(0,r.rerank)(s);if(e.sotedRankList=l,e.myidx=l.findIndex(r.findSelfIndex.bind(e))+1,i.score>=i.highest_score||i.score>=e.myUserInfo.last_week_best_score){(o.default.getMyUserInfo()||{headimg:"",nickname:"",week_best_score:0,score_info:[{score:0}]}).week_best_score=i.score;var c=o.default.getFriendsScore()||[];e.changlleList=[];for(var h=0;h<c.length;h++)c[h].week_best_score<i.score&&c[h].week_best_score>e.myUserInfo.last_week_best_score&&e.changlleList.push(c[h])}e.opt.banType||t?((0,r.routeCanvas)(e,"gameOver"),n(e)):i.score>i.highest_score?((0,r.routeCanvas)(e,"gameOverHighest"),e.opt.type="history",(0,a.drawGameOverHighest)(e,"history")):l.length>1&&i.score>=l[0].week_best_score?((0,r.routeCanvas)(e,"gameOverHighest"),e.opt.type="rank",(0,a.drawGameOverHighest)(e,"rank")):i.score>e.myUserInfo.last_week_best_score?((0,r.routeCanvas)(e,"gameOverHighest"),e.opt.type="week",(0,a.drawGameOverHighest)(e,"week")):((0,r.routeCanvas)(e,"gameOver"),n(e))},t.drawGameOver=n;var r=i(4),o=function(e){return e&&e.__esModule?e:{default:e}}(i(3)),a=i(12)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.drawLookersPage=function(e){var t=e.self;(0,n.routeCanvas)(t,"lookers"),(0,n.createPlane)({self:t});var i=t.context.bg;i.clearRect(0,0,n.WIDTH,n.HEIGHT);var r=t.opt,o=r.score||0,a=r.nickname||"";"in"==r.type?((0,n.drawImageCenter)({self:t,src:r.headimg,pos:[207,91,50,50],type:"bg",cb:function(){(0,n.drawImageCenter)({self:t,src:"res/ava_lookers.png",pos:[207,91,53,53],type:"bg",imgid:t.imgid.bg})},imgid:t.imgid.bg,noupdate:!0,round:!0}),(0,n.drawText)({self:t,t:a+" 正在游戏中",size:17,pos:[207,144],type:"bg",color:"black"})):"gg"==r.type?(i.fillStyle="rgba(0,0,0, 0.4)",i.fillRect(0,0,n.WIDTH,n.HEIGHT),(0,n.drawImageCenter)({self:t,src:r.headimg,pos:[207,91,50,50],type:"bg",cb:function(){(0,n.drawImageCenter)({self:t,src:"res/ava_lookers.png",pos:[207,91,53,53],type:"bg",imgid:t.imgid.bg})},imgid:t.imgid.bg,noupdate:!0,round:!0}),(0,n.drawText)({self:t,t:a+" 游戏已结束",size:17,pos:[207,144],type:"bg"}),(0,n.drawText)({self:t,t:"游戏得分",size:14,pos:[207,207],type:"bg"}),(0,n.drawText)({self:t,t:o,size:80,pos:[212,267],type:"bg",special:!0}),i.strokeStyle="white",i.lineWidth=.5*n.Dpr,i.strokeStyle="rgba(255,255,255,0.5)",i.beginPath(),i.moveTo((0,n.cx)(157),(0,n.cy)(176)),i.lineTo((0,n.cx)(257),(0,n.cy)(176)),i.closePath(),i.stroke(),i.fillStyle="rgba(255,255,255,0.2)",i.fillRect((0,n.cx)(156),(0,n.cy)(203),(0,n.cwh)(9),(0,n.cwh)(3)),i.fillRect((0,n.cx)(156),(0,n.cy)(209),(0,n.cwh)(9),(0,n.cwh)(3)),i.fillRect((0,n.cx)(243),(0,n.cy)(203),(0,n.cwh)(9),(0,n.cwh)(3)),i.fillRect((0,n.cx)(243),(0,n.cy)(209),(0,n.cwh)(9),(0,n.cwh)(3))):"out"==r.type&&(i.fillStyle="rgba(0,0,0, 0.4)",i.fillRect(0,0,n.WIDTH,n.HEIGHT),(0,n.drawImageCenter)({self:t,src:r.headimg,pos:[207,221,50,50],type:"bg",cb:function(){(0,n.drawImageCenter)({self:t,src:"res/ava_lookers.png",pos:[207,221,53,53],type:"bg",imgid:t.imgid.bg})},imgid:t.imgid.bg,noupdate:!0,round:!0}),(0,n.drawText)({self:t,t:a+" 游戏已结束",size:17,pos:[207,278],type:"bg"})),(0,n.drawImageCenter)({self:t,src:"res/btn_iplay.png",pos:[207,663,131,54],type:"bg",imgid:t.imgid.bg}),(0,n.updatePlane)({self:t,type:"bg"})};var n=i(4)},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function r(e){var t=e.self;(0,s.routeCanvas)(t,"pk"),(0,s.createPlane)({self:t}),(0,s.updateClip)({self:t}),t.myidx=t.opt.pkListInfo.findIndex(a)+1,t.myUserInfo=t.opt.pkListInfo[t.myidx-1]||l.default.getMyUserInfo()||{headimg:"",nickname:"",week_best_score:0,score_info:[{score:0}]},function(e){var t=e.self;e.list;t.sotedRankList=e.list;var i=t.sotedRankList.length*(0,s.cwh)(s.ListLineHeight)/s.Dpr,n=(0,s.cwh)(194)/s.Dpr;t.scrollHandler=new c.default({innerOffsetHeight:i,outterOffsetHeight:n,updatePosition:t.updatePosition.bind(t)}),o(t,0,"list1")}({self:t,list:t.opt.pkListInfo});var i=t.context.bg;if(i.clearRect(0,0,s.WIDTH,s.HEIGHT),i.fillStyle="rgba(0,0,0, 0.8)",i.fillRect(0,0,(s.WIDTH-(0,s.cwh)(354))/2,s.HEIGHT),i.fillRect((0,s.cx)(384),0,(s.WIDTH-(0,s.cwh)(354))/2,s.HEIGHT),i.fillRect((0,s.cx)(30),0,(0,s.cwh)(354),(0,s.cy)(110)),i.fillRect((0,s.cx)(30),(0,s.cy)(632),(0,s.cwh)(354),(0,s.cy)(144)),i.fillStyle="rgb(250,250,250)",i.fillRect((0,s.cx)(31),(0,s.cy)(103),(0,s.cwh)(354),(0,s.cwh)(335)),i.lineWidth=2*s.Dpr,i.strokeStyle="#fff",(0,s.roundedRect)((0,s.cx)(30),(0,s.cy)(102),(0,s.cwh)(354),(0,s.cwh)(530),1*s.Dpr,i),void 0==t.opt.gg_score)(0,s.drawImageCenter)({self:t,src:t.opt.organizerInfo.headimg,pos:[207,158,50,50],type:"bg",imgid:t.imgid.bg}),(0,s.drawText)({self:t,t:t.opt.organizerInfo.nickname,color:"rgba(0,0,0,0.8)",size:14,pos:[207,195]}),(0,s.drawText)({self:t,t:"擂主得分",color:"rgba(0,0,0,0.8)",size:14,pos:[207,242]}),i.lineWidth=.5*s.Dpr,i.strokeStyle="rgba(0,0,0,0.06)",i.beginPath(),i.moveTo((0,s.cx)(160),(0,s.cy)(217)),i.lineTo((0,s.cx)(254),(0,s.cy)(217)),i.closePath(),i.stroke(),i.fillStyle="rgba(0,0,0,0.2)",i.fillRect((0,s.cx)(162),(0,s.cy)(239),(0,s.cwh)(9),(0,s.cwh)(3)),i.fillRect((0,s.cx)(162),(0,s.cy)(244),(0,s.cwh)(9),(0,s.cwh)(3)),i.fillRect((0,s.cx)(241),(0,s.cy)(239),(0,s.cwh)(9),(0,s.cwh)(3)),i.fillRect((0,s.cx)(241),(0,s.cy)(244),(0,s.cwh)(9),(0,s.cwh)(3)),(0,s.drawText)({self:t,t:t.opt.organizerInfo.score_info[0].score,color:"#000",size:66,pos:[207,298],special:!0});else{var n=void 0,r=void 0,h=void 0,u=void 0;t.opt.gg_score>t.opt.organizerInfo.score_info[0].score?(n="res/suc.png",r="挑战成功",h="rgba(0,0,0,1)",u="rgba(0,0,0,0.3)",(0,s.drawImageCenter)({self:t,src:"res/flower_small.png",pos:[207,175,140,53],type:"bg",imgis:t.imgid.bg})):(n="res/fail.png",r="挑战失败",h="rgba(0,0,0,0.3)",u="rgba(0,0,0,1)"),(0,s.drawImageCenter)({self:t,src:n,pos:[207,135,20,15],type:"bg",imgid:t.imgid.bg}),(0,s.drawText)({self:t,color:"#000",bold:!0,size:30,t:r,pos:[207,178]}),(0,s.drawImageCenter)({self:t,src:t.myUserInfo.headimg,pos:[158,289,26,26],type:"bg",imgid:t.imgid.bg}),(0,s.drawImageCenter)({self:t,src:t.opt.organizerInfo.headimg,pos:[260,289,26,26],type:"bg",imgid:t.imgid.bg}),(0,s.drawText)({self:t,color:"rgba(0,0,0,0.8)",size:11,t:(0,s.cname)(t.myUserInfo.nickname),pos:[158,318]}),(0,s.drawText)({self:t,color:"rgba(0,0,0,0.8)",size:11,t:(0,s.cname)(t.opt.organizerInfo.nickname),pos:[260,318]}),t.opt.gg_score>999?(0,s.drawText)({self:t,color:h,size:44,special:!0,t:t.opt.gg_score,align:"right",pos:[190,253]}):(0,s.drawText)({self:t,color:h,size:44,special:!0,t:t.opt.gg_score,align:"center",pos:[158,253]}),i.fillStyle="rgba(0,0,0,0.3)",i.fillRect((0,s.cx)(202),(0,s.cy)(242),(0,s.cwh)(10),(0,s.cwh)(4)),t.opt.organizerInfo.score_info[0].score>999?(0,s.drawText)({self:t,color:u,size:44,special:!0,t:t.opt.organizerInfo.score_info[0].score,align:"left",pos:[231,253]}):(0,s.drawText)({self:t,color:u,size:44,special:!0,t:t.opt.organizerInfo.score_info[0].score,pos:[260,253]})}i.strokeStyle="rgba(0,0,0,0.06)",i.lineWidth=1,i.beginPath(),i.moveTo((0,s.cx)(30),(0,s.cy)(437)),i.lineTo((0,s.cx)(384),(0,s.cy)(437)),i.stroke(),i.closePath();var d="挑战";if(t.opt.organizerInfo.left_time>0&&0==t.opt.organizerInfo.is_self){t.myidx>0&&(d="再次挑战"),(0,s.drawImageCenter)({self:t,src:"res/btn_bg_g.png",pos:[207,368,130,63],type:"bg",cb:function(){(0,s.drawText)({self:t,size:14,t:d,pos:[207,368]}),(0,s.updatePlane)({self:t,type:"bg"})},imgid:t.imgid.bg}),(0,s.drawText)({self:t,size:12,align:"right",color:"#000",t:"有效时间至",pos:[223,403.5]});p=(f=+new Date)+1e3*t.opt.organizerInfo.left_time;m=(m=(f=new Date(p)).getHours())<10?"0"+m:m;g=(g=f.getMinutes())<10?"0"+g:g,(0,s.drawText)({self:t,size:12,align:"left",color:"#fc4814",t:m+":"+g,pos:[225,403.5]})}else if(0==t.opt.organizerInfo.left_time&&0==t.opt.organizerInfo.is_self)(0,s.drawImageCenter)({self:t,src:"res/btn_bg_h.png",pos:[207,368,130,63],type:"bg",cb:function(){(0,s.drawText)({self:t,size:14,color:"rgba(0,0,0,0.3)",t:"挑战结束",pos:[207,368]}),(0,s.updatePlane)({self:t,type:"bg"})},imgid:t.imgid.bg}),(0,s.drawText)({self:t,size:14,color:"#888",t:"已失效",pos:[207,403.5]});else if(t.opt.organizerInfo.left_time>0&&1==t.opt.organizerInfo.is_self){(0,s.drawText)({self:t,size:14,align:"right",color:"#888",t:"有效时间至",pos:[223,369]}),i.textAlign="left",i.fillStyle="#2c9f67";var f=+new Date,p=f+1e3*t.opt.organizerInfo.left_time,m=(f=new Date(p)).getHours();m=m<10?"0"+m:m;var g=f.getMinutes();g=g<10?"0"+g:g,(0,s.drawText)({self:t,size:14,align:"left",color:"#2c9f67",t:m+":"+g,pos:[225,369]})}(0,s.drawText)({self:t,size:17,t:"不挑战，直接开始",pos:[199,688]}),(0,s.drawImageCenter)({self:t,src:"res/r_arr.png",pos:[280,688,6.5,12.5],type:"bg",imgid:t.imgid.bg}),(0,s.updatePlane)({self:t,type:"bg"})}function o(e,t,i){"list1"==i?e.imgid.list1++:"list2"==i&&e.imgid.list2++;var n=e.sotedRankList.slice(t,t+10),r=e.context[i];if(r.clearRect(0,0,s.WIDTH,10*(0,s.cwh)(s.ListLineHeight)),r.fillStyle="white",r.textBaseline="middle",r.fillRect(0,0,s.WIDTH,10*(0,s.cwh)(s.ListLineHeight)),0==t||0!=n.length){if(!(t<0)){for(var o=n.length,a=function(){var r=(l+.5)*s.ListLineHeight,o=l+1+t,a="";a=1==o?"rgb(250,126,0)":2==o?"rgb(254,193,30)":3==o?"rgb(251,212,19)":"#aaa",(0,s.drawText)({self:e,bold:!0,italic:!0,size:17,t:o,pos:[58.5,r],type:i,color:a});n[l].grade;(0,s.drawImageCenter)({self:e,src:n[l].headimg,pos:[107,r,34,34],type:i,cb:function(){(0,s.drawImageCenter)({self:e,src:"res/ava_lookers.png",pos:[107,r,37,37],type:i,imgid:e.imgid[i]})},round:!0,imgid:e.imgid[i],noupdate:!0}),(0,s.drawText)({self:e,align:"left",color:"#000",size:17,bold:!0,t:(0,s.cname)(n[l].nickname,14),pos:[144,r-10],type:i}),n[l].score_info[0].score>e.opt.organizerInfo.score_info[0].score?(0,s.drawText)({self:e,color:"#FC4814",size:12,t:"挑战成功",pos:[144,r+12],type:i,align:"left"}):(0,s.drawText)({self:e,color:"#888",size:12,t:"挑战失败",pos:[144,r+12],type:i,align:"left"}),(0,s.drawText)({self:e,color:"#888",size:22,special:!0,t:n[l].score_info[0].score||0,pos:[364,r],type:i,align:"right"})},l=0;l<o;l++)a();0==o&&(0,s.drawText)({self:e,color:"#ccc",size:14,t:"暂无人应战",pos:[207,100],type:i}),(0,s.updatePlane)({self:e,type:i})}}else(0,s.updatePlane)({self:e,type:i})}function a(e,t,i){return 1===e.is_self}Object.defineProperty(t,"__esModule",{value:!0}),t.drawPkPage=r,t.drawPkList=o;var s=i(4),l=n(i(3)),c=n(i(7))},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function r(e){var t=e.self;t.imgid.bg++;var i=t.context.bg;i.clearRect(0,0,s.WIDTH,s.HEIGHT),i.fillStyle="rgba(0,0,0, 0.8)",i.fillRect(0,0,(s.WIDTH-(0,s.cwh)(354))/2,s.HEIGHT),i.fillRect((0,s.cx)(384),0,(s.WIDTH-(0,s.cwh)(354))/2,s.HEIGHT),i.fillRect((0,s.cx)(30),0,(0,s.cwh)(354),(0,s.cy)(110)),i.fillRect((0,s.cx)(30),(0,s.cy)(592),(0,s.cwh)(354),(0,s.cy)(144)),i.fillStyle="rgba(0,0,0,0.9)",i.fillRect((0,s.cx)(30),(0,s.cy)(110),(0,s.cwh)(354),(0,s.cwh)(33)),i.strokeStyle="rgba(255,255,255,0.2)",i.lineWidth=1*s.Dpr,i.beginPath(),i.moveTo((0,s.cx)(30),(0,s.cy)(143)),i.lineTo((0,s.cx)(384),(0,s.cy)(143)),i.stroke(),i.closePath(),(0,s.drawText)({self:t,bold:!0,size:12,align:"left",t:"每周一凌晨刷新",pos:[54,126.5]}),i.lineWidth=1*s.Dpr,i.strokeStyle="rgba(255,255,255,0.2)",(0,s.roundedRect)((0,s.cx)(30),(0,s.cy)(110),(0,s.cwh)(354),(0,s.cwh)(482),1*s.Dpr,i),(0,s.updatePlane)({self:t,type:"bg"}),t.canvasType==s.CANVASTYPE.groupRank&&((0,s.drawText)({self:t,size:17,t:"玩一局",pos:[207,680]}),(0,s.drawImageCenter)({self:t,src:"res/r_arr.png",pos:[244,680,6.6,10],type:"bg",imgid:t.imgid.bg})),t.canvasType==s.CANVASTYPE.friendRank&&((0,s.drawText)({self:t,size:17,t:"查看群排行",pos:[177,674],align:"left"}),(0,s.drawImageCenter)({self:t,src:"res/r_arr.png",pos:[270,674,6.6,10],type:"bg",imgid:t.imgid.bg}),(0,s.drawImageCenter)({self:t,src:"res/rank.png",pos:[154,674,22,22],type:"bg",imgid:t.imgid.bg}),(0,s.drawImageCenter)({self:t,src:"res/close.png",pos:[375,114,48,48],type:"bg",imgid:t.imgid.bg}))}function o(e){var t=e.self,i=e.list,n=[];t.myUserInfo=t.myUserInfo||{headimg:"",nickname:"",week_best_score:0,score_info:[{score:0}]},(i=i||[]).push(t.myUserInfo),console.log(t.myUserInfo,"?????"),n=(0,s.rerank)(i),t.sotedRankList=n;var r,o=t.sotedRankList.length*(0,s.cwh)(s.ListLineHeight)/s.Dpr;t.myidx=n.findIndex(s.findSelfIndex.bind(t))+1,r=(0,s.cwh)(445)/s.Dpr,t.scrollHandler=new c.default({innerOffsetHeight:o,outterOffsetHeight:r,updatePosition:t.updatePosition.bind(t)}),a(t,0,"list1"),a(t,10,"list2")}function a(e,t,i){"list1"==i?e.imgid.list1++:"list2"==i&&e.imgid.list2++;var n=e.sotedRankList.slice(t,t+10),r=e.context[i];if(r.clearRect(0,0,s.WIDTH,10*(0,s.cwh)(s.ListLineHeight)),r.fillStyle="rgba(0,0,0,0.9)",r.fillRect(0,0,s.WIDTH,10*(0,s.cwh)(s.ListLineHeight)),0==t||0!=n.length){if(!(t<0)){for(var o=n.length,a=function(){l%2==1&&(r.fillStyle="rgba(255,255,255, 0.03)",r.fillRect(0,l*(0,s.cwh)(s.ListLineHeight),(0,s.cwh)(414),(0,s.cwh)(s.ListLineHeight)));var o=(l+.5)*s.ListLineHeight;r.textAlign="center",h="",h=1==(c=l+1+t)?"rgb(250,126,0)":2==c?"rgb(254,193,30)":3==c?"rgb(251,212,19)":"#aaa",(0,s.drawText)({self:e,color:h,size:17,italic:!0,bold:!0,t:c,pos:[58.5,o],type:i});n[l].grade;(0,s.drawImageCenter)({round:!0,self:e,src:n[l].headimg,pos:[107,o,34,34],type:i,cb:function(){(0,s.drawImageCenter)({self:e,src:"res/ava_rank.png",pos:[107,o,47,47],type:i,imgid:e.imgid[i]})},imgid:e.imgid[i],noupdate:!0}),(0,s.drawText)({self:e,align:"left",size:17,t:(0,s.cname)(n[l].nickname,16),pos:[144,o],type:i}),(0,s.drawText)({self:e,align:"right",size:22,special:!0,t:n[l].week_best_score||0,pos:[364,o],type:i})},l=0;l<o;l++){var c,h;a()}(0,s.updatePlane)({self:e,type:i})}}else(0,s.updatePlane)({self:e,type:i})}Object.defineProperty(t,"__esModule",{value:!0}),t.drawFriendRankList=function(e){var t=e.self;(0,s.routeCanvas)(t,"friendRank"),t.myUserInfo=l.default.getMyUserInfo()||{},t.myUserInfo.week_best_score=t.opt.week_best_score||0,(0,s.createPlane)({self:t}),(0,s.updateClip)({self:t}),r({self:t}),o({self:t,list:l.default.getFriendsScore()})},t.drawGroupRankList=function(e,t,i){(0,s.routeCanvas)(e,"groupRank"),e.myUserInfo=i||{headimg:"",nickname:"",week_best_score:0,grade:1},(0,s.createPlane)({self:e}),(0,s.updateClip)({self:e}),r({self:e}),o({self:e,list:t})},t.drawRankList=a;var s=i(4),l=n(i(3)),c=n(i(7))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.drawStartPage=function(e){(0,n.routeCanvas)(e,"start"),(0,n.createPlane)({self:e});var t=e.context.bg;t.clearRect(0,0,n.WIDTH,n.HEIGHT),t.fillStyle="rgba(0,0,0, 0.3)",t.fillRect(0,0,n.WIDTH,n.HEIGHT),(0,n.drawImageCenter)({self:e,src:"res/title.png",pos:[204,168,207,52],type:"bg",imgid:e.imgid.bg}),e.context.btn.clearRect(0,0,n.WIDTH,n.HEIGHT),(0,n.drawImageCenter)({self:e,src:"res/play.png",pos:[207,587,208,78],type:"btn",imgid:e.imgid.btn}),(0,n.drawText)({t:"查看排行榜",self:e,size:17,pos:[213.5,684],type:"bg",special:!1,align:"center",color:"#fff"}),(0,n.drawImageCenter)({self:e,src:"res/r_arr.png",pos:[268,684,6.6,10],type:"bg",imgid:e.imgid.bg}),(0,n.drawImageCenter)({self:e,src:"res/rank.png",pos:[154,684,22,22],type:"bg",imgid:e.imgid.bg}),1==e.opt.banType&&(t.lineWidth=1,t.strokeStyle="rgba(0,0,0,0.7)",t.fillStyle="rgba(0,0,0,0.7)",(0,n.roundedRect)((0,n.cx)(30),(0,n.cy)(298),(0,n.cwh)(354),(0,n.cwh)(196),4,t),t.fill(),(0,n.drawText)({t:"游戏中存在可疑操作，存疑分数",self:e,size:17,pos:[207,350]}),(0,n.drawText)({t:"将不在排行榜中显示。",self:e,size:17,pos:[207,376]}),(0,n.drawImageCenter)({self:e,src:"http://mmbiz.qpic.cn/mmbiz_png/icTdbqWNOwNTTiaKet81gQJNNcIVa8Pr2VajbZ52iaZX9Vlib0QAKEJGDIV8F9iaFeqXoawUbQkDP8zc6fbm95nKLgw/0?wx_fmt=png",pos:[207,441,138,44],type:"bg",imgid:e.imgid.bg}),(0,n.drawText)({t:"我要申诉",self:e,size:15,pos:[207,441]})),(0,n.updatePlane)({self:e,type:"bg"})};var n=i(4)},function(e,t,i){"use strict";function n(e){e.opt.verify_step=e.opt.verify_step||0;var t=e.opt.verify_step;0==t?((0,r.createPlane)({self:e}),(0,r.routeCanvas)(e,"verify"),function(e){e.imgid.bg++;var t=e.context.bg;t.clearRect(0,0,r.WIDTH,r.HEIGHT),t.fillStyle="#555",t.fillRect(0,0,r.WIDTH,r.HEIGHT),(0,r.drawText)({self:e,t:"游戏申诉",size:30,pos:[207,153]}),(0,r.drawText)({self:e,t:"我们需要验证你的玩家身份",size:16,pos:[207,496],color:"rgba(255,255,255,0.4)"}),(0,r.drawText)({self:e,t:"将会有专人与你联系",size:16,pos:[207,518],color:"rgba(255,255,255,0.4)"}),(0,r.drawText)({self:e,t:"第一步：请提交一份自拍照片",size:20,pos:[207,450],color:"white"}),(0,r.drawImageCenter)({self:e,src:"http://mmbiz.qpic.cn/mmbiz_png/icTdbqWNOwNTTiaKet81gQJNNcIVa8Pr2VeiaWDZj6rCViaLsuSCWtnyo1mvNqBR05HxPZ5oXTzl0ODXjWiakTvq6yw/0?wx_fmt=png",pos:[207,329,139,139],type:"bg",imgid:e.imgid.bg}),(0,r.drawImageCenter)({self:e,src:"http://mmbiz.qpic.cn/mmbiz_png/icTdbqWNOwNTTiaKet81gQJNNcIVa8Pr2VajbZ52iaZX9Vlib0QAKEJGDIV8F9iaFeqXoawUbQkDP8zc6fbm95nKLgw/0?wx_fmt=png",pos:[207,621,138,44],type:"bg",imgid:e.imgid.bg}),(0,r.drawText)({self:e,t:"提交自拍",size:15,pos:[207,621]}),(0,r.drawText)({self:e,t:"退出申诉",size:17,pos:[197,690]}),(0,r.drawImageCenter)({self:e,src:"res/r_arr.png",pos:[247,690,6.5,12.5],type:"bg",imgid:e.imgid.bg}),(0,r.updatePlane)({self:e,type:"bg"})}(e),e.opt.verify_step++):1==t?(!function(e){wx.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(t){e.opt.path=t.tempFilePaths[0],function(e){var t=e.context.bg;t.clearRect(0,0,r.WIDTH,r.HEIGHT),t.fillStyle="#555",t.fillRect(0,0,r.WIDTH,r.HEIGHT),(0,r.drawText)({self:e,t:"拍摄完成",size:30,pos:[207,117]}),(0,r.drawText)({self:e,t:"照片已存档，仅供身份识别",size:14,pos:[207,158]}),(0,r.drawImageCenter)({self:e,src:"http://mmbiz.qpic.cn/mmbiz_png/icTdbqWNOwNTTiaKet81gQJNNcIVa8Pr2VajbZ52iaZX9Vlib0QAKEJGDIV8F9iaFeqXoawUbQkDP8zc6fbm95nKLgw/0?wx_fmt=png",pos:[207,621,138,44],type:"bg",imgid:e.imgid.bg}),(0,r.drawText)({self:e,t:"下一步",size:15,pos:[207,621]}),(0,r.drawText)({self:e,t:"退出申诉",size:17,pos:[197,690]}),(0,r.drawImageCenter)({self:e,src:"res/r_arr.png",pos:[247,690,6.5,12.5],type:"bg",imgid:e.imgid.bg});var i=new Image;i.onload=function(){console.log(i.width,i.height);var t=240,n=320;i.width/i.height>.75?n=i.height/i.width*t:t=i.width/i.height*n,console.log(t,n),(0,r.drawImageCenter)({self:e,src:e.opt.path,pos:[207,388,t,n],type:"bg",imgid:e.imgid.bg})},i.src=e.opt.path,(0,r.updatePlane)({self:e,type:"bg"})}(e)},fail:function(t){e.opt.verify_step=0}})}(e),e.opt.verify_step++):2==t?function(e){if(e.opt.loading)return;e.opt.loading=!0,wx.showLoading({title:"上传中..."}),(0,o.upLoadVerifyPic)({path:e.opt.path,succ:function(t){e.opt.fileid=t,e.opt.verify_step++,function(e){var t=e.context.bg;t.clearRect(0,0,r.WIDTH,r.HEIGHT),t.fillStyle="#555",t.fillRect(0,0,r.WIDTH,r.HEIGHT),t.fillStyle="#888",t.fillRect(0,(0,r.cy)(206),(0,r.cwh)(414),(0,r.cwh)(215)),(0,r.drawText)({self:e,t:"第二步：请填写联系方式",size:20,pos:[207,117]}),t.beginPath(),t.lineWidth=.5*r.Dpr,t.strokeStyle="rgba(255,255,255,0.4)",t.moveTo((0,r.cx)(30),(0,r.cy)(299)),t.lineTo((0,r.cx)(384),(0,r.cy)(299)),t.stroke(),t.moveTo((0,r.cx)(30),(0,r.cy)(364)),t.lineTo((0,r.cx)(384),(0,r.cy)(364)),t.stroke(),t.closePath(),(0,r.drawText)({self:e,t:"姓名",align:"left",size:17,pos:[30,277],color:"rgba(255,255,255,1)"}),(0,r.drawText)({self:e,t:"手机号码",align:"left",size:17,pos:[30,342],color:"rgba(255,255,255,1)"}),(0,r.drawText)({self:e,t:"请填写",align:"left",size:17,pos:[138,277],color:"rgba(255,255,255,0.3)"}),(0,r.drawText)({self:e,t:"请填写",align:"left",size:17,pos:[138,342],color:"rgba(255,255,255,0.3)"}),(0,r.drawImageCenter)({self:e,src:"http://mmbiz.qpic.cn/mmbiz_png/icTdbqWNOwNTTiaKet81gQJNNcIVa8Pr2VajbZ52iaZX9Vlib0QAKEJGDIV8F9iaFeqXoawUbQkDP8zc6fbm95nKLgw/0?wx_fmt=png",pos:[207,621,138,44],type:"bg",imgid:e.imgid.bg}),(0,r.drawText)({self:e,t:"下一步",size:15,pos:[207,621]}),(0,r.drawText)({self:e,t:"退出申诉",size:17,pos:[197,690]}),(0,r.drawImageCenter)({self:e,src:"res/r_arr.png",pos:[247,690,6.5,12.5],type:"bg",imgid:e.imgid.bg}),(0,r.updatePlane)({self:e,type:"bg"})}(e)},complete:function(){e.opt.loading=!1,wx.hideLoading()}})}(e):3==t&&function(e){if(!e.opt.mobile||!e.opt.name)return void wx.showToast({title:"请填写完整信息",icon:"none"});if(e.opt.loading)return;e.opt.loading=!0,(0,o.upLoadVerifySubmit)({name:e.opt.name,mobile:e.opt.mobile,fileid:e.opt.fileid,is_async:e.lastCanvasType==r.CANVASTYPE.start?1:0,succ:function(){!function(e){var t=e.context.bg;t.clearRect(0,0,r.WIDTH,r.HEIGHT),t.fillStyle="#555",t.fillRect(0,0,r.WIDTH,r.HEIGHT),(0,r.drawText)({self:e,t:"提交成功",size:30,pos:[207,237]}),(0,r.drawText)({self:e,t:"请关注“微信小游戏”官方公众号，回复申诉，进行申诉验证",size:14,pos:[207,298],color:"rgba(255,255,255,0.4)"}),(0,r.drawImageCenter)({self:e,src:"http://mmbiz.qpic.cn/mmbiz_png/icTdbqWNOwNTTiaKet81gQJNNcIVa8Pr2VajbZ52iaZX9Vlib0QAKEJGDIV8F9iaFeqXoawUbQkDP8zc6fbm95nKLgw/0?wx_fmt=png",pos:[207,621,138,44],type:"bg",imgid:e.imgid.bg}),(0,r.drawText)({self:e,t:"完成",size:15,pos:[207,621]}),(0,r.updatePlane)({self:e,type:"bg"})}(e),e.opt.verify_step++},complete:function(){e.opt.loading=!1}})}(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.routeVerify=n,t.clickVerifyForm=function(e,t){console.log(e.opt.showkey),e.opt.showkey||(e.opt.showkey=!0,wx.showKeyboard({defaultValue:e.opt[t]||"",maxLength:20,multiple:!1,confirmType:"done",complete:function(){}}),wx.onKeyboardComplete(function(i){e.opt.showkey=!1,e.opt[t]=i.value;var n=e.context.bg;n.fillStyle="#888","name"==t?(n.fillRect((0,r.cx)(135),(0,r.cy)(262),(0,r.cwh)(250),(0,r.cwh)(30)),(0,r.drawText)({self:e,t:(0,r.cname)(e.opt.name||"请填写",20),align:"left",size:17,pos:[138,277],color:e.opt.name?"#fff":"rgba(255,255,255,0.3)"})):(n.fillRect((0,r.cx)(135),(0,r.cy)(327),(0,r.cwh)(250),(0,r.cwh)(30)),(0,r.drawText)({self:e,t:(0,r.cname)(e.opt.mobile||"请填写",20),align:"left",size:17,pos:[138,342],color:e.opt.mobile?"#fff":"rgba(255,255,255,0.3)"})),(0,r.updatePlane)({self:e,type:"bg"}),wx.offKeyboardComplete()}))};var r=i(4),o=i(2)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,this.model=this.game.gameModel,this.full2D=this.game.full2D,this.UI=this.game.UI,this.viewer=this.game.viewer,this.name="game"}return n(e,[{key:"show",value:function(){this.UI.showScore(),this.UI.scoreText.obj.position.y=21,this.UI.scoreText.obj.position.x=-13,this.UI.scoreText.changeStyle({textAlign:"left"}),this.viewer.open()}},{key:"hide",value:function(){this.viewer.close(),this.UI.hideScore()}}]),e}();t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(e){return e&&e.__esModule?e:{default:e}}(i(3)),o=window.devicePixelRatio>2?2:window.devicePixelRatio,a=(window.innerHeight<window.innerWidth?window.innerHeight:window.innerWidth,window.innerHeight>window.innerWidth?window.innerHeight:window.innerWidth,wx.loadFont("res/num.ttf")),s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.texture={},this.material={}}return n(e,[{key:"getShareCard",value:function(e,t){e=e||{};this.canvas||(this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=693,this.canvas.height=558);var i=this.context;if("shareBattle"==e.type){i.fillStyle="white",i.fillRect(0,0,693,558);n=this;this._drawImageCanvas1("res/changlle_share.png",0,0,693,558,"share",function(){i.fillStyle="rgba(0,0,0,0.8)",i.font="180px "+a,i.textBaseline="middle",i.textAlign="center",i.fillText(e.score||0,356.5,334.8),!!t&&t(n.canvas)})}if("history"==e.type){i.fillStyle="white",i.fillRect(0,0,693,558);n=this;this._drawImageCanvas1("res/high_score.png",0,0,693,558,"share",function(){i.fillStyle="#00c777",i.font="180px "+a,i.textBaseline="middle",i.textAlign="center",i.fillText(e.score||0,356.5,.68*558),!!t&&t(n.canvas)})}if("week"==e.type){i.fillStyle="white",i.fillRect(0,0,693,558);n=this;this._drawImageCanvas1("res/high_score_week.png",0,0,693,558,"share",function(){i.fillStyle="#00c777",i.font="180px "+a,i.textBaseline="middle",i.textAlign="center",i.fillText(e.score||0,356.5,.68*558),!!t&&t(n.canvas)})}if("rank"==e.type){i.fillStyle="white",i.fillRect(0,0,693,558);var n=this,o=r.default.getMyUserInfo();n._drawImageCanvas1(o.headimg,305.5,279,102,102,"share",function(){n._drawImageCanvas1("res/high_rank.png",0,0,693,558,"share",function(){i.fillStyle="#00c777",i.font="60px "+a,i.textBaseline="middle",i.textAlign="center",i.fillText(e.score||5678,356.5,.8*558),!!t&&t(n.canvas)})})}}},{key:"_smallReat",value:function(){for(var e=this.context,t=["red","blue","green","yellow","skyblue"],i=0;i<t.length;i++){e.fillStyle=t[i];for(var n=0;n<5;n++)e.fillRect(553*Math.random(),691*Math.random(),15,15)}}},{key:"_drawImageCanvas",value:function(e,t,i,n,r,o,a){var s=new Image,l=this;s.onload=function(){l.context.drawImage(s,t-n/2,i-r/2,n,r),!!a&&a(l.canvas)},s.onerror=function(){!!a&&a(l.canvas)},s.src=e}},{key:"_drawImageCanvas1",value:function(e,t,i,n,r,o,a){"/0"!=e&&"/96"!=e&&"/64"!=e&&e||(e="res/ava.png");var s=new Image,l=this;s.onload=function(){l.context.drawImage(s,t,i,n,r),!!a&&a(l.canvas)},s.onerror=function(){!!a&&a(l.canvas)},s.src=e}}]),e}();t.default=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,this.model=this.game.gameModel,this.full2D=this.game.full2D,this.name="friendRankList"}return n(e,[{key:"show",value:function(){this.full2D.showFriendRankList({week_best_score:this.model.weekBestScore})}},{key:"hide",value:function(){this.full2D.hide2D()}}]),e}();t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,this.model=this.game.gameModel,this.full2D=this.game.full2D,this.name="singleSettlementPgae"}return n(e,[{key:"show",value:function(e){var t=0;e&&(t=e.banType||0);var i=this.model.currentScore,n=this.model.getHighestScore(),r=this.model.startTime,o=this.model.weekBestScore,a=this.game.historyTimes.getTimes();this.full2D||this.game.handleWxOnError({message:"can not find full 2D gameOverPage",stack:""}),this.full2D&&this.full2D.showGameOverPage({score:i,highest_score:n,start_time:r,week_best_score:o,game_cnt:a,banType:t})}},{key:"hide",value:function(){this.full2D.hide2D()}}]),e}();t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,this.model=this.game.gameModel,this.full2D=this.game.full2D,this.UI=this.game.UI,this.viewer=this.game.viewer,this.name="game"}return n(e,[{key:"show",value:function(){var e=this.model.is_from_wn,t=this.model.firstBlood;e||this.game.guider||(t?this.viewer.lookers.showLookers({avaImg:!1,icon:!0,wording:!0}):this.viewer.open()),this.UI.showScore(),this.UI.scoreText.obj.position.y=21,this.UI.scoreText.obj.position.x=-13,this.UI.scoreText.changeStyle({textAlign:"left"})}},{key:"hide",value:function(){this.viewer.close(),this.UI.hideScore()}},{key:"hideLookersShare",value:function(){this.model.firstBlood&&(this.model.setFirstBlood(!1),this.viewer.open())}}]),e}();t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,this.model=this.game.gameModel,this.full2D=this.game.full2D,this.name="startPage"}return n(e,[{key:"show",value:function(e){this.full2D||this.game.handleWxOnError({message:"can not find full 2D",stack:""}),this.full2D&&this.full2D.showStartPage(e)}},{key:"hide",value:function(){this.full2D.hide2D()}}]),e}();t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,null,[{key:"frameReport",value:function(e,t){var i=0;switch(e){case"iPhone5":i=1;break;case"iPhone5s":i=2;break;case"iPhone6":i=3;break;case"iPhone6s":i=4;break;case"iPhone6Plus":i=5;break;case"iPhone6sPlus":i=6;break;case"iPhone7":i=7;break;case"iPhone7s":i=8;break;case"iPhone7Plus":i=9;break;case"iPhone7sPlus":i=10;break;case"iPhone8":i=11;break;case"iPhone8Plus":i=12;break;case"iPhoneX":i=13}(new Image).src="https://mp.weixin.qq.com/mp/jsmonitor?idkey=58121_"+3*i+"_"+t+";58121_"+(3*i+1)+"_1&t="+Math.random()}}]),e}();t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._drag=t,this._dragLog=Math.log(t),this._x=0,this._v=0,this._startTime=0}return n(e,[{key:"set",value:function(e,t){this._x=e,this._v=t,this._startTime=(new Date).getTime()}},{key:"x",value:function(e){void 0===e&&(e=((new Date).getTime()-this._startTime)/1e3);var t;return t=e===this._dt&&this._powDragDt?this._powDragDt:this._powDragDt=Math.pow(this._drag,e),this._dt=e,this._x+this._v*t/this._dragLog-this._v/this._dragLog}},{key:"dx",value:function(e){void 0===e&&(e=((new Date).getTime()-this._startTime)/1e3);var t;return t=e===this._dt&&this._powDragDt?this._powDragDt:this._powDragDt=Math.pow(this._drag,e),this._dt=e,this._v*t}},{key:"done",value:function(){return Math.abs(this.dx())<3}}]),e}();t.default=r},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=n(i(66)),a=n(i(68)),s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._extent=t,this._friction=new o.default(.01),this._spring=new a.default(1,90,20),this._startTime=0,this._springing=!1,this._springOffset=0}return r(e,[{key:"set",value:function(e,t){this._friction.set(e,t),e>0&&t>=0?(this._springOffset=0,this._springing=!0,this._spring.snap(e),this._spring.setEnd(0)):e<-this._extent&&t<=0?(this._springOffset=0,this._springing=!0,this._spring.snap(e),this._spring.setEnd(-this._extent)):this._springing=!1,this._startTime=(new Date).getTime()}},{key:"x",value:function(e){if(!this._startTime)return 0;if(e||(e=((new Date).getTime()-this._startTime)/1e3),this._springing)return this._spring.x()+this._springOffset;var t=this._friction.x(e),i=this.dx(e);return t<-this._extent&&i<=0&&(this._springing=!0,this._spring.setEnd(0,i),t<-this._extent?this._springOffset=-this._extent:this._springOffset=0,t=this._spring.x()+this._springOffset),t}},{key:"dx",value:function(e){var t=0;return t=this._lastTime===e?this._lastDx:this._springing?this._spring.dx(e):this._friction.dx(e),this._lastTime=e,this._lastDx=t,t}},{key:"done",value:function(){return this._springing?this._spring.done():this._friction.done()}}]),e}();t.default=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(){function e(t,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._m=t,this._k=i,this._c=n,this._solution=null,this._endPosition=0,this._startTime=0}return n(e,[{key:"_solve",value:function(e,t){var i=this._c,n=this._m,r=this._k,o=i*i-4*n*r;if(0==o){var a=e,s=t/((u=-i/(2*n))*e);return{x:function(e){return(a+s*e)*Math.pow(Math.E,u*e)},dx:function(e){var t=Math.pow(Math.E,u*e);return u*(a+s*e)*t+s*t}}}if(o>0){var l=(-i-Math.sqrt(o))/(2*n),c=(-i+Math.sqrt(o))/(2*n),a=e-(s=(t-l*e)/(c-l));return{x:function(e){var t,i;return e===this._t&&(t=this._powER1T,i=this._powER2T),this._t=e,t||(t=this._powER1T=Math.pow(Math.E,l*e)),i||(i=this._powER2T=Math.pow(Math.E,c*e)),a*t+s*i},dx:function(e){var t,i;return e===this._t&&(t=this._powER1T,i=this._powER2T),this._t=e,t||(t=this._powER1T=Math.pow(Math.E,l*e)),i||(i=this._powER2T=Math.pow(Math.E,c*e)),a*l*t+s*c*i}}}var h=Math.sqrt(4*n*r-i*i)/(2*n),u=-i/2*n,a=e,s=(t-u*e)/h;return{x:function(e){return Math.pow(Math.E,u*e)*(a*Math.cos(h*e)+s*Math.sin(h*e))},dx:function(e){var t=Math.pow(Math.E,u*e),i=Math.cos(h*e),n=Math.sin(h*e);return t*(s*h*i-a*h*n)+u*t*(s*n+a*i)}}}},{key:"x",value:function(e){return void 0==e&&(e=((new Date).getTime()-this._startTime)/1e3),this._solution?this._endPosition+this._solution.x(e):0}},{key:"dx",value:function(e){return void 0==e&&(e=((new Date).getTime()-this._startTime)/1e3),this._solution?this._solution.dx(e):0}},{key:"setEnd",value:function(e,t,i){if(i||(i=(new Date).getTime()),e!=this._endPosition||!this.almostZero(t,.4)){t=t||0;var n=this._endPosition;this._solution&&(this.almostZero(t,.4)&&(t=this._solution.dx((i-this._startTime)/1e3)),n=this._solution.x((i-this._startTime)/1e3),this.almostZero(t,.4)&&(t=0),this.almostZero(n,.4)&&(n=0),n+=this._endPosition),this._solution&&this.almostZero(n-e,.4)&&this.almostZero(t,.4)||(this._endPosition=e,this._solution=this._solve(n-this._endPosition,t),this._startTime=i)}}},{key:"snap",value:function(e){this._startTime=(new Date).getTime(),this._endPosition=e,this._solution={x:function(){return 0},dx:function(){return 0}}}},{key:"done",value:function(e){return e||(e=(new Date).getTime()),this.almostEqual(this.x(),this._endPosition,.4)&&this.almostZero(this.dx(),.4)}},{key:"almostEqual",value:function(e,t,i){return e>t-i&&e<t+i}},{key:"almostZero",value:function(e,t){return this.almostEqual(e,0,t)}}]),e}();t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.encrypt=function(e,t){var t=t.slice(0,16),i=n.default.enc.Utf8.parse(t),r=n.default.enc.Utf8.parse(t),o=e;o=JSON.stringify(o);var a=n.default.AES.encrypt(o,i,{iv:r,mode:n.default.mode.CBC,padding:n.default.pad.Pkcs7});return a=a.toString()};var n=function(e){return e&&e.__esModule?e:{default:e}}(i(43))}]); 
 			}); 	require("game.js");
 	